<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-4.18.0-80.el8_ntb | oosTech.com</title>
  <meta name="description" content="&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;NTB Drivers&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; NTB (Non-Transparent Bridge) is a type of PCI-Express bridge chip that connectsthe separate memory systems of two or more computers to the same PCI-Expressfabric. Exi">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-4.18.0-80.el8_ntb">
<meta property="og:url" content="http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_ntb/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;NTB Drivers&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; NTB (Non-Transparent Bridge) is a type of PCI-Express bridge chip that connectsthe separate memory systems of two or more computers to the same PCI-Expressfabric. Exi">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-02-18T16:00:00.000Z">
<meta property="article:modified_time" content="2021-02-18T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_ntb/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a><span class="category-list-count">830</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_devices/" class="title">Kernel-2.6.32-573.12.1.el6_devices</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3c509/" class="title">Kernel-3.10.0-957.el7_3c509</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#NTB-Core-Driver-ntb"><span class="toc-number">1.</span> <span class="toc-text">NTB Core Driver (ntb)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NTB-Client-Drivers"><span class="toc-number">2.</span> <span class="toc-text">NTB Client Drivers</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NTB-Typical-client-driver-implementation"><span class="toc-number">2.1.</span> <span class="toc-text">NTB Typical client driver implementation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTB-Transport-Client-ntb-transport-and-NTB-Netdev-ntb-netdev"><span class="toc-number">2.2.</span> <span class="toc-text">NTB Transport Client (ntb_transport) and NTB Netdev (ntb_netdev)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTB-Ping-Pong-Test-Client-ntb-pingpong"><span class="toc-number">2.3.</span> <span class="toc-text">NTB Ping Pong Test Client (ntb_pingpong)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTB-Tool-Test-Client-ntb-tool"><span class="toc-number">2.4.</span> <span class="toc-text">NTB Tool Test Client (ntb_tool)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#to-set-scratchpads-4-and-7-to-0x123-and-0xabc-respectively"><span class="toc-number">3.</span> <span class="toc-text">to set scratchpads 4 and 7 to 0x123 and 0xabc, respectively).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NTB-Hardware-Drivers"><span class="toc-number">4.</span> <span class="toc-text">NTB Hardware Drivers</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NTB-Intel-Hardware-Driver-ntb-hw-intel"><span class="toc-number">4.1.</span> <span class="toc-text">NTB Intel Hardware Driver (ntb_hw_intel)</span></a></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-4.18.0-80.el8_ntb" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-4.18.0-80.el8_ntb
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/02/19/Kernel-4.18.0-80.el8_ntb/" class="article-date">
	 published: <time datetime="2021-02-18T16:00:00.000Z" itemprop="datePublished">2021-02-19</time>
	</a>
</span>

        
	<a href="/2021/02/19/Kernel-4.18.0-80.el8_ntb/" class="article-date">
	   updated: <time datetime="2021-02-18T16:00:00.000Z" itemprop="dateUpdated">2021-02-19</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/02/19/Kernel-4.18.0-80.el8_ntb/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>===========<br>NTB Drivers<br>===========</p>
<p>NTB (Non-Transparent Bridge) is a type of PCI-Express bridge chip that connects<br>the separate memory systems of two or more computers to the same PCI-Express<br>fabric. Existing NTB hardware supports a common feature set: doorbell<br>registers and memory translation windows, as well as non common features like<br>scratchpad and message registers. Scratchpad registers are read-and-writable<br>registers that are accessible from either side of the device, so that peers can<br>exchange a small amount of information at a fixed address. Message registers can<br>be utilized for the same purpose. Additionally they are provided with with<br>special status bits to make sure the information isn’t rewritten by another<br>peer. Doorbell registers provide a way for peers to send interrupt events.<br>Memory windows allow translated read and write access to the peer memory.</p>
<h1 id="NTB-Core-Driver-ntb"><a href="#NTB-Core-Driver-ntb" class="headerlink" title="NTB Core Driver (ntb)"></a>NTB Core Driver (ntb)</h1><p>The NTB core driver defines an api wrapping the common feature set, and allows<br>clients interested in NTB features to discover NTB the devices supported by<br>hardware drivers.  The term “client” is used here to mean an upper layer<br>component making use of the NTB api.  The term “driver,” or “hardware driver,”<br>is used here to mean a driver for a specific vendor and model of NTB hardware.</p>
<h1 id="NTB-Client-Drivers"><a href="#NTB-Client-Drivers" class="headerlink" title="NTB Client Drivers"></a>NTB Client Drivers</h1><p>NTB client drivers should register with the NTB core driver.  After<br>registering, the client probe and remove functions will be called appropriately<br>as ntb hardware, or hardware drivers, are inserted and removed.  The<br>registration uses the Linux Device framework, so it should feel familiar to<br>anyone who has written a pci driver.</p>
<h2 id="NTB-Typical-client-driver-implementation"><a href="#NTB-Typical-client-driver-implementation" class="headerlink" title="NTB Typical client driver implementation"></a>NTB Typical client driver implementation</h2><p>Primary purpose of NTB is to share some peace of memory between at least two<br>systems. So the NTB device features like Scratchpad/Message registers are<br>mainly used to perform the proper memory window initialization. Typically<br>there are two types of memory window interfaces supported by the NTB API:<br>inbound translation configured on the local ntb port and outbound translation<br>configured by the peer, on the peer ntb port. The first type is<br>depicted on the next figure</p>
<p>Inbound translation:<br> Memory:              Local NTB Port:      Peer NTB Port:      Peer MMIO:</p>
<hr>
<p> | dma-mapped |-ntb_mw_set_trans(addr)  |<br> | memory     |        _v____________   |   <strong><strong><strong>__</strong></strong></strong><br> | (addr)     |&lt;======| MW xlat addr |&lt;====| MW base addr |&lt;== memory-mapped IO<br> |————|       |————–|  |  |————–|</p>
<p>So typical scenario of the first type memory window initialization looks:</p>
<ol>
<li>allocate a memory region, 2) put translated address to NTB config,</li>
<li>somehow notify a peer device of performed initialization, 4) peer device<br>maps corresponding outbound memory window so to have access to the shared<br>memory region.</li>
</ol>
<p>The second type of interface, that implies the shared windows being<br>initialized by a peer device, is depicted on the figure:</p>
<p>Outbound translation:<br> Memory:        Local NTB Port:    Peer NTB Port:      Peer MMIO:</p>
<hr>
<p> | dma-mapped |                |   | MW base addr |&lt;== memory-mapped IO<br> | memory     |                |   |————–|<br> | (addr)     |&lt;===================| MW xlat addr |&lt;-ntb_peer_mw_set_trans(addr)<br> |————|                |   |————–|</p>
<p>Typical scenario of the second type interface initialization would be:</p>
<ol>
<li>allocate a memory region, 2) somehow deliver a translated address to a peer<br>device, 3) peer puts the translated address to NTB config, 4) peer device maps<br>outbound memory window so to have access to the shared memory region.</li>
</ol>
<p>As one can see the described scenarios can be combined in one portable<br>algorithm.<br> Local device:</p>
<ol>
<li>Allocate memory for a shared window</li>
<li>Initialize memory window by translated address of the allocated region<br>(it may fail if local memory window initialization is unsupported)</li>
<li>Send the translated address and memory window index to a peer device<br>Peer device:</li>
<li>Initialize memory window with retrieved address of the allocated<br>by another device memory region (it may fail if peer memory window<br>initialization is unsupported)</li>
<li>Map outbound memory window</li>
</ol>
<p>In accordance with this scenario, the NTB Memory Window API can be used as<br>follows:<br> Local device:</p>
<ol>
<li>ntb_mw_count(pidx) - retrieve number of memory ranges, which can<br>be allocated for memory windows between local device and peer device<br>of port with specified index.</li>
<li>ntb_get_align(pidx, midx) - retrieve parameters restricting the<br>shared memory region alignment and size. Then memory can be properly<br>allocated.</li>
<li>Allocate physically contiguous memory region in compliance with<br>restrictions retrieved in 2).</li>
<li>ntb_mw_set_trans(pidx, midx) - try to set translation address of<br>the memory window with specified index for the defined peer device<br>(it may fail if local translated address setting is not supported)</li>
<li>Send translated base address (usually together with memory window<br>number) to the peer device using, for instance, scratchpad or message<br>registers.<br>Peer device:</li>
<li>ntb_peer_mw_set_trans(pidx, midx) - try to set received from other<br>device (related to pidx) translated address for specified memory<br>window. It may fail if retrieved address, for instance, exceeds<br>maximum possible address or isn’t properly aligned.</li>
<li>ntb_peer_mw_get_addr(widx) - retrieve MMIO address to map the memory<br>window so to have an access to the shared memory.</li>
</ol>
<p>Also it is worth to note, that method ntb_mw_count(pidx) should return the<br>same value as ntb_peer_mw_count() on the peer with port index - pidx.</p>
<h2 id="NTB-Transport-Client-ntb-transport-and-NTB-Netdev-ntb-netdev"><a href="#NTB-Transport-Client-ntb-transport-and-NTB-Netdev-ntb-netdev" class="headerlink" title="NTB Transport Client (ntb_transport) and NTB Netdev (ntb_netdev)"></a>NTB Transport Client (ntb_transport) and NTB Netdev (ntb_netdev)</h2><p>The primary client for NTB is the Transport client, used in tandem with NTB<br>Netdev.  These drivers function together to create a logical link to the peer,<br>across the ntb, to exchange packets of network data.  The Transport client<br>establishes a logical link to the peer, and creates queue pairs to exchange<br>messages and data.  The NTB Netdev then creates an ethernet device using a<br>Transport queue pair.  Network data is copied between socket buffers and the<br>Transport queue pair buffer.  The Transport client may be used for other things<br>besides Netdev, however no other applications have yet been written.</p>
<h2 id="NTB-Ping-Pong-Test-Client-ntb-pingpong"><a href="#NTB-Ping-Pong-Test-Client-ntb-pingpong" class="headerlink" title="NTB Ping Pong Test Client (ntb_pingpong)"></a>NTB Ping Pong Test Client (ntb_pingpong)</h2><p>The Ping Pong test client serves as a demonstration to exercise the doorbell<br>and scratchpad registers of NTB hardware, and as an example simple NTB client.<br>Ping Pong enables the link when started, waits for the NTB link to come up, and<br>then proceeds to read and write the doorbell scratchpad registers of the NTB.<br>The peers interrupt each other using a bit mask of doorbell bits, which is<br>shifted by one in each round, to test the behavior of multiple doorbell bits<br>and interrupt vectors.  The Ping Pong driver also reads the first local<br>scratchpad, and writes the value plus one to the first peer scratchpad, each<br>round before writing the peer doorbell register.</p>
<p>Module Parameters:</p>
<ul>
<li>unsafe - Some hardware has known issues with scratchpad and doorbell<br>  registers.  By default, Ping Pong will not attempt to exercise such<br>  hardware.  You may override this behavior at your own risk by setting<br>  unsafe=1.</li>
<li>delay_ms - Specify the delay between receiving a doorbell<br>  interrupt event and setting the peer doorbell register for the next<br>  round.</li>
<li>init_db - Specify the doorbell bits to start new series of rounds.  A new<br>  series begins once all the doorbell bits have been shifted out of<br>  range.</li>
<li>dyndbg - It is suggested to specify dyndbg=+p when loading this module, and<br>  then to observe debugging output on the console.</li>
</ul>
<h2 id="NTB-Tool-Test-Client-ntb-tool"><a href="#NTB-Tool-Test-Client-ntb-tool" class="headerlink" title="NTB Tool Test Client (ntb_tool)"></a>NTB Tool Test Client (ntb_tool)</h2><p>The Tool test client serves for debugging, primarily, ntb hardware and drivers.<br>The Tool provides access through debugfs for reading, setting, and clearing the<br>NTB doorbell, and reading and writing scratchpads.</p>
<p>The Tool does not currently have any module parameters.</p>
<p>Debugfs Files:</p>
<ul>
<li><em>debugfs</em>/ntb_tool/<em>hw</em>/<br>  A directory in debugfs will be created for each<br>  NTB device probed by the tool.  This directory is shortened to <em>hw</em><br>  below.</li>
<li><em>hw</em>/db<br>  This file is used to read, set, and clear the local doorbell.  Not<br>  all operations may be supported by all hardware.  To read the doorbell,<br>  read the file.  To set the doorbell, write <code>s</code> followed by the bits to<br>  set (eg: <code>echo &#39;s 0x0101&#39; &gt; db</code>).  To clear the doorbell, write <code>c</code><br>  followed by the bits to clear.</li>
<li><em>hw</em>/mask<br>  This file is used to read, set, and clear the local doorbell mask.<br>  See <em>db</em> for details.</li>
<li><em>hw</em>/peer_db<br>  This file is used to read, set, and clear the peer doorbell.<br>  See <em>db</em> for details.</li>
<li><em>hw</em>/peer_mask<br>  This file is used to read, set, and clear the peer doorbell<br>  mask.  See <em>db</em> for details.</li>
<li><em>hw</em>/spad<br>  This file is used to read and write local scratchpads.  To read<br>  the values of all scratchpads, read the file.  To write values, write a<br>  series of pairs of scratchpad number and value<br>  (eg: <code>echo &#39;4 0x123 7 0xabc&#39; &gt; spad</code><h1 id="to-set-scratchpads-4-and-7-to-0x123-and-0xabc-respectively"><a href="#to-set-scratchpads-4-and-7-to-0x123-and-0xabc-respectively" class="headerlink" title="to set scratchpads 4 and 7 to 0x123 and 0xabc, respectively)."></a>to set scratchpads <code>4</code> and <code>7</code> to <code>0x123</code> and <code>0xabc</code>, respectively).</h1></li>
<li><em>hw</em>/peer_spad<br>  This file is used to read and write peer scratchpads.  See<br>  <em>spad</em> for details.</li>
</ul>
<h1 id="NTB-Hardware-Drivers"><a href="#NTB-Hardware-Drivers" class="headerlink" title="NTB Hardware Drivers"></a>NTB Hardware Drivers</h1><p>NTB hardware drivers should register devices with the NTB core driver.  After<br>registering, clients probe and remove functions will be called.</p>
<h2 id="NTB-Intel-Hardware-Driver-ntb-hw-intel"><a href="#NTB-Intel-Hardware-Driver-ntb-hw-intel" class="headerlink" title="NTB Intel Hardware Driver (ntb_hw_intel)"></a>NTB Intel Hardware Driver (ntb_hw_intel)</h2><p>The Intel hardware driver supports NTB on Xeon and Atom CPUs.</p>
<p>Module Parameters:</p>
<ul>
<li>b2b_mw_idx<br>  If the peer ntb is to be accessed via a memory window, then use<br>  this memory window to access the peer ntb.  A value of zero or positive<br>  starts from the first mw idx, and a negative value starts from the last<br>  mw idx.  Both sides MUST set the same value here!  The default value is<br>  <code>-1</code>.</li>
<li>b2b_mw_share<br>  If the peer ntb is to be accessed via a memory window, and if<br>  the memory window is large enough, still allow the client to use the<br>  second half of the memory window for address translation to the peer.</li>
<li>xeon_b2b_usd_bar2_addr64<br>  If using B2B topology on Xeon hardware, use<br>  this 64 bit address on the bus between the NTB devices for the window<br>  at BAR2, on the upstream side of the link.</li>
<li>xeon_b2b_usd_bar4_addr64 - See <em>xeon_b2b_bar2_addr64</em>.</li>
<li>xeon_b2b_usd_bar4_addr32 - See <em>xeon_b2b_bar2_addr64</em>.</li>
<li>xeon_b2b_usd_bar5_addr32 - See <em>xeon_b2b_bar2_addr64</em>.</li>
<li>xeon_b2b_dsd_bar2_addr64 - See <em>xeon_b2b_bar2_addr64</em>.</li>
<li>xeon_b2b_dsd_bar4_addr64 - See <em>xeon_b2b_bar2_addr64</em>.</li>
<li>xeon_b2b_dsd_bar4_addr32 - See <em>xeon_b2b_bar2_addr64</em>.</li>
<li>xeon_b2b_dsd_bar5_addr32 - See <em>xeon_b2b_bar2_addr64</em>.</li>
</ul>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_ntb/" title="Kernel-4.18.0-80.el8_ntb" target="_blank" rel="external">http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_ntb/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/02/19/Kernel-4.18.0-80.el8_nspire/" title="Kernel-4.18.0-80.el8_nspire"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/02/19/Kernel-4.18.0-80.el8_ntc_thermistor/" title="Kernel-4.18.0-80.el8_ntc_thermistor"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>