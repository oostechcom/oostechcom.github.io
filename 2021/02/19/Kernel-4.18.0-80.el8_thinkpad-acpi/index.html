<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-4.18.0-80.el8_thinkpad-acpi | oosTech.com</title>
  <meta name="description" content="ThinkPad ACPI Extras Driver                          Version 0.25                     October 16th,  2013             Borislav Deianov &lt;borislav@users.sf.net&gt;          Henrique de Morae">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-4.18.0-80.el8_thinkpad-acpi">
<meta property="og:url" content="http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_thinkpad-acpi/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="ThinkPad ACPI Extras Driver                          Version 0.25                     October 16th,  2013             Borislav Deianov &lt;borislav@users.sf.net&gt;          Henrique de Morae">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-02-18T16:00:00.000Z">
<meta property="article:modified_time" content="2021-02-18T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_thinkpad-acpi/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_mpc5200/" class="title">Kernel-3.10.0-957.el7_mpc5200</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_6pack/" class="title">Kernel-3.10.0-957.el7_6pack</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Status"><span class="toc-number">1.</span> <span class="toc-text">Status</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Installation"><span class="toc-number">2.</span> <span class="toc-text">Installation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Features"><span class="toc-number">3.</span> <span class="toc-text">Features</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Driver-version"><span class="toc-number">4.</span> <span class="toc-text">Driver version</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sysfs-interface-version"><span class="toc-number">5.</span> <span class="toc-text">Sysfs interface version</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hot-keys"><span class="toc-number">6.</span> <span class="toc-text">Hot keys</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Non-hotkey-ACPI-HKEY-event-map"><span class="toc-number">7.</span> <span class="toc-text">Non hotkey ACPI HKEY event map:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bluetooth"><span class="toc-number">8.</span> <span class="toc-text">Bluetooth</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Video-output-control-%E2%80%93-proc-acpi-ibm-video"><span class="toc-number">9.</span> <span class="toc-text">Video output control – &#x2F;proc&#x2F;acpi&#x2F;ibm&#x2F;video</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ThinkLight-control"><span class="toc-number">10.</span> <span class="toc-text">ThinkLight control</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CMOS-UCMS-control"><span class="toc-number">11.</span> <span class="toc-text">CMOS&#x2F;UCMS control</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LED-control"><span class="toc-number">12.</span> <span class="toc-text">LED control</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ACPI-sounds-%E2%80%93-proc-acpi-ibm-beep"><span class="toc-number">13.</span> <span class="toc-text">ACPI sounds – &#x2F;proc&#x2F;acpi&#x2F;ibm&#x2F;beep</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Temperature-sensors"><span class="toc-number">14.</span> <span class="toc-text">Temperature sensors</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EXPERIMENTAL-Embedded-controller-register-dump"><span class="toc-number">15.</span> <span class="toc-text">EXPERIMENTAL: Embedded controller register dump</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LCD-brightness-control"><span class="toc-number">16.</span> <span class="toc-text">LCD brightness control</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Volume-control-Console-Audio-control"><span class="toc-number">17.</span> <span class="toc-text">Volume control (Console Audio control)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fan-control-and-monitoring-fan-speed-fan-enable-disable"><span class="toc-number">18.</span> <span class="toc-text">Fan control and monitoring: fan speed, fan enable&#x2F;disable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WAN"><span class="toc-number">19.</span> <span class="toc-text">WAN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EXPERIMENTAL-UWB"><span class="toc-number">20.</span> <span class="toc-text">EXPERIMENTAL: UWB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Adaptive-keyboard"><span class="toc-number">21.</span> <span class="toc-text">Adaptive keyboard</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Multiple-Commands-Module-Parameters"><span class="toc-number">22.</span> <span class="toc-text">Multiple Commands, Module Parameters</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enabling-debugging-output"><span class="toc-number">23.</span> <span class="toc-text">Enabling debugging output</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Force-loading-of-module"><span class="toc-number">24.</span> <span class="toc-text">Force loading of module</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-4.18.0-80.el8_thinkpad-acpi" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-4.18.0-80.el8_thinkpad-acpi
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/02/19/Kernel-4.18.0-80.el8_thinkpad-acpi/" class="article-date">
	 published: <time datetime="2021-02-18T16:00:00.000Z" itemprop="datePublished">2021-02-19</time>
	</a>
</span>

        
	<a href="/2021/02/19/Kernel-4.18.0-80.el8_thinkpad-acpi/" class="article-date">
	   updated: <time datetime="2021-02-18T16:00:00.000Z" itemprop="dateUpdated">2021-02-19</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/02/19/Kernel-4.18.0-80.el8_thinkpad-acpi/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <pre><code>         ThinkPad ACPI Extras Driver

                        Version 0.25
                    October 16th,  2013

           Borislav Deianov &lt;borislav@users.sf.net&gt;
         Henrique de Moraes Holschuh &lt;hmh@hmh.eng.br&gt;
                  http://ibm-acpi.sf.net/
</code></pre>
<p>This is a Linux driver for the IBM and Lenovo ThinkPad laptops. It<br>supports various features of these laptops which are accessible<br>through the ACPI and ACPI EC framework, but not otherwise fully<br>supported by the generic Linux ACPI drivers.</p>
<p>This driver used to be named ibm-acpi until kernel 2.6.21 and release<br>0.13-20070314.  It used to be in the drivers/acpi tree, but it was<br>moved to the drivers/misc tree and renamed to thinkpad-acpi for kernel<br>2.6.22, and release 0.14.  It was moved to drivers/platform/x86 for<br>kernel 2.6.29 and release 0.22.</p>
<p>The driver is named “thinkpad-acpi”.  In some places, like module<br>names and log messages, “thinkpad_acpi” is used because of userspace<br>issues.</p>
<p>“tpacpi” is used as a shorthand where “thinkpad-acpi” would be too<br>long due to length limitations on some Linux kernel versions.</p>
<h2 id="Status"><a href="#Status" class="headerlink" title="Status"></a>Status</h2><p>The features currently supported are the following (see below for<br>detailed description):</p>
<pre><code>- Fn key combinations
- Bluetooth enable and disable
- video output switching, expansion control
- ThinkLight on and off
- CMOS/UCMS control
- LED control
- ACPI sounds
- temperature sensors
- Experimental: embedded controller register dump
- LCD brightness control
- Volume control
- Fan control and monitoring: fan speed, fan enable/disable
- WAN enable and disable
- UWB enable and disable
</code></pre>
<p>A compatibility table by model and feature is maintained on the web<br>site, <a target="_blank" rel="noopener" href="http://ibm-acpi.sf.net/">http://ibm-acpi.sf.net/</a>. I appreciate any success or failure<br>reports, especially if they add to or correct the compatibility table.<br>Please include the following information in your report:</p>
<pre><code>- ThinkPad model name
- a copy of your ACPI tables, using the &quot;acpidump&quot; utility
- a copy of the output of dmidecode, with serial numbers
  and UUIDs masked off
- which driver features work and which don&#39;t
- the observed behavior of non-working features
</code></pre>
<p>Any other comments or patches are also more than welcome.</p>
<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><p>If you are compiling this driver as included in the Linux kernel<br>sources, look for the CONFIG_THINKPAD_ACPI Kconfig option.<br>It is located on the menu path: “Device Drivers” -&gt; “X86 Platform<br>Specific Device Drivers” -&gt; “ThinkPad ACPI Laptop Extras”.</p>
<h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><p>The driver exports two different interfaces to userspace, which can be<br>used to access the features it provides.  One is a legacy procfs-based<br>interface, which will be removed at some time in the future.  The other<br>is a new sysfs-based interface which is not complete yet.</p>
<p>The procfs interface creates the /proc/acpi/ibm directory.  There is a<br>file under that directory for each feature it supports.  The procfs<br>interface is mostly frozen, and will change very little if at all: it<br>will not be extended to add any new functionality in the driver, instead<br>all new functionality will be implemented on the sysfs interface.</p>
<p>The sysfs interface tries to blend in the generic Linux sysfs subsystems<br>and classes as much as possible.  Since some of these subsystems are not<br>yet ready or stabilized, it is expected that this interface will change,<br>and any and all userspace programs must deal with it.</p>
<p>Notes about the sysfs interface:</p>
<p>Unlike what was done with the procfs interface, correctness when talking<br>to the sysfs interfaces will be enforced, as will correctness in the<br>thinkpad-acpi’s implementation of sysfs interfaces.</p>
<p>Also, any bugs in the thinkpad-acpi sysfs driver code or in the<br>thinkpad-acpi’s implementation of the sysfs interfaces will be fixed for<br>maximum correctness, even if that means changing an interface in<br>non-compatible ways.  As these interfaces mature both in the kernel and<br>in thinkpad-acpi, such changes should become quite rare.</p>
<p>Applications interfacing to the thinkpad-acpi sysfs interfaces must<br>follow all sysfs guidelines and correctly process all errors (the sysfs<br>interface makes extensive use of errors).  File descriptors and open /<br>close operations to the sysfs inodes must also be properly implemented.</p>
<p>The version of thinkpad-acpi’s sysfs interface is exported by the driver<br>as a driver attribute (see below).</p>
<p>Sysfs driver attributes are on the driver’s sysfs attribute space,<br>for 2.6.23+ this is /sys/bus/platform/drivers/thinkpad_acpi/ and<br>/sys/bus/platform/drivers/thinkpad_hwmon/</p>
<p>Sysfs device attributes are on the thinkpad_acpi device sysfs attribute<br>space, for 2.6.23+ this is /sys/devices/platform/thinkpad_acpi/.</p>
<p>Sysfs device attributes for the sensors and fan are on the<br>thinkpad_hwmon device’s sysfs attribute space, but you should locate it<br>looking for a hwmon device with the name attribute of “thinkpad”, or<br>better yet, through libsensors. For 4.14+ sysfs attributes were moved to the<br>hwmon device (/sys/bus/platform/devices/thinkpad_hwmon/hwmon/hwmon? or<br>/sys/class/hwmon/hwmon?).</p>
<h2 id="Driver-version"><a href="#Driver-version" class="headerlink" title="Driver version"></a>Driver version</h2><p>procfs: /proc/acpi/ibm/driver<br>sysfs driver attribute: version</p>
<p>The driver name and version. No commands can be written to this file.</p>
<h2 id="Sysfs-interface-version"><a href="#Sysfs-interface-version" class="headerlink" title="Sysfs interface version"></a>Sysfs interface version</h2><p>sysfs driver attribute: interface_version</p>
<p>Version of the thinkpad-acpi sysfs interface, as an unsigned long<br>(output in hex format: 0xAAAABBCC), where:<br>    AAAA - major revision<br>    BB - minor revision<br>    CC - bugfix revision</p>
<p>The sysfs interface version changelog for the driver can be found at the<br>end of this document.  Changes to the sysfs interface done by the kernel<br>subsystems are not documented here, nor are they tracked by this<br>attribute.</p>
<p>Changes to the thinkpad-acpi sysfs interface are only considered<br>non-experimental when they are submitted to Linux mainline, at which<br>point the changes in this interface are documented and interface_version<br>may be updated.  If you are using any thinkpad-acpi features not yet<br>sent to mainline for merging, you do so on your own risk: these features<br>may disappear, or be implemented in a different and incompatible way by<br>the time they are merged in Linux mainline.</p>
<p>Changes that are backwards-compatible by nature (e.g. the addition of<br>attributes that do not change the way the other attributes work) do not<br>always warrant an update of interface_version.  Therefore, one must<br>expect that an attribute might not be there, and deal with it properly<br>(an attribute not being there <em>is</em> a valid way to make it clear that a<br>feature is not available in sysfs).</p>
<h2 id="Hot-keys"><a href="#Hot-keys" class="headerlink" title="Hot keys"></a>Hot keys</h2><p>procfs: /proc/acpi/ibm/hotkey<br>sysfs device attribute: hotkey_*</p>
<p>In a ThinkPad, the ACPI HKEY handler is responsible for communicating<br>some important events and also keyboard hot key presses to the operating<br>system.  Enabling the hotkey functionality of thinkpad-acpi signals the<br>firmware that such a driver is present, and modifies how the ThinkPad<br>firmware will behave in many situations.</p>
<p>The driver enables the HKEY (“hot key”) event reporting automatically<br>when loaded, and disables it when it is removed.</p>
<p>The driver will report HKEY events in the following format:</p>
<pre><code>ibm/hotkey HKEY 00000080 0000xxxx
</code></pre>
<p>Some of these events refer to hot key presses, but not all of them.</p>
<p>The driver will generate events over the input layer for hot keys and<br>radio switches, and over the ACPI netlink layer for other events.  The<br>input layer support accepts the standard IOCTLs to remap the keycodes<br>assigned to each hot key.</p>
<p>The hot key bit mask allows some control over which hot keys generate<br>events.  If a key is “masked” (bit set to 0 in the mask), the firmware<br>will handle it.  If it is “unmasked”, it signals the firmware that<br>thinkpad-acpi would prefer to handle it, if the firmware would be so<br>kind to allow it (and it often doesn’t!).</p>
<p>Not all bits in the mask can be modified.  Not all bits that can be<br>modified do anything.  Not all hot keys can be individually controlled<br>by the mask.  Some models do not support the mask at all.  The behaviour<br>of the mask is, therefore, highly dependent on the ThinkPad model.</p>
<p>The driver will filter out any unmasked hotkeys, so even if the firmware<br>doesn’t allow disabling an specific hotkey, the driver will not report<br>events for unmasked hotkeys.</p>
<p>Note that unmasking some keys prevents their default behavior.  For<br>example, if Fn+F5 is unmasked, that key will no longer enable/disable<br>Bluetooth by itself in firmware.</p>
<p>Note also that not all Fn key combinations are supported through ACPI<br>depending on the ThinkPad model and firmware version.  On those<br>ThinkPads, it is still possible to support some extra hotkeys by<br>polling the “CMOS NVRAM” at least 10 times per second.  The driver<br>attempts to enables this functionality automatically when required.</p>
<p>procfs notes:</p>
<p>The following commands can be written to the /proc/acpi/ibm/hotkey file:</p>
<pre><code>echo 0xffffffff &gt; /proc/acpi/ibm/hotkey -- enable all hot keys
echo 0 &gt; /proc/acpi/ibm/hotkey -- disable all possible hot keys
... any other 8-hex-digit mask ...
echo reset &gt; /proc/acpi/ibm/hotkey -- restore the recommended mask
</code></pre>
<p>The following commands have been deprecated and will cause the kernel<br>to log a warning:</p>
<pre><code>echo enable &gt; /proc/acpi/ibm/hotkey -- does nothing
echo disable &gt; /proc/acpi/ibm/hotkey -- returns an error
</code></pre>
<p>The procfs interface does not support NVRAM polling control.  So as to<br>maintain maximum bug-to-bug compatibility, it does not report any masks,<br>nor does it allow one to manipulate the hot key mask when the firmware<br>does not support masks at all, even if NVRAM polling is in use.</p>
<p>sysfs notes:</p>
<pre><code>hotkey_bios_enabled:
    DEPRECATED, WILL BE REMOVED SOON.

    Returns 0.

hotkey_bios_mask:
    DEPRECATED, DON&#39;T USE, WILL BE REMOVED IN THE FUTURE.

    Returns the hot keys mask when thinkpad-acpi was loaded.
    Upon module unload, the hot keys mask will be restored
    to this value.   This is always 0x80c, because those are
    the hotkeys that were supported by ancient firmware
    without mask support.

hotkey_enable:
    DEPRECATED, WILL BE REMOVED SOON.

    0: returns -EPERM
    1: does nothing

hotkey_mask:
    bit mask to enable reporting (and depending on
    the firmware, ACPI event generation) for each hot key
    (see above).  Returns the current status of the hot keys
    mask, and allows one to modify it.

hotkey_all_mask:
    bit mask that should enable event reporting for all
    supported hot keys, when echoed to hotkey_mask above.
    Unless you know which events need to be handled
    passively (because the firmware *will* handle them
    anyway), do *not* use hotkey_all_mask.  Use
    hotkey_recommended_mask, instead. You have been warned.

hotkey_recommended_mask:
    bit mask that should enable event reporting for all
    supported hot keys, except those which are always
    handled by the firmware anyway.  Echo it to
    hotkey_mask above, to use.  This is the default mask
    used by the driver.

hotkey_source_mask:
    bit mask that selects which hot keys will the driver
    poll the NVRAM for.  This is auto-detected by the driver
    based on the capabilities reported by the ACPI firmware,
    but it can be overridden at runtime.

    Hot keys whose bits are set in hotkey_source_mask are
    polled for in NVRAM, and reported as hotkey events if
    enabled in hotkey_mask.  Only a few hot keys are
    available through CMOS NVRAM polling.

    Warning: when in NVRAM mode, the volume up/down/mute
    keys are synthesized according to changes in the mixer,
    which uses a single volume up or volume down hotkey
    press to unmute, as per the ThinkPad volume mixer user
    interface.  When in ACPI event mode, volume up/down/mute
    events are reported by the firmware and can behave
    differently (and that behaviour changes with firmware
    version -- not just with firmware models -- as well as
    OSI(Linux) state).

hotkey_poll_freq:
    frequency in Hz for hot key polling. It must be between
    0 and 25 Hz.  Polling is only carried out when strictly
    needed.

    Setting hotkey_poll_freq to zero disables polling, and
    will cause hot key presses that require NVRAM polling
    to never be reported.

    Setting hotkey_poll_freq too low may cause repeated
    pressings of the same hot key to be misreported as a
    single key press, or to not even be detected at all.
    The recommended polling frequency is 10Hz.

hotkey_radio_sw:
    If the ThinkPad has a hardware radio switch, this
    attribute will read 0 if the switch is in the &quot;radios
    disabled&quot; position, and 1 if the switch is in the
    &quot;radios enabled&quot; position.

    This attribute has poll()/select() support.

hotkey_tablet_mode:
    If the ThinkPad has tablet capabilities, this attribute
    will read 0 if the ThinkPad is in normal mode, and
    1 if the ThinkPad is in tablet mode.

    This attribute has poll()/select() support.

wakeup_reason:
    Set to 1 if the system is waking up because the user
    requested a bay ejection.  Set to 2 if the system is
    waking up because the user requested the system to
    undock.  Set to zero for normal wake-ups or wake-ups
    due to unknown reasons.

    This attribute has poll()/select() support.

wakeup_hotunplug_complete:
    Set to 1 if the system was waken up because of an
    undock or bay ejection request, and that request
    was successfully completed.  At this point, it might
    be useful to send the system back to sleep, at the
    user&#39;s choice.  Refer to HKEY events 0x4003 and
    0x3003, below.

    This attribute has poll()/select() support.
</code></pre>
<p>input layer notes:</p>
<p>A Hot key is mapped to a single input layer EV_KEY event, possibly<br>followed by an EV_MSC MSC_SCAN event that shall contain that key’s scan<br>code.  An EV_SYN event will always be generated to mark the end of the<br>event block.</p>
<p>Do not use the EV_MSC MSC_SCAN events to process keys.  They are to be<br>used as a helper to remap keys, only.  They are particularly useful when<br>remapping KEY_UNKNOWN keys.</p>
<p>The events are available in an input device, with the following id:</p>
<pre><code>Bus:        BUS_HOST
vendor:        0x1014 (PCI_VENDOR_ID_IBM)  or
        0x17aa (PCI_VENDOR_ID_LENOVO)
product:    0x5054 (&quot;TP&quot;)
version:    0x4101
</code></pre>
<p>The version will have its LSB incremented if the keymap changes in a<br>backwards-compatible way.  The MSB shall always be 0x41 for this input<br>device.  If the MSB is not 0x41, do not use the device as described in<br>this section, as it is either something else (e.g. another input device<br>exported by a thinkpad driver, such as HDAPS) or its functionality has<br>been changed in a non-backwards compatible way.</p>
<p>Adding other event types for other functionalities shall be considered a<br>backwards-compatible change for this input device.</p>
<p>Thinkpad-acpi Hot Key event map (version 0x4101):</p>
<p>ACPI    Scan<br>event    code    Key        Notes</p>
<p>0x1001    0x00    FN+F1        -</p>
<p>0x1002    0x01    FN+F2        IBM: battery (rare)<br>                Lenovo: Screen lock</p>
<p>0x1003    0x02    FN+F3        Many IBM models always report<br>                this hot key, even with hot keys<br>                disabled or with Fn+F3 masked<br>                off<br>                IBM: screen lock, often turns<br>                off the ThinkLight as side-effect<br>                Lenovo: battery</p>
<p>0x1004    0x03    FN+F4        Sleep button (ACPI sleep button<br>                semantics, i.e. sleep-to-RAM).<br>                It always generates some kind<br>                of event, either the hot key<br>                event or an ACPI sleep button<br>                event. The firmware may<br>                refuse to generate further FN+F4<br>                key presses until a S3 or S4 ACPI<br>                sleep cycle is performed or some<br>                time passes.</p>
<p>0x1005    0x04    FN+F5        Radio.  Enables/disables<br>                the internal Bluetooth hardware<br>                and W-WAN card if left in control<br>                of the firmware.  Does not affect<br>                the WLAN card.<br>                Should be used to turn on/off all<br>                radios (Bluetooth+W-WAN+WLAN),<br>                really.</p>
<p>0x1006    0x05    FN+F6        -</p>
<p>0x1007    0x06    FN+F7        Video output cycle.<br>                Do you feel lucky today?</p>
<p>0x1008    0x07    FN+F8        IBM: toggle screen expand<br>                Lenovo: configure UltraNav,<br>                or toggle screen expand</p>
<p>0x1009    0x08    FN+F9        -<br>    ..    ..        ..<br>0x100B    0x0A    FN+F11        -</p>
<p>0x100C    0x0B    FN+F12        Sleep to disk.  You are always<br>                supposed to handle it yourself,<br>                either through the ACPI event,<br>                or through a hotkey event.<br>                The firmware may refuse to<br>                generate further FN+F12 key<br>                press events until a S3 or S4<br>                ACPI sleep cycle is performed,<br>                or some time passes.</p>
<p>0x100D    0x0C    FN+BACKSPACE    -<br>0x100E    0x0D    FN+INSERT    -<br>0x100F    0x0E    FN+DELETE    -</p>
<p>0x1010    0x0F    FN+HOME        Brightness up.  This key is<br>                always handled by the firmware<br>                in IBM ThinkPads, even when<br>                unmasked.  Just leave it alone.<br>                For Lenovo ThinkPads with a new<br>                BIOS, it has to be handled either<br>                by the ACPI OSI, or by userspace.<br>                The driver does the right thing,<br>                never mess with this.<br>0x1011    0x10    FN+END        Brightness down.  See brightness<br>                up for details.</p>
<p>0x1012    0x11    FN+PGUP        ThinkLight toggle.  This key is<br>                always handled by the firmware,<br>                even when unmasked.</p>
<p>0x1013    0x12    FN+PGDOWN    -</p>
<p>0x1014    0x13    FN+SPACE    Zoom key</p>
<p>0x1015    0x14    VOLUME UP    Internal mixer volume up. This<br>                key is always handled by the<br>                firmware, even when unmasked.<br>                NOTE: Lenovo seems to be changing<br>                this.<br>0x1016    0x15    VOLUME DOWN    Internal mixer volume up. This<br>                key is always handled by the<br>                firmware, even when unmasked.<br>                NOTE: Lenovo seems to be changing<br>                this.<br>0x1017    0x16    MUTE        Mute internal mixer. This<br>                key is always handled by the<br>                firmware, even when unmasked.</p>
<p>0x1018    0x17    THINKPAD    ThinkPad/Access IBM/Lenovo key</p>
<p>0x1019    0x18    unknown<br>..    ..    ..<br>0x1020    0x1F    unknown</p>
<p>The ThinkPad firmware does not allow one to differentiate when most hot<br>keys are pressed or released (either that, or we don’t know how to, yet).<br>For these keys, the driver generates a set of events for a key press and<br>immediately issues the same set of events for a key release.  It is<br>unknown by the driver if the ThinkPad firmware triggered these events on<br>hot key press or release, but the firmware will do it for either one, not<br>both.</p>
<p>If a key is mapped to KEY_RESERVED, it generates no input events at all.<br>If a key is mapped to KEY_UNKNOWN, it generates an input event that<br>includes an scan code.  If a key is mapped to anything else, it will<br>generate input device EV_KEY events.</p>
<p>In addition to the EV_KEY events, thinkpad-acpi may also issue EV_SW<br>events for switches:</p>
<p>SW_RFKILL_ALL    T60 and later hardware rfkill rocker switch<br>SW_TABLET_MODE    Tablet ThinkPads HKEY events 0x5009 and 0x500A</p>
<h2 id="Non-hotkey-ACPI-HKEY-event-map"><a href="#Non-hotkey-ACPI-HKEY-event-map" class="headerlink" title="Non hotkey ACPI HKEY event map:"></a>Non hotkey ACPI HKEY event map:</h2><p>Events that are never propagated by the driver:</p>
<p>0x2304        System is waking up from suspend to undock<br>0x2305        System is waking up from suspend to eject bay<br>0x2404        System is waking up from hibernation to undock<br>0x2405        System is waking up from hibernation to eject bay<br>0x5001        Lid closed<br>0x5002        Lid opened<br>0x5009        Tablet swivel: switched to tablet mode<br>0x500A        Tablet swivel: switched to normal mode<br>0x5010        Brightness level changed/control event<br>0x6000        KEYBOARD: Numlock key pressed<br>0x6005        KEYBOARD: Fn key pressed (TO BE VERIFIED)<br>0x7000        Radio Switch may have changed state</p>
<p>Events that are propagated by the driver to userspace:</p>
<p>0x2313        ALARM: System is waking up from suspend because<br>        the battery is nearly empty<br>0x2413        ALARM: System is waking up from hibernation because<br>        the battery is nearly empty<br>0x3003        Bay ejection (see 0x2x05) complete, can sleep again<br>0x3006        Bay hotplug request (hint to power up SATA link when<br>        the optical drive tray is ejected)<br>0x4003        Undocked (see 0x2x04), can sleep again<br>0x4010        Docked into hotplug port replicator (non-ACPI dock)<br>0x4011        Undocked from hotplug port replicator (non-ACPI dock)<br>0x500B        Tablet pen inserted into its storage bay<br>0x500C        Tablet pen removed from its storage bay<br>0x6011        ALARM: battery is too hot<br>0x6012        ALARM: battery is extremely hot<br>0x6021        ALARM: a sensor is too hot<br>0x6022        ALARM: a sensor is extremely hot<br>0x6030        System thermal table changed<br>0x6032        Thermal Control command set completion  (DYTC, Windows)<br>0x6040        Nvidia Optimus/AC adapter related (TO BE VERIFIED)<br>0x60C0        X1 Yoga 2016, Tablet mode status changed<br>0x60F0        Thermal Transformation changed (GMTS, Windows)</p>
<p>Battery nearly empty alarms are a last resort attempt to get the<br>operating system to hibernate or shutdown cleanly (0x2313), or shutdown<br>cleanly (0x2413) before power is lost.  They must be acted upon, as the<br>wake up caused by the firmware will have negated most safety nets…</p>
<p>When any of the “too hot” alarms happen, according to Lenovo the user<br>should suspend or hibernate the laptop (and in the case of battery<br>alarms, unplug the AC adapter) to let it cool down.  These alarms do<br>signal that something is wrong, they should never happen on normal<br>operating conditions.</p>
<p>The “extremely hot” alarms are emergencies.  According to Lenovo, the<br>operating system is to force either an immediate suspend or hibernate<br>cycle, or a system shutdown.  Obviously, something is very wrong if this<br>happens.</p>
<p>Brightness hotkey notes:</p>
<p>Don’t mess with the brightness hotkeys in a Thinkpad.  If you want<br>notifications for OSD, use the sysfs backlight class event support.</p>
<p>The driver will issue KEY_BRIGHTNESS_UP and KEY_BRIGHTNESS_DOWN events<br>automatically for the cases were userspace has to do something to<br>implement brightness changes.  When you override these events, you will<br>either fail to handle properly the ThinkPads that require explicit<br>action to change backlight brightness, or the ThinkPads that require<br>that no action be taken to work properly.</p>
<h2 id="Bluetooth"><a href="#Bluetooth" class="headerlink" title="Bluetooth"></a>Bluetooth</h2><p>procfs: /proc/acpi/ibm/bluetooth<br>sysfs device attribute: bluetooth_enable (deprecated)<br>sysfs rfkill class: switch “tpacpi_bluetooth_sw”</p>
<p>This feature shows the presence and current state of a ThinkPad<br>Bluetooth device in the internal ThinkPad CDC slot.</p>
<p>If the ThinkPad supports it, the Bluetooth state is stored in NVRAM,<br>so it is kept across reboots and power-off.</p>
<p>Procfs notes:</p>
<p>If Bluetooth is installed, the following commands can be used:</p>
<pre><code>echo enable &gt; /proc/acpi/ibm/bluetooth
echo disable &gt; /proc/acpi/ibm/bluetooth
</code></pre>
<p>Sysfs notes:</p>
<pre><code>If the Bluetooth CDC card is installed, it can be enabled /
disabled through the &quot;bluetooth_enable&quot; thinkpad-acpi device
attribute, and its current status can also be queried.

enable:
    0: disables Bluetooth / Bluetooth is disabled
    1: enables Bluetooth / Bluetooth is enabled.

Note: this interface has been superseded by the    generic rfkill
class.  It has been deprecated, and it will be removed in year
2010.

rfkill controller switch &quot;tpacpi_bluetooth_sw&quot;: refer to
Documentation/rfkill.txt for details.
</code></pre>
<h2 id="Video-output-control-–-proc-acpi-ibm-video"><a href="#Video-output-control-–-proc-acpi-ibm-video" class="headerlink" title="Video output control – /proc/acpi/ibm/video"></a>Video output control – /proc/acpi/ibm/video</h2><p>This feature allows control over the devices used for video output -<br>LCD, CRT or DVI (if available). The following commands are available:</p>
<pre><code>echo lcd_enable &gt; /proc/acpi/ibm/video
echo lcd_disable &gt; /proc/acpi/ibm/video
echo crt_enable &gt; /proc/acpi/ibm/video
echo crt_disable &gt; /proc/acpi/ibm/video
echo dvi_enable &gt; /proc/acpi/ibm/video
echo dvi_disable &gt; /proc/acpi/ibm/video
echo auto_enable &gt; /proc/acpi/ibm/video
echo auto_disable &gt; /proc/acpi/ibm/video
echo expand_toggle &gt; /proc/acpi/ibm/video
echo video_switch &gt; /proc/acpi/ibm/video
</code></pre>
<p>NOTE: Access to this feature is restricted to processes owning the<br>CAP_SYS_ADMIN capability for safety reasons, as it can interact badly<br>enough with some versions of X.org to crash it.</p>
<p>Each video output device can be enabled or disabled individually.<br>Reading /proc/acpi/ibm/video shows the status of each device.</p>
<p>Automatic video switching can be enabled or disabled.  When automatic<br>video switching is enabled, certain events (e.g. opening the lid,<br>docking or undocking) cause the video output device to change<br>automatically. While this can be useful, it also causes flickering<br>and, on the X40, video corruption. By disabling automatic switching,<br>the flickering or video corruption can be avoided.</p>
<p>The video_switch command cycles through the available video outputs<br>(it simulates the behavior of Fn-F7).</p>
<p>Video expansion can be toggled through this feature. This controls<br>whether the display is expanded to fill the entire LCD screen when a<br>mode with less than full resolution is used. Note that the current<br>video expansion status cannot be determined through this feature.</p>
<p>Note that on many models (particularly those using Radeon graphics<br>chips) the X driver configures the video card in a way which prevents<br>Fn-F7 from working. This also disables the video output switching<br>features of this driver, as it uses the same ACPI methods as<br>Fn-F7. Video switching on the console should still work.</p>
<p>UPDATE: refer to <a target="_blank" rel="noopener" href="https://bugs.freedesktop.org/show_bug.cgi?id=2000">https://bugs.freedesktop.org/show_bug.cgi?id=2000</a></p>
<h2 id="ThinkLight-control"><a href="#ThinkLight-control" class="headerlink" title="ThinkLight control"></a>ThinkLight control</h2><p>procfs: /proc/acpi/ibm/light<br>sysfs attributes: as per LED class, for the “tpacpi::thinklight” LED</p>
<p>procfs notes:</p>
<p>The ThinkLight status can be read and set through the procfs interface.  A<br>few models which do not make the status available will show the ThinkLight<br>status as “unknown”. The available commands are:</p>
<pre><code>echo on  &gt; /proc/acpi/ibm/light
echo off &gt; /proc/acpi/ibm/light
</code></pre>
<p>sysfs notes:</p>
<p>The ThinkLight sysfs interface is documented by the LED class<br>documentation, in Documentation/leds/leds-class.txt.  The ThinkLight LED name<br>is “tpacpi::thinklight”.</p>
<p>Due to limitations in the sysfs LED class, if the status of the ThinkLight<br>cannot be read or if it is unknown, thinkpad-acpi will report it as “off”.<br>It is impossible to know if the status returned through sysfs is valid.</p>
<h2 id="CMOS-UCMS-control"><a href="#CMOS-UCMS-control" class="headerlink" title="CMOS/UCMS control"></a>CMOS/UCMS control</h2><p>procfs: /proc/acpi/ibm/cmos<br>sysfs device attribute: cmos_command</p>
<p>This feature is mostly used internally by the ACPI firmware to keep the legacy<br>CMOS NVRAM bits in sync with the current machine state, and to record this<br>state so that the ThinkPad will retain such settings across reboots.</p>
<p>Some of these commands actually perform actions in some ThinkPad models, but<br>this is expected to disappear more and more in newer models.  As an example, in<br>a T43 and in a X40, commands 12 and 13 still control the ThinkLight state for<br>real, but commands 0 to 2 don’t control the mixer anymore (they have been<br>phased out) and just update the NVRAM.</p>
<p>The range of valid cmos command numbers is 0 to 21, but not all have an<br>effect and the behavior varies from model to model.  Here is the behavior<br>on the X40 (tpb is the ThinkPad Buttons utility):</p>
<pre><code>0 - Related to &quot;Volume down&quot; key press
1 - Related to &quot;Volume up&quot; key press
2 - Related to &quot;Mute on&quot; key press
3 - Related to &quot;Access IBM&quot; key press
4 - Related to &quot;LCD brightness up&quot; key press
5 - Related to &quot;LCD brightness down&quot; key press
11 - Related to &quot;toggle screen expansion&quot; key press/function
12 - Related to &quot;ThinkLight on&quot;
13 - Related to &quot;ThinkLight off&quot;
14 - Related to &quot;ThinkLight&quot; key press (toggle ThinkLight)
</code></pre>
<p>The cmos command interface is prone to firmware split-brain problems, as<br>in newer ThinkPads it is just a compatibility layer.  Do not use it, it is<br>exported just as a debug tool.</p>
<h2 id="LED-control"><a href="#LED-control" class="headerlink" title="LED control"></a>LED control</h2><p>procfs: /proc/acpi/ibm/led<br>sysfs attributes: as per LED class, see below for names</p>
<p>Some of the LED indicators can be controlled through this feature.  On<br>some older ThinkPad models, it is possible to query the status of the<br>LED indicators as well.  Newer ThinkPads cannot query the real status<br>of the LED indicators.</p>
<p>Because misuse of the LEDs could induce an unaware user to perform<br>dangerous actions (like undocking or ejecting a bay device while the<br>buses are still active), or mask an important alarm (such as a nearly<br>empty battery, or a broken battery), access to most LEDs is<br>restricted.</p>
<p>Unrestricted access to all LEDs requires that thinkpad-acpi be<br>compiled with the CONFIG_THINKPAD_ACPI_UNSAFE_LEDS option enabled.<br>Distributions must never enable this option.  Individual users that<br>are aware of the consequences are welcome to enabling it.</p>
<p>Audio mute and microphone mute LEDs are supported, but currently not<br>visible to userspace. They are used by the snd-hda-intel audio driver.</p>
<p>procfs notes:</p>
<p>The available commands are:</p>
<pre><code>echo &#39;&lt;LED number&gt; on&#39; &gt;/proc/acpi/ibm/led
echo &#39;&lt;LED number&gt; off&#39; &gt;/proc/acpi/ibm/led
echo &#39;&lt;LED number&gt; blink&#39; &gt;/proc/acpi/ibm/led
</code></pre>
<p>The <LED number> range is 0 to 15. The set of LEDs that can be<br>controlled varies from model to model. Here is the common ThinkPad<br>mapping:</p>
<pre><code>0 - power
1 - battery (orange)
2 - battery (green)
3 - UltraBase/dock
4 - UltraBay
5 - UltraBase battery slot
6 - (unknown)
7 - standby
8 - dock status 1
9 - dock status 2
10, 11 - (unknown)
12 - thinkvantage
13, 14, 15 - (unknown)
</code></pre>
<p>All of the above can be turned on and off and can be made to blink.</p>
<p>sysfs notes:</p>
<p>The ThinkPad LED sysfs interface is described in detail by the LED class<br>documentation, in Documentation/leds/leds-class.txt.</p>
<p>The LEDs are named (in LED ID order, from 0 to 12):<br>“tpacpi::power”, “tpacpi:orange:batt”, “tpacpi:green:batt”,<br>“tpacpi::dock_active”, “tpacpi::bay_active”, “tpacpi::dock_batt”,<br>“tpacpi::unknown_led”, “tpacpi::standby”, “tpacpi::dock_status1”,<br>“tpacpi::dock_status2”, “tpacpi::unknown_led2”, “tpacpi::unknown_led3”,<br>“tpacpi::thinkvantage”.</p>
<p>Due to limitations in the sysfs LED class, if the status of the LED<br>indicators cannot be read due to an error, thinkpad-acpi will report it as<br>a brightness of zero (same as LED off).</p>
<p>If the thinkpad firmware doesn’t support reading the current status,<br>trying to read the current LED brightness will just return whatever<br>brightness was last written to that attribute.</p>
<p>These LEDs can blink using hardware acceleration.  To request that a<br>ThinkPad indicator LED should blink in hardware accelerated mode, use the<br>“timer” trigger, and leave the delay_on and delay_off parameters set to<br>zero (to request hardware acceleration autodetection).</p>
<p>LEDs that are known not to exist in a given ThinkPad model are not<br>made available through the sysfs interface.  If you have a dock and you<br>notice there are LEDs listed for your ThinkPad that do not exist (and<br>are not in the dock), or if you notice that there are missing LEDs,<br>a report to <a href="mailto:&#x69;&#x62;&#x6d;&#x2d;&#97;&#99;&#112;&#x69;&#x2d;&#x64;&#x65;&#118;&#101;&#108;&#64;&#108;&#x69;&#x73;&#x74;&#115;&#46;&#x73;&#111;&#x75;&#114;&#99;&#x65;&#x66;&#x6f;&#114;&#103;&#101;&#46;&#110;&#x65;&#x74;">&#x69;&#x62;&#x6d;&#x2d;&#97;&#99;&#112;&#x69;&#x2d;&#x64;&#x65;&#118;&#101;&#108;&#64;&#108;&#x69;&#x73;&#x74;&#115;&#46;&#x73;&#111;&#x75;&#114;&#99;&#x65;&#x66;&#x6f;&#114;&#103;&#101;&#46;&#110;&#x65;&#x74;</a> is appreciated.</p>
<h2 id="ACPI-sounds-–-proc-acpi-ibm-beep"><a href="#ACPI-sounds-–-proc-acpi-ibm-beep" class="headerlink" title="ACPI sounds – /proc/acpi/ibm/beep"></a>ACPI sounds – /proc/acpi/ibm/beep</h2><p>The BEEP method is used internally by the ACPI firmware to provide<br>audible alerts in various situations. This feature allows the same<br>sounds to be triggered manually.</p>
<p>The commands are non-negative integer numbers:</p>
<pre><code>echo &lt;number&gt; &gt;/proc/acpi/ibm/beep
</code></pre>
<p>The valid <number> range is 0 to 17. Not all numbers trigger sounds<br>and the sounds vary from model to model. Here is the behavior on the<br>X40:</p>
<pre><code>0 - stop a sound in progress (but use 17 to stop 16)
2 - two beeps, pause, third beep (&quot;low battery&quot;)
3 - single beep
4 - high, followed by low-pitched beep (&quot;unable&quot;)
5 - single beep
6 - very high, followed by high-pitched beep (&quot;AC/DC&quot;)
7 - high-pitched beep
9 - three short beeps
10 - very long beep
12 - low-pitched beep
15 - three high-pitched beeps repeating constantly, stop with 0
16 - one medium-pitched beep repeating constantly, stop with 17
17 - stop 16
</code></pre>
<h2 id="Temperature-sensors"><a href="#Temperature-sensors" class="headerlink" title="Temperature sensors"></a>Temperature sensors</h2><p>procfs: /proc/acpi/ibm/thermal<br>sysfs device attributes: (hwmon “thinkpad”) temp*_input</p>
<p>Most ThinkPads include six or more separate temperature sensors but only<br>expose the CPU temperature through the standard ACPI methods.  This<br>feature shows readings from up to eight different sensors on older<br>ThinkPads, and up to sixteen different sensors on newer ThinkPads.</p>
<p>For example, on the X40, a typical output may be:<br>temperatures:   42 42 45 41 36 -128 33 -128</p>
<p>On the T43/p, a typical output may be:<br>temperatures:   48 48 36 52 38 -128 31 -128 48 52 48 -128 -128 -128 -128 -128</p>
<p>The mapping of thermal sensors to physical locations varies depending on<br>system-board model (and thus, on ThinkPad model).</p>
<p><a target="_blank" rel="noopener" href="http://thinkwiki.org/wiki/Thermal_Sensors">http://thinkwiki.org/wiki/Thermal_Sensors</a> is a public wiki page that<br>tries to track down these locations for various models.</p>
<p>Most (newer?) models seem to follow this pattern:</p>
<p>1:  CPU<br>2:  (depends on model)<br>3:  (depends on model)<br>4:  GPU<br>5:  Main battery: main sensor<br>6:  Bay battery: main sensor<br>7:  Main battery: secondary sensor<br>8:  Bay battery: secondary sensor<br>9-15: (depends on model)</p>
<p>For the R51 (source: Thomas Gruber):<br>2:  Mini-PCI<br>3:  Internal HDD</p>
<p>For the T43, T43/p (source: Shmidoax/Thinkwiki.org)<br><a target="_blank" rel="noopener" href="http://thinkwiki.org/wiki/Thermal_Sensors#ThinkPad_T43.2C_T43p">http://thinkwiki.org/wiki/Thermal_Sensors#ThinkPad_T43.2C_T43p</a><br>2:  System board, left side (near PCMCIA slot), reported as HDAPS temp<br>3:  PCMCIA slot<br>9:  MCH (northbridge) to DRAM Bus<br>10: Clock-generator, mini-pci card and ICH (southbridge), under Mini-PCI<br>    card, under touchpad<br>11: Power regulator, underside of system board, below F2 key</p>
<p>The A31 has a very atypical layout for the thermal sensors<br>(source: Milos Popovic, <a target="_blank" rel="noopener" href="http://thinkwiki.org/wiki/Thermal_Sensors#ThinkPad_A31">http://thinkwiki.org/wiki/Thermal_Sensors#ThinkPad_A31</a>)<br>1:  CPU<br>2:  Main Battery: main sensor<br>3:  Power Converter<br>4:  Bay Battery: main sensor<br>5:  MCH (northbridge)<br>6:  PCMCIA/ambient<br>7:  Main Battery: secondary sensor<br>8:  Bay Battery: secondary sensor</p>
<p>Procfs notes:<br>    Readings from sensors that are not available return -128.<br>    No commands can be written to this file.</p>
<p>Sysfs notes:<br>    Sensors that are not available return the ENXIO error.  This<br>    status may change at runtime, as there are hotplug thermal<br>    sensors, like those inside the batteries and docks.</p>
<pre><code>thinkpad-acpi thermal sensors are reported through the hwmon
subsystem, and follow all of the hwmon guidelines at
Documentation/hwmon.
</code></pre>
<h2 id="EXPERIMENTAL-Embedded-controller-register-dump"><a href="#EXPERIMENTAL-Embedded-controller-register-dump" class="headerlink" title="EXPERIMENTAL: Embedded controller register dump"></a>EXPERIMENTAL: Embedded controller register dump</h2><p>This feature is not included in the thinkpad driver anymore.<br>Instead the EC can be accessed through /sys/kernel/debug/ec with<br>a userspace tool which can be found here:<br><a href="ftp://ftp.suse.com/pub/people/trenn/sources/ec">ftp://ftp.suse.com/pub/people/trenn/sources/ec</a></p>
<p>Use it to determine the register holding the fan<br>speed on some models. To do that, do the following:<br>    - make sure the battery is fully charged<br>    - make sure the fan is running<br>    - use above mentioned tool to read out the EC</p>
<p>Often fan and temperature values vary between<br>readings. Since temperatures don’t change vary fast, you can take<br>several quick dumps to eliminate them.</p>
<p>You can use a similar method to figure out the meaning of other<br>embedded controller registers - e.g. make sure nothing else changes<br>except the charging or discharging battery to determine which<br>registers contain the current battery capacity, etc. If you experiment<br>with this, do send me your results (including some complete dumps with<br>a description of the conditions when they were taken.)</p>
<h2 id="LCD-brightness-control"><a href="#LCD-brightness-control" class="headerlink" title="LCD brightness control"></a>LCD brightness control</h2><p>procfs: /proc/acpi/ibm/brightness<br>sysfs backlight device “thinkpad_screen”</p>
<p>This feature allows software control of the LCD brightness on ThinkPad<br>models which don’t have a hardware brightness slider.</p>
<p>It has some limitations: the LCD backlight cannot be actually turned<br>on or off by this interface, it just controls the backlight brightness<br>level.</p>
<p>On IBM (and some of the earlier Lenovo) ThinkPads, the backlight control<br>has eight brightness levels, ranging from 0 to 7.  Some of the levels<br>may not be distinct.  Later Lenovo models that implement the ACPI<br>display backlight brightness control methods have 16 levels, ranging<br>from 0 to 15.</p>
<p>For IBM ThinkPads, there are two interfaces to the firmware for direct<br>brightness control, EC and UCMS (or CMOS).  To select which one should be<br>used, use the brightness_mode module parameter: brightness_mode=1 selects<br>EC mode, brightness_mode=2 selects UCMS mode, brightness_mode=3 selects EC<br>mode with NVRAM backing (so that brightness changes are remembered across<br>shutdown/reboot).</p>
<p>The driver tries to select which interface to use from a table of<br>defaults for each ThinkPad model.  If it makes a wrong choice, please<br>report this as a bug, so that we can fix it.</p>
<p>Lenovo ThinkPads only support brightness_mode=2 (UCMS).</p>
<p>When display backlight brightness controls are available through the<br>standard ACPI interface, it is best to use it instead of this direct<br>ThinkPad-specific interface.  The driver will disable its native<br>backlight brightness control interface if it detects that the standard<br>ACPI interface is available in the ThinkPad.</p>
<p>If you want to use the thinkpad-acpi backlight brightness control<br>instead of the generic ACPI video backlight brightness control for some<br>reason, you should use the acpi_backlight=vendor kernel parameter.</p>
<p>The brightness_enable module parameter can be used to control whether<br>the LCD brightness control feature will be enabled when available.<br>brightness_enable=0 forces it to be disabled.  brightness_enable=1<br>forces it to be enabled when available, even if the standard ACPI<br>interface is also available.</p>
<p>Procfs notes:</p>
<pre><code>The available commands are:

echo up   &gt;/proc/acpi/ibm/brightness
echo down &gt;/proc/acpi/ibm/brightness
echo &#39;level &lt;level&gt;&#39; &gt;/proc/acpi/ibm/brightness
</code></pre>
<p>Sysfs notes:</p>
<p>The interface is implemented through the backlight sysfs class, which is<br>poorly documented at this time.</p>
<p>Locate the thinkpad_screen device under /sys/class/backlight, and inside<br>it there will be the following attributes:</p>
<pre><code>max_brightness:
    Reads the maximum brightness the hardware can be set to.
    The minimum is always zero.

actual_brightness:
    Reads what brightness the screen is set to at this instant.

brightness:
    Writes request the driver to change brightness to the
    given value.  Reads will tell you what brightness the
    driver is trying to set the display to when &quot;power&quot; is set
    to zero and the display has not been dimmed by a kernel
    power management event.

power:
    power management mode, where 0 is &quot;display on&quot;, and 1 to 3
    will dim the display backlight to brightness level 0
    because thinkpad-acpi cannot really turn the backlight
    off.  Kernel power management events can temporarily
    increase the current power management level, i.e. they can
    dim the display.
</code></pre>
<p>WARNING:</p>
<pre><code>Whatever you do, do NOT ever call thinkpad-acpi backlight-level change
interface and the ACPI-based backlight level change interface
(available on newer BIOSes, and driven by the Linux ACPI video driver)
at the same time.  The two will interact in bad ways, do funny things,
and maybe reduce the life of the backlight lamps by needlessly kicking
its level up and down at every change.
</code></pre>
<h2 id="Volume-control-Console-Audio-control"><a href="#Volume-control-Console-Audio-control" class="headerlink" title="Volume control (Console Audio control)"></a>Volume control (Console Audio control)</h2><p>procfs: /proc/acpi/ibm/volume<br>ALSA: “ThinkPad Console Audio Control”, default ID: “ThinkPadEC”</p>
<p>NOTE: by default, the volume control interface operates in read-only<br>mode, as it is supposed to be used for on-screen-display purposes.<br>The read/write mode can be enabled through the use of the<br>“volume_control=1” module parameter.</p>
<p>NOTE: distros are urged to not enable volume_control by default, this<br>should be done by the local admin only.  The ThinkPad UI is for the<br>console audio control to be done through the volume keys only, and for<br>the desktop environment to just provide on-screen-display feedback.<br>Software volume control should be done only in the main AC97/HDA<br>mixer.</p>
<p>About the ThinkPad Console Audio control:</p>
<p>ThinkPads have a built-in amplifier and muting circuit that drives the<br>console headphone and speakers.  This circuit is after the main AC97<br>or HDA mixer in the audio path, and under exclusive control of the<br>firmware.</p>
<p>ThinkPads have three special hotkeys to interact with the console<br>audio control: volume up, volume down and mute.</p>
<p>It is worth noting that the normal way the mute function works (on<br>ThinkPads that do not have a “mute LED”) is:</p>
<ol>
<li><p>Press mute to mute.  It will <em>always</em> mute, you can press it as<br>many times as you want, and the sound will remain mute.</p>
</li>
<li><p>Press either volume key to unmute the ThinkPad (it will <em>not</em><br>change the volume, it will just unmute).</p>
</li>
</ol>
<p>This is a very superior design when compared to the cheap software-only<br>mute-toggle solution found on normal consumer laptops:  you can be<br>absolutely sure the ThinkPad will not make noise if you press the mute<br>button, no matter the previous state.</p>
<p>The IBM ThinkPads, and the earlier Lenovo ThinkPads have variable-gain<br>amplifiers driving the speakers and headphone output, and the firmware<br>also handles volume control for the headphone and speakers on these<br>ThinkPads without any help from the operating system (this volume<br>control stage exists after the main AC97 or HDA mixer in the audio<br>path).</p>
<p>The newer Lenovo models only have firmware mute control, and depend on<br>the main HDA mixer to do volume control (which is done by the operating<br>system).  In this case, the volume keys are filtered out for unmute<br>key press (there are some firmware bugs in this area) and delivered as<br>normal key presses to the operating system (thinkpad-acpi is not<br>involved).</p>
<p>The ThinkPad-ACPI volume control:</p>
<p>The preferred way to interact with the Console Audio control is the<br>ALSA interface.</p>
<p>The legacy procfs interface allows one to read the current state,<br>and if volume control is enabled, accepts the following commands:</p>
<pre><code>echo up   &gt;/proc/acpi/ibm/volume
echo down &gt;/proc/acpi/ibm/volume
echo mute &gt;/proc/acpi/ibm/volume
echo unmute &gt;/proc/acpi/ibm/volume
echo &#39;level &lt;level&gt;&#39; &gt;/proc/acpi/ibm/volume
</code></pre>
<p>The <level> number range is 0 to 14 although not all of them may be<br>distinct. To unmute the volume after the mute command, use either the<br>up or down command (the level command will not unmute the volume), or<br>the unmute command.</p>
<p>You can use the volume_capabilities parameter to tell the driver<br>whether your thinkpad has volume control or mute-only control:<br>volume_capabilities=1 for mixers with mute and volume control,<br>volume_capabilities=2 for mixers with only mute control.</p>
<p>If the driver misdetects the capabilities for your ThinkPad model,<br>please report this to <a href="mailto:&#x69;&#x62;&#x6d;&#x2d;&#x61;&#x63;&#112;&#x69;&#45;&#x64;&#101;&#118;&#101;&#x6c;&#x40;&#108;&#105;&#115;&#116;&#x73;&#x2e;&#x73;&#111;&#117;&#114;&#99;&#x65;&#x66;&#111;&#x72;&#x67;&#101;&#x2e;&#x6e;&#x65;&#116;">&#x69;&#x62;&#x6d;&#x2d;&#x61;&#x63;&#112;&#x69;&#45;&#x64;&#101;&#118;&#101;&#x6c;&#x40;&#108;&#105;&#115;&#116;&#x73;&#x2e;&#x73;&#111;&#117;&#114;&#99;&#x65;&#x66;&#111;&#x72;&#x67;&#101;&#x2e;&#x6e;&#x65;&#116;</a>, so that we<br>can update the driver.</p>
<p>There are two strategies for volume control.  To select which one<br>should be used, use the volume_mode module parameter: volume_mode=1<br>selects EC mode, and volume_mode=3 selects EC mode with NVRAM backing<br>(so that volume/mute changes are remembered across shutdown/reboot).</p>
<p>The driver will operate in volume_mode=3 by default. If that does not<br>work well on your ThinkPad model, please report this to<br><a href="mailto:&#105;&#98;&#x6d;&#45;&#97;&#x63;&#x70;&#105;&#x2d;&#100;&#x65;&#118;&#x65;&#108;&#x40;&#x6c;&#x69;&#x73;&#x74;&#115;&#46;&#115;&#111;&#x75;&#x72;&#x63;&#101;&#102;&#x6f;&#x72;&#103;&#101;&#46;&#x6e;&#x65;&#116;">&#105;&#98;&#x6d;&#45;&#97;&#x63;&#x70;&#105;&#x2d;&#100;&#x65;&#118;&#x65;&#108;&#x40;&#x6c;&#x69;&#x73;&#x74;&#115;&#46;&#115;&#111;&#x75;&#x72;&#x63;&#101;&#102;&#x6f;&#x72;&#103;&#101;&#46;&#x6e;&#x65;&#116;</a>.</p>
<p>The driver supports the standard ALSA module parameters.  If the ALSA<br>mixer is disabled, the driver will disable all volume functionality.</p>
<h2 id="Fan-control-and-monitoring-fan-speed-fan-enable-disable"><a href="#Fan-control-and-monitoring-fan-speed-fan-enable-disable" class="headerlink" title="Fan control and monitoring: fan speed, fan enable/disable"></a>Fan control and monitoring: fan speed, fan enable/disable</h2><p>procfs: /proc/acpi/ibm/fan<br>sysfs device attributes: (hwmon “thinkpad”) fan1_input, pwm1,<br>              pwm1_enable, fan2_input<br>sysfs hwmon driver attributes: fan_watchdog</p>
<p>NOTE NOTE NOTE: fan control operations are disabled by default for<br>safety reasons.  To enable them, the module parameter “fan_control=1”<br>must be given to thinkpad-acpi.</p>
<p>This feature attempts to show the current fan speed, control mode and<br>other fan data that might be available.  The speed is read directly<br>from the hardware registers of the embedded controller.  This is known<br>to work on later R, T, X and Z series ThinkPads but may show a bogus<br>value on other models.</p>
<p>Some Lenovo ThinkPads support a secondary fan.  This fan cannot be<br>controlled separately, it shares the main fan control.</p>
<p>Fan levels:</p>
<p>Most ThinkPad fans work in “levels” at the firmware interface.  Level 0<br>stops the fan.  The higher the level, the higher the fan speed, although<br>adjacent levels often map to the same fan speed.  7 is the highest<br>level, where the fan reaches the maximum recommended speed.</p>
<p>Level “auto” means the EC changes the fan level according to some<br>internal algorithm, usually based on readings from the thermal sensors.</p>
<p>There is also a “full-speed” level, also known as “disengaged” level.<br>In this level, the EC disables the speed-locked closed-loop fan control,<br>and drives the fan as fast as it can go, which might exceed hardware<br>limits, so use this level with caution.</p>
<p>The fan usually ramps up or down slowly from one speed to another, and<br>it is normal for the EC to take several seconds to react to fan<br>commands.  The full-speed level may take up to two minutes to ramp up to<br>maximum speed, and in some ThinkPads, the tachometer readings go stale<br>while the EC is transitioning to the full-speed level.</p>
<p>WARNING WARNING WARNING: do not leave the fan disabled unless you are<br>monitoring all of the temperature sensor readings and you are ready to<br>enable it if necessary to avoid overheating.</p>
<p>An enabled fan in level “auto” may stop spinning if the EC decides the<br>ThinkPad is cool enough and doesn’t need the extra airflow.  This is<br>normal, and the EC will spin the fan up if the various thermal readings<br>rise too much.</p>
<p>On the X40, this seems to depend on the CPU and HDD temperatures.<br>Specifically, the fan is turned on when either the CPU temperature<br>climbs to 56 degrees or the HDD temperature climbs to 46 degrees.  The<br>fan is turned off when the CPU temperature drops to 49 degrees and the<br>HDD temperature drops to 41 degrees.  These thresholds cannot<br>currently be controlled.</p>
<p>The ThinkPad’s ACPI DSDT code will reprogram the fan on its own when<br>certain conditions are met.  It will override any fan programming done<br>through thinkpad-acpi.</p>
<p>The thinkpad-acpi kernel driver can be programmed to revert the fan<br>level to a safe setting if userspace does not issue one of the procfs<br>fan commands: “enable”, “disable”, “level” or “watchdog”, or if there<br>are no writes to pwm1_enable (or to pwm1 <em>if and only if</em> pwm1_enable is<br>set to 1, manual mode) within a configurable amount of time of up to<br>120 seconds.  This functionality is called fan safety watchdog.</p>
<p>Note that the watchdog timer stops after it enables the fan.  It will be<br>rearmed again automatically (using the same interval) when one of the<br>above mentioned fan commands is received.  The fan watchdog is,<br>therefore, not suitable to protect against fan mode changes made through<br>means other than the “enable”, “disable”, and “level” procfs fan<br>commands, or the hwmon fan control sysfs interface.</p>
<p>Procfs notes:</p>
<p>The fan may be enabled or disabled with the following commands:</p>
<pre><code>echo enable  &gt;/proc/acpi/ibm/fan
echo disable &gt;/proc/acpi/ibm/fan
</code></pre>
<p>Placing a fan on level 0 is the same as disabling it.  Enabling a fan<br>will try to place it in a safe level if it is too slow or disabled.</p>
<p>The fan level can be controlled with the command:</p>
<pre><code>echo &#39;level &lt;level&gt;&#39; &gt; /proc/acpi/ibm/fan
</code></pre>
<p>Where <level> is an integer from 0 to 7, or one of the words “auto” or<br>“full-speed” (without the quotes).  Not all ThinkPads support the “auto”<br>and “full-speed” levels.  The driver accepts “disengaged” as an alias for<br>“full-speed”, and reports it as “disengaged” for backwards<br>compatibility.</p>
<p>On the X31 and X40 (and ONLY on those models), the fan speed can be<br>controlled to a certain degree.  Once the fan is running, it can be<br>forced to run faster or slower with the following command:</p>
<pre><code>echo &#39;speed &lt;speed&gt;&#39; &gt; /proc/acpi/ibm/fan
</code></pre>
<p>The sustainable range of fan speeds on the X40 appears to be from about<br>3700 to about 7350. Values outside this range either do not have any<br>effect or the fan speed eventually settles somewhere in that range.  The<br>fan cannot be stopped or started with this command.  This functionality<br>is incomplete, and not available through the sysfs interface.</p>
<p>To program the safety watchdog, use the “watchdog” command.</p>
<pre><code>echo &#39;watchdog &lt;interval in seconds&gt;&#39; &gt; /proc/acpi/ibm/fan
</code></pre>
<p>If you want to disable the watchdog, use 0 as the interval.</p>
<p>Sysfs notes:</p>
<p>The sysfs interface follows the hwmon subsystem guidelines for the most<br>part, and the exception is the fan safety watchdog.</p>
<p>Writes to any of the sysfs attributes may return the EINVAL error if<br>that operation is not supported in a given ThinkPad or if the parameter<br>is out-of-bounds, and EPERM if it is forbidden.  They may also return<br>EINTR (interrupted system call), and EIO (I/O error while trying to talk<br>to the firmware).</p>
<p>Features not yet implemented by the driver return ENOSYS.</p>
<p>hwmon device attribute pwm1_enable:<br>    0: PWM offline (fan is set to full-speed mode)<br>    1: Manual PWM control (use pwm1 to set fan level)<br>    2: Hardware PWM control (EC “auto” mode)<br>    3: reserved (Software PWM control, not implemented yet)</p>
<pre><code>Modes 0 and 2 are not supported by all ThinkPads, and the
driver is not always able to detect this.  If it does know a
mode is unsupported, it will return -EINVAL.
</code></pre>
<p>hwmon device attribute pwm1:<br>    Fan level, scaled from the firmware values of 0-7 to the hwmon<br>    scale of 0-255.  0 means fan stopped, 255 means highest normal<br>    speed (level 7).</p>
<pre><code>This attribute only commands the fan if pmw1_enable is set to 1
(manual PWM control).
</code></pre>
<p>hwmon device attribute fan1_input:<br>    Fan tachometer reading, in RPM.  May go stale on certain<br>    ThinkPads while the EC transitions the PWM to offline mode,<br>    which can take up to two minutes.  May return rubbish on older<br>    ThinkPads.</p>
<p>hwmon device attribute fan2_input:<br>    Fan tachometer reading, in RPM, for the secondary fan.<br>    Available only on some ThinkPads.  If the secondary fan is<br>    not installed, will always read 0.</p>
<p>hwmon driver attribute fan_watchdog:<br>    Fan safety watchdog timer interval, in seconds.  Minimum is<br>    1 second, maximum is 120 seconds.  0 disables the watchdog.</p>
<p>To stop the fan: set pwm1 to zero, and pwm1_enable to 1.</p>
<p>To start the fan in a safe mode: set pwm1_enable to 2.  If that fails<br>with EINVAL, try to set pwm1_enable to 1 and pwm1 to at least 128 (255<br>would be the safest choice, though).</p>
<h2 id="WAN"><a href="#WAN" class="headerlink" title="WAN"></a>WAN</h2><p>procfs: /proc/acpi/ibm/wan<br>sysfs device attribute: wwan_enable (deprecated)<br>sysfs rfkill class: switch “tpacpi_wwan_sw”</p>
<p>This feature shows the presence and current state of the built-in<br>Wireless WAN device.</p>
<p>If the ThinkPad supports it, the WWAN state is stored in NVRAM,<br>so it is kept across reboots and power-off.</p>
<p>It was tested on a Lenovo ThinkPad X60. It should probably work on other<br>ThinkPad models which come with this module installed.</p>
<p>Procfs notes:</p>
<p>If the W-WAN card is installed, the following commands can be used:</p>
<pre><code>echo enable &gt; /proc/acpi/ibm/wan
echo disable &gt; /proc/acpi/ibm/wan
</code></pre>
<p>Sysfs notes:</p>
<pre><code>If the W-WAN card is installed, it can be enabled /
disabled through the &quot;wwan_enable&quot; thinkpad-acpi device
attribute, and its current status can also be queried.

enable:
    0: disables WWAN card / WWAN card is disabled
    1: enables WWAN card / WWAN card is enabled.

Note: this interface has been superseded by the    generic rfkill
class.  It has been deprecated, and it will be removed in year
2010.

rfkill controller switch &quot;tpacpi_wwan_sw&quot;: refer to
Documentation/rfkill.txt for details.
</code></pre>
<h2 id="EXPERIMENTAL-UWB"><a href="#EXPERIMENTAL-UWB" class="headerlink" title="EXPERIMENTAL: UWB"></a>EXPERIMENTAL: UWB</h2><p>This feature is considered EXPERIMENTAL because it has not been extensively<br>tested and validated in various ThinkPad models yet.  The feature may not<br>work as expected. USE WITH CAUTION! To use this feature, you need to supply<br>the experimental=1 parameter when loading the module.</p>
<p>sysfs rfkill class: switch “tpacpi_uwb_sw”</p>
<p>This feature exports an rfkill controller for the UWB device, if one is<br>present and enabled in the BIOS.</p>
<p>Sysfs notes:</p>
<pre><code>rfkill controller switch &quot;tpacpi_uwb_sw&quot;: refer to
Documentation/rfkill.txt for details.
</code></pre>
<h2 id="Adaptive-keyboard"><a href="#Adaptive-keyboard" class="headerlink" title="Adaptive keyboard"></a>Adaptive keyboard</h2><p>sysfs device attribute: adaptive_kbd_mode</p>
<p>This sysfs attribute controls the keyboard “face” that will be shown on the<br>Lenovo X1 Carbon 2nd gen (2014)’s adaptive keyboard. The value can be read<br>and set.</p>
<p>1 = Home mode<br>2 = Web-browser mode<br>3 = Web-conference mode<br>4 = Function mode<br>5 = Layflat mode</p>
<p>For more details about which buttons will appear depending on the mode, please<br>review the laptop’s user guide:<br><a target="_blank" rel="noopener" href="http://www.lenovo.com/shop/americas/content/user_guides/x1carbon_2_ug_en.pdf">http://www.lenovo.com/shop/americas/content/user_guides/x1carbon_2_ug_en.pdf</a></p>
<h2 id="Multiple-Commands-Module-Parameters"><a href="#Multiple-Commands-Module-Parameters" class="headerlink" title="Multiple Commands, Module Parameters"></a>Multiple Commands, Module Parameters</h2><p>Multiple commands can be written to the proc files in one shot by<br>separating them with commas, for example:</p>
<pre><code>echo enable,0xffff &gt; /proc/acpi/ibm/hotkey
echo lcd_disable,crt_enable &gt; /proc/acpi/ibm/video
</code></pre>
<p>Commands can also be specified when loading the thinkpad-acpi module,<br>for example:</p>
<pre><code>modprobe thinkpad_acpi hotkey=enable,0xffff video=auto_disable
</code></pre>
<h2 id="Enabling-debugging-output"><a href="#Enabling-debugging-output" class="headerlink" title="Enabling debugging output"></a>Enabling debugging output</h2><p>The module takes a debug parameter which can be used to selectively<br>enable various classes of debugging output, for example:</p>
<pre><code> modprobe thinkpad_acpi debug=0xffff
</code></pre>
<p>will enable all debugging output classes.  It takes a bitmask, so<br>to enable more than one output class, just add their values.</p>
<pre><code>Debug bitmask        Description
0x8000            Disclose PID of userspace programs
            accessing some functions of the driver
0x0001            Initialization and probing
0x0002            Removal
0x0004            RF Transmitter control (RFKILL)
            (bluetooth, WWAN, UWB...)
0x0008            HKEY event interface, hotkeys
0x0010            Fan control
0x0020            Backlight brightness
0x0040            Audio mixer/volume control
</code></pre>
<p>There is also a kernel build option to enable more debugging<br>information, which may be necessary to debug driver problems.</p>
<p>The level of debugging information output by the driver can be changed<br>at runtime through sysfs, using the driver attribute debug_level.  The<br>attribute takes the same bitmask as the debug module parameter above.</p>
<h2 id="Force-loading-of-module"><a href="#Force-loading-of-module" class="headerlink" title="Force loading of module"></a>Force loading of module</h2><p>If thinkpad-acpi refuses to detect your ThinkPad, you can try to specify<br>the module parameter force_load=1.  Regardless of whether this works or<br>not, please contact <a href="mailto:&#x69;&#x62;&#109;&#45;&#x61;&#x63;&#112;&#x69;&#x2d;&#x64;&#101;&#x76;&#x65;&#x6c;&#64;&#x6c;&#105;&#x73;&#x74;&#x73;&#x2e;&#115;&#111;&#117;&#114;&#99;&#x65;&#102;&#x6f;&#x72;&#103;&#101;&#46;&#x6e;&#x65;&#x74;">&#x69;&#x62;&#109;&#45;&#x61;&#x63;&#112;&#x69;&#x2d;&#x64;&#101;&#x76;&#x65;&#x6c;&#64;&#x6c;&#105;&#x73;&#x74;&#x73;&#x2e;&#115;&#111;&#117;&#114;&#99;&#x65;&#102;&#x6f;&#x72;&#103;&#101;&#46;&#x6e;&#x65;&#x74;</a> with a report.</p>
<p>Sysfs interface changelog:</p>
<p>0x000100:    Initial sysfs support, as a single platform driver and<br>        device.<br>0x000200:    Hot key support for 32 hot keys, and radio slider switch<br>        support.<br>0x010000:    Hot keys are now handled by default over the input<br>        layer, the radio switch generates input event EV_RADIO,<br>        and the driver enables hot key handling by default in<br>        the firmware.</p>
<p>0x020000:    ABI fix: added a separate hwmon platform device and<br>        driver, which must be located by name (thinkpad)<br>        and the hwmon class for libsensors4 (lm-sensors 3)<br>        compatibility.  Moved all hwmon attributes to this<br>        new platform device.</p>
<p>0x020100:    Marker for thinkpad-acpi with hot key NVRAM polling<br>        support.  If you must, use it to know you should not<br>        start a userspace NVRAM poller (allows to detect when<br>        NVRAM is compiled out by the user because it is<br>        unneeded/undesired in the first place).<br>0x020101:    Marker for thinkpad-acpi with hot key NVRAM polling<br>        and proper hotkey_mask semantics (version 8 of the<br>        NVRAM polling patch).  Some development snapshots of<br>        0.18 had an earlier version that did strange things<br>        to hotkey_mask.</p>
<p>0x020200:    Add poll()/select() support to the following attributes:<br>        hotkey_radio_sw, wakeup_hotunplug_complete, wakeup_reason</p>
<p>0x020300:    hotkey enable/disable support removed, attributes<br>        hotkey_bios_enabled and hotkey_enable deprecated and<br>        marked for removal.</p>
<p>0x020400:    Marker for 16 LEDs support.  Also, LEDs that are known<br>        to not exist in a given model are not registered with<br>        the LED sysfs class anymore.</p>
<p>0x020500:    Updated hotkey driver, hotkey_mask is always available<br>        and it is always able to disable hot keys.  Very old<br>        thinkpads are properly supported.  hotkey_bios_mask<br>        is deprecated and marked for removal.</p>
<p>0x020600:    Marker for backlight change event support.</p>
<p>0x020700:    Support for mute-only mixers.<br>        Volume control in read-only mode by default.<br>        Marker for ALSA mixer support.</p>
<p>0x030000:    Thermal and fan sysfs attributes were moved to the hwmon<br>        device instead of being attached to the backing platform<br>        device.</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_thinkpad-acpi/" title="Kernel-4.18.0-80.el8_thinkpad-acpi" target="_blank" rel="external">http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_thinkpad-acpi/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/02/19/Kernel-4.18.0-80.el8_scsi_mid_low_api/" title="Kernel-4.18.0-80.el8_scsi_mid_low_api"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/02/19/Kernel-4.18.0-80.el8_vfs/" title="Kernel-4.18.0-80.el8_vfs"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>