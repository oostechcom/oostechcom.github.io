<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-4.18.0-80.el8_hvcs | oosTech.com</title>
  <meta name="description" content="&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;                   HVCS    IBM “Hypervisor Virtual Console Server” Installation Guide              for Linux Kernel 2.6.4+">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-4.18.0-80.el8_hvcs">
<meta property="og:url" content="http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_hvcs/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;                   HVCS    IBM “Hypervisor Virtual Console Server” Installation Guide              for Linux Kernel 2.6.4+">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-02-18T16:00:00.000Z">
<meta property="article:modified_time" content="2021-02-18T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_hvcs/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a><span class="category-list-count">830</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_devices/" class="title">Kernel-2.6.32-573.12.1.el6_devices</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3c509/" class="title">Kernel-3.10.0-957.el7_3c509</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Questions-amp-Answers"><span class="toc-number">1.</span> <span class="toc-text">Questions &amp; Answers:</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-4.18.0-80.el8_hvcs" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-4.18.0-80.el8_hvcs
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/02/19/Kernel-4.18.0-80.el8_hvcs/" class="article-date">
	 published: <time datetime="2021-02-18T16:00:00.000Z" itemprop="datePublished">2021-02-19</time>
	</a>
</span>

        
	<a href="/2021/02/19/Kernel-4.18.0-80.el8_hvcs/" class="article-date">
	   updated: <time datetime="2021-02-18T16:00:00.000Z" itemprop="dateUpdated">2021-02-19</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/02/19/Kernel-4.18.0-80.el8_hvcs/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>===========================================================================<br>                   HVCS<br>    IBM “Hypervisor Virtual Console Server” Installation Guide<br>              for Linux Kernel 2.6.4+<br>            Copyright (C) 2004 IBM Corporation</p>
<p>===========================================================================<br>NOTE:Eight space tabs are the optimum editor setting for reading this file.<br>===========================================================================</p>
<pre><code>       Author(s) :  Ryan S. Arnold &lt;rsa@us.ibm.com&gt;
           Date Created: March, 02, 2004
           Last Changed: August, 24, 2004
</code></pre>
<hr>
<p>Table of contents:</p>
<pre><code>1.  Driver Introduction:
2.  System Requirements
3.  Build Options:
    3.1  Built-in:
    3.2  Module:
4.  Installation:
5.  Connection:
6.  Disconnection:
7.  Configuration:
8.  Questions &amp; Answers:
9.  Reporting Bugs:
</code></pre>
<hr>
<ol>
<li>Driver Introduction:</li>
</ol>
<p>This is the device driver for the IBM Hypervisor Virtual Console Server,<br>“hvcs”.  The IBM hvcs provides a tty driver interface to allow Linux user<br>space applications access to the system consoles of logically partitioned<br>operating systems (Linux and AIX) running on the same partitioned Power5<br>ppc64 system.  Physical hardware consoles per partition are not practical<br>on this hardware so system consoles are accessed by this driver using<br>firmware interfaces to virtual terminal devices.</p>
<hr>
<ol start="2">
<li>System Requirements:</li>
</ol>
<p>This device driver was written using 2.6.4 Linux kernel APIs and will only<br>build and run on kernels of this version or later.</p>
<p>This driver was written to operate solely on IBM Power5 ppc64 hardware<br>though some care was taken to abstract the architecture dependent firmware<br>calls from the driver code.</p>
<p>Sysfs must be mounted on the system so that the user can determine which<br>major and minor numbers are associated with each vty-server.  Directions<br>for sysfs mounting are outside the scope of this document.</p>
<hr>
<ol start="3">
<li>Build Options:</li>
</ol>
<p>The hvcs driver registers itself as a tty driver.  The tty layer<br>dynamically allocates a block of major and minor numbers in a quantity<br>requested by the registering driver.  The hvcs driver asks the tty layer<br>for 64 of these major/minor numbers by default to use for hvcs device node<br>entries.</p>
<p>If the default number of device entries is adequate then this driver can be<br>built into the kernel.  If not, the default can be over-ridden by inserting<br>the driver as a module with insmod parameters.</p>
<hr>
<p>3.1 Built-in:</p>
<p>The following menuconfig example demonstrates selecting to build this<br>driver into the kernel.</p>
<pre><code>Device Drivers  ---&gt;
    Character devices  ---&gt;
        &lt;*&gt; IBM Hypervisor Virtual Console Server Support
</code></pre>
<p>Begin the kernel make process.</p>
<hr>
<p>3.2 Module:</p>
<p>The following menuconfig example demonstrates selecting to build this<br>driver as a kernel module.</p>
<pre><code>Device Drivers  ---&gt;
    Character devices  ---&gt;
        &lt;M&gt; IBM Hypervisor Virtual Console Server Support
</code></pre>
<p>The make process will build the following kernel modules:</p>
<pre><code>hvcs.ko
hvcserver.ko
</code></pre>
<p>To insert the module with the default allocation execute the following<br>commands in the order they appear:</p>
<pre><code>insmod hvcserver.ko
insmod hvcs.ko
</code></pre>
<p>The hvcserver module contains architecture specific firmware calls and must<br>be inserted first, otherwise the hvcs module will not find some of the<br>symbols it expects.</p>
<p>To override the default use an insmod parameter as follows (requesting 4<br>tty devices as an example):</p>
<pre><code>insmod hvcs.ko hvcs_parm_num_devs=4
</code></pre>
<p>There is a maximum number of dev entries that can be specified on insmod.<br>We think that 1024 is currently a decent maximum number of server adapters<br>to allow.  This can always be changed by modifying the constant in the<br>source file before building.</p>
<p>NOTE: The length of time it takes to insmod the driver seems to be related<br>to the number of tty interfaces the registering driver requests.</p>
<p>In order to remove the driver module execute the following command:</p>
<pre><code>rmmod hvcs.ko
</code></pre>
<p>The recommended method for installing hvcs as a module is to use depmod to<br>build a current modules.dep file in /lib/modules/<code>uname -r</code> and then<br>execute:</p>
<p>modprobe hvcs hvcs_parm_num_devs=4</p>
<p>The modules.dep file indicates that hvcserver.ko needs to be inserted<br>before hvcs.ko and modprobe uses this file to smartly insert the modules in<br>the proper order.</p>
<p>The following modprobe command is used to remove hvcs and hvcserver in the<br>proper order:</p>
<p>modprobe -r hvcs</p>
<hr>
<ol start="4">
<li>Installation:</li>
</ol>
<p>The tty layer creates sysfs entries which contain the major and minor<br>numbers allocated for the hvcs driver.  The following snippet of “tree”<br>output of the sysfs directory shows where these numbers are presented:</p>
<pre><code>sys/
|-- *other sysfs base dirs*
|
|-- class
|   |-- *other classes of devices*
|   |
|   `-- tty
|       |-- *other tty devices*
|       |
|       |-- hvcs0
|       |   `-- dev
|       |-- hvcs1
|       |   `-- dev
|       |-- hvcs2
|       |   `-- dev
|       |-- hvcs3
|       |   `-- dev
|       |
|       |-- *other tty devices*
|
|-- *other sysfs base dirs*
</code></pre>
<p>For the above examples the following output is a result of cat’ing the<br>“dev” entry in the hvcs directory:</p>
<pre><code>Pow5:/sys/class/tty/hvcs0/ # cat dev
254:0

Pow5:/sys/class/tty/hvcs1/ # cat dev
254:1

Pow5:/sys/class/tty/hvcs2/ # cat dev
254:2

Pow5:/sys/class/tty/hvcs3/ # cat dev
254:3
</code></pre>
<p>The output from reading the “dev” attribute is the char device major and<br>minor numbers that the tty layer has allocated for this driver’s use.  Most<br>systems running hvcs will already have the device entries created or udev<br>will do it automatically.</p>
<p>Given the example output above, to manually create a /dev/hvcs* node entry<br>mknod can be used as follows:</p>
<pre><code>mknod /dev/hvcs0 c 254 0
mknod /dev/hvcs1 c 254 1
mknod /dev/hvcs2 c 254 2
mknod /dev/hvcs3 c 254 3
</code></pre>
<p>Using mknod to manually create the device entries makes these device nodes<br>persistent.  Once created they will exist prior to the driver insmod.</p>
<p>Attempting to connect an application to /dev/hvcs* prior to insertion of<br>the hvcs module will result in an error message similar to the following:</p>
<pre><code>&quot;/dev/hvcs*: No such device&quot;.
</code></pre>
<p>NOTE: Just because there is a device node present doesn’t mean that there<br>is a vty-server device configured for that node.</p>
<hr>
<ol start="5">
<li>Connection</li>
</ol>
<p>Since this driver controls devices that provide a tty interface a user can<br>interact with the device node entries using any standard tty-interactive<br>method (e.g. “cat”, “dd”, “echo”).  The intent of this driver however, is<br>to provide real time console interaction with a Linux partition’s console,<br>which requires the use of applications that provide bi-directional,<br>interactive I/O with a tty device.</p>
<p>Applications (e.g. “minicom” and “screen”) that act as terminal emulators<br>or perform terminal type control sequence conversion on the data being<br>passed through them are NOT acceptable for providing interactive console<br>I/O.  These programs often emulate antiquated terminal types (vt100 and<br>ANSI) and expect inbound data to take the form of one of these supported<br>terminal types but they either do not convert, or do not <em>adequately</em><br>convert, outbound data into the terminal type of the terminal which invoked<br>them (though screen makes an attempt and can apparently be configured with<br>much termcap wrestling.)</p>
<p>For this reason kermit and cu are two of the recommended applications for<br>interacting with a Linux console via an hvcs device.  These programs simply<br>act as a conduit for data transfer to and from the tty device.  They do not<br>require inbound data to take the form of a particular terminal type, nor do<br>they cook outbound data to a particular terminal type.</p>
<p>In order to ensure proper functioning of console applications one must make<br>sure that once connected to a /dev/hvcs console that the console’s $TERM<br>env variable is set to the exact terminal type of the terminal emulator<br>used to launch the interactive I/O application.  If one is using xterm and<br>kermit to connect to /dev/hvcs0 when the console prompt becomes available<br>one should “export TERM=xterm” on the console.  This tells ncurses<br>applications that are invoked from the console that they should output<br>control sequences that xterm can understand.</p>
<p>As a precautionary measure an hvcs user should always “exit” from their<br>session before disconnecting an application such as kermit from the device<br>node.  If this is not done, the next user to connect to the console will<br>continue using the previous user’s logged in session which includes<br>using the $TERM variable that the previous user supplied.</p>
<p>Hotplug add and remove of vty-server adapters affects which /dev/hvcs* node<br>is used to connect to each vty-server adapter.  In order to determine which<br>vty-server adapter is associated with which /dev/hvcs* node a special sysfs<br>attribute has been added to each vty-server sysfs entry.  This entry is<br>called “index” and showing it reveals an integer that refers to the<br>/dev/hvcs* entry to use to connect to that device.  For instance cating the<br>index attribute of vty-server adapter 30000004 shows the following.</p>
<pre><code>Pow5:/sys/bus/vio/drivers/hvcs/30000004 # cat index
2
</code></pre>
<p>This index of ‘2’ means that in order to connect to vty-server adapter<br>30000004 the user should interact with /dev/hvcs2.</p>
<p>It should be noted that due to the system hotplug I/O capabilities of a<br>system the /dev/hvcs* entry that interacts with a particular vty-server<br>adapter is not guaranteed to remain the same across system reboots.  Look<br>in the Q &amp; A section for more on this issue.</p>
<hr>
<ol start="6">
<li>Disconnection</li>
</ol>
<p>As a security feature to prevent the delivery of stale data to an<br>unintended target the Power5 system firmware disables the fetching of data<br>and discards that data when a connection between a vty-server and a vty has<br>been severed.  As an example, when a vty-server is immediately disconnected<br>from a vty following output of data to the vty the vty adapter may not have<br>enough time between when it received the data interrupt and when the<br>connection was severed to fetch the data from firmware before the fetch is<br>disabled by firmware.</p>
<p>When hvcs is being used to serve consoles this behavior is not a huge issue<br>because the adapter stays connected for large amounts of time following<br>almost all data writes.  When hvcs is being used as a tty conduit to tunnel<br>data between two partitions [see Q &amp; A below] this is a huge problem<br>because the standard Linux behavior when cat’ing or dd’ing data to a device<br>is to open the tty, send the data, and then close the tty.  If this driver<br>manually terminated vty-server connections on tty close this would close<br>the vty-server and vty connection before the target vty has had a chance to<br>fetch the data.</p>
<p>Additionally, disconnecting a vty-server and vty only on module removal or<br>adapter removal is impractical because other vty-servers in other<br>partitions may require the usage of the target vty at any time.</p>
<p>Due to this behavioral restriction disconnection of vty-servers from the<br>connected vty is a manual procedure using a write to a sysfs attribute<br>outlined below, on the other hand the initial vty-server connection to a<br>vty is established automatically by this driver.  Manual vty-server<br>connection is never required.</p>
<p>In order to terminate the connection between a vty-server and vty the<br>“vterm_state” sysfs attribute within each vty-server’s sysfs entry is used.<br>Reading this attribute reveals the current connection state of the<br>vty-server adapter.  A zero means that the vty-server is not connected to a<br>vty.  A one indicates that a connection is active.</p>
<p>Writing a ‘0’ (zero) to the vterm_state attribute will disconnect the VTERM<br>connection between the vty-server and target vty ONLY if the vterm_state<br>previously read ‘1’.  The write directive is ignored if the vterm_state<br>read ‘0’ or if any value other than ‘0’ was written to the vterm_state<br>attribute.  The following example will show the method used for verifying<br>the vty-server connection status and disconnecting a vty-server connection.</p>
<pre><code>Pow5:/sys/bus/vio/drivers/hvcs/30000004 # cat vterm_state
1

Pow5:/sys/bus/vio/drivers/hvcs/30000004 # echo 0 &gt; vterm_state

Pow5:/sys/bus/vio/drivers/hvcs/30000004 # cat vterm_state
0
</code></pre>
<p>All vty-server connections are automatically terminated when the device is<br>hotplug removed and when the module is removed.</p>
<hr>
<ol start="7">
<li>Configuration</li>
</ol>
<p>Each vty-server has a sysfs entry in the /sys/devices/vio directory, which<br>is symlinked in several other sysfs tree directories, notably under the<br>hvcs driver entry, which looks like the following example:</p>
<pre><code>Pow5:/sys/bus/vio/drivers/hvcs # ls
.  ..  30000003  30000004  rescan
</code></pre>
<p>By design, firmware notifies the hvcs driver of vty-server lifetimes and<br>partner vty removals but not the addition of partner vtys.  Since an HMC<br>Super Admin can add partner info dynamically we have provided the hvcs<br>driver sysfs directory with the “rescan” update attribute which will query<br>firmware and update the partner info for all the vty-servers that this<br>driver manages.  Writing a ‘1’ to the attribute triggers the update.  An<br>explicit example follows:</p>
<pre><code>Pow5:/sys/bus/vio/drivers/hvcs # echo 1 &gt; rescan
</code></pre>
<p>Reading the attribute will indicate a state of ‘1’ or ‘0’.  A one indicates<br>that an update is in process.  A zero indicates that an update has<br>completed or was never executed.</p>
<p>Vty-server entries in this directory are a 32 bit partition unique unit<br>address that is created by firmware.  An example vty-server sysfs entry<br>looks like the following:</p>
<pre><code>Pow5:/sys/bus/vio/drivers/hvcs/30000004 # ls
.   current_vty   devspec       name          partner_vtys
..  index         partner_clcs  vterm_state
</code></pre>
<p>Each entry is provided, by default with a “name” attribute.  Reading the<br>“name” attribute will reveal the device type as shown in the following<br>example:</p>
<pre><code>Pow5:/sys/bus/vio/drivers/hvcs/30000003 # cat name
vty-server
</code></pre>
<p>Each entry is also provided, by default, with a “devspec” attribute which<br>reveals the full device specification when read, as shown in the following<br>example:</p>
<pre><code>Pow5:/sys/bus/vio/drivers/hvcs/30000004 # cat devspec
/vdevice/vty-server@30000004
</code></pre>
<p>Each vty-server sysfs dir is provided with two read-only attributes that<br>provide lists of easily parsed partner vty data: “partner_vtys” and<br>“partner_clcs”.</p>
<pre><code>Pow5:/sys/bus/vio/drivers/hvcs/30000004 # cat partner_vtys
30000000
30000001
30000002
30000000
30000000

Pow5:/sys/bus/vio/drivers/hvcs/30000004 # cat partner_clcs
U5112.428.103048A-V3-C0
U5112.428.103048A-V3-C2
U5112.428.103048A-V3-C3
U5112.428.103048A-V4-C0
U5112.428.103048A-V5-C0
</code></pre>
<p>Reading partner_vtys returns a list of partner vtys.  Vty unit address<br>numbering is only per-partition-unique so entries will frequently repeat.</p>
<p>Reading partner_clcs returns a list of “converged location codes” which are<br>composed of a system serial number followed by “-V*”, where the ‘<em>‘ is the<br>target partition number, and “-C</em>“, where the ‘*’ is the slot of the<br>adapter.  The first vty partner corresponds to the first clc item, the<br>second vty partner to the second clc item, etc.</p>
<p>A vty-server can only be connected to a single vty at a time.  The entry,<br>“current_vty” prints the clc of the currently selected partner vty when<br>read.</p>
<p>The current_vty can be changed by writing a valid partner clc to the entry<br>as in the following example:</p>
<pre><code>Pow5:/sys/bus/vio/drivers/hvcs/30000004 # echo U5112.428.10304
8A-V4-C0 &gt; current_vty
</code></pre>
<p>Changing the current_vty when a vty-server is already connected to a vty<br>does not affect the current connection.  The change takes effect when the<br>currently open connection is freed.</p>
<p>Information on the “vterm_state” attribute was covered earlier on the<br>chapter entitled “disconnection”.</p>
<hr>
<ol start="8">
<li><h1 id="Questions-amp-Answers"><a href="#Questions-amp-Answers" class="headerlink" title="Questions &amp; Answers:"></a>Questions &amp; Answers:</h1>Q: What are the security concerns involving hvcs?</li>
</ol>
<p>A: There are three main security concerns:</p>
<pre><code>1. The creator of the /dev/hvcs* nodes has the ability to restrict
the access of the device entries to certain users or groups.  It
may be best to create a special hvcs group privilege for providing
access to system consoles.

2. To provide network security when grabbing the console it is
suggested that the user connect to the console hosting partition
using a secure method, such as SSH or sit at a hardware console.

3. Make sure to exit the user session when done with a console or
the next vty-server connection (which may be from another
partition) will experience the previously logged in session.
</code></pre>
<hr>
<p>Q: How do I multiplex a console that I grab through hvcs so that other<br>people can see it:</p>
<p>A: You can use “screen” to directly connect to the /dev/hvcs* device and<br>setup a session on your machine with the console group privileges.  As<br>pointed out earlier by default screen doesn’t provide the termcap settings<br>for most terminal emulators to provide adequate character conversion from<br>term type “screen” to others.  This means that curses based programs may<br>not display properly in screen sessions.</p>
<hr>
<p>Q: Why are the colors all messed up?<br>Q: Why are the control characters acting strange or not working?<br>Q: Why is the console output all strange and unintelligible?</p>
<p>A: Please see the preceding section on “Connection” for a discussion of how<br>applications can affect the display of character control sequences.<br>Additionally, just because you logged into the console using and xterm<br>doesn’t mean someone else didn’t log into the console with the HMC console<br>(vt320) before you and leave the session logged in.  The best thing to do<br>is to export TERM to the terminal type of your terminal emulator when you<br>get the console.  Additionally make sure to “exit” the console before you<br>disconnect from the console.  This will ensure that the next user gets<br>their own TERM type set when they login.</p>
<hr>
<p>Q: When I try to CONNECT kermit to an hvcs device I get:<br>“Sorry, can’t open connection: /dev/hvcs*”What is happening?</p>
<p>A: Some other Power5 console mechanism has a connection to the vty and<br>isn’t giving it up.  You can try to force disconnect the consoles from the<br>HMC by right clicking on the partition and then selecting “close terminal”.<br>Otherwise you have to hunt down the people who have console authority.  It<br>is possible that you already have the console open using another kermit<br>session and just forgot about it.  Please review the console options for<br>Power5 systems to determine the many ways a system console can be held.</p>
<p>OR</p>
<p>A: Another user may not have a connectivity method currently attached to a<br>/dev/hvcs device but the vterm_state may reveal that they still have the<br>vty-server connection established.  They need to free this using the method<br>outlined in the section on “Disconnection” in order for others to connect<br>to the target vty.</p>
<p>OR</p>
<p>A: The user profile you are using to execute kermit probably doesn’t have<br>permissions to use the /dev/hvcs* device.</p>
<p>OR</p>
<p>A: You probably haven’t inserted the hvcs.ko module yet but the /dev/hvcs*<br>entry still exists (on systems without udev).</p>
<p>OR</p>
<p>A: There is not a corresponding vty-server device that maps to an existing<br>/dev/hvcs* entry.</p>
<hr>
<p>Q: When I try to CONNECT kermit to an hvcs device I get:<br>“Sorry, write access to UUCP lockfile directory denied.”</p>
<p>A: The /dev/hvcs* entry you have specified doesn’t exist where you said it<br>does?  Maybe you haven’t inserted the module (on systems with udev).</p>
<hr>
<p>Q: If I already have one Linux partition installed can I use hvcs on said<br>partition to provide the console for the install of a second Linux<br>partition?</p>
<p>A: Yes granted that your are connected to the /dev/hvcs* device using<br>kermit or cu or some other program that doesn’t provide terminal emulation.</p>
<hr>
<p>Q: Can I connect to more than one partition’s console at a time using this<br>driver?</p>
<p>A: Yes.  Of course this means that there must be more than one vty-server<br>configured for this partition and each must point to a disconnected vty.</p>
<hr>
<p>Q: Does the hvcs driver support dynamic (hotplug) addition of devices?</p>
<p>A: Yes, if you have dlpar and hotplug enabled for your system and it has<br>been built into the kernel the hvcs drivers is configured to dynamically<br>handle additions of new devices and removals of unused devices.</p>
<hr>
<p>Q: For some reason /dev/hvcs* doesn’t map to the same vty-server adapter<br>after a reboot.  What happened?</p>
<p>A: Assignment of vty-server adapters to /dev/hvcs* entries is always done<br>in the order that the adapters are exposed.  Due to hotplug capabilities of<br>this driver assignment of hotplug added vty-servers may be in a different<br>order than how they would be exposed on module load.  Rebooting or<br>reloading the module after dynamic addition may result in the /dev/hvcs*<br>and vty-server coupling changing if a vty-server adapter was added in a<br>slot between two other vty-server adapters.  Refer to the section above<br>on how to determine which vty-server goes with which /dev/hvcs* node.<br>Hint; look at the sysfs “index” attribute for the vty-server.</p>
<hr>
<p>Q: Can I use /dev/hvcs* as a conduit to another partition and use a tty<br>device on that partition as the other end of the pipe?</p>
<p>A: Yes, on Power5 platforms the hvc_console driver provides a tty interface<br>for extra /dev/hvc* devices (where /dev/hvc0 is most likely the console).<br>In order to get a tty conduit working between the two partitions the HMC<br>Super Admin must create an additional “serial server” for the target<br>partition with the HMC gui which will show up as /dev/hvc* when the target<br>partition is rebooted.</p>
<p>The HMC Super Admin then creates an additional “serial client” for the<br>current partition and points this at the target partition’s newly created<br>“serial server” adapter (remember the slot).  This shows up as an<br>additional /dev/hvcs* device.</p>
<p>Now a program on the target system can be configured to read or write to<br>/dev/hvc* and another program on the current partition can be configured to<br>read or write to /dev/hvcs*.  Now you have a tty conduit between two<br>partitions.</p>
<hr>
<ol start="9">
<li>Reporting Bugs:</li>
</ol>
<p>The proper channel for reporting bugs is either through the Linux OS<br>distribution company that provided your OS or by posting issues to the<br>PowerPC development mailing list at:</p>
<p><a href="mailto:&#108;&#x69;&#110;&#117;&#120;&#112;&#x70;&#99;&#45;&#100;&#101;&#x76;&#64;&#x6c;&#105;&#115;&#116;&#115;&#x2e;&#x6f;&#122;&#108;&#97;&#x62;&#115;&#x2e;&#111;&#x72;&#x67;">&#108;&#x69;&#110;&#117;&#120;&#112;&#x70;&#99;&#45;&#100;&#101;&#x76;&#64;&#x6c;&#105;&#115;&#116;&#115;&#x2e;&#x6f;&#122;&#108;&#97;&#x62;&#115;&#x2e;&#111;&#x72;&#x67;</a></p>
<p>This request is to provide a documented and searchable public exchange<br>of the problems and solutions surrounding this driver for the benefit of<br>all users.</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_hvcs/" title="Kernel-4.18.0-80.el8_hvcs" target="_blank" rel="external">http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_hvcs/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/02/19/Kernel-4.18.0-80.el8_hdio/" title="Kernel-4.18.0-80.el8_hdio"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/02/19/Kernel-4.18.0-80.el8_idle-states/" title="Kernel-4.18.0-80.el8_idle-states"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>