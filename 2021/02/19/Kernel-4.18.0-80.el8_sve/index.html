<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-4.18.0-80.el8_sve | oosTech.com</title>
  <meta name="description" content="Scalable Vector Extension support for AArch64 Linux         &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  Author: Dave Martin &amp;#x44;&amp;#x61;&amp;#x76;&amp;#101;&amp;#x2e;&amp;#x4d;&amp;#x61;&amp;#114;&amp;#x74;&amp;#x69">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-4.18.0-80.el8_sve">
<meta property="og:url" content="http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_sve/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="Scalable Vector Extension support for AArch64 Linux         &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  Author: Dave Martin &amp;#x44;&amp;#x61;&amp;#x76;&amp;#101;&amp;#x2e;&amp;#x4d;&amp;#x61;&amp;#114;&amp;#x74;&amp;#x69">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-02-18T16:00:00.000Z">
<meta property="article:modified_time" content="2021-02-18T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_sve/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a><span class="category-list-count">830</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_devices/" class="title">Kernel-2.6.32-573.12.1.el6_devices</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3c509/" class="title">Kernel-3.10.0-957.el7_3c509</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Appendix-A-SVE-programmer%E2%80%99s-model-informative"><span class="toc-number">1.</span> <span class="toc-text">Appendix A.  SVE programmer’s model (informative)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#A-1-Registers"><span class="toc-number">1.1.</span> <span class="toc-text">A.1.  Registers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#A-2-Procedure-call-standard"><span class="toc-number">1.2.</span> <span class="toc-text">A.2.  Procedure call standard</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Appendix-B-ARMv8-A-FP-SIMD-programmer%E2%80%99s-model"><span class="toc-number">2.</span> <span class="toc-text">Appendix B.  ARMv8-A FP&#x2F;SIMD programmer’s model</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#References"><span class="toc-number">3.</span> <span class="toc-text">References</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-4.18.0-80.el8_sve" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-4.18.0-80.el8_sve
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/02/19/Kernel-4.18.0-80.el8_sve/" class="article-date">
	 published: <time datetime="2021-02-18T16:00:00.000Z" itemprop="datePublished">2021-02-19</time>
	</a>
</span>

        
	<a href="/2021/02/19/Kernel-4.18.0-80.el8_sve/" class="article-date">
	   updated: <time datetime="2021-02-18T16:00:00.000Z" itemprop="dateUpdated">2021-02-19</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/02/19/Kernel-4.18.0-80.el8_sve/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <pre><code>        Scalable Vector Extension support for AArch64 Linux
        ===================================================
</code></pre>
<p>Author: Dave Martin <a href="mailto:&#x44;&#x61;&#x76;&#101;&#x2e;&#x4d;&#x61;&#114;&#x74;&#x69;&#x6e;&#x40;&#x61;&#x72;&#x6d;&#46;&#x63;&#x6f;&#109;">&#x44;&#x61;&#x76;&#101;&#x2e;&#x4d;&#x61;&#114;&#x74;&#x69;&#x6e;&#x40;&#x61;&#x72;&#x6d;&#46;&#x63;&#x6f;&#109;</a><br>Date:   4 August 2017</p>
<p>This document outlines briefly the interface provided to userspace by Linux in<br>order to support use of the ARM Scalable Vector Extension (SVE).</p>
<p>This is an outline of the most important features and issues only and not<br>intended to be exhaustive.</p>
<p>This document does not aim to describe the SVE architecture or programmer’s<br>model.  To aid understanding, a minimal description of relevant programmer’s<br>model features for SVE is included in Appendix A.</p>
<ol>
<li> General</li>
</ol>
<hr>
<ul>
<li><p>SVE registers Z0..Z31, P0..P15 and FFR and the current vector length VL, are<br>tracked per-thread.</p>
</li>
<li><p>The presence of SVE is reported to userspace via HWCAP_SVE in the aux vector<br>AT_HWCAP entry.  Presence of this flag implies the presence of the SVE<br>instructions and registers, and the Linux-specific system interfaces<br>described in this document.  SVE is reported in /proc/cpuinfo as “sve”.</p>
</li>
<li><p>Support for the execution of SVE instructions in userspace can also be<br>detected by reading the CPU ID register ID_AA64PFR0_EL1 using an MRS<br>instruction, and checking that the value of the SVE field is nonzero. [3]</p>
<p>It does not guarantee the presence of the system interfaces described in the<br>following sections: software that needs to verify that those interfaces are<br>present must check for HWCAP_SVE instead.</p>
</li>
<li><p>Debuggers should restrict themselves to interacting with the target via the<br>NT_ARM_SVE regset.  The recommended way of detecting support for this regset<br>is to connect to a target process first and then attempt a<br>ptrace(PTRACE_GETREGSET, pid, NT_ARM_SVE, &amp;iov).</p>
</li>
</ul>
<ol start="2">
<li> Vector length terminology</li>
</ol>
<hr>
<p>The size of an SVE vector (Z) register is referred to as the “vector length”.</p>
<p>To avoid confusion about the units used to express vector length, the kernel<br>adopts the following conventions:</p>
<ul>
<li><p>Vector length (VL) = size of a Z-register in bytes</p>
</li>
<li><p>Vector quadwords (VQ) = size of a Z-register in units of 128 bits</p>
</li>
</ul>
<p>(So, VL = 16 * VQ.)</p>
<p>The VQ convention is used where the underlying granularity is important, such<br>as in data structure definitions.  In most other situations, the VL convention<br>is used.  This is consistent with the meaning of the “VL” pseudo-register in<br>the SVE instruction set architecture.</p>
<ol start="3">
<li> System call behaviour</li>
</ol>
<hr>
<ul>
<li><p>On syscall, V0..V31 are preserved (as without SVE).  Thus, bits [127:0] of<br>Z0..Z31 are preserved.  All other bits of Z0..Z31, and all of P0..P15 and FFR<br>become unspecified on return from a syscall.</p>
</li>
<li><p>The SVE registers are not used to pass arguments to or receive results from<br>any syscall.</p>
</li>
<li><p>In practice the affected registers/bits will be preserved or will be replaced<br>with zeros on return from a syscall, but userspace should not make<br>assumptions about this.  The kernel behaviour may vary on a case-by-case<br>basis.</p>
</li>
<li><p>All other SVE state of a thread, including the currently configured vector<br>length, the state of the PR_SVE_VL_INHERIT flag, and the deferred vector<br>length (if any), is preserved across all syscalls, subject to the specific<br>exceptions for execve() described in section 6.</p>
<p>In particular, on return from a fork() or clone(), the parent and new child<br>process or thread share identical SVE configuration, matching that of the<br>parent before the call.</p>
</li>
</ul>
<ol start="4">
<li> Signal handling</li>
</ol>
<hr>
<ul>
<li><p>A new signal frame record sve_context encodes the SVE registers on signal<br>delivery. [1]</p>
</li>
<li><p>This record is supplementary to fpsimd_context.  The FPSR and FPCR registers<br>are only present in fpsimd_context.  For convenience, the content of V0..V31<br>is duplicated between sve_context and fpsimd_context.</p>
</li>
<li><p>The signal frame record for SVE always contains basic metadata, in particular<br>the thread’s vector length (in sve_context.vl).</p>
</li>
<li><p>The SVE registers may or may not be included in the record, depending on<br>whether the registers are live for the thread.  The registers are present if<br>and only if:<br>sve_context.head.size &gt;= SVE_SIG_CONTEXT_SIZE(sve_vq_from_vl(sve_context.vl)).</p>
</li>
<li><p>If the registers are present, the remainder of the record has a vl-dependent<br>size and layout.  Macros SVE_SIG_* are defined [1] to facilitate access to<br>the members.</p>
</li>
<li><p>If the SVE context is too big to fit in sigcontext.__reserved[], then extra<br>space is allocated on the stack, an extra_context record is written in<br>__reserved[] referencing this space.  sve_context is then written in the<br>extra space.  Refer to [1] for further details about this mechanism.</p>
</li>
</ul>
<ol start="5">
<li> Signal return</li>
</ol>
<hr>
<p>When returning from a signal handler:</p>
<ul>
<li><p>If there is no sve_context record in the signal frame, or if the record is<br>present but contains no register data as desribed in the previous section,<br>then the SVE registers/bits become non-live and take unspecified values.</p>
</li>
<li><p>If sve_context is present in the signal frame and contains full register<br>data, the SVE registers become live and are populated with the specified<br>data.  However, for backward compatibility reasons, bits [127:0] of Z0..Z31<br>are always restored from the corresponding members of fpsimd_context.vregs[]<br>and not from sve_context.  The remaining bits are restored from sve_context.</p>
</li>
<li><p>Inclusion of fpsimd_context in the signal frame remains mandatory,<br>irrespective of whether sve_context is present or not.</p>
</li>
<li><p>The vector length cannot be changed via signal return.  If sve_context.vl in<br>the signal frame does not match the current vector length, the signal return<br>attempt is treated as illegal, resulting in a forced SIGSEGV.</p>
</li>
</ul>
<ol start="6">
<li> prctl extensions</li>
</ol>
<hr>
<p>Some new prctl() calls are added to allow programs to manage the SVE vector<br>length:</p>
<p>prctl(PR_SVE_SET_VL, unsigned long arg)</p>
<pre><code>Sets the vector length of the calling thread and related flags, where
arg == vl | flags.  Other threads of the calling process are unaffected.

vl is the desired vector length, where sve_vl_valid(vl) must be true.

flags:

PR_SVE_SET_VL_INHERIT

    Inherit the current vector length across execve().  Otherwise, the
    vector length is reset to the system default at execve().  (See
    Section 9.)

PR_SVE_SET_VL_ONEXEC

    Defer the requested vector length change until the next execve()
    performed by this thread.

    The effect is equivalent to implicit exceution of the following
    call immediately after the next execve() (if any) by the thread:

    prctl(PR_SVE_SET_VL, arg &amp; ~PR_SVE_SET_VL_ONEXEC)

    This allows launching of a new program with a different vector
    length, while avoiding runtime side effects in the caller.


    Without PR_SVE_SET_VL_ONEXEC, the requested change takes effect
    immediately.


Return value: a nonnegative on success, or a negative value on error:
EINVAL: SVE not supported, invalid vector length requested, or
    invalid flags.


On success:

* Either the calling thread&#39;s vector length or the deferred vector length
  to be applied at the next execve() by the thread (dependent on whether
  PR_SVE_SET_VL_ONEXEC is present in arg), is set to the largest value
  supported by the system that is less than or equal to vl.  If vl ==
  SVE_VL_MAX, the value set will be the largest value supported by the
  system.

* Any previously outstanding deferred vector length change in the calling
  thread is cancelled.

* The returned value describes the resulting configuration, encoded as for
  PR_SVE_GET_VL.  The vector length reported in this value is the new
  current vector length for this thread if PR_SVE_SET_VL_ONEXEC was not
  present in arg; otherwise, the reported vector length is the deferred
  vector length that will be applied at the next execve() by the calling
  thread.

* Changing the vector length causes all of P0..P15, FFR and all bits of
  Z0..V31 except for Z0 bits [127:0] .. Z31 bits [127:0] to become
  unspecified.  Calling PR_SVE_SET_VL with vl equal to the thread&#39;s current
  vector length, or calling PR_SVE_SET_VL with the PR_SVE_SET_VL_ONEXEC
  flag, does not constitute a change to the vector length for this purpose.
</code></pre>
<p>prctl(PR_SVE_GET_VL)</p>
<pre><code>Gets the vector length of the calling thread.

The following flag may be OR-ed into the result:

PR_SVE_SET_VL_INHERIT

    Vector length will be inherited across execve().

There is no way to determine whether there is an outstanding deferred
vector length change (which would only normally be the case between a
fork() or vfork() and the corresponding execve() in typical use).

To extract the vector length from the result, and it with
PR_SVE_VL_LEN_MASK.

Return value: a nonnegative value on success, or a negative value on error:
EINVAL: SVE not supported.
</code></pre>
<ol start="7">
<li> ptrace extensions</li>
</ol>
<hr>
<ul>
<li><p>A new regset NT_ARM_SVE is defined for use with PTRACE_GETREGSET and<br>PTRACE_SETREGSET.</p>
<p>Refer to [2] for definitions.</p>
</li>
</ul>
<p>The regset data starts with struct user_sve_header, containing:</p>
<pre><code>size

Size of the complete regset, in bytes.
This depends on vl and possibly on other things in the future.

If a call to PTRACE_GETREGSET requests less data than the value of
size, the caller can allocate a larger buffer and retry in order to
read the complete regset.

max_size

Maximum size in bytes that the regset can grow to for the target
thread.  The regset won&#39;t grow bigger than this even if the target
thread changes its vector length etc.

vl

Target thread&#39;s current vector length, in bytes.

max_vl

Maximum possible vector length for the target thread.

flags

either

    SVE_PT_REGS_FPSIMD

    SVE registers are not live (GETREGSET) or are to be made
    non-live (SETREGSET).

    The payload is of type struct user_fpsimd_state, with the same
    meaning as for NT_PRFPREG, starting at offset
    SVE_PT_FPSIMD_OFFSET from the start of user_sve_header.

    Extra data might be appended in the future: the size of the
    payload should be obtained using SVE_PT_FPSIMD_SIZE(vq, flags).

    vq should be obtained using sve_vq_from_vl(vl).

    or

    SVE_PT_REGS_SVE

    SVE registers are live (GETREGSET) or are to be made live
    (SETREGSET).

    The payload contains the SVE register data, starting at offset
    SVE_PT_SVE_OFFSET from the start of user_sve_header, and with
    size SVE_PT_SVE_SIZE(vq, flags);

... OR-ed with zero or more of the following flags, which have the same
meaning and behaviour as the corresponding PR_SET_VL_* flags:

    SVE_PT_VL_INHERIT

    SVE_PT_VL_ONEXEC (SETREGSET only).
</code></pre>
<ul>
<li><p>The effects of changing the vector length and/or flags are equivalent to<br>those documented for PR_SVE_SET_VL.</p>
<p>The caller must make a further GETREGSET call if it needs to know what VL is<br>actually set by SETREGSET, unless is it known in advance that the requested<br>VL is supported.</p>
</li>
<li><p>In the SVE_PT_REGS_SVE case, the size and layout of the payload depends on<br>the header fields.  The SVE_PT_SVE_*() macros are provided to facilitate<br>access to the members.</p>
</li>
<li><p>In either case, for SETREGSET it is permissible to omit the payload, in which<br>case only the vector length and flags are changed (along with any<br>consequences of those changes).</p>
</li>
<li><p>For SETREGSET, if an SVE_PT_REGS_SVE payload is present and the<br>requested VL is not supported, the effect will be the same as if the<br>payload were omitted, except that an EIO error is reported.  No<br>attempt is made to translate the payload data to the correct layout<br>for the vector length actually set.  The thread’s FPSIMD state is<br>preserved, but the remaining bits of the SVE registers become<br>unspecified.  It is up to the caller to translate the payload layout<br>for the actual VL and retry.</p>
</li>
<li><p>The effect of writing a partial, incomplete payload is unspecified.</p>
</li>
</ul>
<ol start="8">
<li> ELF coredump extensions</li>
</ol>
<hr>
<ul>
<li>A NT_ARM_SVE note will be added to each coredump for each thread of the<br>dumped process.  The contents will be equivalent to the data that would have<br>been read if a PTRACE_GETREGSET of NT_ARM_SVE were executed for each thread<br>when the coredump was generated.</li>
</ul>
<ol start="9">
<li> System runtime configuration</li>
</ol>
<hr>
<ul>
<li>To mitigate the ABI impact of expansion of the signal frame, a policy<br>mechanism is provided for administrators, distro maintainers and developers<br>to set the default vector length for userspace processes:</li>
</ul>
<p>/proc/sys/abi/sve_default_vector_length</p>
<pre><code>Writing the text representation of an integer to this file sets the system
default vector length to the specified value, unless the value is greater
than the maximum vector length supported by the system in which case the
default vector length is set to that maximum.

The result can be determined by reopening the file and reading its
contents.

At boot, the default vector length is initially set to 64 or the maximum
supported vector length, whichever is smaller.  This determines the initial
vector length of the init process (PID 1).

Reading this file returns the current system default vector length.
</code></pre>
<ul>
<li><p>At every execve() call, the new vector length of the new process is set to<br>the system default vector length, unless</p>
<ul>
<li><p>PR_SVE_SET_VL_INHERIT (or equivalently SVE_PT_VL_INHERIT) is set for the<br>calling thread, or</p>
</li>
<li><p>a deferred vector length change is pending, established via the<br>PR_SVE_SET_VL_ONEXEC flag (or SVE_PT_VL_ONEXEC).</p>
</li>
</ul>
</li>
<li><p>Modifying the system default vector length does not affect the vector length<br>of any existing process or thread that does not make an execve() call.</p>
</li>
</ul>
<h1 id="Appendix-A-SVE-programmer’s-model-informative"><a href="#Appendix-A-SVE-programmer’s-model-informative" class="headerlink" title="Appendix A.  SVE programmer’s model (informative)"></a>Appendix A.  SVE programmer’s model (informative)</h1><p>This section provides a minimal description of the additions made by SVE to the<br>ARMv8-A programmer’s model that are relevant to this document.</p>
<p>Note: This section is for information only and not intended to be complete or<br>to replace any architectural specification.</p>
<h2 id="A-1-Registers"><a href="#A-1-Registers" class="headerlink" title="A.1.  Registers"></a>A.1.  Registers</h2><p>In A64 state, SVE adds the following:</p>
<ul>
<li><p>32 8VL-bit vector registers Z0..Z31<br>For each Zn, Zn bits [127:0] alias the ARMv8-A vector register Vn.</p>
<p>A register write using a Vn register name zeros all bits of the corresponding<br>Zn except for bits [127:0].</p>
</li>
<li><p>16 VL-bit predicate registers P0..P15</p>
</li>
<li><p>1 VL-bit special-purpose predicate register FFR (the “first-fault register”)</p>
</li>
<li><p>a VL “pseudo-register” that determines the size of each vector register</p>
<p>The SVE instruction set architecture provides no way to write VL directly.<br>Instead, it can be modified only by EL1 and above, by writing appropriate<br>system registers.</p>
</li>
<li><p>The value of VL can be configured at runtime by EL1 and above:<br>16 &lt;= VL &lt;= VLmax, where VL must be a multiple of 16.</p>
</li>
<li><p>The maximum vector length is determined by the hardware:<br>16 &lt;= VLmax &lt;= 256.</p>
<p>(The SVE architecture specifies 256, but permits future architecture<br>revisions to raise this limit.)</p>
</li>
<li><p>FPSR and FPCR are retained from ARMv8-A, and interact with SVE floating-point<br>operations in a similar way to the way in which they interact with ARMv8<br>floating-point operations.</p>
<pre><code>   8VL-1                       128               0  bit index
  +----          ////            -----------------+
</code></pre>
<p>   Z0 |                               :       V0      |</p>
<pre><code>:                                          :
</code></pre>
<p>   Z7 |                               :       V7      |<br>   Z8 |                               :     * V8      |</p>
<pre><code>:                                       :  :
</code></pre>
<p>  Z15 |                               :     *V15      |<br>  Z16 |                               :      V16      |</p>
<pre><code>:                                          :
</code></pre>
<p>  Z31 |                               :      V31      |</p>
<pre><code>  +----          ////            -----------------+
                                           31    0
   VL-1                  0                +-------+
  +----       ////      --+          FPSR |       |
</code></pre>
<p>   P0 |                       |               +——-+</p>
<pre><code>: |                       |         *FPCR |       |
</code></pre>
<p>  P15 |                       |               +——-+</p>
<pre><code>  +----       ////      --+
</code></pre>
<p>  FFR |                       |               +—–+</p>
<pre><code>  +----       ////      --+            VL |     |
                                          +-----+
</code></pre>
</li>
</ul>
<p>(*) callee-save:<br>    This only applies to bits [63:0] of Z-/V-registers.<br>    FPCR contains callee-save and caller-save bits.  See [4] for details.</p>
<h2 id="A-2-Procedure-call-standard"><a href="#A-2-Procedure-call-standard" class="headerlink" title="A.2.  Procedure call standard"></a>A.2.  Procedure call standard</h2><p>The ARMv8-A base procedure call standard is extended as follows with respect to<br>the additional SVE register state:</p>
<ul>
<li><p>All SVE register bits that are not shared with FP/SIMD are caller-save.</p>
</li>
<li><p>Z8 bits [63:0] .. Z15 bits [63:0] are callee-save.</p>
<p>This follows from the way these bits are mapped to V8..V15, which are caller-<br>save in the base procedure call standard.</p>
</li>
</ul>
<h1 id="Appendix-B-ARMv8-A-FP-SIMD-programmer’s-model"><a href="#Appendix-B-ARMv8-A-FP-SIMD-programmer’s-model" class="headerlink" title="Appendix B.  ARMv8-A FP/SIMD programmer’s model"></a>Appendix B.  ARMv8-A FP/SIMD programmer’s model</h1><p>Note: This section is for information only and not intended to be complete or<br>to replace any architectural specification.</p>
<p>Refer to [4] for for more information.</p>
<p>ARMv8-A defines the following floating-point / SIMD register state:</p>
<ul>
<li><p>32 128-bit vector registers V0..V31</p>
</li>
<li><p>2 32-bit status/control registers FPSR, FPCR</p>
<pre><code>   127           0  bit index
  +---------------+
</code></pre>
<p>   V0 |               |</p>
<pre><code>: :               :
</code></pre>
<p>   V7 |               |</p>
<ul>
<li><dl><dt>V8 |               |</dt><dd>: :               :</dd></dl></li>
<li><p>V15 |               |<br>V16 |               |<br>  : :               :<br>V31 |               |</p>
<pre><code>+---------------+

         31    0
        +-------+
   FPSR |       |
        +-------+
  *FPCR |       |
        +-------+
</code></pre>
</li>
</ul>
</li>
</ul>
<p>(*) callee-save:<br>    This only applies to bits [63:0] of V-registers.<br>    FPCR contains a mixture of callee-save and caller-save bits.</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><p>[1] arch/arm64/include/uapi/asm/sigcontext.h<br>    AArch64 Linux signal ABI definitions</p>
<p>[2] arch/arm64/include/uapi/asm/ptrace.h<br>    AArch64 Linux ptrace ABI definitions</p>
<p>[3] linux/Documentation/arm64/cpu-feature-registers.txt</p>
<p>[4] ARM IHI0055C<br>    <a target="_blank" rel="noopener" href="http://infocenter.arm.com/help/topic/com.arm.doc.ihi0055c/IHI0055C_beta_aapcs64.pdf">http://infocenter.arm.com/help/topic/com.arm.doc.ihi0055c/IHI0055C_beta_aapcs64.pdf</a><br>    <a target="_blank" rel="noopener" href="http://infocenter.arm.com/help/topic/com.arm.doc.subset.swdev.abi/index.html">http://infocenter.arm.com/help/topic/com.arm.doc.subset.swdev.abi/index.html</a><br>    Procedure Call Standard for the ARM 64-bit Architecture (AArch64)</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_sve/" title="Kernel-4.18.0-80.el8_sve" target="_blank" rel="external">http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_sve/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/02/19/Kernel-4.18.0-80.el8_sun4i-drm/" title="Kernel-4.18.0-80.el8_sun4i-dr"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/02/19/Kernel-4.18.0-80.el8_switchdev/" title="Kernel-4.18.0-80.el8_switchdev"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>