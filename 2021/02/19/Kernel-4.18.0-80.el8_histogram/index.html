<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-4.18.0-80.el8_histogra | oosTech.com</title>
  <meta name="description" content="Event Histograms          Documentation written by Tom Zanussi   IntroductionHistogram triggers are special event triggers that can be used toaggregate trace event data into histograms.">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-4.18.0-80.el8_histogra">
<meta property="og:url" content="http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_histogram/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="Event Histograms          Documentation written by Tom Zanussi   IntroductionHistogram triggers are special event triggers that can be used toaggregate trace event data into histograms.">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-02-18T16:00:00.000Z">
<meta property="article:modified_time" content="2021-02-18T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_histogram/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a><span class="category-list-count">830</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_devices/" class="title">Kernel-2.6.32-573.12.1.el6_devices</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3c509/" class="title">Kernel-3.10.0-957.el7_3c509</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Histogram-Trigger-Command"><span class="toc-number">2.</span> <span class="toc-text">Histogram Trigger Command</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-skbaddr-hex-vals-len%E2%80%99-gt"><span class="toc-number">3.</span> <span class="toc-text">echo ‘hist:keys&#x3D;skbaddr.hex:vals&#x3D;len’ &gt; \</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-sys-kernel-debug-tracing-events-net-netif-rx-hist"><span class="toc-number">4.</span> <span class="toc-text">cat &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;tracing&#x2F;events&#x2F;net&#x2F;netif_rx&#x2F;hist</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98-hist-keys-skbaddr-hex-vals-len%E2%80%99-gt"><span class="toc-number">5.</span> <span class="toc-text">echo ‘!hist:keys&#x3D;skbaddr.hex:vals&#x3D;len’ &gt; \</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-skbaddr-hex-vals-len-pause%E2%80%99-gt"><span class="toc-number">6.</span> <span class="toc-text">echo ‘hist:keys&#x3D;skbaddr.hex:vals&#x3D;len:pause’ &gt; \</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98enable-hist-net-netif-receive-skb-if-filename-usr-bin-wget%E2%80%99-gt"><span class="toc-number">7.</span> <span class="toc-text">echo ‘enable_hist:net:netif_receive_skb if filename&#x3D;&#x3D;&#x2F;usr&#x2F;bin&#x2F;wget’ &gt; \</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98disable-hist-net-netif-receive-skb-if-comm-wget%E2%80%99-gt"><span class="toc-number">8.</span> <span class="toc-text">echo ‘disable_hist:net:netif_receive_skb if comm&#x3D;&#x3D;wget’ &gt; \</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%80%98special%E2%80%99-event-fields"><span class="toc-number">8.1.</span> <span class="toc-text">‘special’ event fields</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Extended-error-information"><span class="toc-number">8.2.</span> <span class="toc-text">Extended error information</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-xxx-gt-sys-kernel-debug-tracing-events-sched-sched-wakeup-trigger"><span class="toc-number">9.</span> <span class="toc-text">echo xxx &gt; &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;tracing&#x2F;events&#x2F;sched&#x2F;sched_wakeup&#x2F;trigger</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-sys-kernel-debug-tracing-events-sched-sched-wakeup-hist"><span class="toc-number">10.</span> <span class="toc-text">cat &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;tracing&#x2F;events&#x2F;sched&#x2F;sched_wakeup&#x2F;hist</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E2%80%98hist%E2%80%99-trigger-examples"><span class="toc-number">10.1.</span> <span class="toc-text">6.2 ‘hist’ trigger examples</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-Inter-event-hist-triggers"><span class="toc-number">10.2.</span> <span class="toc-text">2.2 Inter-event hist triggers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-1-Histogram-Variables"><span class="toc-number">10.3.</span> <span class="toc-text">2.2.1 Histogram Variables</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-next-pid-vals-ts0-ts0-common-timestamp-%E2%80%A6-gt-gt"><span class="toc-number">11.</span> <span class="toc-text">echo ‘hist:keys&#x3D;next_pid:vals&#x3D;$ts0:ts0&#x3D;common_timestamp … &gt;&gt; \</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-timer-pid-common-pid-key-timer-pid-%E2%80%A6%E2%80%99-gt-gt-event-trigger"><span class="toc-number">12.</span> <span class="toc-text">echo ‘hist:timer_pid&#x3D;common_pid:key&#x3D;timer_pid …’ &gt;&gt; event&#x2F;trigger</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-next-pid-ts1-common-timestamp-%E2%80%A6%E2%80%99-gt-gt-event-trigger"><span class="toc-number">13.</span> <span class="toc-text">echo ‘hist:keys&#x3D;next_pid:ts1&#x3D;common_timestamp …’ &gt;&gt; event&#x2F;trigger</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-pid-vals-ts0-b-ts0-common-timestamp-b-field1-%E2%80%A6%E2%80%99-gt-gt"><span class="toc-number">14.</span> <span class="toc-text">echo ‘hist:keys&#x3D;pid:vals&#x3D;$ts0,$b:ts0&#x3D;common_timestamp,b&#x3D;field1 …’ &gt;&gt; \</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-pid-ts0-common-timestamp-b-field1-vals-ts0-b-%E2%80%A6%E2%80%99-gt-gt"><span class="toc-number">15.</span> <span class="toc-text">echo ‘hist:keys&#x3D;pid:ts0&#x3D;common_timestamp,b&#x3D;field1:vals&#x3D;$ts0,$b …’ &gt;&gt; \</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-pid-ts0-common-timestamp-b-field1-%E2%80%A6%E2%80%99-gt-gt-event-trigger"><span class="toc-number">16.</span> <span class="toc-text">echo ‘hist:keys&#x3D;pid:ts0&#x3D;common_timestamp:b&#x3D;field1 …’ &gt;&gt; event&#x2F;trigger</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-pid-prio-ts0-common-timestamp-%E2%80%A6%E2%80%99-gt-gt-event1-trigger"><span class="toc-number">17.</span> <span class="toc-text">echo ‘hist:keys&#x3D;pid,prio:ts0&#x3D;common_timestamp …’ &gt;&gt; event1&#x2F;trigger</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-next-pid-wakeup-lat-common-timestamp-ts0-%E2%80%A6%E2%80%99-gt-gt-event2-trigger"><span class="toc-number">18.</span> <span class="toc-text">echo ‘hist:keys&#x3D;next_pid:wakeup_lat&#x3D;common_timestamp-$ts0 …’ &gt;&gt; event2&#x2F;trigger</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-key-pid-wakeupswitch-lat-wakeup-lat-switchtime-lat-%E2%80%A6%E2%80%99-gt-gt-event3-trigger"><span class="toc-number">19.</span> <span class="toc-text">echo ‘hist:key&#x3D;pid:wakeupswitch_lat&#x3D;$wakeup_lat+$switchtime_lat …’ &gt;&gt; event3&#x2F;trigger</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-2-Synthetic-Events"><span class="toc-number">19.1.</span> <span class="toc-text">2.2.2 Synthetic Events</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98wakeup-latency"><span class="toc-number">20.</span> <span class="toc-text">echo ‘wakeup_latency \</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-sys-kernel-debug-tracing-synthetic-events"><span class="toc-number">21.</span> <span class="toc-text">cat &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;tracing&#x2F;synthetic_events</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98-wakeup-latency-u64-lat-pid-t-pid-int-prio%E2%80%99-gt-gt"><span class="toc-number">22.</span> <span class="toc-text">echo ‘!wakeup_latency u64 lat pid_t pid int prio’ &gt;&gt; \</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-pid-prio-lat-log2-sort-pid-lat%E2%80%99-gt-gt"><span class="toc-number">23.</span> <span class="toc-text">echo ‘hist:keys&#x3D;pid,prio,lat.log2:sort&#x3D;pid,lat’ &gt;&gt; \</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ls-sys-kernel-debug-tracing-events-synthetic-wakeup-latency"><span class="toc-number">24.</span> <span class="toc-text">ls &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;tracing&#x2F;events&#x2F;synthetic&#x2F;wakeup_latency</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-3-Hist-trigger-%E2%80%98actions%E2%80%99"><span class="toc-number">24.1.</span> <span class="toc-text">2.2.3 Hist trigger ‘actions’</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98wakeup-new-test-pid-t-pid%E2%80%99-gt-gt"><span class="toc-number">25.</span> <span class="toc-text">echo ‘wakeup_new_test pid_t pid’ &gt;&gt; \</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-sys-kernel-debug-tracing-synthetic-events-1"><span class="toc-number">26.</span> <span class="toc-text">cat &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;tracing&#x2F;synthetic_events</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-testpid-testpid-pid-onmatch-sched-sched-wakeup-new"><span class="toc-number">27.</span> <span class="toc-text">echo ‘hist:keys&#x3D;$testpid:testpid&#x3D;pid:onmatch(sched.sched_wakeup_new).\</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-pid-sort-pid%E2%80%99-gt-gt"><span class="toc-number">28.</span> <span class="toc-text">echo ‘hist:keys&#x3D;pid:sort&#x3D;pid’ &gt;&gt; \</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-sys-kernel-debug-tracing-events-synthetic-wakeup-new-test-hist"><span class="toc-number">29.</span> <span class="toc-text">cat &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;tracing&#x2F;events&#x2F;synthetic&#x2F;wakeup_new_test&#x2F;hist</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98wakeup-latency-u64-lat-pid-t-pid-int-prio%E2%80%99-gt-gt"><span class="toc-number">30.</span> <span class="toc-text">echo ‘wakeup_latency u64 lat; pid_t pid; int prio’ &gt;&gt; \</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-saved-pid-saved-pid-pid-ts0-common-timestamp-usecs"><span class="toc-number">31.</span> <span class="toc-text">echo ‘hist:keys&#x3D;$saved_pid:saved_pid&#x3D;pid:ts0&#x3D;common_timestamp.usecs \</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-next-pid-wakeup-lat-common-timestamp-usecs-ts0"><span class="toc-number">32.</span> <span class="toc-text">echo ‘hist:keys&#x3D;next_pid:wakeup_lat&#x3D;common_timestamp.usecs-$ts0:\</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-pid-prio-lat-sort-pid-lat%E2%80%99-gt-gt"><span class="toc-number">33.</span> <span class="toc-text">echo ‘hist:keys&#x3D;pid,prio,lat:sort&#x3D;pid,lat’ &gt;&gt; \</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-sys-kernel-debug-tracing-events-synthetic-wakeup-latency-hist"><span class="toc-number">34.</span> <span class="toc-text">cat &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;tracing&#x2F;events&#x2F;synthetic&#x2F;wakeup_latency&#x2F;hist</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-pid-ts0-common-timestamp-usecs"><span class="toc-number">35.</span> <span class="toc-text">echo ‘hist:keys&#x3D;pid:ts0&#x3D;common_timestamp.usecs \</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-next-pid"><span class="toc-number">36.</span> <span class="toc-text">echo ‘hist:keys&#x3D;next_pid:\</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-sys-kernel-debug-tracing-events-sched-sched-switch-hist"><span class="toc-number">37.</span> <span class="toc-text">cat &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;tracing&#x2F;events&#x2F;sched&#x2F;sched_switch&#x2F;hist</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cd-sys-kernel-tracing"><span class="toc-number">38.</span> <span class="toc-text">cd &#x2F;sys&#x2F;kernel&#x2F;tracing</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98latency-u64-lat%E2%80%99-gt-synthetic-events"><span class="toc-number">39.</span> <span class="toc-text">echo ‘latency u64 lat’ &gt; synthetic_events</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-common-pid-ts0-common-timestamp-usecs-if-buf-%E2%80%9Cstart%E2%80%9D%E2%80%98-gt-events-ftrace-print-trigger"><span class="toc-number">40.</span> <span class="toc-text">echo ‘hist:keys&#x3D;common_pid:ts0&#x3D;common_timestamp.usecs if buf &#x3D;&#x3D; “start”‘ &gt; events&#x2F;ftrace&#x2F;print&#x2F;trigger</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-common-pid-lat-common-timestamp-usecs-ts0-onmatch-ftrace-print-latency-lat-if-buf-%E2%80%9Cend%E2%80%9D%E2%80%98-gt-gt-events-ftrace-print-trigger"><span class="toc-number">41.</span> <span class="toc-text">echo ‘hist:keys&#x3D;common_pid:lat&#x3D;common_timestamp.usecs-$ts0:onmatch(ftrace.print).latency($lat) if buf &#x3D;&#x3D; “end”‘ &gt;&gt; events&#x2F;ftrace&#x2F;print&#x2F;trigger</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-lat-common-pid-sort-lat%E2%80%99-gt-events-synthetic-latency-trigger"><span class="toc-number">42.</span> <span class="toc-text">echo ‘hist:keys&#x3D;lat,common_pid:sort&#x3D;lat’ &gt; events&#x2F;synthetic&#x2F;latency&#x2F;trigger</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cyclictest-p80-d0-i250-n-a-t-%E2%80%93tracemark-b-1000"><span class="toc-number">43.</span> <span class="toc-text">.&#x2F;cyclictest -p80 -d0 -i250 -n -a -t –tracemark -b 1000</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-events-synthetic-latency-hist"><span class="toc-number">44.</span> <span class="toc-text">cat events&#x2F;synthetic&#x2F;latency&#x2F;hist</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#event-histogram"><span class="toc-number">45.</span> <span class="toc-text">event histogram</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">46.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#trigger-info-hist-keys-lat-common-pid-vals-hitcount-sort-lat-size-2048-active"><span class="toc-number">47.</span> <span class="toc-text">trigger info: hist:keys&#x3D;lat,common_pid:vals&#x3D;hitcount:sort&#x3D;lat:size&#x3D;2048 [active]</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-1"><span class="toc-number">48.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cd-sys-kernel-tracing-1"><span class="toc-number">49.</span> <span class="toc-text">cd &#x2F;sys&#x2F;kernel&#x2F;tracing</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98latency-u64-lat%E2%80%99-gt-synthetic-events-1"><span class="toc-number">50.</span> <span class="toc-text">echo ‘latency u64 lat’ &gt; synthetic_events</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-pid-ts0-common-timestamp-usecs%E2%80%99-gt-events-sched-sched-waking-trigger"><span class="toc-number">51.</span> <span class="toc-text">echo ‘hist:keys&#x3D;pid:ts0&#x3D;common_timestamp.usecs’ &gt; events&#x2F;sched&#x2F;sched_waking&#x2F;trigger</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-common-pid-lat-common-timestamp-usecs-ts0-onmatch-sched-sched-waking-latency-lat-if-buf-%E2%80%9Cend%E2%80%9D%E2%80%98-gt-events-ftrace-print-trigger"><span class="toc-number">52.</span> <span class="toc-text">echo ‘hist:keys&#x3D;common_pid:lat&#x3D;common_timestamp.usecs-$ts0:onmatch(sched.sched_waking).latency($lat) if buf &#x3D;&#x3D; “end”‘ &gt; events&#x2F;ftrace&#x2F;print&#x2F;trigger</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hist-keys-lat-common-pid-sort-lat%E2%80%99-gt-events-synthetic-latency-trigger-1"><span class="toc-number">53.</span> <span class="toc-text">echo ‘hist:keys&#x3D;lat,common_pid:sort&#x3D;lat’ &gt; events&#x2F;synthetic&#x2F;latency&#x2F;trigger</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-events-synthetic-latency-hist-1"><span class="toc-number">54.</span> <span class="toc-text">cat events&#x2F;synthetic&#x2F;latency&#x2F;hist</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#event-histogram-1"><span class="toc-number">55.</span> <span class="toc-text">event histogram</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-2"><span class="toc-number">56.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#trigger-info-hist-keys-lat-common-pid-vals-hitcount-sort-lat-size-2048-active-1"><span class="toc-number">57.</span> <span class="toc-text">trigger info: hist:keys&#x3D;lat,common_pid:vals&#x3D;hitcount:sort&#x3D;lat:size&#x3D;2048 [active]</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-3"><span class="toc-number">58.</span> <span class="toc-text"></span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-4.18.0-80.el8_histogram" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-4.18.0-80.el8_histogra
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/02/19/Kernel-4.18.0-80.el8_histogram/" class="article-date">
	 published: <time datetime="2021-02-18T16:00:00.000Z" itemprop="datePublished">2021-02-19</time>
	</a>
</span>

        
	<a href="/2021/02/19/Kernel-4.18.0-80.el8_histogram/" class="article-date">
	   updated: <time datetime="2021-02-18T16:00:00.000Z" itemprop="dateUpdated">2021-02-19</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/02/19/Kernel-4.18.0-80.el8_histogram/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <pre><code>             Event Histograms

        Documentation written by Tom Zanussi
</code></pre>
<ol>
<li><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Histogram triggers are special event triggers that can be used to<br>aggregate trace event data into histograms.  For information on<br>trace events and event triggers, see Documentation/trace/events.rst.</p>
</li>
</ol>
<ol start="2">
<li><h1 id="Histogram-Trigger-Command"><a href="#Histogram-Trigger-Command" class="headerlink" title="Histogram Trigger Command"></a>Histogram Trigger Command</h1><p>A histogram trigger command is an event trigger command that<br>aggregates event hits into a hash table keyed on one or more trace<br>event format fields (or stacktrace) and a set of running totals<br>derived from one or more trace event format fields and/or event<br>counts (hitcount).</p>
<p>The format of a hist trigger is as follows:</p>
<pre><code> hist:keys=&lt;field1[,field2,...]&gt;[:values=&lt;field1[,field2,...]&gt;]
   [:sort=&lt;field1[,field2,...]&gt;][:size=#entries][:pause][:continue]
   [:clear][:name=histname1] [if &lt;filter&gt;]
</code></pre>
<p>When a matching event is hit, an entry is added to a hash table<br>using the key(s) and value(s) named.  Keys and values correspond to<br>fields in the event’s format description.  Values must correspond to<br>numeric fields - on an event hit, the value(s) will be added to a<br>sum kept for that field.  The special string ‘hitcount’ can be used<br>in place of an explicit value field - this is simply a count of<br>event hits.  If ‘values’ isn’t specified, an implicit ‘hitcount’<br>value will be automatically created and used as the only value.<br>Keys can be any field, or the special string ‘stacktrace’, which<br>will use the event’s kernel stacktrace as the key.  The keywords<br>‘keys’ or ‘key’ can be used to specify keys, and the keywords<br>‘values’, ‘vals’, or ‘val’ can be used to specify values.  Compound<br>keys consisting of up to two fields can be specified by the ‘keys’<br>keyword.  Hashing a compound key produces a unique entry in the<br>table for each unique combination of component keys, and can be<br>useful for providing more fine-grained summaries of event data.<br>Additionally, sort keys consisting of up to two fields can be<br>specified by the ‘sort’ keyword.  If more than one field is<br>specified, the result will be a ‘sort within a sort’: the first key<br>is taken to be the primary sort key and the second the secondary<br>key.  If a hist trigger is given a name using the ‘name’ parameter,<br>its histogram data will be shared with other triggers of the same<br>name, and trigger hits will update this common data.  Only triggers<br>with ‘compatible’ fields can be combined in this way; triggers are<br>‘compatible’ if the fields named in the trigger share the same<br>number and type of fields and those fields also have the same names.<br>Note that any two events always share the compatible ‘hitcount’ and<br>‘stacktrace’ fields and can therefore be combined using those<br>fields, however pointless that may be.</p>
<p>‘hist’ triggers add a ‘hist’ file to each event’s subdirectory.<br>Reading the ‘hist’ file for the event will dump the hash table in<br>its entirety to stdout.  If there are multiple hist triggers<br>attached to an event, there will be a table for each trigger in the<br>output.  The table displayed for a named trigger will be the same as<br>any other instance having the same name. Each printed hash table<br>entry is a simple list of the keys and values comprising the entry;<br>keys are printed first and are delineated by curly braces, and are<br>followed by the set of value fields for the entry.  By default,<br>numeric fields are displayed as base-10 integers.  This can be<br>modified by appending any of the following modifiers to the field<br>name:</p>
<pre><code> .hex        display a number as a hex value
</code></pre>
<p> .sym        display an address as a symbol<br> .sym-offset display an address as a symbol and offset<br> .syscall    display a syscall id as a system call name<br> .execname   display a common_pid as a program name<br> .log2       display log2 value rather than raw number<br> .usecs      display a common_timestamp in microseconds</p>
<p>Note that in general the semantics of a given field aren’t<br>interpreted when applying a modifier to it, but there are some<br>restrictions to be aware of in this regard:</p>
<ul>
<li>only the ‘hex’ modifier can be used for values (because values<br>are essentially sums, and the other modifiers don’t make sense<br>in that context).</li>
<li>the ‘execname’ modifier can only be used on a ‘common_pid’.  The<br>reason for this is that the execname is simply the ‘comm’ value<br>saved for the ‘current’ process when an event was triggered,<br>which is the same as the common_pid value saved by the event<br>tracing code.  Trying to apply that comm value to other pid<br>values wouldn’t be correct, and typically events that care save<br>pid-specific comm fields in the event itself.</li>
</ul>
<p>A typical usage scenario would be the following to enable a hist<br>trigger, read its current contents, and then turn it off:</p>
<h1 id="echo-‘hist-keys-skbaddr-hex-vals-len’-gt"><a href="#echo-‘hist-keys-skbaddr-hex-vals-len’-gt" class="headerlink" title="echo ‘hist:keys=skbaddr.hex:vals=len’ &gt; \"></a>echo ‘hist:keys=skbaddr.hex:vals=len’ &gt; \</h1><p> /sys/kernel/debug/tracing/events/net/netif_rx/trigger</p>
<h1 id="cat-sys-kernel-debug-tracing-events-net-netif-rx-hist"><a href="#cat-sys-kernel-debug-tracing-events-net-netif-rx-hist" class="headerlink" title="cat /sys/kernel/debug/tracing/events/net/netif_rx/hist"></a>cat /sys/kernel/debug/tracing/events/net/netif_rx/hist</h1><h1 id="echo-‘-hist-keys-skbaddr-hex-vals-len’-gt"><a href="#echo-‘-hist-keys-skbaddr-hex-vals-len’-gt" class="headerlink" title="echo ‘!hist:keys=skbaddr.hex:vals=len’ &gt; \"></a>echo ‘!hist:keys=skbaddr.hex:vals=len’ &gt; \</h1><p> /sys/kernel/debug/tracing/events/net/netif_rx/trigger</p>
<p>The trigger file itself can be read to show the details of the<br>currently attached hist trigger.  This information is also displayed<br>at the top of the ‘hist’ file when read.</p>
<p>By default, the size of the hash table is 2048 entries.  The ‘size’<br>parameter can be used to specify more or fewer than that.  The units<br>are in terms of hashtable entries - if a run uses more entries than<br>specified, the results will show the number of ‘drops’, the number<br>of hits that were ignored.  The size should be a power of 2 between<br>128 and 131072 (any non- power-of-2 number specified will be rounded<br>up).</p>
<p>The ‘sort’ parameter can be used to specify a value field to sort<br>on.  The default if unspecified is ‘hitcount’ and the default sort<br>order is ‘ascending’.  To sort in the opposite direction, append<br>.descending’ to the sort key.</p>
<p>The ‘pause’ parameter can be used to pause an existing hist trigger<br>or to start a hist trigger but not log any events until told to do<br>so.  ‘continue’ or ‘cont’ can be used to start or restart a paused<br>hist trigger.</p>
<p>The ‘clear’ parameter will clear the contents of a running hist<br>trigger and leave its current paused/active state.</p>
<p>Note that the ‘pause’, ‘cont’, and ‘clear’ parameters should be<br>applied using ‘append’ shell operator (‘&gt;&gt;’) if applied to an<br>existing trigger, rather than via the ‘&gt;’ operator, which will cause<br>the trigger to be removed through truncation.</p>
</li>
</ol>
<ul>
<li><p>enable_hist/disable_hist</p>
<p>The enable_hist and disable_hist triggers can be used to have one<br>event conditionally start and stop another event’s already-attached<br>hist trigger.  Any number of enable_hist and disable_hist triggers<br>can be attached to a given event, allowing that event to kick off<br>and stop aggregations on a host of other events.</p>
<p>The format is very similar to the enable/disable_event triggers:</p>
<pre><code>enable_hist:&lt;system&gt;:&lt;event&gt;[:count]
disable_hist:&lt;system&gt;:&lt;event&gt;[:count]
</code></pre>
<p>Instead of enabling or disabling the tracing of the target event<br>into the trace buffer as the enable/disable_event triggers do, the<br>enable/disable_hist triggers enable or disable the aggregation of<br>the target event into a hash table.</p>
<p>A typical usage scenario for the enable_hist/disable_hist triggers<br>would be to first set up a paused hist trigger on some event,<br>followed by an enable_hist/disable_hist pair that turns the hist<br>aggregation on and off when conditions of interest are hit:</p>
<h1 id="echo-‘hist-keys-skbaddr-hex-vals-len-pause’-gt"><a href="#echo-‘hist-keys-skbaddr-hex-vals-len-pause’-gt" class="headerlink" title="echo ‘hist:keys=skbaddr.hex:vals=len:pause’ &gt; \"></a>echo ‘hist:keys=skbaddr.hex:vals=len:pause’ &gt; \</h1><p>  /sys/kernel/debug/tracing/events/net/netif_receive_skb/trigger</p>
<h1 id="echo-‘enable-hist-net-netif-receive-skb-if-filename-usr-bin-wget’-gt"><a href="#echo-‘enable-hist-net-netif-receive-skb-if-filename-usr-bin-wget’-gt" class="headerlink" title="echo ‘enable_hist:net:netif_receive_skb if filename==/usr/bin/wget’ &gt; \"></a>echo ‘enable_hist:net:netif_receive_skb if filename==/usr/bin/wget’ &gt; \</h1><p>  /sys/kernel/debug/tracing/events/sched/sched_process_exec/trigger</p>
<h1 id="echo-‘disable-hist-net-netif-receive-skb-if-comm-wget’-gt"><a href="#echo-‘disable-hist-net-netif-receive-skb-if-comm-wget’-gt" class="headerlink" title="echo ‘disable_hist:net:netif_receive_skb if comm==wget’ &gt; \"></a>echo ‘disable_hist:net:netif_receive_skb if comm==wget’ &gt; \</h1><p>  /sys/kernel/debug/tracing/events/sched/sched_process_exit/trigger</p>
<p>The above sets up an initially paused hist trigger which is unpaused<br>and starts aggregating events when a given program is executed, and<br>which stops aggregating when the process exits and the hist trigger<br>is paused again.</p>
<p>The examples below provide a more concrete illustration of the<br>concepts and typical usage patterns discussed above.</p>
<h2 id="‘special’-event-fields"><a href="#‘special’-event-fields" class="headerlink" title="‘special’ event fields"></a>‘special’ event fields</h2><p>There are a number of ‘special event fields’ available for use as<br>keys or values in a hist trigger.  These look like and behave as if<br>they were actual event fields, but aren’t really part of the event’s<br>field definition or format file.  They are however available for any<br>event, and can be used anywhere an actual event field could be.<br>They are:</p>
<p>  common_timestamp       u64 - timestamp (from ring buffer) associated</p>
<pre><code>                           with the event, in nanoseconds.  May be
           modified by .usecs to have timestamps
           interpreted as microseconds.
</code></pre>
<p>  cpu                    int - the cpu on which the event occurred.</p>
<h2 id="Extended-error-information"><a href="#Extended-error-information" class="headerlink" title="Extended error information"></a>Extended error information</h2><p>For some error conditions encountered when invoking a hist trigger<br>command, extended error information is available via the<br>corresponding event’s ‘hist’ file.  Reading the hist file after an<br>error will display more detailed information about what went wrong,<br>if information is available.  This extended error information will<br>be available until the next hist trigger command for that event.</p>
<p>If available for a given error condition, the extended error<br>information and usage takes the following form:</p>
<h1 id="echo-xxx-gt-sys-kernel-debug-tracing-events-sched-sched-wakeup-trigger"><a href="#echo-xxx-gt-sys-kernel-debug-tracing-events-sched-sched-wakeup-trigger" class="headerlink" title="echo xxx &gt; /sys/kernel/debug/tracing/events/sched/sched_wakeup/trigger"></a>echo xxx &gt; /sys/kernel/debug/tracing/events/sched/sched_wakeup/trigger</h1><p>  echo: write error: Invalid argument</p>
<h1 id="cat-sys-kernel-debug-tracing-events-sched-sched-wakeup-hist"><a href="#cat-sys-kernel-debug-tracing-events-sched-sched-wakeup-hist" class="headerlink" title="cat /sys/kernel/debug/tracing/events/sched/sched_wakeup/hist"></a>cat /sys/kernel/debug/tracing/events/sched/sched_wakeup/hist</h1><p>  ERROR: Couldn’t yyy: zzz</p>
<pre><code>Last command: xxx
</code></pre>
</li>
</ul>
<h2 id="6-2-‘hist’-trigger-examples"><a href="#6-2-‘hist’-trigger-examples" class="headerlink" title="6.2 ‘hist’ trigger examples"></a>6.2 ‘hist’ trigger examples</h2><p>  The first set of examples creates aggregations using the kmalloc<br>  event.  The fields that can be used for the hist trigger are listed<br>  in the kmalloc event’s format file:</p>
<pre><code># cat /sys/kernel/debug/tracing/events/kmem/kmalloc/format
name: kmalloc
ID: 374
format:
field:unsigned short common_type;    offset:0;    size:2;    signed:0;
field:unsigned char common_flags;    offset:2;    size:1;    signed:0;
field:unsigned char common_preempt_count;        offset:3;    size:1;    signed:0;
field:int common_pid;                    offset:4;    size:4;    signed:1;

field:unsigned long call_site;                offset:8;    size:8;    signed:0;
field:const void * ptr;                    offset:16;    size:8;    signed:0;
field:size_t bytes_req;                    offset:24;    size:8;    signed:0;
field:size_t bytes_alloc;                offset:32;    size:8;    signed:0;
field:gfp_t gfp_flags;                    offset:40;    size:4;    signed:0;
</code></pre>
<p>  We’ll start by creating a hist trigger that generates a simple table<br>  that lists the total number of bytes requested for each function in<br>  the kernel that made one or more calls to kmalloc:</p>
<pre><code># echo &#39;hist:key=call_site:val=bytes_req&#39; &gt; \
        /sys/kernel/debug/tracing/events/kmem/kmalloc/trigger
</code></pre>
<p>  This tells the tracing system to create a ‘hist’ trigger using the<br>  call_site field of the kmalloc event as the key for the table, which<br>  just means that each unique call_site address will have an entry<br>  created for it in the table.  The ‘val=bytes_req’ parameter tells<br>  the hist trigger that for each unique entry (call_site) in the<br>  table, it should keep a running total of the number of bytes<br>  requested by that call_site.</p>
<p>  We’ll let it run for awhile and then dump the contents of the ‘hist’<br>  file in the kmalloc event’s subdirectory (for readability, a number<br>  of entries have been omitted):</p>
<pre><code># cat /sys/kernel/debug/tracing/events/kmem/kmalloc/hist
# trigger info: hist:keys=call_site:vals=bytes_req:sort=hitcount:size=2048 [active]

&#123; call_site: 18446744072106379007 &#125; hitcount:          1  bytes_req:        176
&#123; call_site: 18446744071579557049 &#125; hitcount:          1  bytes_req:       1024
&#123; call_site: 18446744071580608289 &#125; hitcount:          1  bytes_req:      16384
&#123; call_site: 18446744071581827654 &#125; hitcount:          1  bytes_req:         24
&#123; call_site: 18446744071580700980 &#125; hitcount:          1  bytes_req:          8
&#123; call_site: 18446744071579359876 &#125; hitcount:          1  bytes_req:        152
&#123; call_site: 18446744071580795365 &#125; hitcount:          3  bytes_req:        144
&#123; call_site: 18446744071581303129 &#125; hitcount:          3  bytes_req:        144
&#123; call_site: 18446744071580713234 &#125; hitcount:          4  bytes_req:       2560
&#123; call_site: 18446744071580933750 &#125; hitcount:          4  bytes_req:        736
.
.
.
&#123; call_site: 18446744072106047046 &#125; hitcount:         69  bytes_req:       5576
&#123; call_site: 18446744071582116407 &#125; hitcount:         73  bytes_req:       2336
&#123; call_site: 18446744072106054684 &#125; hitcount:        136  bytes_req:     140504
&#123; call_site: 18446744072106224230 &#125; hitcount:        136  bytes_req:      19584
&#123; call_site: 18446744072106078074 &#125; hitcount:        153  bytes_req:       2448
&#123; call_site: 18446744072106062406 &#125; hitcount:        153  bytes_req:      36720
&#123; call_site: 18446744071582507929 &#125; hitcount:        153  bytes_req:      37088
&#123; call_site: 18446744072102520590 &#125; hitcount:        273  bytes_req:      10920
&#123; call_site: 18446744071582143559 &#125; hitcount:        358  bytes_req:        716
&#123; call_site: 18446744072106465852 &#125; hitcount:        417  bytes_req:      56712
&#123; call_site: 18446744072102523378 &#125; hitcount:        485  bytes_req:      27160
&#123; call_site: 18446744072099568646 &#125; hitcount:       1676  bytes_req:      33520

Totals:
    Hits: 4610
    Entries: 45
    Dropped: 0
</code></pre>
<p>  The output displays a line for each entry, beginning with the key<br>  specified in the trigger, followed by the value(s) also specified in<br>  the trigger.  At the beginning of the output is a line that displays<br>  the trigger info, which can also be displayed by reading the<br>  ‘trigger’ file:</p>
<pre><code># cat /sys/kernel/debug/tracing/events/kmem/kmalloc/trigger
hist:keys=call_site:vals=bytes_req:sort=hitcount:size=2048 [active]
</code></pre>
<p>  At the end of the output are a few lines that display the overall<br>  totals for the run.  The ‘Hits’ field shows the total number of<br>  times the event trigger was hit, the ‘Entries’ field shows the total<br>  number of used entries in the hash table, and the ‘Dropped’ field<br>  shows the number of hits that were dropped because the number of<br>  used entries for the run exceeded the maximum number of entries<br>  allowed for the table (normally 0, but if not a hint that you may<br>  want to increase the size of the table using the ‘size’ parameter).</p>
<p>  Notice in the above output that there’s an extra field, ‘hitcount’,<br>  which wasn’t specified in the trigger.  Also notice that in the<br>  trigger info output, there’s a parameter, ‘sort=hitcount’, which<br>  wasn’t specified in the trigger either.  The reason for that is that<br>  every trigger implicitly keeps a count of the total number of hits<br>  attributed to a given entry, called the ‘hitcount’.  That hitcount<br>  information is explicitly displayed in the output, and in the<br>  absence of a user-specified sort parameter, is used as the default<br>  sort field.</p>
<p>  The value ‘hitcount’ can be used in place of an explicit value in<br>  the ‘values’ parameter if you don’t really need to have any<br>  particular field summed and are mainly interested in hit<br>  frequencies.</p>
<p>  To turn the hist trigger off, simply call up the trigger in the<br>  command history and re-execute it with a ‘!’ prepended:</p>
<pre><code># echo &#39;!hist:key=call_site:val=bytes_req&#39; &gt; \
       /sys/kernel/debug/tracing/events/kmem/kmalloc/trigger
</code></pre>
<p>  Finally, notice that the call_site as displayed in the output above<br>  isn’t really very useful.  It’s an address, but normally addresses<br>  are displayed in hex.  To have a numeric field displayed as a hex<br>  value, simply append ‘.hex’ to the field name in the trigger:</p>
<pre><code># echo &#39;hist:key=call_site.hex:val=bytes_req&#39; &gt; \
       /sys/kernel/debug/tracing/events/kmem/kmalloc/trigger

# cat /sys/kernel/debug/tracing/events/kmem/kmalloc/hist
# trigger info: hist:keys=call_site.hex:vals=bytes_req:sort=hitcount:size=2048 [active]

&#123; call_site: ffffffffa026b291 &#125; hitcount:          1  bytes_req:        433
&#123; call_site: ffffffffa07186ff &#125; hitcount:          1  bytes_req:        176
&#123; call_site: ffffffff811ae721 &#125; hitcount:          1  bytes_req:      16384
&#123; call_site: ffffffff811c5134 &#125; hitcount:          1  bytes_req:          8
&#123; call_site: ffffffffa04a9ebb &#125; hitcount:          1  bytes_req:        511
&#123; call_site: ffffffff8122e0a6 &#125; hitcount:          1  bytes_req:         12
&#123; call_site: ffffffff8107da84 &#125; hitcount:          1  bytes_req:        152
&#123; call_site: ffffffff812d8246 &#125; hitcount:          1  bytes_req:         24
&#123; call_site: ffffffff811dc1e5 &#125; hitcount:          3  bytes_req:        144
&#123; call_site: ffffffffa02515e8 &#125; hitcount:          3  bytes_req:        648
&#123; call_site: ffffffff81258159 &#125; hitcount:          3  bytes_req:        144
&#123; call_site: ffffffff811c80f4 &#125; hitcount:          4  bytes_req:        544
.
.
.
&#123; call_site: ffffffffa06c7646 &#125; hitcount:        106  bytes_req:       8024
&#123; call_site: ffffffffa06cb246 &#125; hitcount:        132  bytes_req:      31680
&#123; call_site: ffffffffa06cef7a &#125; hitcount:        132  bytes_req:       2112
&#123; call_site: ffffffff8137e399 &#125; hitcount:        132  bytes_req:      23232
&#123; call_site: ffffffffa06c941c &#125; hitcount:        185  bytes_req:     171360
&#123; call_site: ffffffffa06f2a66 &#125; hitcount:        185  bytes_req:      26640
&#123; call_site: ffffffffa036a70e &#125; hitcount:        265  bytes_req:      10600
&#123; call_site: ffffffff81325447 &#125; hitcount:        292  bytes_req:        584
&#123; call_site: ffffffffa072da3c &#125; hitcount:        446  bytes_req:      60656
&#123; call_site: ffffffffa036b1f2 &#125; hitcount:        526  bytes_req:      29456
&#123; call_site: ffffffffa0099c06 &#125; hitcount:       1780  bytes_req:      35600

Totals:
    Hits: 4775
    Entries: 46
    Dropped: 0
</code></pre>
<p>  Even that’s only marginally more useful - while hex values do look<br>  more like addresses, what users are typically more interested in<br>  when looking at text addresses are the corresponding symbols<br>  instead.  To have an address displayed as symbolic value instead,<br>  simply append ‘.sym’ or ‘.sym-offset’ to the field name in the<br>  trigger:</p>
<pre><code># echo &#39;hist:key=call_site.sym:val=bytes_req&#39; &gt; \
       /sys/kernel/debug/tracing/events/kmem/kmalloc/trigger

# cat /sys/kernel/debug/tracing/events/kmem/kmalloc/hist
# trigger info: hist:keys=call_site.sym:vals=bytes_req:sort=hitcount:size=2048 [active]

&#123; call_site: [ffffffff810adcb9] syslog_print_all                              &#125; hitcount:          1  bytes_req:       1024
&#123; call_site: [ffffffff8154bc62] usb_control_msg                               &#125; hitcount:          1  bytes_req:          8
&#123; call_site: [ffffffffa00bf6fe] hidraw_send_report [hid]                      &#125; hitcount:          1  bytes_req:          7
&#123; call_site: [ffffffff8154acbe] usb_alloc_urb                                 &#125; hitcount:          1  bytes_req:        192
&#123; call_site: [ffffffffa00bf1ca] hidraw_report_event [hid]                     &#125; hitcount:          1  bytes_req:          7
&#123; call_site: [ffffffff811e3a25] __seq_open_private                            &#125; hitcount:          1  bytes_req:         40
&#123; call_site: [ffffffff8109524a] alloc_fair_sched_group                        &#125; hitcount:          2  bytes_req:        128
&#123; call_site: [ffffffff811febd5] fsnotify_alloc_group                          &#125; hitcount:          2  bytes_req:        528
&#123; call_site: [ffffffff81440f58] __tty_buffer_request_room                     &#125; hitcount:          2  bytes_req:       2624
&#123; call_site: [ffffffff81200ba6] inotify_new_group                             &#125; hitcount:          2  bytes_req:         96
&#123; call_site: [ffffffffa05e19af] ieee80211_start_tx_ba_session [mac80211]      &#125; hitcount:          2  bytes_req:        464
&#123; call_site: [ffffffff81672406] tcp_get_metrics                               &#125; hitcount:          2  bytes_req:        304
&#123; call_site: [ffffffff81097ec2] alloc_rt_sched_group                          &#125; hitcount:          2  bytes_req:        128
&#123; call_site: [ffffffff81089b05] sched_create_group                            &#125; hitcount:          2  bytes_req:       1424
.
.
.
&#123; call_site: [ffffffffa04a580c] intel_crtc_page_flip [i915]                   &#125; hitcount:       1185  bytes_req:     123240
&#123; call_site: [ffffffffa0287592] drm_mode_page_flip_ioctl [drm]                &#125; hitcount:       1185  bytes_req:     104280
&#123; call_site: [ffffffffa04c4a3c] intel_plane_duplicate_state [i915]            &#125; hitcount:       1402  bytes_req:     190672
&#123; call_site: [ffffffff812891ca] ext4_find_extent                              &#125; hitcount:       1518  bytes_req:     146208
&#123; call_site: [ffffffffa029070e] drm_vma_node_allow [drm]                      &#125; hitcount:       1746  bytes_req:      69840
&#123; call_site: [ffffffffa045e7c4] i915_gem_do_execbuffer.isra.23 [i915]         &#125; hitcount:       2021  bytes_req:     792312
&#123; call_site: [ffffffffa02911f2] drm_modeset_lock_crtc [drm]                   &#125; hitcount:       2592  bytes_req:     145152
&#123; call_site: [ffffffffa0489a66] intel_ring_begin [i915]                       &#125; hitcount:       2629  bytes_req:     378576
&#123; call_site: [ffffffffa046041c] i915_gem_execbuffer2 [i915]                   &#125; hitcount:       2629  bytes_req:    3783248
&#123; call_site: [ffffffff81325607] apparmor_file_alloc_security                  &#125; hitcount:       5192  bytes_req:      10384
&#123; call_site: [ffffffffa00b7c06] hid_report_raw_event [hid]                    &#125; hitcount:       5529  bytes_req:     110584
&#123; call_site: [ffffffff8131ebf7] aa_alloc_task_context                         &#125; hitcount:      21943  bytes_req:     702176
&#123; call_site: [ffffffff8125847d] ext4_htree_store_dirent                       &#125; hitcount:      55759  bytes_req:    5074265

Totals:
    Hits: 109928
    Entries: 71
    Dropped: 0
</code></pre>
<p>  Because the default sort key above is ‘hitcount’, the above shows a<br>  the list of call_sites by increasing hitcount, so that at the bottom<br>  we see the functions that made the most kmalloc calls during the<br>  run.  If instead we we wanted to see the top kmalloc callers in<br>  terms of the number of bytes requested rather than the number of<br>  calls, and we wanted the top caller to appear at the top, we can use<br>  the ‘sort’ parameter, along with the ‘descending’ modifier:</p>
<pre><code># echo &#39;hist:key=call_site.sym:val=bytes_req:sort=bytes_req.descending&#39; &gt; \
       /sys/kernel/debug/tracing/events/kmem/kmalloc/trigger

# cat /sys/kernel/debug/tracing/events/kmem/kmalloc/hist
# trigger info: hist:keys=call_site.sym:vals=bytes_req:sort=bytes_req.descending:size=2048 [active]

&#123; call_site: [ffffffffa046041c] i915_gem_execbuffer2 [i915]                   &#125; hitcount:       2186  bytes_req:    3397464
&#123; call_site: [ffffffffa045e7c4] i915_gem_do_execbuffer.isra.23 [i915]         &#125; hitcount:       1790  bytes_req:     712176
&#123; call_site: [ffffffff8125847d] ext4_htree_store_dirent                       &#125; hitcount:       8132  bytes_req:     513135
&#123; call_site: [ffffffff811e2a1b] seq_buf_alloc                                 &#125; hitcount:        106  bytes_req:     440128
&#123; call_site: [ffffffffa0489a66] intel_ring_begin [i915]                       &#125; hitcount:       2186  bytes_req:     314784
&#123; call_site: [ffffffff812891ca] ext4_find_extent                              &#125; hitcount:       2174  bytes_req:     208992
&#123; call_site: [ffffffff811ae8e1] __kmalloc                                     &#125; hitcount:          8  bytes_req:     131072
&#123; call_site: [ffffffffa04c4a3c] intel_plane_duplicate_state [i915]            &#125; hitcount:        859  bytes_req:     116824
&#123; call_site: [ffffffffa02911f2] drm_modeset_lock_crtc [drm]                   &#125; hitcount:       1834  bytes_req:     102704
&#123; call_site: [ffffffffa04a580c] intel_crtc_page_flip [i915]                   &#125; hitcount:        972  bytes_req:     101088
&#123; call_site: [ffffffffa0287592] drm_mode_page_flip_ioctl [drm]                &#125; hitcount:        972  bytes_req:      85536
&#123; call_site: [ffffffffa00b7c06] hid_report_raw_event [hid]                    &#125; hitcount:       3333  bytes_req:      66664
&#123; call_site: [ffffffff8137e559] sg_kmalloc                                    &#125; hitcount:        209  bytes_req:      61632
.
.
.
&#123; call_site: [ffffffff81095225] alloc_fair_sched_group                        &#125; hitcount:          2  bytes_req:        128
&#123; call_site: [ffffffff81097ec2] alloc_rt_sched_group                          &#125; hitcount:          2  bytes_req:        128
&#123; call_site: [ffffffff812d8406] copy_semundo                                  &#125; hitcount:          2  bytes_req:         48
&#123; call_site: [ffffffff81200ba6] inotify_new_group                             &#125; hitcount:          1  bytes_req:         48
&#123; call_site: [ffffffffa027121a] drm_getmagic [drm]                            &#125; hitcount:          1  bytes_req:         48
&#123; call_site: [ffffffff811e3a25] __seq_open_private                            &#125; hitcount:          1  bytes_req:         40
&#123; call_site: [ffffffff811c52f4] bprm_change_interp                            &#125; hitcount:          2  bytes_req:         16
&#123; call_site: [ffffffff8154bc62] usb_control_msg                               &#125; hitcount:          1  bytes_req:          8
&#123; call_site: [ffffffffa00bf1ca] hidraw_report_event [hid]                     &#125; hitcount:          1  bytes_req:          7
&#123; call_site: [ffffffffa00bf6fe] hidraw_send_report [hid]                      &#125; hitcount:          1  bytes_req:          7

Totals:
    Hits: 32133
    Entries: 81
    Dropped: 0
</code></pre>
<p>  To display the offset and size information in addition to the symbol<br>  name, just use ‘sym-offset’ instead:</p>
<pre><code># echo &#39;hist:key=call_site.sym-offset:val=bytes_req:sort=bytes_req.descending&#39; &gt; \
       /sys/kernel/debug/tracing/events/kmem/kmalloc/trigger

# cat /sys/kernel/debug/tracing/events/kmem/kmalloc/hist
# trigger info: hist:keys=call_site.sym-offset:vals=bytes_req:sort=bytes_req.descending:size=2048 [active]

&#123; call_site: [ffffffffa046041c] i915_gem_execbuffer2+0x6c/0x2c0 [i915]                  &#125; hitcount:       4569  bytes_req:    3163720
&#123; call_site: [ffffffffa0489a66] intel_ring_begin+0xc6/0x1f0 [i915]                      &#125; hitcount:       4569  bytes_req:     657936
&#123; call_site: [ffffffffa045e7c4] i915_gem_do_execbuffer.isra.23+0x694/0x1020 [i915]      &#125; hitcount:       1519  bytes_req:     472936
&#123; call_site: [ffffffffa045e646] i915_gem_do_execbuffer.isra.23+0x516/0x1020 [i915]      &#125; hitcount:       3050  bytes_req:     211832
&#123; call_site: [ffffffff811e2a1b] seq_buf_alloc+0x1b/0x50                                 &#125; hitcount:         34  bytes_req:     148384
&#123; call_site: [ffffffffa04a580c] intel_crtc_page_flip+0xbc/0x870 [i915]                  &#125; hitcount:       1385  bytes_req:     144040
&#123; call_site: [ffffffff811ae8e1] __kmalloc+0x191/0x1b0                                   &#125; hitcount:          8  bytes_req:     131072
&#123; call_site: [ffffffffa0287592] drm_mode_page_flip_ioctl+0x282/0x360 [drm]              &#125; hitcount:       1385  bytes_req:     121880
&#123; call_site: [ffffffffa02911f2] drm_modeset_lock_crtc+0x32/0x100 [drm]                  &#125; hitcount:       1848  bytes_req:     103488
&#123; call_site: [ffffffffa04c4a3c] intel_plane_duplicate_state+0x2c/0xa0 [i915]            &#125; hitcount:        461  bytes_req:      62696
&#123; call_site: [ffffffffa029070e] drm_vma_node_allow+0x2e/0xd0 [drm]                      &#125; hitcount:       1541  bytes_req:      61640
&#123; call_site: [ffffffff815f8d7b] sk_prot_alloc+0xcb/0x1b0                                &#125; hitcount:         57  bytes_req:      57456
.
.
.
&#123; call_site: [ffffffff8109524a] alloc_fair_sched_group+0x5a/0x1a0                       &#125; hitcount:          2  bytes_req:        128
&#123; call_site: [ffffffffa027b921] drm_vm_open_locked+0x31/0xa0 [drm]                      &#125; hitcount:          3  bytes_req:         96
&#123; call_site: [ffffffff8122e266] proc_self_follow_link+0x76/0xb0                         &#125; hitcount:          8  bytes_req:         96
&#123; call_site: [ffffffff81213e80] load_elf_binary+0x240/0x1650                            &#125; hitcount:          3  bytes_req:         84
&#123; call_site: [ffffffff8154bc62] usb_control_msg+0x42/0x110                              &#125; hitcount:          1  bytes_req:          8
&#123; call_site: [ffffffffa00bf6fe] hidraw_send_report+0x7e/0x1a0 [hid]                     &#125; hitcount:          1  bytes_req:          7
&#123; call_site: [ffffffffa00bf1ca] hidraw_report_event+0x8a/0x120 [hid]                    &#125; hitcount:          1  bytes_req:          7

Totals:
    Hits: 26098
    Entries: 64
    Dropped: 0
</code></pre>
<p>  We can also add multiple fields to the ‘values’ parameter.  For<br>  example, we might want to see the total number of bytes allocated<br>  alongside bytes requested, and display the result sorted by bytes<br>  allocated in a descending order:</p>
<pre><code># echo &#39;hist:keys=call_site.sym:values=bytes_req,bytes_alloc:sort=bytes_alloc.descending&#39; &gt; \
       /sys/kernel/debug/tracing/events/kmem/kmalloc/trigger

# cat /sys/kernel/debug/tracing/events/kmem/kmalloc/hist
# trigger info: hist:keys=call_site.sym:vals=bytes_req,bytes_alloc:sort=bytes_alloc.descending:size=2048 [active]

&#123; call_site: [ffffffffa046041c] i915_gem_execbuffer2 [i915]                   &#125; hitcount:       7403  bytes_req:    4084360  bytes_alloc:    5958016
&#123; call_site: [ffffffff811e2a1b] seq_buf_alloc                                 &#125; hitcount:        541  bytes_req:    2213968  bytes_alloc:    2228224
&#123; call_site: [ffffffffa0489a66] intel_ring_begin [i915]                       &#125; hitcount:       7404  bytes_req:    1066176  bytes_alloc:    1421568
&#123; call_site: [ffffffffa045e7c4] i915_gem_do_execbuffer.isra.23 [i915]         &#125; hitcount:       1565  bytes_req:     557368  bytes_alloc:    1037760
&#123; call_site: [ffffffff8125847d] ext4_htree_store_dirent                       &#125; hitcount:       9557  bytes_req:     595778  bytes_alloc:     695744
&#123; call_site: [ffffffffa045e646] i915_gem_do_execbuffer.isra.23 [i915]         &#125; hitcount:       5839  bytes_req:     430680  bytes_alloc:     470400
&#123; call_site: [ffffffffa04c4a3c] intel_plane_duplicate_state [i915]            &#125; hitcount:       2388  bytes_req:     324768  bytes_alloc:     458496
&#123; call_site: [ffffffffa02911f2] drm_modeset_lock_crtc [drm]                   &#125; hitcount:       3911  bytes_req:     219016  bytes_alloc:     250304
&#123; call_site: [ffffffff815f8d7b] sk_prot_alloc                                 &#125; hitcount:        235  bytes_req:     236880  bytes_alloc:     240640
&#123; call_site: [ffffffff8137e559] sg_kmalloc                                    &#125; hitcount:        557  bytes_req:     169024  bytes_alloc:     221760
&#123; call_site: [ffffffffa00b7c06] hid_report_raw_event [hid]                    &#125; hitcount:       9378  bytes_req:     187548  bytes_alloc:     206312
&#123; call_site: [ffffffffa04a580c] intel_crtc_page_flip [i915]                   &#125; hitcount:       1519  bytes_req:     157976  bytes_alloc:     194432
.
.
.
&#123; call_site: [ffffffff8109bd3b] sched_autogroup_create_attach                 &#125; hitcount:          2  bytes_req:        144  bytes_alloc:        192
&#123; call_site: [ffffffff81097ee8] alloc_rt_sched_group                          &#125; hitcount:          2  bytes_req:        128  bytes_alloc:        128
&#123; call_site: [ffffffff8109524a] alloc_fair_sched_group                        &#125; hitcount:          2  bytes_req:        128  bytes_alloc:        128
&#123; call_site: [ffffffff81095225] alloc_fair_sched_group                        &#125; hitcount:          2  bytes_req:        128  bytes_alloc:        128
&#123; call_site: [ffffffff81097ec2] alloc_rt_sched_group                          &#125; hitcount:          2  bytes_req:        128  bytes_alloc:        128
&#123; call_site: [ffffffff81213e80] load_elf_binary                               &#125; hitcount:          3  bytes_req:         84  bytes_alloc:         96
&#123; call_site: [ffffffff81079a2e] kthread_create_on_node                        &#125; hitcount:          1  bytes_req:         56  bytes_alloc:         64
&#123; call_site: [ffffffffa00bf6fe] hidraw_send_report [hid]                      &#125; hitcount:          1  bytes_req:          7  bytes_alloc:          8
&#123; call_site: [ffffffff8154bc62] usb_control_msg                               &#125; hitcount:          1  bytes_req:          8  bytes_alloc:          8
&#123; call_site: [ffffffffa00bf1ca] hidraw_report_event [hid]                     &#125; hitcount:          1  bytes_req:          7  bytes_alloc:          8

Totals:
    Hits: 66598
    Entries: 65
    Dropped: 0
</code></pre>
<p>  Finally, to finish off our kmalloc example, instead of simply having<br>  the hist trigger display symbolic call_sites, we can have the hist<br>  trigger additionally display the complete set of kernel stack traces<br>  that led to each call_site.  To do that, we simply use the special<br>  value ‘stacktrace’ for the key parameter:</p>
<pre><code># echo &#39;hist:keys=stacktrace:values=bytes_req,bytes_alloc:sort=bytes_alloc&#39; &gt; \
       /sys/kernel/debug/tracing/events/kmem/kmalloc/trigger
</code></pre>
<p>  The above trigger will use the kernel stack trace in effect when an<br>  event is triggered as the key for the hash table.  This allows the<br>  enumeration of every kernel callpath that led up to a particular<br>  event, along with a running total of any of the event fields for<br>  that event.  Here we tally bytes requested and bytes allocated for<br>  every callpath in the system that led up to a kmalloc (in this case<br>  every callpath to a kmalloc for a kernel compile):</p>
<pre><code># cat /sys/kernel/debug/tracing/events/kmem/kmalloc/hist
# trigger info: hist:keys=stacktrace:vals=bytes_req,bytes_alloc:sort=bytes_alloc:size=2048 [active]

&#123; stacktrace:
     __kmalloc_track_caller+0x10b/0x1a0
     kmemdup+0x20/0x50
     hidraw_report_event+0x8a/0x120 [hid]
     hid_report_raw_event+0x3ea/0x440 [hid]
     hid_input_report+0x112/0x190 [hid]
     hid_irq_in+0xc2/0x260 [usbhid]
     __usb_hcd_giveback_urb+0x72/0x120
     usb_giveback_urb_bh+0x9e/0xe0
     tasklet_hi_action+0xf8/0x100
     __do_softirq+0x114/0x2c0
     irq_exit+0xa5/0xb0
     do_IRQ+0x5a/0xf0
     ret_from_intr+0x0/0x30
     cpuidle_enter+0x17/0x20
     cpu_startup_entry+0x315/0x3e0
     rest_init+0x7c/0x80
&#125; hitcount:          3  bytes_req:         21  bytes_alloc:         24
&#123; stacktrace:
     __kmalloc_track_caller+0x10b/0x1a0
     kmemdup+0x20/0x50
     hidraw_report_event+0x8a/0x120 [hid]
     hid_report_raw_event+0x3ea/0x440 [hid]
     hid_input_report+0x112/0x190 [hid]
     hid_irq_in+0xc2/0x260 [usbhid]
     __usb_hcd_giveback_urb+0x72/0x120
     usb_giveback_urb_bh+0x9e/0xe0
     tasklet_hi_action+0xf8/0x100
     __do_softirq+0x114/0x2c0
     irq_exit+0xa5/0xb0
     do_IRQ+0x5a/0xf0
     ret_from_intr+0x0/0x30
&#125; hitcount:          3  bytes_req:         21  bytes_alloc:         24
&#123; stacktrace:
     kmem_cache_alloc_trace+0xeb/0x150
     aa_alloc_task_context+0x27/0x40
     apparmor_cred_prepare+0x1f/0x50
     security_prepare_creds+0x16/0x20
     prepare_creds+0xdf/0x1a0
     SyS_capset+0xb5/0x200
     system_call_fastpath+0x12/0x6a
&#125; hitcount:          1  bytes_req:         32  bytes_alloc:         32
.
.
.
&#123; stacktrace:
     __kmalloc+0x11b/0x1b0
     i915_gem_execbuffer2+0x6c/0x2c0 [i915]
     drm_ioctl+0x349/0x670 [drm]
     do_vfs_ioctl+0x2f0/0x4f0
     SyS_ioctl+0x81/0xa0
     system_call_fastpath+0x12/0x6a
&#125; hitcount:      17726  bytes_req:   13944120  bytes_alloc:   19593808
&#123; stacktrace:
     __kmalloc+0x11b/0x1b0
     load_elf_phdrs+0x76/0xa0
     load_elf_binary+0x102/0x1650
     search_binary_handler+0x97/0x1d0
     do_execveat_common.isra.34+0x551/0x6e0
     SyS_execve+0x3a/0x50
     return_from_execve+0x0/0x23
&#125; hitcount:      33348  bytes_req:   17152128  bytes_alloc:   20226048
&#123; stacktrace:
     kmem_cache_alloc_trace+0xeb/0x150
     apparmor_file_alloc_security+0x27/0x40
     security_file_alloc+0x16/0x20
     get_empty_filp+0x93/0x1c0
     path_openat+0x31/0x5f0
     do_filp_open+0x3a/0x90
     do_sys_open+0x128/0x220
     SyS_open+0x1e/0x20
     system_call_fastpath+0x12/0x6a
&#125; hitcount:    4766422  bytes_req:    9532844  bytes_alloc:   38131376
&#123; stacktrace:
     __kmalloc+0x11b/0x1b0
     seq_buf_alloc+0x1b/0x50
     seq_read+0x2cc/0x370
     proc_reg_read+0x3d/0x80
     __vfs_read+0x28/0xe0
     vfs_read+0x86/0x140
     SyS_read+0x46/0xb0
     system_call_fastpath+0x12/0x6a
&#125; hitcount:      19133  bytes_req:   78368768  bytes_alloc:   78368768

Totals:
    Hits: 6085872
    Entries: 253
    Dropped: 0
</code></pre>
<p>  If you key a hist trigger on common_pid, in order for example to<br>  gather and display sorted totals for each process, you can use the<br>  special .execname modifier to display the executable names for the<br>  processes in the table rather than raw pids.  The example below<br>  keeps a per-process sum of total bytes read:</p>
<pre><code># echo &#39;hist:key=common_pid.execname:val=count:sort=count.descending&#39; &gt; \
       /sys/kernel/debug/tracing/events/syscalls/sys_enter_read/trigger

# cat /sys/kernel/debug/tracing/events/syscalls/sys_enter_read/hist
# trigger info: hist:keys=common_pid.execname:vals=count:sort=count.descending:size=2048 [active]

&#123; common_pid: gnome-terminal  [      3196] &#125; hitcount:        280  count:    1093512
&#123; common_pid: Xorg            [      1309] &#125; hitcount:        525  count:     256640
&#123; common_pid: compiz          [      2889] &#125; hitcount:         59  count:     254400
&#123; common_pid: bash            [      8710] &#125; hitcount:          3  count:      66369
&#123; common_pid: dbus-daemon-lau [      8703] &#125; hitcount:         49  count:      47739
&#123; common_pid: irqbalance      [      1252] &#125; hitcount:         27  count:      27648
&#123; common_pid: 01ifupdown      [      8705] &#125; hitcount:          3  count:      17216
&#123; common_pid: dbus-daemon     [       772] &#125; hitcount:         10  count:      12396
&#123; common_pid: Socket Thread   [      8342] &#125; hitcount:         11  count:      11264
&#123; common_pid: nm-dhcp-client. [      8701] &#125; hitcount:          6  count:       7424
&#123; common_pid: gmain           [      1315] &#125; hitcount:         18  count:       6336
.
.
.
&#123; common_pid: postgres        [      1892] &#125; hitcount:          2  count:         32
&#123; common_pid: postgres        [      1891] &#125; hitcount:          2  count:         32
&#123; common_pid: gmain           [      8704] &#125; hitcount:          2  count:         32
&#123; common_pid: upstart-dbus-br [      2740] &#125; hitcount:         21  count:         21
&#123; common_pid: nm-dispatcher.a [      8696] &#125; hitcount:          1  count:         16
&#123; common_pid: indicator-datet [      2904] &#125; hitcount:          1  count:         16
&#123; common_pid: gdbus           [      2998] &#125; hitcount:          1  count:         16
&#123; common_pid: rtkit-daemon    [      2052] &#125; hitcount:          1  count:          8
&#123; common_pid: init            [         1] &#125; hitcount:          2  count:          2

Totals:
    Hits: 2116
    Entries: 51
    Dropped: 0
</code></pre>
<p>  Similarly, if you key a hist trigger on syscall id, for example to<br>  gather and display a list of systemwide syscall hits, you can use<br>  the special .syscall modifier to display the syscall names rather<br>  than raw ids.  The example below keeps a running total of syscall<br>  counts for the system during the run:</p>
<pre><code># echo &#39;hist:key=id.syscall:val=hitcount&#39; &gt; \
       /sys/kernel/debug/tracing/events/raw_syscalls/sys_enter/trigger

# cat /sys/kernel/debug/tracing/events/raw_syscalls/sys_enter/hist
# trigger info: hist:keys=id.syscall:vals=hitcount:sort=hitcount:size=2048 [active]

&#123; id: sys_fsync                     [ 74] &#125; hitcount:          1
&#123; id: sys_newuname                  [ 63] &#125; hitcount:          1
&#123; id: sys_prctl                     [157] &#125; hitcount:          1
&#123; id: sys_statfs                    [137] &#125; hitcount:          1
&#123; id: sys_symlink                   [ 88] &#125; hitcount:          1
&#123; id: sys_sendmmsg                  [307] &#125; hitcount:          1
&#123; id: sys_semctl                    [ 66] &#125; hitcount:          1
&#123; id: sys_readlink                  [ 89] &#125; hitcount:          3
&#123; id: sys_bind                      [ 49] &#125; hitcount:          3
&#123; id: sys_getsockname               [ 51] &#125; hitcount:          3
&#123; id: sys_unlink                    [ 87] &#125; hitcount:          3
&#123; id: sys_rename                    [ 82] &#125; hitcount:          4
&#123; id: unknown_syscall               [ 58] &#125; hitcount:          4
&#123; id: sys_connect                   [ 42] &#125; hitcount:          4
&#123; id: sys_getpid                    [ 39] &#125; hitcount:          4
.
.
.
&#123; id: sys_rt_sigprocmask            [ 14] &#125; hitcount:        952
&#123; id: sys_futex                     [202] &#125; hitcount:       1534
&#123; id: sys_write                     [  1] &#125; hitcount:       2689
&#123; id: sys_setitimer                 [ 38] &#125; hitcount:       2797
&#123; id: sys_read                      [  0] &#125; hitcount:       3202
&#123; id: sys_select                    [ 23] &#125; hitcount:       3773
&#123; id: sys_writev                    [ 20] &#125; hitcount:       4531
&#123; id: sys_poll                      [  7] &#125; hitcount:       8314
&#123; id: sys_recvmsg                   [ 47] &#125; hitcount:      13738
&#123; id: sys_ioctl                     [ 16] &#125; hitcount:      21843

Totals:
    Hits: 67612
    Entries: 72
    Dropped: 0

The syscall counts above provide a rough overall picture of system
call activity on the system; we can see for example that the most
popular system call on this system was the &#39;sys_ioctl&#39; system call.

We can use &#39;compound&#39; keys to refine that number and provide some
further insight as to which processes exactly contribute to the
overall ioctl count.

The command below keeps a hitcount for every unique combination of
system call id and pid - the end result is essentially a table
that keeps a per-pid sum of system call hits.  The results are
sorted using the system call id as the primary key, and the
hitcount sum as the secondary key:

# echo &#39;hist:key=id.syscall,common_pid.execname:val=hitcount:sort=id,hitcount&#39; &gt; \
       /sys/kernel/debug/tracing/events/raw_syscalls/sys_enter/trigger

# cat /sys/kernel/debug/tracing/events/raw_syscalls/sys_enter/hist
# trigger info: hist:keys=id.syscall,common_pid.execname:vals=hitcount:sort=id.syscall,hitcount:size=2048 [active]

&#123; id: sys_read                      [  0], common_pid: rtkit-daemon    [      1877] &#125; hitcount:          1
&#123; id: sys_read                      [  0], common_pid: gdbus           [      2976] &#125; hitcount:          1
&#123; id: sys_read                      [  0], common_pid: console-kit-dae [      3400] &#125; hitcount:          1
&#123; id: sys_read                      [  0], common_pid: postgres        [      1865] &#125; hitcount:          1
&#123; id: sys_read                      [  0], common_pid: deja-dup-monito [      3543] &#125; hitcount:          2
&#123; id: sys_read                      [  0], common_pid: NetworkManager  [       890] &#125; hitcount:          2
&#123; id: sys_read                      [  0], common_pid: evolution-calen [      3048] &#125; hitcount:          2
&#123; id: sys_read                      [  0], common_pid: postgres        [      1864] &#125; hitcount:          2
&#123; id: sys_read                      [  0], common_pid: nm-applet       [      3022] &#125; hitcount:          2
&#123; id: sys_read                      [  0], common_pid: whoopsie        [      1212] &#125; hitcount:          2
.
.
.
&#123; id: sys_ioctl                     [ 16], common_pid: bash            [      8479] &#125; hitcount:          1
&#123; id: sys_ioctl                     [ 16], common_pid: bash            [      3472] &#125; hitcount:         12
&#123; id: sys_ioctl                     [ 16], common_pid: gnome-terminal  [      3199] &#125; hitcount:         16
&#123; id: sys_ioctl                     [ 16], common_pid: Xorg            [      1267] &#125; hitcount:       1808
&#123; id: sys_ioctl                     [ 16], common_pid: compiz          [      2994] &#125; hitcount:       5580
.
.
.
&#123; id: sys_waitid                    [247], common_pid: upstart-dbus-br [      2690] &#125; hitcount:          3
&#123; id: sys_waitid                    [247], common_pid: upstart-dbus-br [      2688] &#125; hitcount:         16
&#123; id: sys_inotify_add_watch         [254], common_pid: gmain           [       975] &#125; hitcount:          2
&#123; id: sys_inotify_add_watch         [254], common_pid: gmain           [      3204] &#125; hitcount:          4
&#123; id: sys_inotify_add_watch         [254], common_pid: gmain           [      2888] &#125; hitcount:          4
&#123; id: sys_inotify_add_watch         [254], common_pid: gmain           [      3003] &#125; hitcount:          4
&#123; id: sys_inotify_add_watch         [254], common_pid: gmain           [      2873] &#125; hitcount:          4
&#123; id: sys_inotify_add_watch         [254], common_pid: gmain           [      3196] &#125; hitcount:          6
&#123; id: sys_openat                    [257], common_pid: java            [      2623] &#125; hitcount:          2
&#123; id: sys_eventfd2                  [290], common_pid: ibus-ui-gtk3    [      2760] &#125; hitcount:          4
&#123; id: sys_eventfd2                  [290], common_pid: compiz          [      2994] &#125; hitcount:          6

Totals:
    Hits: 31536
    Entries: 323
    Dropped: 0

The above list does give us a breakdown of the ioctl syscall by
pid, but it also gives us quite a bit more than that, which we
don&#39;t really care about at the moment.  Since we know the syscall
id for sys_ioctl (16, displayed next to the sys_ioctl name), we
can use that to filter out all the other syscalls:

# echo &#39;hist:key=id.syscall,common_pid.execname:val=hitcount:sort=id,hitcount if id == 16&#39; &gt; \
       /sys/kernel/debug/tracing/events/raw_syscalls/sys_enter/trigger

# cat /sys/kernel/debug/tracing/events/raw_syscalls/sys_enter/hist
# trigger info: hist:keys=id.syscall,common_pid.execname:vals=hitcount:sort=id.syscall,hitcount:size=2048 if id == 16 [active]

&#123; id: sys_ioctl                     [ 16], common_pid: gmain           [      2769] &#125; hitcount:          1
&#123; id: sys_ioctl                     [ 16], common_pid: evolution-addre [      8571] &#125; hitcount:          1
&#123; id: sys_ioctl                     [ 16], common_pid: gmain           [      3003] &#125; hitcount:          1
&#123; id: sys_ioctl                     [ 16], common_pid: gmain           [      2781] &#125; hitcount:          1
&#123; id: sys_ioctl                     [ 16], common_pid: gmain           [      2829] &#125; hitcount:          1
&#123; id: sys_ioctl                     [ 16], common_pid: bash            [      8726] &#125; hitcount:          1
&#123; id: sys_ioctl                     [ 16], common_pid: bash            [      8508] &#125; hitcount:          1
&#123; id: sys_ioctl                     [ 16], common_pid: gmain           [      2970] &#125; hitcount:          1
&#123; id: sys_ioctl                     [ 16], common_pid: gmain           [      2768] &#125; hitcount:          1
.
.
.
&#123; id: sys_ioctl                     [ 16], common_pid: pool            [      8559] &#125; hitcount:         45
&#123; id: sys_ioctl                     [ 16], common_pid: pool            [      8555] &#125; hitcount:         48
&#123; id: sys_ioctl                     [ 16], common_pid: pool            [      8551] &#125; hitcount:         48
&#123; id: sys_ioctl                     [ 16], common_pid: avahi-daemon    [       896] &#125; hitcount:         66
&#123; id: sys_ioctl                     [ 16], common_pid: Xorg            [      1267] &#125; hitcount:      26674
&#123; id: sys_ioctl                     [ 16], common_pid: compiz          [      2994] &#125; hitcount:      73443

Totals:
    Hits: 101162
    Entries: 103
    Dropped: 0

The above output shows that &#39;compiz&#39; and &#39;Xorg&#39; are far and away
the heaviest ioctl callers (which might lead to questions about
whether they really need to be making all those calls and to
possible avenues for further investigation.)

The compound key examples used a key and a sum value (hitcount) to
sort the output, but we can just as easily use two keys instead.
Here&#39;s an example where we use a compound key composed of the the
common_pid and size event fields.  Sorting with pid as the primary
key and &#39;size&#39; as the secondary key allows us to display an
ordered summary of the recvfrom sizes, with counts, received by
each process:

# echo &#39;hist:key=common_pid.execname,size:val=hitcount:sort=common_pid,size&#39; &gt; \
       /sys/kernel/debug/tracing/events/syscalls/sys_enter_recvfrom/trigger

# cat /sys/kernel/debug/tracing/events/syscalls/sys_enter_recvfrom/hist
# trigger info: hist:keys=common_pid.execname,size:vals=hitcount:sort=common_pid.execname,size:size=2048 [active]

&#123; common_pid: smbd            [       784], size:          4 &#125; hitcount:          1
&#123; common_pid: dnsmasq         [      1412], size:       4096 &#125; hitcount:        672
&#123; common_pid: postgres        [      1796], size:       1000 &#125; hitcount:          6
&#123; common_pid: postgres        [      1867], size:       1000 &#125; hitcount:         10
&#123; common_pid: bamfdaemon      [      2787], size:         28 &#125; hitcount:          2
&#123; common_pid: bamfdaemon      [      2787], size:      14360 &#125; hitcount:          1
&#123; common_pid: compiz          [      2994], size:          8 &#125; hitcount:          1
&#123; common_pid: compiz          [      2994], size:         20 &#125; hitcount:         11
&#123; common_pid: gnome-terminal  [      3199], size:          4 &#125; hitcount:          2
&#123; common_pid: firefox         [      8817], size:          4 &#125; hitcount:          1
&#123; common_pid: firefox         [      8817], size:          8 &#125; hitcount:          5
&#123; common_pid: firefox         [      8817], size:        588 &#125; hitcount:          2
&#123; common_pid: firefox         [      8817], size:        628 &#125; hitcount:          1
&#123; common_pid: firefox         [      8817], size:       6944 &#125; hitcount:          1
&#123; common_pid: firefox         [      8817], size:     408880 &#125; hitcount:          2
&#123; common_pid: firefox         [      8822], size:          8 &#125; hitcount:          2
&#123; common_pid: firefox         [      8822], size:        160 &#125; hitcount:          2
&#123; common_pid: firefox         [      8822], size:        320 &#125; hitcount:          2
&#123; common_pid: firefox         [      8822], size:        352 &#125; hitcount:          1
.
.
.
&#123; common_pid: pool            [      8923], size:       1960 &#125; hitcount:         10
&#123; common_pid: pool            [      8923], size:       2048 &#125; hitcount:         10
&#123; common_pid: pool            [      8924], size:       1960 &#125; hitcount:         10
&#123; common_pid: pool            [      8924], size:       2048 &#125; hitcount:         10
&#123; common_pid: pool            [      8928], size:       1964 &#125; hitcount:          4
&#123; common_pid: pool            [      8928], size:       1965 &#125; hitcount:          2
&#123; common_pid: pool            [      8928], size:       2048 &#125; hitcount:          6
&#123; common_pid: pool            [      8929], size:       1982 &#125; hitcount:          1
&#123; common_pid: pool            [      8929], size:       2048 &#125; hitcount:          1

Totals:
    Hits: 2016
    Entries: 224
    Dropped: 0
</code></pre>
<p>  The above example also illustrates the fact that although a compound<br>  key is treated as a single entity for hashing purposes, the sub-keys<br>  it’s composed of can be accessed independently.</p>
<p>  The next example uses a string field as the hash key and<br>  demonstrates how you can manually pause and continue a hist trigger.<br>  In this example, we’ll aggregate fork counts and don’t expect a<br>  large number of entries in the hash table, so we’ll drop it to a<br>  much smaller number, say 256:</p>
<pre><code># echo &#39;hist:key=child_comm:val=hitcount:size=256&#39; &gt; \
       /sys/kernel/debug/tracing/events/sched/sched_process_fork/trigger

# cat /sys/kernel/debug/tracing/events/sched/sched_process_fork/hist
# trigger info: hist:keys=child_comm:vals=hitcount:sort=hitcount:size=256 [active]

&#123; child_comm: dconf worker                        &#125; hitcount:          1
&#123; child_comm: ibus-daemon                         &#125; hitcount:          1
&#123; child_comm: whoopsie                            &#125; hitcount:          1
&#123; child_comm: smbd                                &#125; hitcount:          1
&#123; child_comm: gdbus                               &#125; hitcount:          1
&#123; child_comm: kthreadd                            &#125; hitcount:          1
&#123; child_comm: dconf worker                        &#125; hitcount:          1
&#123; child_comm: evolution-alarm                     &#125; hitcount:          2
&#123; child_comm: Socket Thread                       &#125; hitcount:          2
&#123; child_comm: postgres                            &#125; hitcount:          2
&#123; child_comm: bash                                &#125; hitcount:          3
&#123; child_comm: compiz                              &#125; hitcount:          3
&#123; child_comm: evolution-sourc                     &#125; hitcount:          4
&#123; child_comm: dhclient                            &#125; hitcount:          4
&#123; child_comm: pool                                &#125; hitcount:          5
&#123; child_comm: nm-dispatcher.a                     &#125; hitcount:          8
&#123; child_comm: firefox                             &#125; hitcount:          8
&#123; child_comm: dbus-daemon                         &#125; hitcount:          8
&#123; child_comm: glib-pacrunner                      &#125; hitcount:         10
&#123; child_comm: evolution                           &#125; hitcount:         23

Totals:
    Hits: 89
    Entries: 20
    Dropped: 0
</code></pre>
<p>  If we want to pause the hist trigger, we can simply append :pause to<br>  the command that started the trigger.  Notice that the trigger info<br>  displays as [paused]:</p>
<pre><code># echo &#39;hist:key=child_comm:val=hitcount:size=256:pause&#39; &gt;&gt; \
       /sys/kernel/debug/tracing/events/sched/sched_process_fork/trigger

# cat /sys/kernel/debug/tracing/events/sched/sched_process_fork/hist
# trigger info: hist:keys=child_comm:vals=hitcount:sort=hitcount:size=256 [paused]

&#123; child_comm: dconf worker                        &#125; hitcount:          1
&#123; child_comm: kthreadd                            &#125; hitcount:          1
&#123; child_comm: dconf worker                        &#125; hitcount:          1
&#123; child_comm: gdbus                               &#125; hitcount:          1
&#123; child_comm: ibus-daemon                         &#125; hitcount:          1
&#123; child_comm: Socket Thread                       &#125; hitcount:          2
&#123; child_comm: evolution-alarm                     &#125; hitcount:          2
&#123; child_comm: smbd                                &#125; hitcount:          2
&#123; child_comm: bash                                &#125; hitcount:          3
&#123; child_comm: whoopsie                            &#125; hitcount:          3
&#123; child_comm: compiz                              &#125; hitcount:          3
&#123; child_comm: evolution-sourc                     &#125; hitcount:          4
&#123; child_comm: pool                                &#125; hitcount:          5
&#123; child_comm: postgres                            &#125; hitcount:          6
&#123; child_comm: firefox                             &#125; hitcount:          8
&#123; child_comm: dhclient                            &#125; hitcount:         10
&#123; child_comm: emacs                               &#125; hitcount:         12
&#123; child_comm: dbus-daemon                         &#125; hitcount:         20
&#123; child_comm: nm-dispatcher.a                     &#125; hitcount:         20
&#123; child_comm: evolution                           &#125; hitcount:         35
&#123; child_comm: glib-pacrunner                      &#125; hitcount:         59

Totals:
    Hits: 199
    Entries: 21
    Dropped: 0
</code></pre>
<p>  To manually continue having the trigger aggregate events, append<br>  :cont instead.  Notice that the trigger info displays as [active]<br>  again, and the data has changed:</p>
<pre><code># echo &#39;hist:key=child_comm:val=hitcount:size=256:cont&#39; &gt;&gt; \
       /sys/kernel/debug/tracing/events/sched/sched_process_fork/trigger

# cat /sys/kernel/debug/tracing/events/sched/sched_process_fork/hist
# trigger info: hist:keys=child_comm:vals=hitcount:sort=hitcount:size=256 [active]

&#123; child_comm: dconf worker                        &#125; hitcount:          1
&#123; child_comm: dconf worker                        &#125; hitcount:          1
&#123; child_comm: kthreadd                            &#125; hitcount:          1
&#123; child_comm: gdbus                               &#125; hitcount:          1
&#123; child_comm: ibus-daemon                         &#125; hitcount:          1
&#123; child_comm: Socket Thread                       &#125; hitcount:          2
&#123; child_comm: evolution-alarm                     &#125; hitcount:          2
&#123; child_comm: smbd                                &#125; hitcount:          2
&#123; child_comm: whoopsie                            &#125; hitcount:          3
&#123; child_comm: compiz                              &#125; hitcount:          3
&#123; child_comm: evolution-sourc                     &#125; hitcount:          4
&#123; child_comm: bash                                &#125; hitcount:          5
&#123; child_comm: pool                                &#125; hitcount:          5
&#123; child_comm: postgres                            &#125; hitcount:          6
&#123; child_comm: firefox                             &#125; hitcount:          8
&#123; child_comm: dhclient                            &#125; hitcount:         11
&#123; child_comm: emacs                               &#125; hitcount:         12
&#123; child_comm: dbus-daemon                         &#125; hitcount:         22
&#123; child_comm: nm-dispatcher.a                     &#125; hitcount:         22
&#123; child_comm: evolution                           &#125; hitcount:         35
&#123; child_comm: glib-pacrunner                      &#125; hitcount:         59

Totals:
    Hits: 206
    Entries: 21
    Dropped: 0
</code></pre>
<p>  The previous example showed how to start and stop a hist trigger by<br>  appending ‘pause’ and ‘continue’ to the hist trigger command.  A<br>  hist trigger can also be started in a paused state by initially<br>  starting the trigger with ‘:pause’ appended.  This allows you to<br>  start the trigger only when you’re ready to start collecting data<br>  and not before.  For example, you could start the trigger in a<br>  paused state, then unpause it and do something you want to measure,<br>  then pause the trigger again when done.</p>
<p>  Of course, doing this manually can be difficult and error-prone, but<br>  it is possible to automatically start and stop a hist trigger based<br>  on some condition, via the enable_hist and disable_hist triggers.</p>
<p>  For example, suppose we wanted to take a look at the relative<br>  weights in terms of skb length for each callpath that leads to a<br>  netif_receieve_skb event when downloading a decent-sized file using<br>  wget.</p>
<p>  First we set up an initially paused stacktrace trigger on the<br>  netif_receive_skb event:</p>
<pre><code># echo &#39;hist:key=stacktrace:vals=len:pause&#39; &gt; \
       /sys/kernel/debug/tracing/events/net/netif_receive_skb/trigger
</code></pre>
<p>  Next, we set up an ‘enable_hist’ trigger on the sched_process_exec<br>  event, with an ‘if filename==/usr/bin/wget’ filter.  The effect of<br>  this new trigger is that it will ‘unpause’ the hist trigger we just<br>  set up on netif_receive_skb if and only if it sees a<br>  sched_process_exec event with a filename of ‘/usr/bin/wget’.  When<br>  that happens, all netif_receive_skb events are aggregated into a<br>  hash table keyed on stacktrace:</p>
<pre><code># echo &#39;enable_hist:net:netif_receive_skb if filename==/usr/bin/wget&#39; &gt; \
       /sys/kernel/debug/tracing/events/sched/sched_process_exec/trigger
</code></pre>
<p>  The aggregation continues until the netif_receive_skb is paused<br>  again, which is what the following disable_hist event does by<br>  creating a similar setup on the sched_process_exit event, using the<br>  filter ‘comm==wget’:</p>
<pre><code># echo &#39;disable_hist:net:netif_receive_skb if comm==wget&#39; &gt; \
       /sys/kernel/debug/tracing/events/sched/sched_process_exit/trigger
</code></pre>
<p>  Whenever a process exits and the comm field of the disable_hist<br>  trigger filter matches ‘comm==wget’, the netif_receive_skb hist<br>  trigger is disabled.</p>
<p>  The overall effect is that netif_receive_skb events are aggregated<br>  into the hash table for only the duration of the wget.  Executing a<br>  wget command and then listing the ‘hist’ file will display the<br>  output generated by the wget command:</p>
<pre><code>$ wget https://www.kernel.org/pub/linux/kernel/v3.x/patch-3.19.xz

# cat /sys/kernel/debug/tracing/events/net/netif_receive_skb/hist
# trigger info: hist:keys=stacktrace:vals=len:sort=hitcount:size=2048 [paused]

&#123; stacktrace:
     __netif_receive_skb_core+0x46d/0x990
     __netif_receive_skb+0x18/0x60
     netif_receive_skb_internal+0x23/0x90
     napi_gro_receive+0xc8/0x100
     ieee80211_deliver_skb+0xd6/0x270 [mac80211]
     ieee80211_rx_handlers+0xccf/0x22f0 [mac80211]
     ieee80211_prepare_and_rx_handle+0x4e7/0xc40 [mac80211]
     ieee80211_rx+0x31d/0x900 [mac80211]
     iwlagn_rx_reply_rx+0x3db/0x6f0 [iwldvm]
     iwl_rx_dispatch+0x8e/0xf0 [iwldvm]
     iwl_pcie_irq_handler+0xe3c/0x12f0 [iwlwifi]
     irq_thread_fn+0x20/0x50
     irq_thread+0x11f/0x150
     kthread+0xd2/0xf0
     ret_from_fork+0x42/0x70
&#125; hitcount:         85  len:      28884
&#123; stacktrace:
     __netif_receive_skb_core+0x46d/0x990
     __netif_receive_skb+0x18/0x60
     netif_receive_skb_internal+0x23/0x90
     napi_gro_complete+0xa4/0xe0
     dev_gro_receive+0x23a/0x360
     napi_gro_receive+0x30/0x100
     ieee80211_deliver_skb+0xd6/0x270 [mac80211]
     ieee80211_rx_handlers+0xccf/0x22f0 [mac80211]
     ieee80211_prepare_and_rx_handle+0x4e7/0xc40 [mac80211]
     ieee80211_rx+0x31d/0x900 [mac80211]
     iwlagn_rx_reply_rx+0x3db/0x6f0 [iwldvm]
     iwl_rx_dispatch+0x8e/0xf0 [iwldvm]
     iwl_pcie_irq_handler+0xe3c/0x12f0 [iwlwifi]
     irq_thread_fn+0x20/0x50
     irq_thread+0x11f/0x150
     kthread+0xd2/0xf0
&#125; hitcount:         98  len:     664329
&#123; stacktrace:
     __netif_receive_skb_core+0x46d/0x990
     __netif_receive_skb+0x18/0x60
     process_backlog+0xa8/0x150
     net_rx_action+0x15d/0x340
     __do_softirq+0x114/0x2c0
     do_softirq_own_stack+0x1c/0x30
     do_softirq+0x65/0x70
     __local_bh_enable_ip+0xb5/0xc0
     ip_finish_output+0x1f4/0x840
     ip_output+0x6b/0xc0
     ip_local_out_sk+0x31/0x40
     ip_send_skb+0x1a/0x50
     udp_send_skb+0x173/0x2a0
     udp_sendmsg+0x2bf/0x9f0
     inet_sendmsg+0x64/0xa0
     sock_sendmsg+0x3d/0x50
&#125; hitcount:        115  len:      13030
&#123; stacktrace:
     __netif_receive_skb_core+0x46d/0x990
     __netif_receive_skb+0x18/0x60
     netif_receive_skb_internal+0x23/0x90
     napi_gro_complete+0xa4/0xe0
     napi_gro_flush+0x6d/0x90
     iwl_pcie_irq_handler+0x92a/0x12f0 [iwlwifi]
     irq_thread_fn+0x20/0x50
     irq_thread+0x11f/0x150
     kthread+0xd2/0xf0
     ret_from_fork+0x42/0x70
&#125; hitcount:        934  len:    5512212

Totals:
    Hits: 1232
    Entries: 4
    Dropped: 0
</code></pre>
<p>  The above shows all the netif_receive_skb callpaths and their total<br>  lengths for the duration of the wget command.</p>
<p>  The ‘clear’ hist trigger param can be used to clear the hash table.<br>  Suppose we wanted to try another run of the previous example but<br>  this time also wanted to see the complete list of events that went<br>  into the histogram.  In order to avoid having to set everything up<br>  again, we can just clear the histogram first:</p>
<pre><code># echo &#39;hist:key=stacktrace:vals=len:clear&#39; &gt;&gt; \
       /sys/kernel/debug/tracing/events/net/netif_receive_skb/trigger
</code></pre>
<p>  Just to verify that it is in fact cleared, here’s what we now see in<br>  the hist file:</p>
<pre><code># cat /sys/kernel/debug/tracing/events/net/netif_receive_skb/hist
# trigger info: hist:keys=stacktrace:vals=len:sort=hitcount:size=2048 [paused]

Totals:
    Hits: 0
    Entries: 0
    Dropped: 0
</code></pre>
<p>  Since we want to see the detailed list of every netif_receive_skb<br>  event occurring during the new run, which are in fact the same<br>  events being aggregated into the hash table, we add some additional<br>  ‘enable_event’ events to the triggering sched_process_exec and<br>  sched_process_exit events as such:</p>
<pre><code># echo &#39;enable_event:net:netif_receive_skb if filename==/usr/bin/wget&#39; &gt; \
       /sys/kernel/debug/tracing/events/sched/sched_process_exec/trigger

# echo &#39;disable_event:net:netif_receive_skb if comm==wget&#39; &gt; \
       /sys/kernel/debug/tracing/events/sched/sched_process_exit/trigger
</code></pre>
<p>  If you read the trigger files for the sched_process_exec and<br>  sched_process_exit triggers, you should see two triggers for each:<br>  one enabling/disabling the hist aggregation and the other<br>  enabling/disabling the logging of events:</p>
<pre><code># cat /sys/kernel/debug/tracing/events/sched/sched_process_exec/trigger
enable_event:net:netif_receive_skb:unlimited if filename==/usr/bin/wget
enable_hist:net:netif_receive_skb:unlimited if filename==/usr/bin/wget

# cat /sys/kernel/debug/tracing/events/sched/sched_process_exit/trigger
enable_event:net:netif_receive_skb:unlimited if comm==wget
disable_hist:net:netif_receive_skb:unlimited if comm==wget
</code></pre>
<p>  In other words, whenever either of the sched_process_exec or<br>  sched_process_exit events is hit and matches ‘wget’, it enables or<br>  disables both the histogram and the event log, and what you end up<br>  with is a hash table and set of events just covering the specified<br>  duration.  Run the wget command again:</p>
<pre><code>$ wget https://www.kernel.org/pub/linux/kernel/v3.x/patch-3.19.xz
</code></pre>
<p>  Displaying the ‘hist’ file should show something similar to what you<br>  saw in the last run, but this time you should also see the<br>  individual events in the trace file:</p>
<pre><code># cat /sys/kernel/debug/tracing/trace

# tracer: nop
#
# entries-in-buffer/entries-written: 183/1426   #P:4
#
#                              _-----=&gt; irqs-off
#                             / _----=&gt; need-resched
#                            | / _---=&gt; hardirq/softirq
#                            || / _--=&gt; preempt-depth
#                            ||| /     delay
#           TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION
#              | |       |   ||||       |         |
            wget-15108 [000] ..s1 31769.606929: netif_receive_skb: dev=lo skbaddr=ffff88009c353100 len=60
            wget-15108 [000] ..s1 31769.606999: netif_receive_skb: dev=lo skbaddr=ffff88009c353200 len=60
         dnsmasq-1382  [000] ..s1 31769.677652: netif_receive_skb: dev=lo skbaddr=ffff88009c352b00 len=130
         dnsmasq-1382  [000] ..s1 31769.685917: netif_receive_skb: dev=lo skbaddr=ffff88009c352200 len=138
##### CPU 2 buffer started ####
  irq/29-iwlwifi-559   [002] ..s. 31772.031529: netif_receive_skb: dev=wlan0 skbaddr=ffff88009d433d00 len=2948
  irq/29-iwlwifi-559   [002] ..s. 31772.031572: netif_receive_skb: dev=wlan0 skbaddr=ffff88009d432200 len=1500
  irq/29-iwlwifi-559   [002] ..s. 31772.032196: netif_receive_skb: dev=wlan0 skbaddr=ffff88009d433100 len=2948
  irq/29-iwlwifi-559   [002] ..s. 31772.032761: netif_receive_skb: dev=wlan0 skbaddr=ffff88009d433000 len=2948
  irq/29-iwlwifi-559   [002] ..s. 31772.033220: netif_receive_skb: dev=wlan0 skbaddr=ffff88009d432e00 len=1500
.
.
.
</code></pre>
<p>  The following example demonstrates how multiple hist triggers can be<br>  attached to a given event.  This capability can be useful for<br>  creating a set of different summaries derived from the same set of<br>  events, or for comparing the effects of different filters, among<br>  other things.</p>
<pre><code># echo &#39;hist:keys=skbaddr.hex:vals=len if len &lt; 0&#39; &gt;&gt; \
       /sys/kernel/debug/tracing/events/net/netif_receive_skb/trigger
# echo &#39;hist:keys=skbaddr.hex:vals=len if len &gt; 4096&#39; &gt;&gt; \
       /sys/kernel/debug/tracing/events/net/netif_receive_skb/trigger
# echo &#39;hist:keys=skbaddr.hex:vals=len if len == 256&#39; &gt;&gt; \
       /sys/kernel/debug/tracing/events/net/netif_receive_skb/trigger
# echo &#39;hist:keys=skbaddr.hex:vals=len&#39; &gt;&gt; \
       /sys/kernel/debug/tracing/events/net/netif_receive_skb/trigger
# echo &#39;hist:keys=len:vals=common_preempt_count&#39; &gt;&gt; \
       /sys/kernel/debug/tracing/events/net/netif_receive_skb/trigger
</code></pre>
<p>  The above set of commands create four triggers differing only in<br>  their filters, along with a completely different though fairly<br>  nonsensical trigger.  Note that in order to append multiple hist<br>  triggers to the same file, you should use the ‘&gt;&gt;’ operator to<br>  append them (‘&gt;’ will also add the new hist trigger, but will remove<br>  any existing hist triggers beforehand).</p>
<p>  Displaying the contents of the ‘hist’ file for the event shows the<br>  contents of all five histograms:</p>
<pre><code># cat /sys/kernel/debug/tracing/events/net/netif_receive_skb/hist

# event histogram
#
# trigger info: hist:keys=len:vals=hitcount,common_preempt_count:sort=hitcount:size=2048 [active]
#

&#123; len:        176 &#125; hitcount:          1  common_preempt_count:          0
&#123; len:        223 &#125; hitcount:          1  common_preempt_count:          0
&#123; len:       4854 &#125; hitcount:          1  common_preempt_count:          0
&#123; len:        395 &#125; hitcount:          1  common_preempt_count:          0
&#123; len:        177 &#125; hitcount:          1  common_preempt_count:          0
&#123; len:        446 &#125; hitcount:          1  common_preempt_count:          0
&#123; len:       1601 &#125; hitcount:          1  common_preempt_count:          0
.
.
.
&#123; len:       1280 &#125; hitcount:         66  common_preempt_count:          0
&#123; len:        116 &#125; hitcount:         81  common_preempt_count:         40
&#123; len:        708 &#125; hitcount:        112  common_preempt_count:          0
&#123; len:         46 &#125; hitcount:        221  common_preempt_count:          0
&#123; len:       1264 &#125; hitcount:        458  common_preempt_count:          0

Totals:
    Hits: 1428
    Entries: 147
    Dropped: 0


# event histogram
#
# trigger info: hist:keys=skbaddr.hex:vals=hitcount,len:sort=hitcount:size=2048 [active]
#

&#123; skbaddr: ffff8800baee5e00 &#125; hitcount:          1  len:        130
&#123; skbaddr: ffff88005f3d5600 &#125; hitcount:          1  len:       1280
&#123; skbaddr: ffff88005f3d4900 &#125; hitcount:          1  len:       1280
&#123; skbaddr: ffff88009fed6300 &#125; hitcount:          1  len:        115
&#123; skbaddr: ffff88009fe0ad00 &#125; hitcount:          1  len:        115
&#123; skbaddr: ffff88008cdb1900 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff880064b5ef00 &#125; hitcount:          1  len:        118
&#123; skbaddr: ffff880044e3c700 &#125; hitcount:          1  len:         60
&#123; skbaddr: ffff880100065900 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff8800d46bd500 &#125; hitcount:          1  len:        116
&#123; skbaddr: ffff88005f3d5f00 &#125; hitcount:          1  len:       1280
&#123; skbaddr: ffff880100064700 &#125; hitcount:          1  len:        365
&#123; skbaddr: ffff8800badb6f00 &#125; hitcount:          1  len:         60
.
.
.
&#123; skbaddr: ffff88009fe0be00 &#125; hitcount:         27  len:      24677
&#123; skbaddr: ffff88009fe0a400 &#125; hitcount:         27  len:      23052
&#123; skbaddr: ffff88009fe0b700 &#125; hitcount:         31  len:      25589
&#123; skbaddr: ffff88009fe0b600 &#125; hitcount:         32  len:      27326
&#123; skbaddr: ffff88006a462800 &#125; hitcount:         68  len:      71678
&#123; skbaddr: ffff88006a463700 &#125; hitcount:         70  len:      72678
&#123; skbaddr: ffff88006a462b00 &#125; hitcount:         71  len:      77589
&#123; skbaddr: ffff88006a463600 &#125; hitcount:         73  len:      71307
&#123; skbaddr: ffff88006a462200 &#125; hitcount:         81  len:      81032

Totals:
    Hits: 1451
    Entries: 318
    Dropped: 0


# event histogram
#
# trigger info: hist:keys=skbaddr.hex:vals=hitcount,len:sort=hitcount:size=2048 if len == 256 [active]
#


Totals:
    Hits: 0
    Entries: 0
    Dropped: 0


# event histogram
#
# trigger info: hist:keys=skbaddr.hex:vals=hitcount,len:sort=hitcount:size=2048 if len &gt; 4096 [active]
#

&#123; skbaddr: ffff88009fd2c300 &#125; hitcount:          1  len:       7212
&#123; skbaddr: ffff8800d2bcce00 &#125; hitcount:          1  len:       7212
&#123; skbaddr: ffff8800d2bcd700 &#125; hitcount:          1  len:       7212
&#123; skbaddr: ffff8800d2bcda00 &#125; hitcount:          1  len:      21492
&#123; skbaddr: ffff8800ae2e2d00 &#125; hitcount:          1  len:       7212
&#123; skbaddr: ffff8800d2bcdb00 &#125; hitcount:          1  len:       7212
&#123; skbaddr: ffff88006a4df500 &#125; hitcount:          1  len:       4854
&#123; skbaddr: ffff88008ce47b00 &#125; hitcount:          1  len:      18636
&#123; skbaddr: ffff8800ae2e2200 &#125; hitcount:          1  len:      12924
&#123; skbaddr: ffff88005f3e1000 &#125; hitcount:          1  len:       4356
&#123; skbaddr: ffff8800d2bcdc00 &#125; hitcount:          2  len:      24420
&#123; skbaddr: ffff8800d2bcc200 &#125; hitcount:          2  len:      12996

Totals:
    Hits: 14
    Entries: 12
    Dropped: 0


# event histogram
#
# trigger info: hist:keys=skbaddr.hex:vals=hitcount,len:sort=hitcount:size=2048 if len &lt; 0 [active]
#


Totals:
    Hits: 0
    Entries: 0
    Dropped: 0
</code></pre>
<p>  Named triggers can be used to have triggers share a common set of<br>  histogram data.  This capability is mostly useful for combining the<br>  output of events generated by tracepoints contained inside inline<br>  functions, but names can be used in a hist trigger on any event.<br>  For example, these two triggers when hit will update the same ‘len’<br>  field in the shared ‘foo’ histogram data:</p>
<pre><code># echo &#39;hist:name=foo:keys=skbaddr.hex:vals=len&#39; &gt; \
       /sys/kernel/debug/tracing/events/net/netif_receive_skb/trigger
# echo &#39;hist:name=foo:keys=skbaddr.hex:vals=len&#39; &gt; \
       /sys/kernel/debug/tracing/events/net/netif_rx/trigger
</code></pre>
<p>  You can see that they’re updating common histogram data by reading<br>  each event’s hist files at the same time:</p>
<pre><code># cat /sys/kernel/debug/tracing/events/net/netif_receive_skb/hist;
  cat /sys/kernel/debug/tracing/events/net/netif_rx/hist

# event histogram
#
# trigger info: hist:name=foo:keys=skbaddr.hex:vals=hitcount,len:sort=hitcount:size=2048 [active]
#

&#123; skbaddr: ffff88000ad53500 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff8800af5a1500 &#125; hitcount:          1  len:         76
&#123; skbaddr: ffff8800d62a1900 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff8800d2bccb00 &#125; hitcount:          1  len:        468
&#123; skbaddr: ffff8800d3c69900 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff88009ff09100 &#125; hitcount:          1  len:         52
&#123; skbaddr: ffff88010f13ab00 &#125; hitcount:          1  len:        168
&#123; skbaddr: ffff88006a54f400 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff8800d2bcc500 &#125; hitcount:          1  len:        260
&#123; skbaddr: ffff880064505000 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff8800baf24e00 &#125; hitcount:          1  len:         32
&#123; skbaddr: ffff88009fe0ad00 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff8800d3edff00 &#125; hitcount:          1  len:         44
&#123; skbaddr: ffff88009fe0b400 &#125; hitcount:          1  len:        168
&#123; skbaddr: ffff8800a1c55a00 &#125; hitcount:          1  len:         40
&#123; skbaddr: ffff8800d2bcd100 &#125; hitcount:          1  len:         40
&#123; skbaddr: ffff880064505f00 &#125; hitcount:          1  len:        174
&#123; skbaddr: ffff8800a8bff200 &#125; hitcount:          1  len:        160
&#123; skbaddr: ffff880044e3cc00 &#125; hitcount:          1  len:         76
&#123; skbaddr: ffff8800a8bfe700 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff8800d2bcdc00 &#125; hitcount:          1  len:         32
&#123; skbaddr: ffff8800a1f64800 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff8800d2bcde00 &#125; hitcount:          1  len:        988
&#123; skbaddr: ffff88006a5dea00 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff88002e37a200 &#125; hitcount:          1  len:         44
&#123; skbaddr: ffff8800a1f32c00 &#125; hitcount:          2  len:        676
&#123; skbaddr: ffff88000ad52600 &#125; hitcount:          2  len:        107
&#123; skbaddr: ffff8800a1f91e00 &#125; hitcount:          2  len:         92
&#123; skbaddr: ffff8800af5a0200 &#125; hitcount:          2  len:        142
&#123; skbaddr: ffff8800d2bcc600 &#125; hitcount:          2  len:        220
&#123; skbaddr: ffff8800ba36f500 &#125; hitcount:          2  len:         92
&#123; skbaddr: ffff8800d021f800 &#125; hitcount:          2  len:         92
&#123; skbaddr: ffff8800a1f33600 &#125; hitcount:          2  len:        675
&#123; skbaddr: ffff8800a8bfff00 &#125; hitcount:          3  len:        138
&#123; skbaddr: ffff8800d62a1300 &#125; hitcount:          3  len:        138
&#123; skbaddr: ffff88002e37a100 &#125; hitcount:          4  len:        184
&#123; skbaddr: ffff880064504400 &#125; hitcount:          4  len:        184
&#123; skbaddr: ffff8800a8bfec00 &#125; hitcount:          4  len:        184
&#123; skbaddr: ffff88000ad53700 &#125; hitcount:          5  len:        230
&#123; skbaddr: ffff8800d2bcdb00 &#125; hitcount:          5  len:        196
&#123; skbaddr: ffff8800a1f90000 &#125; hitcount:          6  len:        276
&#123; skbaddr: ffff88006a54f900 &#125; hitcount:          6  len:        276

Totals:
    Hits: 81
    Entries: 42
    Dropped: 0
# event histogram
#
# trigger info: hist:name=foo:keys=skbaddr.hex:vals=hitcount,len:sort=hitcount:size=2048 [active]
#

&#123; skbaddr: ffff88000ad53500 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff8800af5a1500 &#125; hitcount:          1  len:         76
&#123; skbaddr: ffff8800d62a1900 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff8800d2bccb00 &#125; hitcount:          1  len:        468
&#123; skbaddr: ffff8800d3c69900 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff88009ff09100 &#125; hitcount:          1  len:         52
&#123; skbaddr: ffff88010f13ab00 &#125; hitcount:          1  len:        168
&#123; skbaddr: ffff88006a54f400 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff8800d2bcc500 &#125; hitcount:          1  len:        260
&#123; skbaddr: ffff880064505000 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff8800baf24e00 &#125; hitcount:          1  len:         32
&#123; skbaddr: ffff88009fe0ad00 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff8800d3edff00 &#125; hitcount:          1  len:         44
&#123; skbaddr: ffff88009fe0b400 &#125; hitcount:          1  len:        168
&#123; skbaddr: ffff8800a1c55a00 &#125; hitcount:          1  len:         40
&#123; skbaddr: ffff8800d2bcd100 &#125; hitcount:          1  len:         40
&#123; skbaddr: ffff880064505f00 &#125; hitcount:          1  len:        174
&#123; skbaddr: ffff8800a8bff200 &#125; hitcount:          1  len:        160
&#123; skbaddr: ffff880044e3cc00 &#125; hitcount:          1  len:         76
&#123; skbaddr: ffff8800a8bfe700 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff8800d2bcdc00 &#125; hitcount:          1  len:         32
&#123; skbaddr: ffff8800a1f64800 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff8800d2bcde00 &#125; hitcount:          1  len:        988
&#123; skbaddr: ffff88006a5dea00 &#125; hitcount:          1  len:         46
&#123; skbaddr: ffff88002e37a200 &#125; hitcount:          1  len:         44
&#123; skbaddr: ffff8800a1f32c00 &#125; hitcount:          2  len:        676
&#123; skbaddr: ffff88000ad52600 &#125; hitcount:          2  len:        107
&#123; skbaddr: ffff8800a1f91e00 &#125; hitcount:          2  len:         92
&#123; skbaddr: ffff8800af5a0200 &#125; hitcount:          2  len:        142
&#123; skbaddr: ffff8800d2bcc600 &#125; hitcount:          2  len:        220
&#123; skbaddr: ffff8800ba36f500 &#125; hitcount:          2  len:         92
&#123; skbaddr: ffff8800d021f800 &#125; hitcount:          2  len:         92
&#123; skbaddr: ffff8800a1f33600 &#125; hitcount:          2  len:        675
&#123; skbaddr: ffff8800a8bfff00 &#125; hitcount:          3  len:        138
&#123; skbaddr: ffff8800d62a1300 &#125; hitcount:          3  len:        138
&#123; skbaddr: ffff88002e37a100 &#125; hitcount:          4  len:        184
&#123; skbaddr: ffff880064504400 &#125; hitcount:          4  len:        184
&#123; skbaddr: ffff8800a8bfec00 &#125; hitcount:          4  len:        184
&#123; skbaddr: ffff88000ad53700 &#125; hitcount:          5  len:        230
&#123; skbaddr: ffff8800d2bcdb00 &#125; hitcount:          5  len:        196
&#123; skbaddr: ffff8800a1f90000 &#125; hitcount:          6  len:        276
&#123; skbaddr: ffff88006a54f900 &#125; hitcount:          6  len:        276

Totals:
    Hits: 81
    Entries: 42
    Dropped: 0
</code></pre>
<p>  And here’s an example that shows how to combine histogram data from<br>  any two events even if they don’t share any ‘compatible’ fields<br>  other than ‘hitcount’ and ‘stacktrace’.  These commands create a<br>  couple of triggers named ‘bar’ using those fields:</p>
<pre><code># echo &#39;hist:name=bar:key=stacktrace:val=hitcount&#39; &gt; \
       /sys/kernel/debug/tracing/events/sched/sched_process_fork/trigger
# echo &#39;hist:name=bar:key=stacktrace:val=hitcount&#39; &gt; \
      /sys/kernel/debug/tracing/events/net/netif_rx/trigger
</code></pre>
<p>  And displaying the output of either shows some interesting if<br>  somewhat confusing output:</p>
<pre><code># cat /sys/kernel/debug/tracing/events/sched/sched_process_fork/hist
# cat /sys/kernel/debug/tracing/events/net/netif_rx/hist

# event histogram
#
# trigger info: hist:name=bar:keys=stacktrace:vals=hitcount:sort=hitcount:size=2048 [active]
#

&#123; stacktrace:
         _do_fork+0x18e/0x330
         kernel_thread+0x29/0x30
         kthreadd+0x154/0x1b0
         ret_from_fork+0x3f/0x70
&#125; hitcount:          1
&#123; stacktrace:
         netif_rx_internal+0xb2/0xd0
         netif_rx_ni+0x20/0x70
         dev_loopback_xmit+0xaa/0xd0
         ip_mc_output+0x126/0x240
         ip_local_out_sk+0x31/0x40
         igmp_send_report+0x1e9/0x230
         igmp_timer_expire+0xe9/0x120
         call_timer_fn+0x39/0xf0
         run_timer_softirq+0x1e1/0x290
         __do_softirq+0xfd/0x290
         irq_exit+0x98/0xb0
         smp_apic_timer_interrupt+0x4a/0x60
         apic_timer_interrupt+0x6d/0x80
         cpuidle_enter+0x17/0x20
         call_cpuidle+0x3b/0x60
         cpu_startup_entry+0x22d/0x310
&#125; hitcount:          1
&#123; stacktrace:
         netif_rx_internal+0xb2/0xd0
         netif_rx_ni+0x20/0x70
         dev_loopback_xmit+0xaa/0xd0
         ip_mc_output+0x17f/0x240
         ip_local_out_sk+0x31/0x40
         ip_send_skb+0x1a/0x50
         udp_send_skb+0x13e/0x270
         udp_sendmsg+0x2bf/0x980
         inet_sendmsg+0x67/0xa0
         sock_sendmsg+0x38/0x50
         SYSC_sendto+0xef/0x170
         SyS_sendto+0xe/0x10
         entry_SYSCALL_64_fastpath+0x12/0x6a
&#125; hitcount:          2
&#123; stacktrace:
         netif_rx_internal+0xb2/0xd0
         netif_rx+0x1c/0x60
         loopback_xmit+0x6c/0xb0
         dev_hard_start_xmit+0x219/0x3a0
         __dev_queue_xmit+0x415/0x4f0
         dev_queue_xmit_sk+0x13/0x20
         ip_finish_output2+0x237/0x340
         ip_finish_output+0x113/0x1d0
         ip_output+0x66/0xc0
         ip_local_out_sk+0x31/0x40
         ip_send_skb+0x1a/0x50
         udp_send_skb+0x16d/0x270
         udp_sendmsg+0x2bf/0x980
         inet_sendmsg+0x67/0xa0
         sock_sendmsg+0x38/0x50
         ___sys_sendmsg+0x14e/0x270
&#125; hitcount:         76
&#123; stacktrace:
         netif_rx_internal+0xb2/0xd0
         netif_rx+0x1c/0x60
         loopback_xmit+0x6c/0xb0
         dev_hard_start_xmit+0x219/0x3a0
         __dev_queue_xmit+0x415/0x4f0
         dev_queue_xmit_sk+0x13/0x20
         ip_finish_output2+0x237/0x340
         ip_finish_output+0x113/0x1d0
         ip_output+0x66/0xc0
         ip_local_out_sk+0x31/0x40
         ip_send_skb+0x1a/0x50
         udp_send_skb+0x16d/0x270
         udp_sendmsg+0x2bf/0x980
         inet_sendmsg+0x67/0xa0
         sock_sendmsg+0x38/0x50
         ___sys_sendmsg+0x269/0x270
&#125; hitcount:         77
&#123; stacktrace:
         netif_rx_internal+0xb2/0xd0
         netif_rx+0x1c/0x60
         loopback_xmit+0x6c/0xb0
         dev_hard_start_xmit+0x219/0x3a0
         __dev_queue_xmit+0x415/0x4f0
         dev_queue_xmit_sk+0x13/0x20
         ip_finish_output2+0x237/0x340
         ip_finish_output+0x113/0x1d0
         ip_output+0x66/0xc0
         ip_local_out_sk+0x31/0x40
         ip_send_skb+0x1a/0x50
         udp_send_skb+0x16d/0x270
         udp_sendmsg+0x2bf/0x980
         inet_sendmsg+0x67/0xa0
         sock_sendmsg+0x38/0x50
         SYSC_sendto+0xef/0x170
&#125; hitcount:         88
&#123; stacktrace:
         _do_fork+0x18e/0x330
         SyS_clone+0x19/0x20
         entry_SYSCALL_64_fastpath+0x12/0x6a
&#125; hitcount:        244

Totals:
    Hits: 489
    Entries: 7
    Dropped: 0
</code></pre>
<h2 id="2-2-Inter-event-hist-triggers"><a href="#2-2-Inter-event-hist-triggers" class="headerlink" title="2.2 Inter-event hist triggers"></a>2.2 Inter-event hist triggers</h2><p>Inter-event hist triggers are hist triggers that combine values from<br>one or more other events and create a histogram using that data.  Data<br>from an inter-event histogram can in turn become the source for<br>further combined histograms, thus providing a chain of related<br>histograms, which is important for some applications.</p>
<p>The most important example of an inter-event quantity that can be used<br>in this manner is latency, which is simply a difference in timestamps<br>between two events.  Although latency is the most important<br>inter-event quantity, note that because the support is completely<br>general across the trace event subsystem, any event field can be used<br>in an inter-event quantity.</p>
<p>An example of a histogram that combines data from other histograms<br>into a useful chain would be a ‘wakeupswitch latency’ histogram that<br>combines a ‘wakeup latency’ histogram and a ‘switch latency’<br>histogram.</p>
<p>Normally, a hist trigger specification consists of a (possibly<br>compound) key along with one or more numeric values, which are<br>continually updated sums associated with that key.  A histogram<br>specification in this case consists of individual key and value<br>specifications that refer to trace event fields associated with a<br>single event type.</p>
<p>The inter-event hist trigger extension allows fields from multiple<br>events to be referenced and combined into a multi-event histogram<br>specification.  In support of this overall goal, a few enabling<br>features have been added to the hist trigger support:</p>
<ul>
<li><p>In order to compute an inter-event quantity, a value from one<br>event needs to saved and then referenced from another event.  This<br>requires the introduction of support for histogram ‘variables’.</p>
</li>
<li><p>The computation of inter-event quantities and their combination<br>require some minimal amount of support for applying simple<br>expressions to variables (+ and -).</p>
</li>
<li><p>A histogram consisting of inter-event quantities isn’t logically a<br>histogram on either event (so having the ‘hist’ file for either<br>event host the histogram output doesn’t really make sense).  To<br>address the idea that the histogram is associated with a<br>combination of events, support is added allowing the creation of<br>‘synthetic’ events that are events derived from other events.<br>These synthetic events are full-fledged events just like any other<br>and can be used as such, as for instance to create the<br>‘combination’ histograms mentioned previously.</p>
</li>
<li><p>A set of ‘actions’ can be associated with histogram entries -<br>these can be used to generate the previously mentioned synthetic<br>events, but can also be used for other purposes, such as for<br>example saving context when a ‘max’ latency has been hit.</p>
</li>
<li><p>Trace events don’t have a ‘timestamp’ associated with them, but<br>there is an implicit timestamp saved along with an event in the<br>underlying ftrace ring buffer.  This timestamp is now exposed as a<br>a synthetic field named ‘common_timestamp’ which can be used in<br>histograms as if it were any other event field; it isn’t an actual<br>field in the trace format but rather is a synthesized value that<br>nonetheless can be used as if it were an actual field.  By default<br>it is in units of nanoseconds; appending ‘.usecs’ to a<br>common_timestamp field changes the units to microseconds.</p>
</li>
</ul>
<p>A note on inter-event timestamps: If common_timestamp is used in a<br>histogram, the trace buffer is automatically switched over to using<br>absolute timestamps and the “global” trace clock, in order to avoid<br>bogus timestamp differences with other clocks that aren’t coherent<br>across CPUs.  This can be overridden by specifying one of the other<br>trace clocks instead, using the “clock=XXX” hist trigger attribute,<br>where XXX is any of the clocks listed in the tracing/trace_clock<br>pseudo-file.</p>
<p>These features are described in more detail in the following sections.</p>
<h2 id="2-2-1-Histogram-Variables"><a href="#2-2-1-Histogram-Variables" class="headerlink" title="2.2.1 Histogram Variables"></a>2.2.1 Histogram Variables</h2><p>Variables are simply named locations used for saving and retrieving<br>values between matching events.  A ‘matching’ event is defined as an<br>event that has a matching key - if a variable is saved for a histogram<br>entry corresponding to that key, any subsequent event with a matching<br>key can access that variable.</p>
<p>A variable’s value is normally available to any subsequent event until<br>it is set to something else by a subsequent event.  The one exception<br>to that rule is that any variable used in an expression is essentially<br>‘read-once’ - once it’s used by an expression in a subsequent event,<br>it’s reset to its ‘unset’ state, which means it can’t be used again<br>unless it’s set again.  This ensures not only that an event doesn’t<br>use an uninitialized variable in a calculation, but that that variable<br>is used only once and not for any unrelated subsequent match.</p>
<p>The basic syntax for saving a variable is to simply prefix a unique<br>variable name not corresponding to any keyword along with an ‘=’ sign<br>to any event field.</p>
<p>Either keys or values can be saved and retrieved in this way.  This<br>creates a variable named ‘ts0’ for a histogram entry with the key<br>‘next_pid’:</p>
<h1 id="echo-‘hist-keys-next-pid-vals-ts0-ts0-common-timestamp-…-gt-gt"><a href="#echo-‘hist-keys-next-pid-vals-ts0-ts0-common-timestamp-…-gt-gt" class="headerlink" title="echo ‘hist:keys=next_pid:vals=$ts0:ts0=common_timestamp … &gt;&gt; \"></a>echo ‘hist:keys=next_pid:vals=$ts0:ts0=common_timestamp … &gt;&gt; \</h1><pre><code>event/trigger
</code></pre>
<p>The ts0 variable can be accessed by any subsequent event having the<br>same pid as ‘next_pid’.</p>
<p>Variable references are formed by prepending the variable name with<br>the ‘$’ sign.  Thus for example, the ts0 variable above would be<br>referenced as ‘$ts0’ in expressions.</p>
<p>Because ‘vals=’ is used, the common_timestamp variable value above<br>will also be summed as a normal histogram value would (though for a<br>timestamp it makes little sense).</p>
<p>The below shows that a key value can also be saved in the same way:</p>
<h1 id="echo-‘hist-timer-pid-common-pid-key-timer-pid-…’-gt-gt-event-trigger"><a href="#echo-‘hist-timer-pid-common-pid-key-timer-pid-…’-gt-gt-event-trigger" class="headerlink" title="echo ‘hist:timer_pid=common_pid:key=timer_pid …’ &gt;&gt; event/trigger"></a>echo ‘hist:timer_pid=common_pid:key=timer_pid …’ &gt;&gt; event/trigger</h1><p>If a variable isn’t a key variable or prefixed with ‘vals=’, the<br>associated event field will be saved in a variable but won’t be summed<br>as a value:</p>
<h1 id="echo-‘hist-keys-next-pid-ts1-common-timestamp-…’-gt-gt-event-trigger"><a href="#echo-‘hist-keys-next-pid-ts1-common-timestamp-…’-gt-gt-event-trigger" class="headerlink" title="echo ‘hist:keys=next_pid:ts1=common_timestamp …’ &gt;&gt; event/trigger"></a>echo ‘hist:keys=next_pid:ts1=common_timestamp …’ &gt;&gt; event/trigger</h1><p>Multiple variables can be assigned at the same time.  The below would<br>result in both ts0 and b being created as variables, with both<br>common_timestamp and field1 additionally being summed as values:</p>
<h1 id="echo-‘hist-keys-pid-vals-ts0-b-ts0-common-timestamp-b-field1-…’-gt-gt"><a href="#echo-‘hist-keys-pid-vals-ts0-b-ts0-common-timestamp-b-field1-…’-gt-gt" class="headerlink" title="echo ‘hist:keys=pid:vals=$ts0,$b:ts0=common_timestamp,b=field1 …’ &gt;&gt; \"></a>echo ‘hist:keys=pid:vals=$ts0,$b:ts0=common_timestamp,b=field1 …’ &gt;&gt; \</h1><pre><code>event/trigger
</code></pre>
<p>Note that variable assignments can appear either preceding or<br>following their use.  The command below behaves identically to the<br>command above:</p>
<h1 id="echo-‘hist-keys-pid-ts0-common-timestamp-b-field1-vals-ts0-b-…’-gt-gt"><a href="#echo-‘hist-keys-pid-ts0-common-timestamp-b-field1-vals-ts0-b-…’-gt-gt" class="headerlink" title="echo ‘hist:keys=pid:ts0=common_timestamp,b=field1:vals=$ts0,$b …’ &gt;&gt; \"></a>echo ‘hist:keys=pid:ts0=common_timestamp,b=field1:vals=$ts0,$b …’ &gt;&gt; \</h1><pre><code>event/trigger
</code></pre>
<p>Any number of variables not bound to a ‘vals=’ prefix can also be<br>assigned by simply separating them with colons.  Below is the same<br>thing but without the values being summed in the histogram:</p>
<h1 id="echo-‘hist-keys-pid-ts0-common-timestamp-b-field1-…’-gt-gt-event-trigger"><a href="#echo-‘hist-keys-pid-ts0-common-timestamp-b-field1-…’-gt-gt-event-trigger" class="headerlink" title="echo ‘hist:keys=pid:ts0=common_timestamp:b=field1 …’ &gt;&gt; event/trigger"></a>echo ‘hist:keys=pid:ts0=common_timestamp:b=field1 …’ &gt;&gt; event/trigger</h1><p>Variables set as above can be referenced and used in expressions on<br>another event.</p>
<p>For example, here’s how a latency can be calculated:</p>
<h1 id="echo-‘hist-keys-pid-prio-ts0-common-timestamp-…’-gt-gt-event1-trigger"><a href="#echo-‘hist-keys-pid-prio-ts0-common-timestamp-…’-gt-gt-event1-trigger" class="headerlink" title="echo ‘hist:keys=pid,prio:ts0=common_timestamp …’ &gt;&gt; event1/trigger"></a>echo ‘hist:keys=pid,prio:ts0=common_timestamp …’ &gt;&gt; event1/trigger</h1><h1 id="echo-‘hist-keys-next-pid-wakeup-lat-common-timestamp-ts0-…’-gt-gt-event2-trigger"><a href="#echo-‘hist-keys-next-pid-wakeup-lat-common-timestamp-ts0-…’-gt-gt-event2-trigger" class="headerlink" title="echo ‘hist:keys=next_pid:wakeup_lat=common_timestamp-$ts0 …’ &gt;&gt; event2/trigger"></a>echo ‘hist:keys=next_pid:wakeup_lat=common_timestamp-$ts0 …’ &gt;&gt; event2/trigger</h1><p>In the first line above, the event’s timetamp is saved into the<br>variable ts0.  In the next line, ts0 is subtracted from the second<br>event’s timestamp to produce the latency, which is then assigned into<br>yet another variable, ‘wakeup_lat’.  The hist trigger below in turn<br>makes use of the wakeup_lat variable to compute a combined latency<br>using the same key and variable from yet another event:</p>
<h1 id="echo-‘hist-key-pid-wakeupswitch-lat-wakeup-lat-switchtime-lat-…’-gt-gt-event3-trigger"><a href="#echo-‘hist-key-pid-wakeupswitch-lat-wakeup-lat-switchtime-lat-…’-gt-gt-event3-trigger" class="headerlink" title="echo ‘hist:key=pid:wakeupswitch_lat=$wakeup_lat+$switchtime_lat …’ &gt;&gt; event3/trigger"></a>echo ‘hist:key=pid:wakeupswitch_lat=$wakeup_lat+$switchtime_lat …’ &gt;&gt; event3/trigger</h1><h2 id="2-2-2-Synthetic-Events"><a href="#2-2-2-Synthetic-Events" class="headerlink" title="2.2.2 Synthetic Events"></a>2.2.2 Synthetic Events</h2><p>Synthetic events are user-defined events generated from hist trigger<br>variables or fields associated with one or more other events.  Their<br>purpose is to provide a mechanism for displaying data spanning<br>multiple events consistent with the existing and already familiar<br>usage for normal events.</p>
<p>To define a synthetic event, the user writes a simple specification<br>consisting of the name of the new event along with one or more<br>variables and their types, which can be any valid field type,<br>separated by semicolons, to the tracing/synthetic_events file.</p>
<p>For instance, the following creates a new event named ‘wakeup_latency’<br>with 3 fields: lat, pid, and prio.  Each of those fields is simply a<br>variable reference to a variable on another event:</p>
<h1 id="echo-‘wakeup-latency"><a href="#echo-‘wakeup-latency" class="headerlink" title="echo ‘wakeup_latency \"></a>echo ‘wakeup_latency \</h1><pre><code>      u64 lat; \
      pid_t pid; \
  int prio&#39; &gt;&gt; \
  /sys/kernel/debug/tracing/synthetic_events
</code></pre>
<p>Reading the tracing/synthetic_events file lists all the currently<br>defined synthetic events, in this case the event defined above:</p>
<h1 id="cat-sys-kernel-debug-tracing-synthetic-events"><a href="#cat-sys-kernel-debug-tracing-synthetic-events" class="headerlink" title="cat /sys/kernel/debug/tracing/synthetic_events"></a>cat /sys/kernel/debug/tracing/synthetic_events</h1><pre><code>wakeup_latency u64 lat; pid_t pid; int prio
</code></pre>
<p>An existing synthetic event definition can be removed by prepending<br>the command that defined it with a ‘!’:</p>
<h1 id="echo-‘-wakeup-latency-u64-lat-pid-t-pid-int-prio’-gt-gt"><a href="#echo-‘-wakeup-latency-u64-lat-pid-t-pid-int-prio’-gt-gt" class="headerlink" title="echo ‘!wakeup_latency u64 lat pid_t pid int prio’ &gt;&gt; \"></a>echo ‘!wakeup_latency u64 lat pid_t pid int prio’ &gt;&gt; \</h1><pre><code>/sys/kernel/debug/tracing/synthetic_events
</code></pre>
<p>At this point, there isn’t yet an actual ‘wakeup_latency’ event<br>instantiated in the event subsytem - for this to happen, a ‘hist<br>trigger action’ needs to be instantiated and bound to actual fields<br>and variables defined on other events (see Section 2.2.3 below on<br>how that is done using hist trigger ‘onmatch’ action). Once that is<br>done, the ‘wakeup_latency’ synthetic event instance is created.</p>
<p>A histogram can now be defined for the new synthetic event:</p>
<h1 id="echo-‘hist-keys-pid-prio-lat-log2-sort-pid-lat’-gt-gt"><a href="#echo-‘hist-keys-pid-prio-lat-log2-sort-pid-lat’-gt-gt" class="headerlink" title="echo ‘hist:keys=pid,prio,lat.log2:sort=pid,lat’ &gt;&gt; \"></a>echo ‘hist:keys=pid,prio,lat.log2:sort=pid,lat’ &gt;&gt; \</h1><pre><code>    /sys/kernel/debug/tracing/events/synthetic/wakeup_latency/trigger
</code></pre>
<p>The new event is created under the tracing/events/synthetic/ directory<br>and looks and behaves just like any other event:</p>
<h1 id="ls-sys-kernel-debug-tracing-events-synthetic-wakeup-latency"><a href="#ls-sys-kernel-debug-tracing-events-synthetic-wakeup-latency" class="headerlink" title="ls /sys/kernel/debug/tracing/events/synthetic/wakeup_latency"></a>ls /sys/kernel/debug/tracing/events/synthetic/wakeup_latency</h1><pre><code>    enable  filter  format  hist  id  trigger
</code></pre>
<p>Like any other event, once a histogram is enabled for the event, the<br>output can be displayed by reading the event’s ‘hist’ file.</p>
<h2 id="2-2-3-Hist-trigger-‘actions’"><a href="#2-2-3-Hist-trigger-‘actions’" class="headerlink" title="2.2.3 Hist trigger ‘actions’"></a>2.2.3 Hist trigger ‘actions’</h2><p>A hist trigger ‘action’ is a function that’s executed whenever a<br>histogram entry is added or updated.</p>
<p>The default ‘action’ if no special function is explicity specified is<br>as it always has been, to simply update the set of values associated<br>with an entry.  Some applications, however, may want to perform<br>additional actions at that point, such as generate another event, or<br>compare and save a maximum.</p>
<p>The following additional actions are available.  To specify an action<br>for a given event, simply specify the action between colons in the<br>hist trigger specification.</p>
<ul>
<li><p>onmatch(matching.event).<synthetic_event_name>(param list)</p>
<p>The ‘onmatch(matching.event).<synthetic_event_name>(params)’ hist<br>trigger action is invoked whenever an event matches and the<br>histogram entry would be added or updated.  It causes the named<br>synthetic event to be generated with the values given in the<br>‘param list’.  The result is the generation of a synthetic event<br>that consists of the values contained in those variables at the<br>time the invoking event was hit.</p>
<p>The ‘param list’ consists of one or more parameters which may be<br>either variables or fields defined on either the ‘matching.event’<br>or the target event.  The variables or fields specified in the<br>param list may be either fully-qualified or unqualified.  If a<br>variable is specified as unqualified, it must be unique between<br>the two events.  A field name used as a param can be unqualified<br>if it refers to the target event, but must be fully qualified if<br>it refers to the matching event.  A fully-qualified name is of the<br>form ‘system.event_name.$var_name’ or ‘system.event_name.field’.</p>
<p>The ‘matching.event’ specification is simply the fully qualified<br>event name of the event that matches the target event for the<br>onmatch() functionality, in the form ‘system.event_name’.</p>
<p>Finally, the number and type of variables/fields in the ‘param<br>list’ must match the number and types of the fields in the<br>synthetic event being generated.</p>
<p>As an example the below defines a simple synthetic event and uses<br>a variable defined on the sched_wakeup_new event as a parameter<br>when invoking the synthetic event.  Here we define the synthetic<br>event:</p>
<h1 id="echo-‘wakeup-new-test-pid-t-pid’-gt-gt"><a href="#echo-‘wakeup-new-test-pid-t-pid’-gt-gt" class="headerlink" title="echo ‘wakeup_new_test pid_t pid’ &gt;&gt; \"></a>echo ‘wakeup_new_test pid_t pid’ &gt;&gt; \</h1><pre><code>   /sys/kernel/debug/tracing/synthetic_events
</code></pre>
<h1 id="cat-sys-kernel-debug-tracing-synthetic-events-1"><a href="#cat-sys-kernel-debug-tracing-synthetic-events-1" class="headerlink" title="cat /sys/kernel/debug/tracing/synthetic_events"></a>cat /sys/kernel/debug/tracing/synthetic_events</h1><pre><code>  wakeup_new_test pid_t pid
</code></pre>
<p>The following hist trigger both defines the missing testpid<br>variable and specifies an onmatch() action that generates a<br>wakeup_new_test synthetic event whenever a sched_wakeup_new event<br>occurs, which because of the ‘if comm == “cyclictest”‘ filter only<br>happens when the executable is cyclictest:</p>
<h1 id="echo-‘hist-keys-testpid-testpid-pid-onmatch-sched-sched-wakeup-new"><a href="#echo-‘hist-keys-testpid-testpid-pid-onmatch-sched-sched-wakeup-new" class="headerlink" title="echo ‘hist:keys=$testpid:testpid=pid:onmatch(sched.sched_wakeup_new).\"></a>echo ‘hist:keys=$testpid:testpid=pid:onmatch(sched.sched_wakeup_new).\</h1><pre><code>    wakeup_new_test($testpid) if comm==&quot;cyclictest&quot;&#39; &gt;&gt; \
    /sys/kernel/debug/tracing/events/sched/sched_wakeup_new/trigger
</code></pre>
<p>Creating and displaying a histogram based on those events is now<br>just a matter of using the fields and new synthetic event in the<br>tracing/events/synthetic directory, as usual:</p>
<h1 id="echo-‘hist-keys-pid-sort-pid’-gt-gt"><a href="#echo-‘hist-keys-pid-sort-pid’-gt-gt" class="headerlink" title="echo ‘hist:keys=pid:sort=pid’ &gt;&gt; \"></a>echo ‘hist:keys=pid:sort=pid’ &gt;&gt; \</h1><pre><code>   /sys/kernel/debug/tracing/events/synthetic/wakeup_new_test/trigger
</code></pre>
<p>Running ‘cyclictest’ should cause wakeup_new events to generate<br>wakeup_new_test synthetic events which should result in histogram<br>output in the wakeup_new_test event’s hist file:</p>
<h1 id="cat-sys-kernel-debug-tracing-events-synthetic-wakeup-new-test-hist"><a href="#cat-sys-kernel-debug-tracing-events-synthetic-wakeup-new-test-hist" class="headerlink" title="cat /sys/kernel/debug/tracing/events/synthetic/wakeup_new_test/hist"></a>cat /sys/kernel/debug/tracing/events/synthetic/wakeup_new_test/hist</h1><p>A more typical usage would be to use two events to calculate a<br>latency.  The following example uses a set of hist triggers to<br>produce a ‘wakeup_latency’ histogram:</p>
<p>First, we define a ‘wakeup_latency’ synthetic event:</p>
<h1 id="echo-‘wakeup-latency-u64-lat-pid-t-pid-int-prio’-gt-gt"><a href="#echo-‘wakeup-latency-u64-lat-pid-t-pid-int-prio’-gt-gt" class="headerlink" title="echo ‘wakeup_latency u64 lat; pid_t pid; int prio’ &gt;&gt; \"></a>echo ‘wakeup_latency u64 lat; pid_t pid; int prio’ &gt;&gt; \</h1><pre><code>    /sys/kernel/debug/tracing/synthetic_events
</code></pre>
<p>Next, we specify that whenever we see a sched_waking event for a<br>cyclictest thread, save the timestamp in a ‘ts0’ variable:</p>
<h1 id="echo-‘hist-keys-saved-pid-saved-pid-pid-ts0-common-timestamp-usecs"><a href="#echo-‘hist-keys-saved-pid-saved-pid-pid-ts0-common-timestamp-usecs" class="headerlink" title="echo ‘hist:keys=$saved_pid:saved_pid=pid:ts0=common_timestamp.usecs \"></a>echo ‘hist:keys=$saved_pid:saved_pid=pid:ts0=common_timestamp.usecs \</h1><pre><code>    if comm==&quot;cyclictest&quot;&#39; &gt;&gt; \
/sys/kernel/debug/tracing/events/sched/sched_waking/trigger
</code></pre>
<p>Then, when the corresponding thread is actually scheduled onto the<br>CPU by a sched_switch event, calculate the latency and use that<br>along with another variable and an event field to generate a<br>wakeup_latency synthetic event:</p>
<h1 id="echo-‘hist-keys-next-pid-wakeup-lat-common-timestamp-usecs-ts0"><a href="#echo-‘hist-keys-next-pid-wakeup-lat-common-timestamp-usecs-ts0" class="headerlink" title="echo ‘hist:keys=next_pid:wakeup_lat=common_timestamp.usecs-$ts0:\"></a>echo ‘hist:keys=next_pid:wakeup_lat=common_timestamp.usecs-$ts0:\</h1><pre><code>    onmatch(sched.sched_waking).wakeup_latency($wakeup_lat,\
        $saved_pid,next_prio) if next_comm==&quot;cyclictest&quot;&#39; &gt;&gt; \
/sys/kernel/debug/tracing/events/sched/sched_switch/trigger
</code></pre>
<p>We also need to create a histogram on the wakeup_latency synthetic<br>event in order to aggregate the generated synthetic event data:</p>
<h1 id="echo-‘hist-keys-pid-prio-lat-sort-pid-lat’-gt-gt"><a href="#echo-‘hist-keys-pid-prio-lat-sort-pid-lat’-gt-gt" class="headerlink" title="echo ‘hist:keys=pid,prio,lat:sort=pid,lat’ &gt;&gt; \"></a>echo ‘hist:keys=pid,prio,lat:sort=pid,lat’ &gt;&gt; \</h1><pre><code>    /sys/kernel/debug/tracing/events/synthetic/wakeup_latency/trigger
</code></pre>
<p>Finally, once we’ve run cyclictest to actually generate some<br>events, we can see the output by looking at the wakeup_latency<br>synthetic event’s hist file:</p>
<h1 id="cat-sys-kernel-debug-tracing-events-synthetic-wakeup-latency-hist"><a href="#cat-sys-kernel-debug-tracing-events-synthetic-wakeup-latency-hist" class="headerlink" title="cat /sys/kernel/debug/tracing/events/synthetic/wakeup_latency/hist"></a>cat /sys/kernel/debug/tracing/events/synthetic/wakeup_latency/hist</h1></li>
<li><p>onmax(var).save(field,..    .)</p>
<p>The ‘onmax(var).save(field,…)’ hist trigger action is invoked<br>whenever the value of ‘var’ associated with a histogram entry<br>exceeds the current maximum contained in that variable.</p>
<p>The end result is that the trace event fields specified as the<br>onmax.save() params will be saved if ‘var’ exceeds the current<br>maximum for that hist trigger entry.  This allows context from the<br>event that exhibited the new maximum to be saved for later<br>reference.  When the histogram is displayed, additional fields<br>displaying the saved values will be printed.</p>
<p>As an example the below defines a couple of hist triggers, one for<br>sched_waking and another for sched_switch, keyed on pid.  Whenever<br>a sched_waking occurs, the timestamp is saved in the entry<br>corresponding to the current pid, and when the scheduler switches<br>back to that pid, the timestamp difference is calculated.  If the<br>resulting latency, stored in wakeup_lat, exceeds the current<br>maximum latency, the values specified in the save() fields are<br>recorded:</p>
<h1 id="echo-‘hist-keys-pid-ts0-common-timestamp-usecs"><a href="#echo-‘hist-keys-pid-ts0-common-timestamp-usecs" class="headerlink" title="echo ‘hist:keys=pid:ts0=common_timestamp.usecs \"></a>echo ‘hist:keys=pid:ts0=common_timestamp.usecs \</h1><pre><code>    if comm==&quot;cyclictest&quot;&#39; &gt;&gt; \
    /sys/kernel/debug/tracing/events/sched/sched_waking/trigger
</code></pre>
<h1 id="echo-‘hist-keys-next-pid"><a href="#echo-‘hist-keys-next-pid" class="headerlink" title="echo ‘hist:keys=next_pid:\"></a>echo ‘hist:keys=next_pid:\</h1><pre><code>    wakeup_lat=common_timestamp.usecs-$ts0:\
    onmax($wakeup_lat).save(next_comm,prev_pid,prev_prio,prev_comm) \
    if next_comm==&quot;cyclictest&quot;&#39; &gt;&gt; \
    /sys/kernel/debug/tracing/events/sched/sched_switch/trigger
</code></pre>
<p>When the histogram is displayed, the max value and the saved<br>values corresponding to the max are displayed following the rest<br>of the fields:</p>
<h1 id="cat-sys-kernel-debug-tracing-events-sched-sched-switch-hist"><a href="#cat-sys-kernel-debug-tracing-events-sched-sched-switch-hist" class="headerlink" title="cat /sys/kernel/debug/tracing/events/sched/sched_switch/hist"></a>cat /sys/kernel/debug/tracing/events/sched/sched_switch/hist</h1><p>  { next_pid:       2255 } hitcount:        239</p>
<pre><code>common_timestamp-ts0:          0
max:         27
</code></pre>
<p>next_comm: cyclictest</p>
<pre><code>prev_pid:          0  prev_prio:        120  prev_comm: swapper/1
</code></pre>
<p>  { next_pid:       2256 } hitcount:       2355</p>
<pre><code>common_timestamp-ts0: 0
max:         49  next_comm: cyclictest
prev_pid:          0  prev_prio:        120  prev_comm: swapper/0
</code></pre>
<p>  Totals:</p>
<pre><code>  Hits: 12970
  Entries: 2
  Dropped: 0
</code></pre>
</li>
</ul>
<ol start="3">
<li>User space creating a trigger</li>
</ol>
<hr>
<p>Writing into /sys/kernel/tracing/trace_marker writes into the ftrace<br>ring buffer. This can also act like an event, by writing into the trigger<br>file located in /sys/kernel/tracing/events/ftrace/print/</p>
<p>Modifying cyclictest to write into the trace_marker file before it sleeps<br>and after it wakes up, something like this:</p>
<p>static void traceputs(char <em>str)<br>{<br>    /</em> tracemark_fd is the trace_marker file descriptor <em>/<br>    if (tracemark_fd &lt; 0)<br>        return;<br>    /</em> write the tracemark message */<br>    write(tracemark_fd, str, strlen(str));<br>}</p>
<p>And later add something like:</p>
<pre><code>traceputs(&quot;start&quot;);
clock_nanosleep(...);
traceputs(&quot;end&quot;);
</code></pre>
<p>We can make a histogram from this:</p>
<h1 id="cd-sys-kernel-tracing"><a href="#cd-sys-kernel-tracing" class="headerlink" title="cd /sys/kernel/tracing"></a>cd /sys/kernel/tracing</h1><h1 id="echo-‘latency-u64-lat’-gt-synthetic-events"><a href="#echo-‘latency-u64-lat’-gt-synthetic-events" class="headerlink" title="echo ‘latency u64 lat’ &gt; synthetic_events"></a>echo ‘latency u64 lat’ &gt; synthetic_events</h1><h1 id="echo-‘hist-keys-common-pid-ts0-common-timestamp-usecs-if-buf-“start”‘-gt-events-ftrace-print-trigger"><a href="#echo-‘hist-keys-common-pid-ts0-common-timestamp-usecs-if-buf-“start”‘-gt-events-ftrace-print-trigger" class="headerlink" title="echo ‘hist:keys=common_pid:ts0=common_timestamp.usecs if buf == “start”‘ &gt; events/ftrace/print/trigger"></a>echo ‘hist:keys=common_pid:ts0=common_timestamp.usecs if buf == “start”‘ &gt; events/ftrace/print/trigger</h1><h1 id="echo-‘hist-keys-common-pid-lat-common-timestamp-usecs-ts0-onmatch-ftrace-print-latency-lat-if-buf-“end”‘-gt-gt-events-ftrace-print-trigger"><a href="#echo-‘hist-keys-common-pid-lat-common-timestamp-usecs-ts0-onmatch-ftrace-print-latency-lat-if-buf-“end”‘-gt-gt-events-ftrace-print-trigger" class="headerlink" title="echo ‘hist:keys=common_pid:lat=common_timestamp.usecs-$ts0:onmatch(ftrace.print).latency($lat) if buf == “end”‘ &gt;&gt; events/ftrace/print/trigger"></a>echo ‘hist:keys=common_pid:lat=common_timestamp.usecs-$ts0:onmatch(ftrace.print).latency($lat) if buf == “end”‘ &gt;&gt; events/ftrace/print/trigger</h1><h1 id="echo-‘hist-keys-lat-common-pid-sort-lat’-gt-events-synthetic-latency-trigger"><a href="#echo-‘hist-keys-lat-common-pid-sort-lat’-gt-events-synthetic-latency-trigger" class="headerlink" title="echo ‘hist:keys=lat,common_pid:sort=lat’ &gt; events/synthetic/latency/trigger"></a>echo ‘hist:keys=lat,common_pid:sort=lat’ &gt; events/synthetic/latency/trigger</h1><p>The above created a synthetic event called “latency” and two histograms<br>against the trace_marker, one gets triggered when “start” is written into the<br>trace_marker file and the other when “end” is written. If the pids match, then<br>it will call the “latency” synthetic event with the calculated latency as its<br>parameter. Finally, a histogram is added to the latency synthetic event to<br>record the calculated latency along with the pid.</p>
<p>Now running cyclictest with:</p>
<h1 id="cyclictest-p80-d0-i250-n-a-t-–tracemark-b-1000"><a href="#cyclictest-p80-d0-i250-n-a-t-–tracemark-b-1000" class="headerlink" title="./cyclictest -p80 -d0 -i250 -n -a -t –tracemark -b 1000"></a>./cyclictest -p80 -d0 -i250 -n -a -t –tracemark -b 1000</h1><p> -p80  : run threads at priority 80<br> -d0   : have all threads run at the same interval<br> -i250 : start the interval at 250 microseconds (all threads will do this)<br> -n    : sleep with nanosleep<br> -a    : affine all threads to a separate CPU<br> -t    : one thread per available CPU<br> –tracemark : enable trace mark writing<br> -b 1000 : stop if any latency is greater than 1000 microseconds</p>
<p>Note, the -b 1000 is used just to make –tracemark available.</p>
<p>Then we can see the histogram created by this with:</p>
<h1 id="cat-events-synthetic-latency-hist"><a href="#cat-events-synthetic-latency-hist" class="headerlink" title="cat events/synthetic/latency/hist"></a>cat events/synthetic/latency/hist</h1><h1 id="event-histogram"><a href="#event-histogram" class="headerlink" title="event histogram"></a>event histogram</h1><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="trigger-info-hist-keys-lat-common-pid-vals-hitcount-sort-lat-size-2048-active"><a href="#trigger-info-hist-keys-lat-common-pid-vals-hitcount-sort-lat-size-2048-active" class="headerlink" title="trigger info: hist:keys=lat,common_pid:vals=hitcount:sort=lat:size=2048 [active]"></a>trigger info: hist:keys=lat,common_pid:vals=hitcount:sort=lat:size=2048 [active]</h1><h1 id="-1"><a href="#-1" class="headerlink" title=""></a></h1><p>{ lat:        107, common_pid:       2039 } hitcount:          1<br>{ lat:        122, common_pid:       2041 } hitcount:          1<br>{ lat:        166, common_pid:       2039 } hitcount:          1<br>{ lat:        174, common_pid:       2039 } hitcount:          1<br>{ lat:        194, common_pid:       2041 } hitcount:          1<br>{ lat:        196, common_pid:       2036 } hitcount:          1<br>{ lat:        197, common_pid:       2038 } hitcount:          1<br>{ lat:        198, common_pid:       2039 } hitcount:          1<br>{ lat:        199, common_pid:       2039 } hitcount:          1<br>{ lat:        200, common_pid:       2041 } hitcount:          1<br>{ lat:        201, common_pid:       2039 } hitcount:          2<br>{ lat:        202, common_pid:       2038 } hitcount:          1<br>{ lat:        202, common_pid:       2043 } hitcount:          1<br>{ lat:        203, common_pid:       2039 } hitcount:          1<br>{ lat:        203, common_pid:       2036 } hitcount:          1<br>{ lat:        203, common_pid:       2041 } hitcount:          1<br>{ lat:        206, common_pid:       2038 } hitcount:          2<br>{ lat:        207, common_pid:       2039 } hitcount:          1<br>{ lat:        207, common_pid:       2036 } hitcount:          1<br>{ lat:        208, common_pid:       2040 } hitcount:          1<br>{ lat:        209, common_pid:       2043 } hitcount:          1<br>{ lat:        210, common_pid:       2039 } hitcount:          1<br>{ lat:        211, common_pid:       2039 } hitcount:          4<br>{ lat:        212, common_pid:       2043 } hitcount:          1<br>{ lat:        212, common_pid:       2039 } hitcount:          2<br>{ lat:        213, common_pid:       2039 } hitcount:          1<br>{ lat:        214, common_pid:       2038 } hitcount:          1<br>{ lat:        214, common_pid:       2039 } hitcount:          2<br>{ lat:        214, common_pid:       2042 } hitcount:          1<br>{ lat:        215, common_pid:       2039 } hitcount:          1<br>{ lat:        217, common_pid:       2036 } hitcount:          1<br>{ lat:        217, common_pid:       2040 } hitcount:          1<br>{ lat:        217, common_pid:       2039 } hitcount:          1<br>{ lat:        218, common_pid:       2039 } hitcount:          6<br>{ lat:        219, common_pid:       2039 } hitcount:          9<br>{ lat:        220, common_pid:       2039 } hitcount:         11<br>{ lat:        221, common_pid:       2039 } hitcount:          5<br>{ lat:        221, common_pid:       2042 } hitcount:          1<br>{ lat:        222, common_pid:       2039 } hitcount:          7<br>{ lat:        223, common_pid:       2036 } hitcount:          1<br>{ lat:        223, common_pid:       2039 } hitcount:          3<br>{ lat:        224, common_pid:       2039 } hitcount:          4<br>{ lat:        224, common_pid:       2037 } hitcount:          1<br>{ lat:        224, common_pid:       2036 } hitcount:          2<br>{ lat:        225, common_pid:       2039 } hitcount:          5<br>{ lat:        225, common_pid:       2042 } hitcount:          1<br>{ lat:        226, common_pid:       2039 } hitcount:          7<br>{ lat:        226, common_pid:       2036 } hitcount:          4<br>{ lat:        227, common_pid:       2039 } hitcount:          6<br>{ lat:        227, common_pid:       2036 } hitcount:         12<br>{ lat:        227, common_pid:       2043 } hitcount:          1<br>{ lat:        228, common_pid:       2039 } hitcount:          7<br>{ lat:        228, common_pid:       2036 } hitcount:         14<br>{ lat:        229, common_pid:       2039 } hitcount:          9<br>{ lat:        229, common_pid:       2036 } hitcount:          8<br>{ lat:        229, common_pid:       2038 } hitcount:          1<br>{ lat:        230, common_pid:       2039 } hitcount:         11<br>{ lat:        230, common_pid:       2036 } hitcount:          6<br>{ lat:        230, common_pid:       2043 } hitcount:          1<br>{ lat:        230, common_pid:       2042 } hitcount:          2<br>{ lat:        231, common_pid:       2041 } hitcount:          1<br>{ lat:        231, common_pid:       2036 } hitcount:          6<br>{ lat:        231, common_pid:       2043 } hitcount:          1<br>{ lat:        231, common_pid:       2039 } hitcount:          8<br>{ lat:        232, common_pid:       2037 } hitcount:          1<br>{ lat:        232, common_pid:       2039 } hitcount:          6<br>{ lat:        232, common_pid:       2040 } hitcount:          2<br>{ lat:        232, common_pid:       2036 } hitcount:          5<br>{ lat:        232, common_pid:       2043 } hitcount:          1<br>{ lat:        233, common_pid:       2036 } hitcount:          5<br>{ lat:        233, common_pid:       2039 } hitcount:         11<br>{ lat:        234, common_pid:       2039 } hitcount:          4<br>{ lat:        234, common_pid:       2038 } hitcount:          2<br>{ lat:        234, common_pid:       2043 } hitcount:          2<br>{ lat:        234, common_pid:       2036 } hitcount:         11<br>{ lat:        234, common_pid:       2040 } hitcount:          1<br>{ lat:        235, common_pid:       2037 } hitcount:          2<br>{ lat:        235, common_pid:       2036 } hitcount:          8<br>{ lat:        235, common_pid:       2043 } hitcount:          2<br>{ lat:        235, common_pid:       2039 } hitcount:          5<br>{ lat:        235, common_pid:       2042 } hitcount:          2<br>{ lat:        235, common_pid:       2040 } hitcount:          4<br>{ lat:        235, common_pid:       2041 } hitcount:          1<br>{ lat:        236, common_pid:       2036 } hitcount:          7<br>{ lat:        236, common_pid:       2037 } hitcount:          1<br>{ lat:        236, common_pid:       2041 } hitcount:          5<br>{ lat:        236, common_pid:       2039 } hitcount:          3<br>{ lat:        236, common_pid:       2043 } hitcount:          9<br>{ lat:        236, common_pid:       2040 } hitcount:          7<br>{ lat:        237, common_pid:       2037 } hitcount:          1<br>{ lat:        237, common_pid:       2040 } hitcount:          1<br>{ lat:        237, common_pid:       2036 } hitcount:          9<br>{ lat:        237, common_pid:       2039 } hitcount:          3<br>{ lat:        237, common_pid:       2043 } hitcount:          8<br>{ lat:        237, common_pid:       2042 } hitcount:          2<br>{ lat:        237, common_pid:       2041 } hitcount:          2<br>{ lat:        238, common_pid:       2043 } hitcount:         10<br>{ lat:        238, common_pid:       2040 } hitcount:          1<br>{ lat:        238, common_pid:       2037 } hitcount:          9<br>{ lat:        238, common_pid:       2038 } hitcount:          1<br>{ lat:        238, common_pid:       2039 } hitcount:          1<br>{ lat:        238, common_pid:       2042 } hitcount:          3<br>{ lat:        238, common_pid:       2036 } hitcount:          7<br>{ lat:        239, common_pid:       2041 } hitcount:          1<br>{ lat:        239, common_pid:       2043 } hitcount:         11<br>{ lat:        239, common_pid:       2037 } hitcount:         11<br>{ lat:        239, common_pid:       2038 } hitcount:          6<br>{ lat:        239, common_pid:       2036 } hitcount:          7<br>{ lat:        239, common_pid:       2040 } hitcount:          1<br>{ lat:        239, common_pid:       2042 } hitcount:          9<br>{ lat:        240, common_pid:       2037 } hitcount:         29<br>{ lat:        240, common_pid:       2043 } hitcount:         15<br>{ lat:        240, common_pid:       2040 } hitcount:         44<br>{ lat:        240, common_pid:       2039 } hitcount:          1<br>{ lat:        240, common_pid:       2041 } hitcount:          2<br>{ lat:        240, common_pid:       2038 } hitcount:          1<br>{ lat:        240, common_pid:       2036 } hitcount:         10<br>{ lat:        240, common_pid:       2042 } hitcount:         13<br>{ lat:        241, common_pid:       2036 } hitcount:         21<br>{ lat:        241, common_pid:       2041 } hitcount:         36<br>{ lat:        241, common_pid:       2037 } hitcount:         34<br>{ lat:        241, common_pid:       2042 } hitcount:         14<br>{ lat:        241, common_pid:       2040 } hitcount:         94<br>{ lat:        241, common_pid:       2039 } hitcount:         12<br>{ lat:        241, common_pid:       2038 } hitcount:          2<br>{ lat:        241, common_pid:       2043 } hitcount:         28<br>{ lat:        242, common_pid:       2040 } hitcount:        109<br>{ lat:        242, common_pid:       2041 } hitcount:        506<br>{ lat:        242, common_pid:       2039 } hitcount:        155<br>{ lat:        242, common_pid:       2042 } hitcount:         21<br>{ lat:        242, common_pid:       2037 } hitcount:         52<br>{ lat:        242, common_pid:       2043 } hitcount:         21<br>{ lat:        242, common_pid:       2036 } hitcount:         16<br>{ lat:        242, common_pid:       2038 } hitcount:        156<br>{ lat:        243, common_pid:       2037 } hitcount:         46<br>{ lat:        243, common_pid:       2039 } hitcount:         40<br>{ lat:        243, common_pid:       2042 } hitcount:        119<br>{ lat:        243, common_pid:       2041 } hitcount:        611<br>{ lat:        243, common_pid:       2036 } hitcount:         69<br>{ lat:        243, common_pid:       2038 } hitcount:        784<br>{ lat:        243, common_pid:       2040 } hitcount:        323<br>{ lat:        243, common_pid:       2043 } hitcount:         14<br>{ lat:        244, common_pid:       2043 } hitcount:         35<br>{ lat:        244, common_pid:       2042 } hitcount:        305<br>{ lat:        244, common_pid:       2039 } hitcount:          8<br>{ lat:        244, common_pid:       2040 } hitcount:       4515<br>{ lat:        244, common_pid:       2038 } hitcount:        371<br>{ lat:        244, common_pid:       2037 } hitcount:         31<br>{ lat:        244, common_pid:       2036 } hitcount:        114<br>{ lat:        244, common_pid:       2041 } hitcount:       3396<br>{ lat:        245, common_pid:       2036 } hitcount:        700<br>{ lat:        245, common_pid:       2041 } hitcount:       2772<br>{ lat:        245, common_pid:       2037 } hitcount:        268<br>{ lat:        245, common_pid:       2039 } hitcount:        472<br>{ lat:        245, common_pid:       2038 } hitcount:       2758<br>{ lat:        245, common_pid:       2042 } hitcount:       3833<br>{ lat:        245, common_pid:       2040 } hitcount:       3105<br>{ lat:        245, common_pid:       2043 } hitcount:        645<br>{ lat:        246, common_pid:       2038 } hitcount:       3451<br>{ lat:        246, common_pid:       2041 } hitcount:        142<br>{ lat:        246, common_pid:       2037 } hitcount:       5101<br>{ lat:        246, common_pid:       2040 } hitcount:         68<br>{ lat:        246, common_pid:       2043 } hitcount:       5099<br>{ lat:        246, common_pid:       2039 } hitcount:       5608<br>{ lat:        246, common_pid:       2042 } hitcount:       3723<br>{ lat:        246, common_pid:       2036 } hitcount:       4738<br>{ lat:        247, common_pid:       2042 } hitcount:        312<br>{ lat:        247, common_pid:       2043 } hitcount:       2385<br>{ lat:        247, common_pid:       2041 } hitcount:        452<br>{ lat:        247, common_pid:       2038 } hitcount:        792<br>{ lat:        247, common_pid:       2040 } hitcount:         78<br>{ lat:        247, common_pid:       2036 } hitcount:       2375<br>{ lat:        247, common_pid:       2039 } hitcount:       1834<br>{ lat:        247, common_pid:       2037 } hitcount:       2655<br>{ lat:        248, common_pid:       2037 } hitcount:         36<br>{ lat:        248, common_pid:       2042 } hitcount:         11<br>{ lat:        248, common_pid:       2038 } hitcount:        122<br>{ lat:        248, common_pid:       2036 } hitcount:        135<br>{ lat:        248, common_pid:       2039 } hitcount:         26<br>{ lat:        248, common_pid:       2041 } hitcount:        503<br>{ lat:        248, common_pid:       2043 } hitcount:         66<br>{ lat:        248, common_pid:       2040 } hitcount:         46<br>{ lat:        249, common_pid:       2037 } hitcount:         29<br>{ lat:        249, common_pid:       2038 } hitcount:          1<br>{ lat:        249, common_pid:       2043 } hitcount:         29<br>{ lat:        249, common_pid:       2039 } hitcount:          8<br>{ lat:        249, common_pid:       2042 } hitcount:         56<br>{ lat:        249, common_pid:       2040 } hitcount:         27<br>{ lat:        249, common_pid:       2041 } hitcount:         11<br>{ lat:        249, common_pid:       2036 } hitcount:         27<br>{ lat:        250, common_pid:       2038 } hitcount:          1<br>{ lat:        250, common_pid:       2036 } hitcount:         30<br>{ lat:        250, common_pid:       2040 } hitcount:         19<br>{ lat:        250, common_pid:       2043 } hitcount:         22<br>{ lat:        250, common_pid:       2042 } hitcount:         20<br>{ lat:        250, common_pid:       2041 } hitcount:          1<br>{ lat:        250, common_pid:       2039 } hitcount:          6<br>{ lat:        250, common_pid:       2037 } hitcount:         48<br>{ lat:        251, common_pid:       2037 } hitcount:         43<br>{ lat:        251, common_pid:       2039 } hitcount:          1<br>{ lat:        251, common_pid:       2036 } hitcount:         12<br>{ lat:        251, common_pid:       2042 } hitcount:          2<br>{ lat:        251, common_pid:       2041 } hitcount:          1<br>{ lat:        251, common_pid:       2043 } hitcount:         15<br>{ lat:        251, common_pid:       2040 } hitcount:          3<br>{ lat:        252, common_pid:       2040 } hitcount:          1<br>{ lat:        252, common_pid:       2036 } hitcount:         12<br>{ lat:        252, common_pid:       2037 } hitcount:         21<br>{ lat:        252, common_pid:       2043 } hitcount:         14<br>{ lat:        253, common_pid:       2037 } hitcount:         21<br>{ lat:        253, common_pid:       2039 } hitcount:          2<br>{ lat:        253, common_pid:       2036 } hitcount:          9<br>{ lat:        253, common_pid:       2043 } hitcount:          6<br>{ lat:        253, common_pid:       2040 } hitcount:          1<br>{ lat:        254, common_pid:       2036 } hitcount:          8<br>{ lat:        254, common_pid:       2043 } hitcount:          3<br>{ lat:        254, common_pid:       2041 } hitcount:          1<br>{ lat:        254, common_pid:       2042 } hitcount:          1<br>{ lat:        254, common_pid:       2039 } hitcount:          1<br>{ lat:        254, common_pid:       2037 } hitcount:         12<br>{ lat:        255, common_pid:       2043 } hitcount:          1<br>{ lat:        255, common_pid:       2037 } hitcount:          2<br>{ lat:        255, common_pid:       2036 } hitcount:          2<br>{ lat:        255, common_pid:       2039 } hitcount:          8<br>{ lat:        256, common_pid:       2043 } hitcount:          1<br>{ lat:        256, common_pid:       2036 } hitcount:          4<br>{ lat:        256, common_pid:       2039 } hitcount:          6<br>{ lat:        257, common_pid:       2039 } hitcount:          5<br>{ lat:        257, common_pid:       2036 } hitcount:          4<br>{ lat:        258, common_pid:       2039 } hitcount:          5<br>{ lat:        258, common_pid:       2036 } hitcount:          2<br>{ lat:        259, common_pid:       2036 } hitcount:          7<br>{ lat:        259, common_pid:       2039 } hitcount:          7<br>{ lat:        260, common_pid:       2036 } hitcount:          8<br>{ lat:        260, common_pid:       2039 } hitcount:          6<br>{ lat:        261, common_pid:       2036 } hitcount:          5<br>{ lat:        261, common_pid:       2039 } hitcount:          7<br>{ lat:        262, common_pid:       2039 } hitcount:          5<br>{ lat:        262, common_pid:       2036 } hitcount:          5<br>{ lat:        263, common_pid:       2039 } hitcount:          7<br>{ lat:        263, common_pid:       2036 } hitcount:          7<br>{ lat:        264, common_pid:       2039 } hitcount:          9<br>{ lat:        264, common_pid:       2036 } hitcount:          9<br>{ lat:        265, common_pid:       2036 } hitcount:          5<br>{ lat:        265, common_pid:       2039 } hitcount:          1<br>{ lat:        266, common_pid:       2036 } hitcount:          1<br>{ lat:        266, common_pid:       2039 } hitcount:          3<br>{ lat:        267, common_pid:       2036 } hitcount:          1<br>{ lat:        267, common_pid:       2039 } hitcount:          3<br>{ lat:        268, common_pid:       2036 } hitcount:          1<br>{ lat:        268, common_pid:       2039 } hitcount:          6<br>{ lat:        269, common_pid:       2036 } hitcount:          1<br>{ lat:        269, common_pid:       2043 } hitcount:          1<br>{ lat:        269, common_pid:       2039 } hitcount:          2<br>{ lat:        270, common_pid:       2040 } hitcount:          1<br>{ lat:        270, common_pid:       2039 } hitcount:          6<br>{ lat:        271, common_pid:       2041 } hitcount:          1<br>{ lat:        271, common_pid:       2039 } hitcount:          5<br>{ lat:        272, common_pid:       2039 } hitcount:         10<br>{ lat:        273, common_pid:       2039 } hitcount:          8<br>{ lat:        274, common_pid:       2039 } hitcount:          2<br>{ lat:        275, common_pid:       2039 } hitcount:          1<br>{ lat:        276, common_pid:       2039 } hitcount:          2<br>{ lat:        276, common_pid:       2037 } hitcount:          1<br>{ lat:        276, common_pid:       2038 } hitcount:          1<br>{ lat:        277, common_pid:       2039 } hitcount:          1<br>{ lat:        277, common_pid:       2042 } hitcount:          1<br>{ lat:        278, common_pid:       2039 } hitcount:          1<br>{ lat:        279, common_pid:       2039 } hitcount:          4<br>{ lat:        279, common_pid:       2043 } hitcount:          1<br>{ lat:        280, common_pid:       2039 } hitcount:          3<br>{ lat:        283, common_pid:       2036 } hitcount:          2<br>{ lat:        284, common_pid:       2039 } hitcount:          1<br>{ lat:        284, common_pid:       2043 } hitcount:          1<br>{ lat:        288, common_pid:       2039 } hitcount:          1<br>{ lat:        289, common_pid:       2039 } hitcount:          1<br>{ lat:        300, common_pid:       2039 } hitcount:          1<br>{ lat:        384, common_pid:       2039 } hitcount:          1</p>
<p>Totals:<br>    Hits: 67625<br>    Entries: 278<br>    Dropped: 0</p>
<p>Note, the writes are around the sleep, so ideally they will all be of 250<br>microseconds. If you are wondering how there are several that are under<br>250 microseconds, that is because the way cyclictest works, is if one<br>iteration comes in late, the next one will set the timer to wake up less that<br>250. That is, if an iteration came in 50 microseconds late, the next wake up<br>will be at 200 microseconds.</p>
<p>But this could easily be done in userspace. To make this even more<br>interesting, we can mix the histogram between events that happened in the<br>kernel with trace_marker.</p>
<h1 id="cd-sys-kernel-tracing-1"><a href="#cd-sys-kernel-tracing-1" class="headerlink" title="cd /sys/kernel/tracing"></a>cd /sys/kernel/tracing</h1><h1 id="echo-‘latency-u64-lat’-gt-synthetic-events-1"><a href="#echo-‘latency-u64-lat’-gt-synthetic-events-1" class="headerlink" title="echo ‘latency u64 lat’ &gt; synthetic_events"></a>echo ‘latency u64 lat’ &gt; synthetic_events</h1><h1 id="echo-‘hist-keys-pid-ts0-common-timestamp-usecs’-gt-events-sched-sched-waking-trigger"><a href="#echo-‘hist-keys-pid-ts0-common-timestamp-usecs’-gt-events-sched-sched-waking-trigger" class="headerlink" title="echo ‘hist:keys=pid:ts0=common_timestamp.usecs’ &gt; events/sched/sched_waking/trigger"></a>echo ‘hist:keys=pid:ts0=common_timestamp.usecs’ &gt; events/sched/sched_waking/trigger</h1><h1 id="echo-‘hist-keys-common-pid-lat-common-timestamp-usecs-ts0-onmatch-sched-sched-waking-latency-lat-if-buf-“end”‘-gt-events-ftrace-print-trigger"><a href="#echo-‘hist-keys-common-pid-lat-common-timestamp-usecs-ts0-onmatch-sched-sched-waking-latency-lat-if-buf-“end”‘-gt-events-ftrace-print-trigger" class="headerlink" title="echo ‘hist:keys=common_pid:lat=common_timestamp.usecs-$ts0:onmatch(sched.sched_waking).latency($lat) if buf == “end”‘ &gt; events/ftrace/print/trigger"></a>echo ‘hist:keys=common_pid:lat=common_timestamp.usecs-$ts0:onmatch(sched.sched_waking).latency($lat) if buf == “end”‘ &gt; events/ftrace/print/trigger</h1><h1 id="echo-‘hist-keys-lat-common-pid-sort-lat’-gt-events-synthetic-latency-trigger-1"><a href="#echo-‘hist-keys-lat-common-pid-sort-lat’-gt-events-synthetic-latency-trigger-1" class="headerlink" title="echo ‘hist:keys=lat,common_pid:sort=lat’ &gt; events/synthetic/latency/trigger"></a>echo ‘hist:keys=lat,common_pid:sort=lat’ &gt; events/synthetic/latency/trigger</h1><p>The difference this time is that instead of using the trace_marker to start<br>the latency, the sched_waking event is used, matching the common_pid for the<br>trace_marker write with the pid that is being woken by sched_waking.</p>
<p>After running cyclictest again with the same parameters, we now have:</p>
<h1 id="cat-events-synthetic-latency-hist-1"><a href="#cat-events-synthetic-latency-hist-1" class="headerlink" title="cat events/synthetic/latency/hist"></a>cat events/synthetic/latency/hist</h1><h1 id="event-histogram-1"><a href="#event-histogram-1" class="headerlink" title="event histogram"></a>event histogram</h1><h1 id="-2"><a href="#-2" class="headerlink" title=""></a></h1><h1 id="trigger-info-hist-keys-lat-common-pid-vals-hitcount-sort-lat-size-2048-active-1"><a href="#trigger-info-hist-keys-lat-common-pid-vals-hitcount-sort-lat-size-2048-active-1" class="headerlink" title="trigger info: hist:keys=lat,common_pid:vals=hitcount:sort=lat:size=2048 [active]"></a>trigger info: hist:keys=lat,common_pid:vals=hitcount:sort=lat:size=2048 [active]</h1><h1 id="-3"><a href="#-3" class="headerlink" title=""></a></h1><p>{ lat:          7, common_pid:       2302 } hitcount:        640<br>{ lat:          7, common_pid:       2299 } hitcount:         42<br>{ lat:          7, common_pid:       2303 } hitcount:         18<br>{ lat:          7, common_pid:       2305 } hitcount:        166<br>{ lat:          7, common_pid:       2306 } hitcount:          1<br>{ lat:          7, common_pid:       2301 } hitcount:         91<br>{ lat:          7, common_pid:       2300 } hitcount:         17<br>{ lat:          8, common_pid:       2303 } hitcount:       8296<br>{ lat:          8, common_pid:       2304 } hitcount:       6864<br>{ lat:          8, common_pid:       2305 } hitcount:       9464<br>{ lat:          8, common_pid:       2301 } hitcount:       9213<br>{ lat:          8, common_pid:       2306 } hitcount:       6246<br>{ lat:          8, common_pid:       2302 } hitcount:       8797<br>{ lat:          8, common_pid:       2299 } hitcount:       8771<br>{ lat:          8, common_pid:       2300 } hitcount:       8119<br>{ lat:          9, common_pid:       2305 } hitcount:       1519<br>{ lat:          9, common_pid:       2299 } hitcount:       2346<br>{ lat:          9, common_pid:       2303 } hitcount:       2841<br>{ lat:          9, common_pid:       2301 } hitcount:       1846<br>{ lat:          9, common_pid:       2304 } hitcount:       3861<br>{ lat:          9, common_pid:       2302 } hitcount:       1210<br>{ lat:          9, common_pid:       2300 } hitcount:       2762<br>{ lat:          9, common_pid:       2306 } hitcount:       4247<br>{ lat:         10, common_pid:       2299 } hitcount:         16<br>{ lat:         10, common_pid:       2306 } hitcount:        333<br>{ lat:         10, common_pid:       2303 } hitcount:         16<br>{ lat:         10, common_pid:       2304 } hitcount:        168<br>{ lat:         10, common_pid:       2302 } hitcount:        240<br>{ lat:         10, common_pid:       2301 } hitcount:         28<br>{ lat:         10, common_pid:       2300 } hitcount:         95<br>{ lat:         10, common_pid:       2305 } hitcount:         18<br>{ lat:         11, common_pid:       2303 } hitcount:          5<br>{ lat:         11, common_pid:       2305 } hitcount:          8<br>{ lat:         11, common_pid:       2306 } hitcount:        221<br>{ lat:         11, common_pid:       2302 } hitcount:         76<br>{ lat:         11, common_pid:       2304 } hitcount:         26<br>{ lat:         11, common_pid:       2300 } hitcount:        125<br>{ lat:         11, common_pid:       2299 } hitcount:          2<br>{ lat:         12, common_pid:       2305 } hitcount:          3<br>{ lat:         12, common_pid:       2300 } hitcount:          6<br>{ lat:         12, common_pid:       2306 } hitcount:         90<br>{ lat:         12, common_pid:       2302 } hitcount:          4<br>{ lat:         12, common_pid:       2303 } hitcount:          1<br>{ lat:         12, common_pid:       2304 } hitcount:        122<br>{ lat:         13, common_pid:       2300 } hitcount:         12<br>{ lat:         13, common_pid:       2301 } hitcount:          1<br>{ lat:         13, common_pid:       2306 } hitcount:         32<br>{ lat:         13, common_pid:       2302 } hitcount:          5<br>{ lat:         13, common_pid:       2305 } hitcount:          1<br>{ lat:         13, common_pid:       2303 } hitcount:          1<br>{ lat:         13, common_pid:       2304 } hitcount:         61<br>{ lat:         14, common_pid:       2303 } hitcount:          4<br>{ lat:         14, common_pid:       2306 } hitcount:          5<br>{ lat:         14, common_pid:       2305 } hitcount:          4<br>{ lat:         14, common_pid:       2304 } hitcount:         62<br>{ lat:         14, common_pid:       2302 } hitcount:         19<br>{ lat:         14, common_pid:       2300 } hitcount:         33<br>{ lat:         14, common_pid:       2299 } hitcount:          1<br>{ lat:         14, common_pid:       2301 } hitcount:          4<br>{ lat:         15, common_pid:       2305 } hitcount:          1<br>{ lat:         15, common_pid:       2302 } hitcount:         25<br>{ lat:         15, common_pid:       2300 } hitcount:         11<br>{ lat:         15, common_pid:       2299 } hitcount:          5<br>{ lat:         15, common_pid:       2301 } hitcount:          1<br>{ lat:         15, common_pid:       2304 } hitcount:          8<br>{ lat:         15, common_pid:       2303 } hitcount:          1<br>{ lat:         15, common_pid:       2306 } hitcount:          6<br>{ lat:         16, common_pid:       2302 } hitcount:         31<br>{ lat:         16, common_pid:       2306 } hitcount:          3<br>{ lat:         16, common_pid:       2300 } hitcount:          5<br>{ lat:         17, common_pid:       2302 } hitcount:          6<br>{ lat:         17, common_pid:       2303 } hitcount:          1<br>{ lat:         18, common_pid:       2304 } hitcount:          1<br>{ lat:         18, common_pid:       2302 } hitcount:          8<br>{ lat:         18, common_pid:       2299 } hitcount:          1<br>{ lat:         18, common_pid:       2301 } hitcount:          1<br>{ lat:         19, common_pid:       2303 } hitcount:          4<br>{ lat:         19, common_pid:       2304 } hitcount:          5<br>{ lat:         19, common_pid:       2302 } hitcount:          4<br>{ lat:         19, common_pid:       2299 } hitcount:          3<br>{ lat:         19, common_pid:       2306 } hitcount:          1<br>{ lat:         19, common_pid:       2300 } hitcount:          4<br>{ lat:         19, common_pid:       2305 } hitcount:          5<br>{ lat:         20, common_pid:       2299 } hitcount:          2<br>{ lat:         20, common_pid:       2302 } hitcount:          3<br>{ lat:         20, common_pid:       2305 } hitcount:          1<br>{ lat:         20, common_pid:       2300 } hitcount:          2<br>{ lat:         20, common_pid:       2301 } hitcount:          2<br>{ lat:         20, common_pid:       2303 } hitcount:          3<br>{ lat:         21, common_pid:       2305 } hitcount:          1<br>{ lat:         21, common_pid:       2299 } hitcount:          5<br>{ lat:         21, common_pid:       2303 } hitcount:          4<br>{ lat:         21, common_pid:       2302 } hitcount:          7<br>{ lat:         21, common_pid:       2300 } hitcount:          1<br>{ lat:         21, common_pid:       2301 } hitcount:          5<br>{ lat:         21, common_pid:       2304 } hitcount:          2<br>{ lat:         22, common_pid:       2302 } hitcount:          5<br>{ lat:         22, common_pid:       2303 } hitcount:          1<br>{ lat:         22, common_pid:       2306 } hitcount:          3<br>{ lat:         22, common_pid:       2301 } hitcount:          2<br>{ lat:         22, common_pid:       2300 } hitcount:          1<br>{ lat:         22, common_pid:       2299 } hitcount:          1<br>{ lat:         22, common_pid:       2305 } hitcount:          1<br>{ lat:         22, common_pid:       2304 } hitcount:          1<br>{ lat:         23, common_pid:       2299 } hitcount:          1<br>{ lat:         23, common_pid:       2306 } hitcount:          2<br>{ lat:         23, common_pid:       2302 } hitcount:          6<br>{ lat:         24, common_pid:       2302 } hitcount:          3<br>{ lat:         24, common_pid:       2300 } hitcount:          1<br>{ lat:         24, common_pid:       2306 } hitcount:          2<br>{ lat:         24, common_pid:       2305 } hitcount:          1<br>{ lat:         24, common_pid:       2299 } hitcount:          1<br>{ lat:         25, common_pid:       2300 } hitcount:          1<br>{ lat:         25, common_pid:       2302 } hitcount:          4<br>{ lat:         26, common_pid:       2302 } hitcount:          2<br>{ lat:         27, common_pid:       2305 } hitcount:          1<br>{ lat:         27, common_pid:       2300 } hitcount:          1<br>{ lat:         27, common_pid:       2302 } hitcount:          3<br>{ lat:         28, common_pid:       2306 } hitcount:          1<br>{ lat:         28, common_pid:       2302 } hitcount:          4<br>{ lat:         29, common_pid:       2302 } hitcount:          1<br>{ lat:         29, common_pid:       2300 } hitcount:          2<br>{ lat:         29, common_pid:       2306 } hitcount:          1<br>{ lat:         29, common_pid:       2304 } hitcount:          1<br>{ lat:         30, common_pid:       2302 } hitcount:          4<br>{ lat:         31, common_pid:       2302 } hitcount:          6<br>{ lat:         32, common_pid:       2302 } hitcount:          1<br>{ lat:         33, common_pid:       2299 } hitcount:          1<br>{ lat:         33, common_pid:       2302 } hitcount:          3<br>{ lat:         34, common_pid:       2302 } hitcount:          2<br>{ lat:         35, common_pid:       2302 } hitcount:          1<br>{ lat:         35, common_pid:       2304 } hitcount:          1<br>{ lat:         36, common_pid:       2302 } hitcount:          4<br>{ lat:         37, common_pid:       2302 } hitcount:          6<br>{ lat:         38, common_pid:       2302 } hitcount:          2<br>{ lat:         39, common_pid:       2302 } hitcount:          2<br>{ lat:         39, common_pid:       2304 } hitcount:          1<br>{ lat:         40, common_pid:       2304 } hitcount:          2<br>{ lat:         40, common_pid:       2302 } hitcount:          5<br>{ lat:         41, common_pid:       2304 } hitcount:          1<br>{ lat:         41, common_pid:       2302 } hitcount:          8<br>{ lat:         42, common_pid:       2302 } hitcount:          6<br>{ lat:         42, common_pid:       2304 } hitcount:          1<br>{ lat:         43, common_pid:       2302 } hitcount:          3<br>{ lat:         43, common_pid:       2304 } hitcount:          4<br>{ lat:         44, common_pid:       2302 } hitcount:          6<br>{ lat:         45, common_pid:       2302 } hitcount:          5<br>{ lat:         46, common_pid:       2302 } hitcount:          5<br>{ lat:         47, common_pid:       2302 } hitcount:          7<br>{ lat:         48, common_pid:       2301 } hitcount:          1<br>{ lat:         48, common_pid:       2302 } hitcount:          9<br>{ lat:         49, common_pid:       2302 } hitcount:          3<br>{ lat:         50, common_pid:       2302 } hitcount:          1<br>{ lat:         50, common_pid:       2301 } hitcount:          1<br>{ lat:         51, common_pid:       2302 } hitcount:          2<br>{ lat:         51, common_pid:       2301 } hitcount:          1<br>{ lat:         61, common_pid:       2302 } hitcount:          1<br>{ lat:        110, common_pid:       2302 } hitcount:          1</p>
<p>Totals:<br>    Hits: 89565<br>    Entries: 158<br>    Dropped: 0</p>
<p>This doesn’t tell us any information about how late cyclictest may have<br>woken up, but it does show us a nice histogram of how long it took from<br>the time that cyclictest was woken to the time it made it into user space.</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_histogram/" title="Kernel-4.18.0-80.el8_histogra" target="_blank" rel="external">http://www.oostech.com/2021/02/19/Kernel-4.18.0-80.el8_histogram/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/02/19/Kernel-4.18.0-80.el8_dht11/" title="Kernel-4.18.0-80.el8_dht11"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/02/19/Kernel-4.18.0-80.el8_api/" title="Kernel-4.18.0-80.el8_api"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>