<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-2.6.32-573.12.1.el6_credentials | oosTech.com</title>
  <meta name="description" content="&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;              CREDENTIALS IN LINUX              &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  By: David Howells &amp;#x64;&amp;#x68;&amp;#x6f;&amp;#119;&amp;#101;&amp;#108;&amp;#108;&amp;#x73;&amp;#64;&amp;#114;&amp;#101;&amp;#100;&amp;#x68;&amp;#">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-2.6.32-573.12.1.el6_credentials">
<meta property="og:url" content="http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_credentials/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;              CREDENTIALS IN LINUX              &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  By: David Howells &amp;#x64;&amp;#x68;&amp;#x6f;&amp;#119;&amp;#101;&amp;#108;&amp;#108;&amp;#x73;&amp;#64;&amp;#114;&amp;#101;&amp;#100;&amp;#x68;&amp;#">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_credentials/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a><span class="category-list-count">830</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_devices/" class="title">Kernel-2.6.32-573.12.1.el6_devices</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3c509/" class="title">Kernel-3.10.0-957.el7_3c509</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#IMMUTABLE-CREDENTIALS"><span class="toc-number">1.</span> <span class="toc-text">IMMUTABLE CREDENTIALS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ACCESSING-TASK-CREDENTIALS"><span class="toc-number">2.</span> <span class="toc-text">ACCESSING TASK CREDENTIALS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ACCESSING-ANOTHER-TASK%E2%80%99S-CREDENTIALS"><span class="toc-number">3.</span> <span class="toc-text">ACCESSING ANOTHER TASK’S CREDENTIALS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ALTERING-CREDENTIALS"><span class="toc-number">4.</span> <span class="toc-text">ALTERING CREDENTIALS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MANAGING-CREDENTIALS"><span class="toc-number">5.</span> <span class="toc-text">MANAGING CREDENTIALS</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-2.6.32-573.12.1.el6_credentials" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-2.6.32-573.12.1.el6_credentials
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_credentials/" class="article-date">
	 published: <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
	</a>
</span>

        
	<a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_credentials/" class="article-date">
	   updated: <time datetime="2021-03-12T16:00:00.000Z" itemprop="dateUpdated">2021-03-13</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_credentials/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <pre><code>             ====================
             CREDENTIALS IN LINUX
             ====================
</code></pre>
<p>By: David Howells <a href="mailto:&#x64;&#x68;&#x6f;&#119;&#101;&#108;&#108;&#x73;&#64;&#114;&#101;&#100;&#x68;&#97;&#116;&#46;&#x63;&#111;&#x6d;">&#x64;&#x68;&#x6f;&#119;&#101;&#108;&#108;&#x73;&#64;&#114;&#101;&#100;&#x68;&#97;&#116;&#46;&#x63;&#111;&#x6d;</a></p>
<p>Contents:</p>
<p> (*) Overview.</p>
<p> (*) Types of credentials.</p>
<p> (*) File markings.</p>
<p> (*) Task credentials.</p>
<pre><code> - Immutable credentials.
 - Accessing task credentials.
 - Accessing another task&#39;s credentials.
 - Altering credentials.
 - Managing credentials.
</code></pre>
<p> (*) Open file credentials.</p>
<p> (*) Overriding the VFS’s use of credentials.</p>
<p>========<br>OVERVIEW<br>========</p>
<p>There are several parts to the security check performed by Linux when one<br>object acts upon another:</p>
<p> (1) Objects.</p>
<pre><code> Objects are things in the system that may be acted upon directly by
 userspace programs.  Linux has a variety of actionable objects, including:

- Tasks
- Files/inodes
- Sockets
- Message queues
- Shared memory segments
- Semaphores
- Keys

 As a part of the description of all these objects there is a set of
 credentials.  What&#39;s in the set depends on the type of object.
</code></pre>
<p> (2) Object ownership.</p>
<pre><code> Amongst the credentials of most objects, there will be a subset that
 indicates the ownership of that object.  This is used for resource
 accounting and limitation (disk quotas and task rlimits for example).

 In a standard UNIX filesystem, for instance, this will be defined by the
 UID marked on the inode.
</code></pre>
<p> (3) The objective context.</p>
<pre><code> Also amongst the credentials of those objects, there will be a subset that
 indicates the &#39;objective context&#39; of that object.  This may or may not be
 the same set as in (2) - in standard UNIX files, for instance, this is the
 defined by the UID and the GID marked on the inode.

 The objective context is used as part of the security calculation that is
 carried out when an object is acted upon.
</code></pre>
<p> (4) Subjects.</p>
<pre><code> A subject is an object that is acting upon another object.

 Most of the objects in the system are inactive: they don&#39;t act on other
 objects within the system.  Processes/tasks are the obvious exception:
 they do stuff; they access and manipulate things.

 Objects other than tasks may under some circumstances also be subjects.
 For instance an open file may send SIGIO to a task using the UID and EUID
 given to it by a task that called fcntl(F_SETOWN) upon it.  In this case,
 the file struct will have a subjective context too.
</code></pre>
<p> (5) The subjective context.</p>
<pre><code> A subject has an additional interpretation of its credentials.  A subset
 of its credentials forms the &#39;subjective context&#39;.  The subjective context
 is used as part of the security calculation that is carried out when a
 subject acts.

 A Linux task, for example, has the FSUID, FSGID and the supplementary
 group list for when it is acting upon a file - which are quite separate
 from the real UID and GID that normally form the objective context of the
 task.
</code></pre>
<p> (6) Actions.</p>
<pre><code> Linux has a number of actions available that a subject may perform upon an
 object.  The set of actions available depends on the nature of the subject
 and the object.

 Actions include reading, writing, creating and deleting files; forking or
 signalling and tracing tasks.
</code></pre>
<p> (7) Rules, access control lists and security calculations.</p>
<pre><code> When a subject acts upon an object, a security calculation is made.  This
 involves taking the subjective context, the objective context and the
 action, and searching one or more sets of rules to see whether the subject
 is granted or denied permission to act in the desired manner on the
 object, given those contexts.

 There are two main sources of rules:

 (a) Discretionary access control (DAC):

 Sometimes the object will include sets of rules as part of its
 description.  This is an &#39;Access Control List&#39; or &#39;ACL&#39;.  A Linux
 file may supply more than one ACL.

 A traditional UNIX file, for example, includes a permissions mask that
 is an abbreviated ACL with three fixed classes of subject (&#39;user&#39;,
 &#39;group&#39; and &#39;other&#39;), each of which may be granted certain privileges
 (&#39;read&#39;, &#39;write&#39; and &#39;execute&#39; - whatever those map to for the object
 in question).  UNIX file permissions do not allow the arbitrary
 specification of subjects, however, and so are of limited use.

 A Linux file might also sport a POSIX ACL.  This is a list of rules
 that grants various permissions to arbitrary subjects.

 (b) Mandatory access control (MAC):

 The system as a whole may have one or more sets of rules that get
 applied to all subjects and objects, regardless of their source.
 SELinux and Smack are examples of this.

 In the case of SELinux and Smack, each object is given a label as part
 of its credentials.  When an action is requested, they take the
 subject label, the object label and the action and look for a rule
 that says that this action is either granted or denied.
</code></pre>
<p>====================<br>TYPES OF CREDENTIALS<br>====================</p>
<p>The Linux kernel supports the following types of credentials:</p>
<p> (1) Traditional UNIX credentials.</p>
<pre><code>Real User ID
Real Group ID

 The UID and GID are carried by most, if not all, Linux objects, even if in
 some cases it has to be invented (FAT or CIFS files for example, which are
 derived from Windows).  These (mostly) define the objective context of
 that object, with tasks being slightly different in some cases.

Effective, Saved and FS User ID
Effective, Saved and FS Group ID
Supplementary groups

 These are additional credentials used by tasks only.  Usually, an
 EUID/EGID/GROUPS will be used as the subjective context, and real UID/GID
 will be used as the objective.  For tasks, it should be noted that this is
 not always true.
</code></pre>
<p> (2) Capabilities.</p>
<pre><code>Set of permitted capabilities
Set of inheritable capabilities
Set of effective capabilities
Capability bounding set

 These are only carried by tasks.  They indicate superior capabilities
 granted piecemeal to a task that an ordinary task wouldn&#39;t otherwise have.
 These are manipulated implicitly by changes to the traditional UNIX
 credentials, but can also be manipulated directly by the capset() system
 call.

 The permitted capabilities are those caps that the process might grant
 itself to its effective or permitted sets through capset().  This
 inheritable set might also be so constrained.

 The effective capabilities are the ones that a task is actually allowed to
 make use of itself.

 The inheritable capabilities are the ones that may get passed across
 execve().

 The bounding set limits the capabilities that may be inherited across
 execve(), especially when a binary is executed that will execute as UID 0.
</code></pre>
<p> (3) Secure management flags (securebits).</p>
<pre><code> These are only carried by tasks.  These govern the way the above
 credentials are manipulated and inherited over certain operations such as
 execve().  They aren&#39;t used directly as objective or subjective
 credentials.
</code></pre>
<p> (4) Keys and keyrings.</p>
<pre><code> These are only carried by tasks.  They carry and cache security tokens
 that don&#39;t fit into the other standard UNIX credentials.  They are for
 making such things as network filesystem keys available to the file
 accesses performed by processes, without the necessity of ordinary
 programs having to know about security details involved.

 Keyrings are a special type of key.  They carry sets of other keys and can
 be searched for the desired key.  Each process may subscribe to a number
 of keyrings:

Per-thread keying
Per-process keyring
Per-session keyring

 When a process accesses a key, if not already present, it will normally be
 cached on one of these keyrings for future accesses to find.

 For more information on using keys, see Documentation/keys.txt.
</code></pre>
<p> (5) LSM</p>
<pre><code> The Linux Security Module allows extra controls to be placed over the
 operations that a task may do.  Currently Linux supports two main
 alternate LSM options: SELinux and Smack.

 Both work by labelling the objects in a system and then applying sets of
 rules (policies) that say what operations a task with one label may do to
 an object with another label.
</code></pre>
<p> (6) AF_KEY</p>
<pre><code> This is a socket-based approach to credential management for networking
 stacks [RFC 2367].  It isn&#39;t discussed by this document as it doesn&#39;t
 interact directly with task and file credentials; rather it keeps system
 level credentials.
</code></pre>
<p>When a file is opened, part of the opening task’s subjective context is<br>recorded in the file struct created.  This allows operations using that file<br>struct to use those credentials instead of the subjective context of the task<br>that issued the operation.  An example of this would be a file opened on a<br>network filesystem where the credentials of the opened file should be presented<br>to the server, regardless of who is actually doing a read or a write upon it.</p>
<p>=============<br>FILE MARKINGS<br>=============</p>
<p>Files on disk or obtained over the network may have annotations that form the<br>objective security context of that file.  Depending on the type of filesystem,<br>this may include one or more of the following:</p>
<p> (*) UNIX UID, GID, mode;</p>
<p> (*) Windows user ID;</p>
<p> (*) Access control list;</p>
<p> (*) LSM security label;</p>
<p> (*) UNIX exec privilege escalation bits (SUID/SGID);</p>
<p> (*) File capabilities exec privilege escalation bits.</p>
<p>These are compared to the task’s subjective security context, and certain<br>operations allowed or disallowed as a result.  In the case of execve(), the<br>privilege escalation bits come into play, and may allow the resulting process<br>extra privileges, based on the annotations on the executable file.</p>
<p>================<br>TASK CREDENTIALS<br>================</p>
<p>In Linux, all of a task’s credentials are held in (uid, gid) or through<br>(groups, keys, LSM security) a refcounted structure of type ‘struct cred’.<br>Each task points to its credentials by a pointer called ‘cred’ in its<br>task_struct.</p>
<p>Once a set of credentials has been prepared and committed, it may not be<br>changed, barring the following exceptions:</p>
<p> (1) its reference count may be changed;</p>
<p> (2) the reference count on the group_info struct it points to may be changed;</p>
<p> (3) the reference count on the security data it points to may be changed;</p>
<p> (4) the reference count on any keyrings it points to may be changed;</p>
<p> (5) any keyrings it points to may be revoked, expired or have their security<br>     attributes changed; and</p>
<p> (6) the contents of any keyrings to which it points may be changed (the whole<br>     point of keyrings being a shared set of credentials, modifiable by anyone<br>     with appropriate access).</p>
<p>To alter anything in the cred struct, the copy-and-replace principle must be<br>adhered to.  First take a copy, then alter the copy and then use RCU to change<br>the task pointer to make it point to the new copy.  There are wrappers to aid<br>with this (see below).</p>
<p>A task may only alter its <em>own</em> credentials; it is no longer permitted for a<br>task to alter another’s credentials.  This means the capset() system call is no<br>longer permitted to take any PID other than the one of the current process.<br>Also keyctl_instantiate() and keyctl_negate() functions no longer permit<br>attachment to process-specific keyrings in the requesting process as the<br>instantiating process may need to create them.</p>
<h2 id="IMMUTABLE-CREDENTIALS"><a href="#IMMUTABLE-CREDENTIALS" class="headerlink" title="IMMUTABLE CREDENTIALS"></a>IMMUTABLE CREDENTIALS</h2><p>Once a set of credentials has been made public (by calling commit_creds() for<br>example), it must be considered immutable, barring two exceptions:</p>
<p> (1) The reference count may be altered.</p>
<p> (2) Whilst the keyring subscriptions of a set of credentials may not be<br>     changed, the keyrings subscribed to may have their contents altered.</p>
<p>To catch accidental credential alteration at compile time, struct task_struct<br>has <em>const</em> pointers to its credential sets, as does struct file.  Furthermore,<br>certain functions such as get_cred() and put_cred() operate on const pointers,<br>thus rendering casts unnecessary, but require to temporarily ditch the const<br>qualification to be able to alter the reference count.</p>
<h2 id="ACCESSING-TASK-CREDENTIALS"><a href="#ACCESSING-TASK-CREDENTIALS" class="headerlink" title="ACCESSING TASK CREDENTIALS"></a>ACCESSING TASK CREDENTIALS</h2><p>A task being able to alter only its own credentials permits the current process<br>to read or replace its own credentials without the need for any form of locking</p>
<ul>
<li><p>which simplifies things greatly.  It can just call:</p>
<p>  const struct cred *current_cred()</p>
</li>
</ul>
<p>to get a pointer to its credentials structure, and it doesn’t have to release<br>it afterwards.</p>
<p>There are convenience wrappers for retrieving specific aspects of a task’s<br>credentials (the value is simply returned in each case):</p>
<pre><code>uid_t current_uid(void)        Current&#39;s real UID
gid_t current_gid(void)        Current&#39;s real GID
uid_t current_euid(void)    Current&#39;s effective UID
gid_t current_egid(void)    Current&#39;s effective GID
uid_t current_fsuid(void)    Current&#39;s file access UID
gid_t current_fsgid(void)    Current&#39;s file access GID
kernel_cap_t current_cap(void)    Current&#39;s effective capabilities
void *current_security(void)    Current&#39;s LSM security pointer
struct user_struct *current_user(void)  Current&#39;s user account
</code></pre>
<p>There are also convenience wrappers for retrieving specific associated pairs of<br>a task’s credentials:</p>
<pre><code>void current_uid_gid(uid_t *, gid_t *);
void current_euid_egid(uid_t *, gid_t *);
void current_fsuid_fsgid(uid_t *, gid_t *);
</code></pre>
<p>which return these pairs of values through their arguments after retrieving<br>them from the current task’s credentials.</p>
<p>In addition, there is a function for obtaining a reference on the current<br>process’s current set of credentials:</p>
<pre><code>const struct cred *get_current_cred(void);
</code></pre>
<p>and functions for getting references to one of the credentials that don’t<br>actually live in struct cred:</p>
<pre><code>struct user_struct *get_current_user(void);
struct group_info *get_current_groups(void);
</code></pre>
<p>which get references to the current process’s user accounting structure and<br>supplementary groups list respectively.</p>
<p>Once a reference has been obtained, it must be released with put_cred(),<br>free_uid() or put_group_info() as appropriate.</p>
<h2 id="ACCESSING-ANOTHER-TASK’S-CREDENTIALS"><a href="#ACCESSING-ANOTHER-TASK’S-CREDENTIALS" class="headerlink" title="ACCESSING ANOTHER TASK’S CREDENTIALS"></a>ACCESSING ANOTHER TASK’S CREDENTIALS</h2><p>Whilst a task may access its own credentials without the need for locking, the<br>same is not true of a task wanting to access another task’s credentials.  It<br>must use the RCU read lock and rcu_dereference().</p>
<p>The rcu_dereference() is wrapped by:</p>
<pre><code>const struct cred *__task_cred(struct task_struct *task);
</code></pre>
<p>This should be used inside the RCU read lock, as in the following example:</p>
<pre><code>void foo(struct task_struct *t, struct foo_data *f)
&#123;
    const struct cred *tcred;
    ...
    rcu_read_lock();
    tcred = __task_cred(t);
    f-&gt;uid = tcred-&gt;uid;
    f-&gt;gid = tcred-&gt;gid;
    f-&gt;groups = get_group_info(tcred-&gt;groups);
    rcu_read_unlock();
    ...
&#125;
</code></pre>
<p>A function need not get RCU read lock to use __task_cred() if it is holding a<br>spinlock at the time as this implicitly holds the RCU read lock.</p>
<p>Should it be necessary to hold another task’s credentials for a long period of<br>time, and possibly to sleep whilst doing so, then the caller should get a<br>reference on them using:</p>
<pre><code>const struct cred *get_task_cred(struct task_struct *task);
</code></pre>
<p>This does all the RCU magic inside of it.  The caller must call put_cred() on<br>the credentials so obtained when they’re finished with.</p>
<p>There are a couple of convenience functions to access bits of another task’s<br>credentials, hiding the RCU magic from the caller:</p>
<pre><code>uid_t task_uid(task)        Task&#39;s real UID
uid_t task_euid(task)        Task&#39;s effective UID
</code></pre>
<p>If the caller is holding a spinlock or the RCU read lock at the time anyway,<br>then:</p>
<pre><code>__task_cred(task)-&gt;uid
__task_cred(task)-&gt;euid
</code></pre>
<p>should be used instead.  Similarly, if multiple aspects of a task’s credentials<br>need to be accessed, RCU read lock or a spinlock should be used, __task_cred()<br>called, the result stored in a temporary pointer and then the credential<br>aspects called from that before dropping the lock.  This prevents the<br>potentially expensive RCU magic from being invoked multiple times.</p>
<p>Should some other single aspect of another task’s credentials need to be<br>accessed, then this can be used:</p>
<pre><code>task_cred_xxx(task, member)
</code></pre>
<p>where ‘member’ is a non-pointer member of the cred struct.  For instance:</p>
<pre><code>uid_t task_cred_xxx(task, suid);
</code></pre>
<p>will retrieve ‘struct cred::suid’ from the task, doing the appropriate RCU<br>magic.  This may not be used for pointer members as what they point to may<br>disappear the moment the RCU read lock is dropped.</p>
<h2 id="ALTERING-CREDENTIALS"><a href="#ALTERING-CREDENTIALS" class="headerlink" title="ALTERING CREDENTIALS"></a>ALTERING CREDENTIALS</h2><p>As previously mentioned, a task may only alter its own credentials, and may not<br>alter those of another task.  This means that it doesn’t need to use any<br>locking to alter its own credentials.</p>
<p>To alter the current process’s credentials, a function should first prepare a<br>new set of credentials by calling:</p>
<pre><code>struct cred *prepare_creds(void);
</code></pre>
<p>this locks current-&gt;cred_replace_mutex and then allocates and constructs a<br>duplicate of the current process’s credentials, returning with the mutex still<br>held if successful.  It returns NULL if not successful (out of memory).</p>
<p>The mutex prevents ptrace() from altering the ptrace state of a process whilst<br>security checks on credentials construction and changing is taking place as<br>the ptrace state may alter the outcome, particularly in the case of execve().</p>
<p>The new credentials set should be altered appropriately, and any security<br>checks and hooks done.  Both the current and the proposed sets of credentials<br>are available for this purpose as current_cred() will return the current set<br>still at this point.</p>
<p>When the credential set is ready, it should be committed to the current process<br>by calling:</p>
<pre><code>int commit_creds(struct cred *new);
</code></pre>
<p>This will alter various aspects of the credentials and the process, giving the<br>LSM a chance to do likewise, then it will use rcu_assign_pointer() to actually<br>commit the new credentials to current-&gt;cred, it will release<br>current-&gt;cred_replace_mutex to allow ptrace() to take place, and it will notify<br>the scheduler and others of the changes.</p>
<p>This function is guaranteed to return 0, so that it can be tail-called at the<br>end of such functions as sys_setresuid().</p>
<p>Note that this function consumes the caller’s reference to the new credentials.<br>The caller should <em>not</em> call put_cred() on the new credentials afterwards.</p>
<p>Furthermore, once this function has been called on a new set of credentials,<br>those credentials may <em>not</em> be changed further.</p>
<p>Should the security checks fail or some other error occur after prepare_creds()<br>has been called, then the following function should be invoked:</p>
<pre><code>void abort_creds(struct cred *new);
</code></pre>
<p>This releases the lock on current-&gt;cred_replace_mutex that prepare_creds() got<br>and then releases the new credentials.</p>
<p>A typical credentials alteration function would look something like this:</p>
<pre><code>int alter_suid(uid_t suid)
&#123;
    struct cred *new;
    int ret;

    new = prepare_creds();
    if (!new)
        return -ENOMEM;

    new-&gt;suid = suid;
    ret = security_alter_suid(new);
    if (ret &lt; 0) &#123;
        abort_creds(new);
        return ret;
    &#125;

    return commit_creds(new);
&#125;
</code></pre>
<h2 id="MANAGING-CREDENTIALS"><a href="#MANAGING-CREDENTIALS" class="headerlink" title="MANAGING CREDENTIALS"></a>MANAGING CREDENTIALS</h2><p>There are some functions to help manage credentials:</p>
<p> (*) void put_cred(const struct cred *cred);</p>
<pre><code> This releases a reference to the given set of credentials.  If the
 reference count reaches zero, the credentials will be scheduled for
 destruction by the RCU system.
</code></pre>
<p> (*) const struct cred *get_cred(const struct cred *cred);</p>
<pre><code> This gets a reference on a live set of credentials, returning a pointer to
 that set of credentials.
</code></pre>
<p> (*) struct cred *get_new_cred(struct cred *cred);</p>
<pre><code> This gets a reference on a set of credentials that is under construction
 and is thus still mutable, returning a pointer to that set of credentials.
</code></pre>
<p>=====================<br>OPEN FILE CREDENTIALS<br>=====================</p>
<p>When a new file is opened, a reference is obtained on the opening task’s<br>credentials and this is attached to the file struct as ‘f_cred’ in place of<br>‘f_uid’ and ‘f_gid’.  Code that used to access file-&gt;f_uid and file-&gt;f_gid<br>should now access file-&gt;f_cred-&gt;fsuid and file-&gt;f_cred-&gt;fsgid.</p>
<p>It is safe to access f_cred without the use of RCU or locking because the<br>pointer will not change over the lifetime of the file struct, and nor will the<br>contents of the cred struct pointed to, barring the exceptions listed above<br>(see the Task Credentials section).</p>
<p>=======================================<br>OVERRIDING THE VFS’S USE OF CREDENTIALS<br>=======================================</p>
<p>Under some circumstances it is desirable to override the credentials used by<br>the VFS, and that can be done by calling into such as vfs_mkdir() with a<br>different set of credentials.  This is done in the following places:</p>
<p> (*) sys_faccessat().</p>
<p> (*) do_coredump().</p>
<p> (*) nfs4recover.c.</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_credentials/" title="Kernel-2.6.32-573.12.1.el6_credentials" target="_blank" rel="external">http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_credentials/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_cs89x0/" title="Kernel-2.6.32-573.12.1.el6_cs89x0"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_configfs/" title="Kernel-2.6.32-573.12.1.el6_configfs"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>