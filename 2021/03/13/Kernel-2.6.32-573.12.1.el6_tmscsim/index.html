<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-2.6.32-573.12.1.el6_tmscsi | oosTech.com</title>
  <meta name="description" content="The tmscsim driver Purpose and history Installation Features Configuration via &#x2F;proc&#x2F;scsi&#x2F;tmscsim&#x2F;? Configuration via boot&#x2F;module params Potential improvements Bug reports, debugging and updates Ackno">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-2.6.32-573.12.1.el6_tmscsi">
<meta property="og:url" content="http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_tmscsim/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="The tmscsim driver Purpose and history Installation Features Configuration via &#x2F;proc&#x2F;scsi&#x2F;tmscsim&#x2F;? Configuration via boot&#x2F;module params Potential improvements Bug reports, debugging and updates Ackno">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_tmscsim/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a><span class="category-list-count">830</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_devices/" class="title">Kernel-2.6.32-573.12.1.el6_devices</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3c509/" class="title">Kernel-3.10.0-957.el7_3c509</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#The-tmscsim-driver"><span class="toc-number">1.</span> <span class="toc-text">The tmscsim driver</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Features"><span class="toc-number">1.1.</span> <span class="toc-text">3.Features</span></a></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-2.6.32-573.12.1.el6_tmscsim" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-2.6.32-573.12.1.el6_tmscsi
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_tmscsim/" class="article-date">
	 published: <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
	</a>
</span>

        
	<a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_tmscsim/" class="article-date">
	   updated: <time datetime="2021-03-12T16:00:00.000Z" itemprop="dateUpdated">2021-03-13</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_tmscsim/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="The-tmscsim-driver"><a href="#The-tmscsim-driver" class="headerlink" title="The tmscsim driver"></a>The tmscsim driver</h1><ol>
<li>Purpose and history</li>
<li>Installation</li>
<li>Features</li>
<li>Configuration via /proc/scsi/tmscsim/?</li>
<li>Configuration via boot/module params</li>
<li>Potential improvements</li>
<li>Bug reports, debugging and updates</li>
<li>Acknowledgements</li>
<li>Copyright</li>
</ol>
<ol>
<li>Purpose and history</li>
</ol>
<hr>
<p>The tmscsim driver supports PCI SCSI Host Adapters based on the AM53C974<br>chip. AM53C974 based SCSI adapters include:<br> Tekram DC390, DC390T<br> Dawicontrol 2974<br> QLogic Fast! PCI Basic<br> some on-board adapters<br>(This is most probably not a complete list)</p>
<p>It has originally written by C.L. Huang from the Tekram corp. to support the<br>Tekram DC390(T) adapter. This is where the name comes from: tm = Tekram<br>scsi = SCSI driver, m = AMD (?) as opposed to w for the DC390W/U/F<br>(NCR53c8X5, X=2/7) driver. Yes, there was also a driver for the latter,<br>tmscsiw, which supported DC390W/U/F adapters. It’s not maintained any more,<br>as the ncr53c8xx is perfectly supporting these adapters since some time.</p>
<p>The driver first appeared in April 1996, exclusively supported the DC390<br>and has been enhanced since then in various steps. In May 1998 support for<br>general AM53C974 based adapters and some possibilities to configure it were<br>added. The non-DC390 support works by assuming some values for the data<br>normally taken from the DC390 EEPROM. See below (chapter 5) for details.</p>
<p>When using the DC390, the configuration is still be done using the DC390<br>BIOS setup. The DC390 EEPROM is read and used by the driver, any boot or<br>module parameters (chapter 5) are ignored! However, you can change settings<br>dynamically, as described in chapter 4. </p>
<p>For a more detailed description of the driver’s history, see the first lines<br>of tmscsim.c.<br>The numbering scheme isn’t consistent. The first versions went from 1.00 to<br>1.12, then 1.20a to 1.20t. Finally I decided to use the ncr53c8xx scheme. So<br>the next revisions will be 2.0a to 2.0X (stable), 2.1a to 2.1X (experimental),<br>2.2a to 2.2X (stable, again) etc. (X = anything between a and z.) If I send<br>fixes to people for testing, I create intermediate versions with a digit<br>appended, e.g. 2.0c3.</p>
<ol start="2">
<li>Installation</li>
</ol>
<hr>
<p>If you got any recent kernel with this driver and document included in<br>linux/drivers/scsi, you basically have to do nothing special to use this<br>driver. Of course you have to choose to compile SCSI support and DC390(T)<br>support into your kernel or as module when configuring your kernel for<br>compiling.<br>NEW: You may as well compile this module outside your kernel, using the<br>supplied Makefile.</p>
<p> If you got an old kernel (pre 2.1.127, pre 2.0.37p1) with an old version of<br> this driver: Get dc390-21125-20b.diff.gz or dc390-2036p21-20b1.diff.gz from<br> my web page and apply the patch. Apply further patches to upgrade to the<br> latest version of the driver.</p>
<p> If you want to do it manually, you should copy the files (dc390.h,<br> tmscsim.h, tmscsim.c, scsiiom.c and README.tmscsim) from this directory to<br> linux/drivers/scsi. You have to recompile your kernel/module of course.</p>
<p> You should apply the three patches included in dc390-120-kernel.diff<br> (Applying them: cd /usr/src; patch -p0 &lt;~/dc390-120-kernel.diff)<br> The patches are against 2.1.125, so you might have to manually resolve<br> rejections when applying to another kernel version.</p>
<p> The patches will update the kernel startup code to allow boot parameters to<br> be passed to the driver, update the Documentation and finally offer you the<br> possibility to omit the non-DC390 parts of the driver.<br> (By selecting “Omit support for non DC390” you basically disable the<br> emulation of a DC390 EEPROM for non DC390 adapters. This saves a few bytes<br> of memory.)</p>
<p>If you got a very old kernel without the tmscsim driver (pre 2.0.31)<br>I recommend upgrading your kernel. However, if you don’t want to, please<br>contact me to get the appropriate patches.</p>
<p>Upgrading a SCSI driver is always a delicate thing to do. The 2.0 driver has<br>proven stable on many systems, but it’s still a good idea to take some<br>precautions. In an ideal world you would have a full backup of your disks.<br>The world isn’t ideal and most people don’t have full backups (me neither).<br>So take at least the following measures:</p>
<ul>
<li>make your kernel remount the FS read-only on detecting an error:<br>tune2fs -e remount-ro /dev/sd??</li>
<li>have copies of your SCSI disk’s partition tables on some safe location:<br>dd if=/dev/sda of=/mnt/floppy/sda bs=512 count=1<br>or just print it with:<br>fdisk -l | lpr</li>
<li>make sure you are able to boot Linux (e.g. from floppy disk using InitRD)<br>if your SCSI disk gets corrupted. You can use<br><a href="ftp://student.physik.uni-dortmund.de/pub/linux/kernel/bootdisk.gz">ftp://student.physik.uni-dortmund.de/pub/linux/kernel/bootdisk.gz</a></li>
</ul>
<p>One more warning: I used to overclock my PCI bus to 41.67 MHz. My Tekram<br>DC390F (Sym53c875) accepted this as well as my Millenium. But the Am53C974<br>produced errors and started to corrupt my disks. So don’t do that! A 37.50<br>MHz PCI bus works for me, though, but I don’t recommend using higher clocks<br>than the 33.33 MHz being in the PCI spec.</p>
<p>If you want to share the IRQ with another device and the driver refuses to<br>do so, you might succeed with changing the DC390_IRQ type in tmscsim.c to<br>IRQF_SHARED | IRQF_DISABLED.</p>
<h2 id="3-Features"><a href="#3-Features" class="headerlink" title="3.Features"></a>3.Features</h2><ul>
<li>SCSI</li>
</ul>
<ul>
<li>Tagged command queueing</li>
<li>Sync speed up to 10 MHz</li>
<li>Disconnection</li>
<li>Multiple LUNs</li>
</ul>
<ul>
<li>General / Linux interface</li>
</ul>
<ul>
<li>Support for up to 4 AM53C974 adapters.</li>
<li>DC390 EEPROM usage or boot/module params</li>
<li>Information via cat /proc/scsi/tmscsim/?</li>
<li>Dynamically configurable by writing to /proc/scsi/tmscsim/?</li>
<li>Dynamic allocation of resources</li>
<li>SMP support: Locking on io_request lock (Linux 2.1/2.2) or adapter<br> specific locks (Linux 2.5?)</li>
<li>Uniform source code for Linux-2.x.y</li>
<li>Support for dyn. addition/removal of devices via add/remove-single-device<br>(Try: echo “scsi add-single-device C B T U” &gt;/proc/scsi/scsi<br> C = Controller, B = Bus, T = Target SCSI ID, U = Unit SCSI LUN.)<br> Use with care!</li>
<li>Try to use the partition table for the determination of the mapping</li>
</ul>
<ol start="4">
<li>Configuration via /proc/scsi/tmscsim/?</li>
</ol>
<hr>
<p>First of all look at the output of /proc/scsi/tmscsim/? by typing<br> cat /proc/scsi/tmscsim/?<br>The “?” should be replaced by the SCSI host number. (The shell might do this<br>for you.)<br>You will see some info regarding the adapter and, at the end, a listing of<br>the attached devices and their settings.</p>
<p>Here’s an example:<br>garloff@kurt:/home/garloff &gt; cat /proc/scsi/tmscsim/0<br>Tekram DC390/AM53C974 PCI SCSI Host Adapter, Driver Version 2.0e7 2000-11-28<br>SCSI Host Nr 1, AM53C974 Adapter Nr 0<br>IOPortBase 0xb000, IRQ 10<br>MaxID 8, MaxLUN 8, AdapterID 6, SelTimeout 250 ms, DelayReset 1 s<br>TagMaxNum 16, Status 0x00, ACBFlag 0x00, GlitchEater 24 ns<br>Statistics: Cmnds 1470165, Cmnds not sent directly 0, Out of SRB conds 0<br>            Lost arbitrations 587,  Sel. connected 0, Connected: No<br>Nr of attached devices: 4, Nr of DCBs: 4<br>Map of attached LUNs: 01 00 00 03 01 00 00 00<br>Idx ID LUN Prty Sync DsCn SndS TagQ NegoPeriod SyncSpeed SyncOffs MaxCmd<br>00  00  00  Yes  Yes  Yes  Yes  Yes   100 ns    10.0 M      15      16<br>01  03  00  Yes  Yes  Yes  Yes  No    100 ns    10.0 M      15      01<br>02  03  01  Yes  Yes  Yes  Yes  No    100 ns    10.0 M      15      01<br>03  04  00  Yes  Yes  Yes  Yes  No    100 ns    10.0 M      15      01</p>
<p>Note that the settings MaxID and MaxLUN are not zero- but one-based, which<br>means that a setting MaxLUN=4, will result in the support of LUNs 0..3. This<br>is somehow inconvenient, but the way the mid-level SCSI code expects it to be.</p>
<p>ACB and DCB are acronyms for Adapter Control Block and Device Control Block.<br>These are data structures of the driver containing information about the<br>adapter and the connected SCSI devices respectively.</p>
<p>Idx is the device index (just a consecutive number for the driver), ID and<br>LUN are the SCSI ID and LUN, Prty means Parity checking, Sync synchronous<br>negotiation, DsCn Disconnection, SndS Send Start command on startup (not<br>used by the driver) and TagQ Tagged Command Queueing. NegoPeriod and<br>SyncSpeed are somehow redundant, because they are reciprocal values<br>(1 / 112 ns = 8.9 MHz). At least in theory. The driver is able to adjust the<br>NegoPeriod more accurate (4ns) than the SyncSpeed (1 / 25ns). I don’t know<br>if certain devices will have problems with this discrepancy. Max. speed is<br>10 MHz corresp. to a min. NegoPeriod of 100 ns.<br>(The driver allows slightly higher speeds if the devices (Ultra SCSI) accept<br>it, but that’s out of adapter spec, on your own risk and unlikely to improve<br>performance. You’re likely to crash your disks.)<br>SyncOffs is the offset used for synchronous negotiations; max. is 15.<br>The last values are only shown, if Sync is enabled. (NegoPeriod is still<br>displayed in brackets to show the values which will be used after enabling<br>Sync.)<br>MaxCmd ist the number of commands (=tags) which can be processed at the same<br>time by the device.</p>
<p>If you want to change a setting, you can do that by writing to<br>/proc/scsi/tmscsim/?. Basically you have to imitate the output of driver.<br>(Don’t use the brackets for NegoPeriod on Sync disabled devices.)<br>You don’t have to care about capitalisation. The driver will accept space,<br>tab, comma, = and : as separators.</p>
<p>There are three kinds of changes: </p>
<p>(1) Change driver settings:<br>    You type the names of the parameters and the params following it.<br>    Example:<br>     echo “MaxLUN=8 seltimeout 200” &gt;/proc/scsi/tmscsim/0</p>
<pre><code>Note that you can only change MaxID, MaxLUN, AdapterID, SelTimeOut,
TagMaxNum, ACBFlag, GlitchEater and DelayReset. Don&#39;t change ACBFlag
unless you want to see what happens, if the driver hangs.
</code></pre>
<p>(2) Change device settings: You write a config line to the driver. The Nr<br>    must match the ID and LUN given. If you give “-“ as parameter, it is<br>    ignored and the corresponding setting won’t be changed.<br>    You can use “y” or “n” instead of “Yes” and “No” if you want to.<br>    You don’t need to specify a full line. The driver automatically performs<br>    an INQUIRY on the device if necessary to check if it is capable to operate<br>    with the given settings (Sync, TagQ).<br>    Examples:<br>     echo “0 0 0 y y y - y - 10 “ &gt;/proc/scsi/tmscsim/0<br>     echo “3 5 0 y n y “ &gt;/proc/scsi/tmscsim/0</p>
<pre><code>To give a short explanation of the first example: 
The first three numbers, &quot;0 0 0&quot; (Device index 0, SCSI ID 0, SCSI LUN 0),
select the device to which the following parameters apply. Note that it
would be sufficient to use the index or both SCSI ID and LUN, but I chose
to require all three to have a syntax similar to the output.
The following &quot;y y y - y&quot; enables Parity checking, enables Synchronous
transfers, Disconnection, leaves Send Start (not used) untouched and
enables Tagged Command Queueing for the selected device. The &quot;-&quot; skips
the Negotiation Period setting but the &quot;10&quot; sets the max sync. speed to
10 MHz. It&#39;s useless to specify both NegoPeriod and SyncSpeed as
discussed above. The values used in this example will result in maximum
performance.
</code></pre>
<p>(3) Special commands: You can force a SCSI bus reset, an INQUIRY command, the<br>    removal or the addition of a device’s DCB and a SCSI register dump.<br>    This is only used for debugging when you meet problems. The parameter of<br>    the INQUIRY and REMOVE commands is the device index as shown by the<br>    output of /proc/scsi/tmscsim/? in the device listing in the first column<br>    (Idx). ADD takes the SCSI ID and LUN.<br>    Examples:<br>     echo “reset” &gt;/proc/scsi/tmscsim/0<br>     echo “inquiry 1” &gt;/proc/scsi/tmscsim/0<br>     echo “remove 2” &gt;/proc/scsi/tmscsim/1<br>     echo “add 2 3” &gt;/proc/scsi/tmscsim/?<br>     echo “dump” &gt;/proc/scsi/tmscsim/0</p>
<pre><code>Note that you will meet problems when you REMOVE a device&#39;s DCB with the
remove command if it contains partitions which are mounted. Only use it
after unmounting its partitions, telling the SCSI mid-level code to
remove it (scsi remove-single-device) and you really need a few bytes of
memory.
The ADD command allows you to configure a device before you tell the
mid-level code to try detection.
</code></pre>
<p>I’d suggest reviewing the output of /proc/scsi/tmscsim/? after changing<br>settings to see if everything changed as requested.</p>
<ol start="5">
<li>Configuration via boot/module parameters</li>
</ol>
<hr>
<p>With the DC390, the driver reads its EEPROM settings and tries to use them.<br>But you may want to override the settings prior to being able to change the<br>driver configuration via /proc/scsi/tmscsim/?.<br>If you do have another AM53C974 based adapter, that’s even the only<br>possibility to adjust settings before you are able to write to the<br>/proc/scsi/tmscsim/? pseudo-file, e.g. if you want to use another<br>adapter ID than 7.<br>(BTW, the log message “DC390: No EEPROM found!” is normal without a DC390.)<br>For this purpose, you can pass options to the driver before it is initialised<br>by using kernel or module parameters. See lilo(8) or modprobe(1) manual<br>pages on how to pass params to the kernel or a module.<br>[NOTE: Formerly, it was not possible to override the EEPROM supplied<br> settings of the DC390 with cmd line parameters. This has changed since<br> 2.0e7]</p>
<p>The syntax of the params is much shorter than the syntax of the /proc/…<br>interface. This makes it a little bit more difficult to use. However, long<br>parameter lines have the risk to be misinterpreted and the length of kernel<br>parameters is limited.</p>
<p>As the support for non-DC390 adapters works by simulating the values of the<br>DC390 EEPROM, the settings are given in a DC390 BIOS’ way.</p>
<p>Here’s the syntax:<br>tmscsim=AdaptID,SpdIdx,DevMode,AdaptMode,TaggedCmnds,DelayReset</p>
<p>Each of the parameters is a number, containing the described information:</p>
<ul>
<li><p>AdaptID: The SCSI ID of the host adapter. Must be in the range 0..7<br>Default is 7.</p>
</li>
<li><p>SpdIdx: The index of the maximum speed as in the DC390 BIOS. The values<br>0..7 mean 10, 8.0, 6.7, 5.7, 5.0, 4.0, 3.1 and 2 MHz resp. Default is<br>0 (10.0 MHz).</p>
</li>
<li><p>DevMode is a bit mapped value describing the per-device features. It<br>applies to all devices. (Sync, Disc and TagQ will only apply, if the<br>device supports it.) The meaning of the bits (* = default):</p>
<p> Bit Val(hex) Val(dec)  Meaning<br> *0     0x01        1      Parity check<br> *1     0x02        2      Synchronous Negotiation<br> *2     0x04        4      Disconnection<br> *3     0x08        8      Send Start command on startup. (Not used)<br> *4     0x10       16      Tagged Command Queueing</p>
<p>As usual, the desired value is obtained by adding the wanted values. If<br>you want to enable all values, e.g., you would use 31(0x1f). Default is 31.</p>
</li>
<li><p>AdaptMode is a bit mapped value describing the enabled adapter features.</p>
<p> Bit Val(hex) Val(dec)  Meaning<br> *0     0x01        1      Support more than two drives. (Not used)<br> <em>1     0x02        2      Use DOS compatible mapping for HDs greater than 1GB.<br> *2     0x04        4      Reset SCSI Bus on startup.<br> *3     0x08        8      Active Negation: Improves SCSI Bus noise immunity.<br>  4     0x10       16      Immediate return on BIOS seek command. (Not used)<br>(</em>)5     0x20       32      Check for LUNs &gt;= 1.</p>
<p>The default for LUN Check depends on CONFIG_SCSI_MULTI_LUN.</p>
</li>
<li><p>TaggedCmnds is a number indicating the maximum number of Tagged Commands.<br>It is the binary logarithm - 1 of the actual number. Max is 4 (32).<br> Value  Number of Tagged Commands<br>   0         2<br>   1         4<br>   2         8<br>  *3        16<br>   4        32</p>
</li>
<li><p>DelayReset is the time in seconds (minus 0.5s), the adapter waits, after a<br>bus reset. Default is 1 (corresp. to 1.5s).</p>
</li>
</ul>
<p>Example:<br> modprobe tmscsim tmscsim=6,2,31<br>would set the adapter ID to 6, max. speed to 6.7 MHz, enable all device<br>features and leave the adapter features, the number of Tagged Commands<br>and the Delay after a reset to the defaults.</p>
<p>As you can see, you don’t need to specify all of the six params.<br>If you want values to be ignored (i.e. the EEprom settings or the defaults<br>will be used), you may pass -2 (not 0!) at the corresponding position.</p>
<p>The defaults (7,0,31,15,3,1) are aggressive to allow good performance. You<br>can use tmscsim=7,0,31,63,4,0 for maximum performance, if your SCSI chain<br>allows it. If you meet problems, you can use tmscsim=-1 which is a shortcut<br>for tmscsim=7,4,9,15,2,10.</p>
<ol start="6">
<li>Potential improvements</li>
</ol>
<hr>
<p>Most of the intended work on the driver has been done. Here are a few ideas<br>to further improve its usability:</p>
<ul>
<li>Cleanly separate per-Target and per-LUN properties (DCB)</li>
<li>More intelligent abort() routine</li>
<li>Use new_eh code (Linux-2.1+)</li>
<li>Have the mid-level (ML) code (and not the driver) handle more of the<br>various conditions.</li>
<li>Command queueing in the driver: Eliminate Query list and use ML instead.</li>
<li>More user friendly boot/module param syntax</li>
</ul>
<p>Further investigation on these problems:</p>
<ul>
<li>Driver hangs with sync readcdda (xcdroast) (most probably VIA PCI error)</li>
</ul>
<p>Known problems:<br>Please see <a target="_blank" rel="noopener" href="http://www.garloff.de/kurt/linux/dc390/problems.html">http://www.garloff.de/kurt/linux/dc390/problems.html</a></p>
<ul>
<li>Changing the parameters of multi-lun by the tmscsim/? interface will<br>cause problems, cause these settings are mostly per Target and not per LUN<br>and should be updated accordingly. To be fixed for 2.0d24.</li>
<li>CDRs (eg Yam CRW4416) not recognized, because some buggy devices don’t<br>recover from a SCSI reset in time. Use a higher delay or don’t issue<br>a SCSI bus reset on driver initialization. See problems page.<br>For the CRW4416S, this seems to be solved with firmware 1.0g (reported by<br>Jean-Yves Barbier).</li>
<li>TEAC CD-532S not being recognized. (Works with 1.11).</li>
<li>Scanners (eg. Astra UMAX 1220S) don’t work: Disable Sync Negotiation.<br>If this does not help, try echo “INQUIRY t” &gt;/proc/scsi/tmscsim/? (t<br>replaced by the dev index of your scanner). You may try to reset your SCSI<br>bus afterwards (echo “RESET” &gt;/proc/scsi/tmscsim/?).<br>The problem seems to be solved as of 2.0d18, thanks to Andreas Rick.</li>
<li>If there is a valid partition table, the driver will use it for determining<br>the mapping. If there’s none, a reasonable mapping (Symbios-like) will be<br>assumed. Other operating systems may not like this mapping, though<br>it’s consistent with the BIOS’ behaviour. Old DC390 drivers ignored the<br>partition table and used a H/S = 64/32 or 255/63 translation. So if you<br>want to be compatible to those, use this old mapping when creating<br>partition tables. Even worse, on bootup the DC390 might complain if other<br>mappings are found, so auto rebooting may fail.</li>
<li>In some situations, the driver will get stuck in an abort loop. This is a<br>bad interaction between the Mid-Layer of Linux’ SCSI code and the driver.<br>Try to disable DsCn, if you meet this problem. Please contact me for<br>further debugging.</li>
</ul>
<ol start="7">
<li>Bug reports, debugging and updates</li>
</ol>
<hr>
<p>Whenever you have problems with the driver, you are invited to ask the<br>author for help. However, I’d suggest reading the docs and trying to solve<br>the problem yourself, first.<br>If you find something, which you believe to be a bug, please report it to me.<br>Please append the output of /proc/scsi/scsi, /proc/scsi/tmscsim/? and<br>maybe the DC390 log messages to the report. </p>
<p>Bug reports should be send to me (Kurt Garloff <a href="mailto:&#x64;&#99;&#x33;&#57;&#48;&#x40;&#103;&#97;&#114;&#x6c;&#111;&#x66;&#x66;&#x2e;&#x64;&#101;">&#x64;&#99;&#x33;&#57;&#48;&#x40;&#103;&#97;&#114;&#x6c;&#111;&#x66;&#x66;&#x2e;&#x64;&#101;</a>) as well<br>as to the linux-scsi list (<a href="mailto:&#108;&#x69;&#x6e;&#117;&#x78;&#45;&#115;&#99;&#x73;&#x69;&#x40;&#118;&#x67;&#x65;&#x72;&#46;&#107;&#x65;&#x72;&#x6e;&#101;&#x6c;&#46;&#111;&#x72;&#103;">&#108;&#x69;&#x6e;&#117;&#x78;&#45;&#115;&#99;&#x73;&#x69;&#x40;&#118;&#x67;&#x65;&#x72;&#46;&#107;&#x65;&#x72;&#x6e;&#101;&#x6c;&#46;&#111;&#x72;&#103;</a>), as sometimes bugs<br>are caused by the SCSI mid-level code.</p>
<p>I will ask you for some more details and probably I will also ask you to<br>enable some of the DEBUG options in the driver (tmscsim.c:DC390_DEBUGXXX<br>defines). The driver will produce some data for the syslog facility then.<br>Beware: If your syslog gets written to a SCSI disk connected to your<br>AM53C974, the logging might produce log output again, and you might end<br>having your box spending most of its time doing the logging.</p>
<p>The latest version of the driver can be found at:<br> <a target="_blank" rel="noopener" href="http://www.garloff.de/kurt/linux/dc390/">http://www.garloff.de/kurt/linux/dc390/</a><br> <a href="ftp://ftp.suse.com/pub/people/garloff/linux/dc390/">ftp://ftp.suse.com/pub/people/garloff/linux/dc390/</a></p>
<ol start="8">
<li>Acknowledgements</li>
</ol>
<hr>
<p>Thanks to Linus Torvalds, Alan Cox, the FSF people, the XFree86 team and<br>all the others for the wonderful OS and software.<br>Thanks to C.L. Huang and Philip Giang (Tekram) for the initial driver<br>release and support.<br>Thanks to Doug Ledford, GÃ©rard Roudier for support with SCSI coding.<br>Thanks to a lot of people (espec. Chiaki Ishikawa, Andreas Haumer, Hubert<br>Tonneau) for intensively testing the driver (and even risking data loss<br>doing this during early revisions).<br>Recently, SuSE GmbH, Nuernberg, FRG, has been paying me for the driver<br>development and maintenance. Special thanks!</p>
<ol start="9">
<li>Copyright</li>
</ol>
<hr>
<p> This driver is free software; you can redistribute it and/or modify<br> it under the terms of the GNU General Public License as published by<br> the Free Software Foundation; version 2 of the License.<br> If you want to use any later version of the GNU GPL, you will probably<br> be allowed to, but you have to ask me and Tekram <a href="mailto:&#101;&#x72;&#x69;&#99;&#104;&#x40;&#x74;&#101;&#x6b;&#x72;&#x61;&#x6d;&#46;&#x63;&#x6f;&#x6d;&#x2e;&#116;&#x77;">&#101;&#x72;&#x69;&#99;&#104;&#x40;&#x74;&#101;&#x6b;&#x72;&#x61;&#x6d;&#46;&#x63;&#x6f;&#x6d;&#x2e;&#116;&#x77;</a><br> before.</p>
<hr>
<p>Written by Kurt Garloff <a href="mailto:&#x6b;&#x75;&#114;&#x74;&#x40;&#103;&#97;&#114;&#x6c;&#x6f;&#102;&#x66;&#46;&#x64;&#x65;">&#x6b;&#x75;&#114;&#x74;&#x40;&#103;&#97;&#114;&#x6c;&#x6f;&#102;&#x66;&#46;&#x64;&#x65;</a> 1998/06/11<br>Last updated 2000/11/28, driver revision 2.0e7<br>$Id: README.tmscsim,v 2.25.2.7 2000/12/20 01:07:12 garloff Exp $</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_tmscsim/" title="Kernel-2.6.32-573.12.1.el6_tmscsi" target="_blank" rel="external">http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_tmscsim/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_trace/" title="Kernel-2.6.32-573.12.1.el6_trace"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_swsusp/" title="Kernel-2.6.32-573.12.1.el6_swsusp"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>