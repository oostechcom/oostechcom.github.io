<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-2.6.32-573.12.1.el6_dap | oosTech.com</title>
  <meta name="description" content="Dynamic Audio Power Management for Portable Devices Description  Dynamic Audio Power Management (DAPM) is designed to allow portableLinux devices to use the minimum amount of power within the audiosub">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-2.6.32-573.12.1.el6_dap">
<meta property="og:url" content="http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_dapm/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="Dynamic Audio Power Management for Portable Devices Description  Dynamic Audio Power Management (DAPM) is designed to allow portableLinux devices to use the minimum amount of power within the audiosub">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_dapm/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a><span class="category-list-count">830</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_devices/" class="title">Kernel-2.6.32-573.12.1.el6_devices</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3c509/" class="title">Kernel-3.10.0-957.el7_3c509</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Dynamic-Audio-Power-Management-for-Portable-Devices"><span class="toc-number">1.</span> <span class="toc-text">Dynamic Audio Power Management for Portable Devices</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Description"><span class="toc-number">2.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DAPM-Widgets"><span class="toc-number">3.</span> <span class="toc-text">DAPM Widgets</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-Stream-Domain-Widgets"><span class="toc-number">3.1.</span> <span class="toc-text">2.1 Stream Domain Widgets</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-Path-Domain-Widgets"><span class="toc-number">3.2.</span> <span class="toc-text">2.2 Path Domain Widgets</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Platform-Machine-domain-Widgets"><span class="toc-number">3.3.</span> <span class="toc-text">2.3 Platform&#x2F;Machine domain Widgets</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-Codec-Domain"><span class="toc-number">3.4.</span> <span class="toc-text">2.4 Codec Domain</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-Virtual-Widgets"><span class="toc-number">3.5.</span> <span class="toc-text">2.5 Virtual Widgets</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Codec-Widget-Interconnections"><span class="toc-number">4.</span> <span class="toc-text">Codec Widget Interconnections</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-Machine-Widget-Interconnections"><span class="toc-number">4.1.</span> <span class="toc-text">3.1 Machine Widget Interconnections</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Endpoint-Widgets"><span class="toc-number">5.</span> <span class="toc-text">4 Endpoint Widgets</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-DAPM-Widget-Events"><span class="toc-number">6.</span> <span class="toc-text">5 DAPM Widget Events</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-Event-types"><span class="toc-number">6.1.</span> <span class="toc-text">5.1 Event types</span></a></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-2.6.32-573.12.1.el6_dapm" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-2.6.32-573.12.1.el6_dap
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_dapm/" class="article-date">
	 published: <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
	</a>
</span>

        
	<a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_dapm/" class="article-date">
	   updated: <time datetime="2021-03-12T16:00:00.000Z" itemprop="dateUpdated">2021-03-13</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_dapm/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="Dynamic-Audio-Power-Management-for-Portable-Devices"><a href="#Dynamic-Audio-Power-Management-for-Portable-Devices" class="headerlink" title="Dynamic Audio Power Management for Portable Devices"></a>Dynamic Audio Power Management for Portable Devices</h1><ol>
<li><h1 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h1></li>
</ol>
<p>Dynamic Audio Power Management (DAPM) is designed to allow portable<br>Linux devices to use the minimum amount of power within the audio<br>subsystem at all times. It is independent of other kernel PM and as<br>such, can easily co-exist with the other PM systems.</p>
<p>DAPM is also completely transparent to all user space applications as<br>all power switching is done within the ASoC core. No code changes or<br>recompiling are required for user space applications. DAPM makes power<br>switching decisions based upon any audio stream (capture/playback)<br>activity and audio mixer settings within the device.</p>
<p>DAPM spans the whole machine. It covers power control within the entire<br>audio subsystem, this includes internal codec power blocks and machine<br>level power systems.</p>
<p>There are 4 power domains within DAPM</p>
<ol>
<li><p>Codec domain - VREF, VMID (core codec and audio power)<br>Usually controlled at codec probe/remove and suspend/resume, although<br>can be set at stream time if power is not needed for sidetone, etc.</p>
</li>
<li><p>Platform/Machine domain - physically connected inputs and outputs<br>Is platform/machine and user action specific, is configured by the<br>machine driver and responds to asynchronous events e.g when HP<br>are inserted</p>
</li>
<li><p>Path domain - audio susbsystem signal paths<br>Automatically set when mixer and mux settings are changed by the user.<br>e.g. alsamixer, amixer.</p>
</li>
<li><p>Stream domain - DACs and ADCs.<br>Enabled and disabled when stream playback/capture is started and<br>stopped respectively. e.g. aplay, arecord.</p>
</li>
</ol>
<p>All DAPM power switching decisions are made automatically by consulting an audio<br>routing map of the whole machine. This map is specific to each machine and<br>consists of the interconnections between every audio component (including<br>internal codec components). All audio components that effect power are called<br>widgets hereafter.</p>
<ol start="2">
<li><h1 id="DAPM-Widgets"><a href="#DAPM-Widgets" class="headerlink" title="DAPM Widgets"></a>DAPM Widgets</h1></li>
</ol>
<p>Audio DAPM widgets fall into a number of types:-</p>
<p> o Mixer      - Mixes several analog signals into a single analog signal.<br> o Mux        - An analog switch that outputs only one of many inputs.<br> o PGA        - A programmable gain amplifier or attenuation widget.<br> o ADC        - Analog to Digital Converter<br> o DAC        - Digital to Analog Converter<br> o Switch     - An analog switch<br> o Input      - A codec input pin<br> o Output     - A codec output pin<br> o Headphone  - Headphone (and optional Jack)<br> o Mic        - Mic (and optional Jack)<br> o Line       - Line Input/Output (and optional Jack)<br> o Speaker    - Speaker<br> o Supply     - Power or clock supply widget used by other widgets.<br> o Pre        - Special PRE widget (exec before all others)<br> o Post       - Special POST widget (exec after all others)</p>
<p>(Widgets are defined in include/sound/soc-dapm.h)</p>
<p>Widgets are usually added in the codec driver and the machine driver. There are<br>convenience macros defined in soc-dapm.h that can be used to quickly build a<br>list of widgets of the codecs and machines DAPM widgets.</p>
<p>Most widgets have a name, register, shift and invert. Some widgets have extra<br>parameters for stream name and kcontrols.</p>
<h2 id="2-1-Stream-Domain-Widgets"><a href="#2-1-Stream-Domain-Widgets" class="headerlink" title="2.1 Stream Domain Widgets"></a>2.1 Stream Domain Widgets</h2><p>Stream Widgets relate to the stream power domain and only consist of ADCs<br>(analog to digital converters) and DACs (digital to analog converters).</p>
<p>Stream widgets have the following format:-</p>
<p>SND_SOC_DAPM_DAC(name, stream name, reg, shift, invert),</p>
<p>NOTE: the stream name must match the corresponding stream name in your codec<br>snd_soc_codec_dai.</p>
<p>e.g. stream widgets for HiFi playback and capture</p>
<p>SND_SOC_DAPM_DAC(“HiFi DAC”, “HiFi Playback”, REG, 3, 1),<br>SND_SOC_DAPM_ADC(“HiFi ADC”, “HiFi Capture”, REG, 2, 1),</p>
<h2 id="2-2-Path-Domain-Widgets"><a href="#2-2-Path-Domain-Widgets" class="headerlink" title="2.2 Path Domain Widgets"></a>2.2 Path Domain Widgets</h2><p>Path domain widgets have a ability to control or affect the audio signal or<br>audio paths within the audio subsystem. They have the following form:-</p>
<p>SND_SOC_DAPM_PGA(name, reg, shift, invert, controls, num_controls)</p>
<p>Any widget kcontrols can be set using the controls and num_controls members.</p>
<p>e.g. Mixer widget (the kcontrols are declared first)</p>
<p>/* Output Mixer */<br>static const snd_kcontrol_new_t wm8731_output_mixer_controls[] = {<br>SOC_DAPM_SINGLE(“Line Bypass Switch”, WM8731_APANA, 3, 1, 0),<br>SOC_DAPM_SINGLE(“Mic Sidetone Switch”, WM8731_APANA, 5, 1, 0),<br>SOC_DAPM_SINGLE(“HiFi Playback Switch”, WM8731_APANA, 4, 1, 0),<br>};</p>
<p>SND_SOC_DAPM_MIXER(“Output Mixer”, WM8731_PWR, 4, 1, wm8731_output_mixer_controls,<br>    ARRAY_SIZE(wm8731_output_mixer_controls)),</p>
<p>If you dont want the mixer elements prefixed with the name of the mixer widget,<br>you can use SND_SOC_DAPM_MIXER_NAMED_CTL instead. the parameters are the same<br>as for SND_SOC_DAPM_MIXER.</p>
<h2 id="2-3-Platform-Machine-domain-Widgets"><a href="#2-3-Platform-Machine-domain-Widgets" class="headerlink" title="2.3 Platform/Machine domain Widgets"></a>2.3 Platform/Machine domain Widgets</h2><p>Machine widgets are different from codec widgets in that they don’t have a<br>codec register bit associated with them. A machine widget is assigned to each<br>machine audio component (non codec) that can be independently powered. e.g.</p>
<p> o Speaker Amp<br> o Microphone Bias<br> o Jack connectors</p>
<p>A machine widget can have an optional call back.</p>
<p>e.g. Jack connector widget for an external Mic that enables Mic Bias<br>when the Mic is inserted:-</p>
<p>static int spitz_mic_bias(struct snd_soc_dapm_widget* w, int event)<br>{<br>    gpio_set_value(SPITZ_GPIO_MIC_BIAS, SND_SOC_DAPM_EVENT_ON(event));<br>    return 0;<br>}</p>
<p>SND_SOC_DAPM_MIC(“Mic Jack”, spitz_mic_bias),</p>
<h2 id="2-4-Codec-Domain"><a href="#2-4-Codec-Domain" class="headerlink" title="2.4 Codec Domain"></a>2.4 Codec Domain</h2><p>The codec power domain has no widgets and is handled by the codecs DAPM event<br>handler. This handler is called when the codec powerstate is changed wrt to any<br>stream event or by kernel PM events.</p>
<h2 id="2-5-Virtual-Widgets"><a href="#2-5-Virtual-Widgets" class="headerlink" title="2.5 Virtual Widgets"></a>2.5 Virtual Widgets</h2><p>Sometimes widgets exist in the codec or machine audio map that don’t have any<br>corresponding soft power control. In this case it is necessary to create<br>a virtual widget - a widget with no control bits e.g.</p>
<p>SND_SOC_DAPM_MIXER(“AC97 Mixer”, SND_SOC_DAPM_NOPM, 0, 0, NULL, 0),</p>
<p>This can be used to merge to signal paths together in software.</p>
<p>After all the widgets have been defined, they can then be added to the DAPM<br>subsystem individually with a call to snd_soc_dapm_new_control().</p>
<ol start="3">
<li><h1 id="Codec-Widget-Interconnections"><a href="#Codec-Widget-Interconnections" class="headerlink" title="Codec Widget Interconnections"></a>Codec Widget Interconnections</h1></li>
</ol>
<p>Widgets are connected to each other within the codec and machine by audio paths<br>(called interconnections). Each interconnection must be defined in order to<br>create a map of all audio paths between widgets.</p>
<p>This is easiest with a diagram of the codec (and schematic of the machine audio<br>system), as it requires joining widgets together via their audio signal paths.</p>
<p>e.g., from the WM8731 output mixer (wm8731.c)</p>
<p>The WM8731 output mixer has 3 inputs (sources)</p>
<ol>
<li>Line Bypass Input</li>
<li>DAC (HiFi playback)</li>
<li>Mic Sidetone Input</li>
</ol>
<p>Each input in this example has a kcontrol associated with it (defined in example<br>above) and is connected to the output mixer via it’s kcontrol name. We can now<br>connect the destination widget (wrt audio signal) with it’s source widgets.</p>
<pre><code>/* output mixer */
&#123;&quot;Output Mixer&quot;, &quot;Line Bypass Switch&quot;, &quot;Line Input&quot;&#125;,
&#123;&quot;Output Mixer&quot;, &quot;HiFi Playback Switch&quot;, &quot;DAC&quot;&#125;,
&#123;&quot;Output Mixer&quot;, &quot;Mic Sidetone Switch&quot;, &quot;Mic Bias&quot;&#125;,
</code></pre>
<p>So we have :-</p>
<pre><code>Destination Widget  &lt;=== Path Name &lt;=== Source Widget
</code></pre>
<p>Or:-</p>
<pre><code>Sink, Path, Source
</code></pre>
<p>Or :-</p>
<pre><code>&quot;Output Mixer&quot; is connected to the &quot;DAC&quot; via the &quot;HiFi Playback Switch&quot;.
</code></pre>
<p>When there is no path name connecting widgets (e.g. a direct connection) we<br>pass NULL for the path name.</p>
<p>Interconnections are created with a call to:-</p>
<p>snd_soc_dapm_connect_input(codec, sink, path, source);</p>
<p>Finally, snd_soc_dapm_new_widgets(codec) must be called after all widgets and<br>interconnections have been registered with the core. This causes the core to<br>scan the codec and machine so that the internal DAPM state matches the<br>physical state of the machine.</p>
<h2 id="3-1-Machine-Widget-Interconnections"><a href="#3-1-Machine-Widget-Interconnections" class="headerlink" title="3.1 Machine Widget Interconnections"></a>3.1 Machine Widget Interconnections</h2><p>Machine widget interconnections are created in the same way as codec ones and<br>directly connect the codec pins to machine level widgets.</p>
<p>e.g. connects the speaker out codec pins to the internal speaker.</p>
<pre><code>/* ext speaker connected to codec pins LOUT2, ROUT2  */
&#123;&quot;Ext Spk&quot;, NULL , &quot;ROUT2&quot;&#125;,
&#123;&quot;Ext Spk&quot;, NULL , &quot;LOUT2&quot;&#125;,
</code></pre>
<p>This allows the DAPM to power on and off pins that are connected (and in use)<br>and pins that are NC respectively.</p>
<h1 id="4-Endpoint-Widgets"><a href="#4-Endpoint-Widgets" class="headerlink" title="4 Endpoint Widgets"></a>4 Endpoint Widgets</h1><p>An endpoint is a start or end point (widget) of an audio signal within the<br>machine and includes the codec. e.g.</p>
<p> o Headphone Jack<br> o Internal Speaker<br> o Internal Mic<br> o Mic Jack<br> o Codec Pins</p>
<p>When a codec pin is NC it can be marked as not used with a call to</p>
<p>snd_soc_dapm_set_endpoint(codec, “Widget Name”, 0);</p>
<p>The last argument is 0 for inactive and 1 for active. This way the pin and its<br>input widget will never be powered up and consume power.</p>
<p>This also applies to machine widgets. e.g. if a headphone is connected to a<br>jack then the jack can be marked active. If the headphone is removed, then<br>the headphone jack can be marked inactive.</p>
<h1 id="5-DAPM-Widget-Events"><a href="#5-DAPM-Widget-Events" class="headerlink" title="5 DAPM Widget Events"></a>5 DAPM Widget Events</h1><p>Some widgets can register their interest with the DAPM core in PM events.<br>e.g. A Speaker with an amplifier registers a widget so the amplifier can be<br>powered only when the spk is in use.</p>
<p>/* turn speaker amplifier on/off depending on use */<br>static int corgi_amp_event(struct snd_soc_dapm_widget *w, int event)<br>{<br>    gpio_set_value(CORGI_GPIO_APM_ON, SND_SOC_DAPM_EVENT_ON(event));<br>    return 0;<br>}</p>
<p>/* corgi machine dapm widgets */<br>static const struct snd_soc_dapm_widget wm8731_dapm_widgets =<br>    SND_SOC_DAPM_SPK(“Ext Spk”, corgi_amp_event);</p>
<p>Please see soc-dapm.h for all other widgets that support events.</p>
<h2 id="5-1-Event-types"><a href="#5-1-Event-types" class="headerlink" title="5.1 Event types"></a>5.1 Event types</h2><p>The following event types are supported by event widgets.</p>
<p>/* dapm event types <em>/<br>#define SND_SOC_DAPM_PRE_PMU    0x1     /</em> before widget power up <em>/<br>#define SND_SOC_DAPM_POST_PMU    0x2        /</em> after widget power up <em>/<br>#define SND_SOC_DAPM_PRE_PMD    0x4     /</em> before widget power down <em>/<br>#define SND_SOC_DAPM_POST_PMD    0x8        /</em> after widget power down <em>/<br>#define SND_SOC_DAPM_PRE_REG    0x10    /</em> before audio path setup <em>/<br>#define SND_SOC_DAPM_POST_REG    0x20    /</em> after audio path setup */</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_dapm/" title="Kernel-2.6.32-573.12.1.el6_dap" target="_blank" rel="external">http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_dapm/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_data-integrity/" title="Kernel-2.6.32-573.12.1.el6_data-integrity"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_cxgb3i/" title="Kernel-2.6.32-573.12.1.el6_cxgb3i"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>