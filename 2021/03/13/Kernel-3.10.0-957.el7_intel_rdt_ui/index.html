<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-3.10.0-957.el7_intel_rdt_ui | oosTech.com</title>
  <meta name="description" content="User Interface for Resource Allocation in Intel Resource Director Technology Copyright (C) 2016 Intel Corporation Fenghua Yu &amp;#102;&amp;#x65;&amp;#x6e;&amp;#103;&amp;#104;&amp;#x75;&amp;#x61;&amp;#46;&amp;#121;&amp;#x75;&amp;#x40;&amp;#105;&amp;#11">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-3.10.0-957.el7_intel_rdt_ui">
<meta property="og:url" content="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_intel_rdt_ui/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="User Interface for Resource Allocation in Intel Resource Director Technology Copyright (C) 2016 Intel Corporation Fenghua Yu &amp;#102;&amp;#x65;&amp;#x6e;&amp;#103;&amp;#104;&amp;#x75;&amp;#x61;&amp;#46;&amp;#121;&amp;#x75;&amp;#x40;&amp;#105;&amp;#11">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_intel_rdt_ui/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a><span class="category-list-count">830</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_devices/" class="title">Kernel-2.6.32-573.12.1.el6_devices</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3c509/" class="title">Kernel-3.10.0-957.el7_3c509</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#mount-t-resctrl-resctrl-o-cdp-cdpl2-sys-fs-resctrl"><span class="toc-number">1.</span> <span class="toc-text">mount -t resctrl resctrl [-o cdp[,cdpl2]] &#x2F;sys&#x2F;fs&#x2F;resctrl</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Info-directory"><span class="toc-number">1.1.</span> <span class="toc-text">Info directory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Resource-alloc-and-monitor-groups"><span class="toc-number">1.2.</span> <span class="toc-text">Resource alloc and monitor groups</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Resource-allocation-rules"><span class="toc-number">1.3.</span> <span class="toc-text">Resource allocation rules</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Resource-monitoring-rules"><span class="toc-number">1.4.</span> <span class="toc-text">Resource monitoring rules</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Notes-on-cache-occupancy-monitoring-and-control"><span class="toc-number">1.5.</span> <span class="toc-text">Notes on cache occupancy monitoring and control</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#max-threshold-occupancy-generic-concepts"><span class="toc-number">1.6.</span> <span class="toc-text">max_threshold_occupancy - generic concepts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Schemata-files-general-concepts"><span class="toc-number">1.7.</span> <span class="toc-text">Schemata files - general concepts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cache-IDs"><span class="toc-number">1.8.</span> <span class="toc-text">Cache IDs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cache-Bit-Masks-CBM"><span class="toc-number">1.9.</span> <span class="toc-text">Cache Bit Masks (CBM)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Memory-bandwidth-b-w-percentage"><span class="toc-number">1.10.</span> <span class="toc-text">Memory bandwidth(b&#x2F;w) percentage</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#L3-schemata-file-details-code-and-data-prioritization-disabled"><span class="toc-number">1.11.</span> <span class="toc-text">L3 schemata file details (code and data prioritization disabled)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#L3-schemata-file-details-CDP-enabled-via-mount-option-to-resctrl"><span class="toc-number">1.12.</span> <span class="toc-text">L3 schemata file details (CDP enabled via mount option to resctrl)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#L2-schemata-file-details"><span class="toc-number">1.13.</span> <span class="toc-text">L2 schemata file details</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Memory-b-w-Allocation-details"><span class="toc-number">1.14.</span> <span class="toc-text">Memory b&#x2F;w Allocation details</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reading-writing-the-schemata-file"><span class="toc-number">1.15.</span> <span class="toc-text">Reading&#x2F;writing the schemata file</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-schemata"><span class="toc-number">2.</span> <span class="toc-text">cat schemata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%9CL3DATA-2-3c0-%E2%80%9D-gt-schemata"><span class="toc-number">3.</span> <span class="toc-text">echo “L3DATA:2&#x3D;3c0;” &gt; schemata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-schemata-1"><span class="toc-number">4.</span> <span class="toc-text">cat schemata</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-1"><span class="toc-number">4.1.</span> <span class="toc-text">Example 1</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mount-t-resctrl-resctrl-sys-fs-resctrl"><span class="toc-number">5.</span> <span class="toc-text">mount -t resctrl resctrl &#x2F;sys&#x2F;fs&#x2F;resctrl</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cd-sys-fs-resctrl"><span class="toc-number">6.</span> <span class="toc-text">cd &#x2F;sys&#x2F;fs&#x2F;resctrl</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mkdir-p0-p1"><span class="toc-number">7.</span> <span class="toc-text">mkdir p0 p1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%9CL3-0-3-1-c-nMB-0-50-1-50%E2%80%9D-gt-sys-fs-resctrl-p0-schemata"><span class="toc-number">8.</span> <span class="toc-text">echo “L3:0&#x3D;3;1&#x3D;c\nMB:0&#x3D;50;1&#x3D;50” &gt; &#x2F;sys&#x2F;fs&#x2F;resctrl&#x2F;p0&#x2F;schemata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%9CL3-0-3-1-3-nMB-0-50-1-50%E2%80%9D-gt-sys-fs-resctrl-p1-schemata"><span class="toc-number">9.</span> <span class="toc-text">echo “L3:0&#x3D;3;1&#x3D;3\nMB:0&#x3D;50;1&#x3D;50” &gt; &#x2F;sys&#x2F;fs&#x2F;resctrl&#x2F;p1&#x2F;schemata</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-2"><span class="toc-number">9.1.</span> <span class="toc-text">Example 2</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mount-t-resctrl-resctrl-sys-fs-resctrl-1"><span class="toc-number">10.</span> <span class="toc-text">mount -t resctrl resctrl &#x2F;sys&#x2F;fs&#x2F;resctrl</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cd-sys-fs-resctrl-1"><span class="toc-number">11.</span> <span class="toc-text">cd &#x2F;sys&#x2F;fs&#x2F;resctrl</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%9CL3-0-3ff-1-fffff-nMB-0-50-1-100%E2%80%9D-gt-schemata"><span class="toc-number">12.</span> <span class="toc-text">echo “L3:0&#x3D;3ff;1&#x3D;fffff\nMB:0&#x3D;50;1&#x3D;100” &gt; schemata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mkdir-p0"><span class="toc-number">13.</span> <span class="toc-text">mkdir p0</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%9CL3-0-f8000-1-fffff%E2%80%9D-gt-p0-schemata"><span class="toc-number">14.</span> <span class="toc-text">echo “L3:0&#x3D;f8000;1&#x3D;fffff” &gt; p0&#x2F;schemata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1234-gt-p0-tasks"><span class="toc-number">15.</span> <span class="toc-text">echo 1234 &gt; p0&#x2F;tasks</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#taskset-cp-1-1234"><span class="toc-number">16.</span> <span class="toc-text">taskset -cp 1 1234</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mkdir-p1"><span class="toc-number">17.</span> <span class="toc-text">mkdir p1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%9CL3-0-7c00-1-fffff%E2%80%9D-gt-p1-schemata"><span class="toc-number">18.</span> <span class="toc-text">echo “L3:0&#x3D;7c00;1&#x3D;fffff” &gt; p1&#x2F;schemata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-5678-gt-p1-tasks"><span class="toc-number">19.</span> <span class="toc-text">echo 5678 &gt; p1&#x2F;tasks</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#taskset-cp-2-5678"><span class="toc-number">20.</span> <span class="toc-text">taskset -cp 2 5678</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-e-%E2%80%9CL3-0-f8000-1-fffff-nMB-0-20-1-100%E2%80%9D-gt-p0-schemata"><span class="toc-number">21.</span> <span class="toc-text">echo -e “L3:0&#x3D;f8000;1&#x3D;fffff\nMB:0&#x3D;20;1&#x3D;100” &gt; p0&#x2F;schemata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-e-%E2%80%9CL3-0-f8000-1-fffff-nMB-0-20-1-100%E2%80%9D-gt-p0-schemata-1"><span class="toc-number">22.</span> <span class="toc-text">echo -e “L3:0&#x3D;f8000;1&#x3D;fffff\nMB:0&#x3D;20;1&#x3D;100” &gt; p0&#x2F;schemata</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-3"><span class="toc-number">22.1.</span> <span class="toc-text">Example 3</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mount-t-resctrl-resctrl-sys-fs-resctrl-2"><span class="toc-number">23.</span> <span class="toc-text">mount -t resctrl resctrl &#x2F;sys&#x2F;fs&#x2F;resctrl</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cd-sys-fs-resctrl-2"><span class="toc-number">24.</span> <span class="toc-text">cd &#x2F;sys&#x2F;fs&#x2F;resctrl</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%9CL3-0-3ff-nMB-0-50%E2%80%9D-gt-schemata"><span class="toc-number">25.</span> <span class="toc-text">echo “L3:0&#x3D;3ff\nMB:0&#x3D;50” &gt; schemata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mkdir-p0-1"><span class="toc-number">26.</span> <span class="toc-text">mkdir p0</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%9CL3-0-ffc00-nMB-0-50%E2%80%9D-gt-p0-schemata"><span class="toc-number">27.</span> <span class="toc-text">echo “L3:0&#x3D;ffc00\nMB:0&#x3D;50” &gt; p0&#x2F;schemata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-F0-gt-p0-cpus"><span class="toc-number">28.</span> <span class="toc-text">echo F0 &gt; p0&#x2F;cpus</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Atomically-read-directory-structure"><span class="toc-number">29.</span> <span class="toc-text">Atomically read directory structure</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Read-directory-contents-and-create-new-subdirectory"><span class="toc-number">30.</span> <span class="toc-text">Read directory contents and create new subdirectory</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Reading-monitored-data"><span class="toc-number">30.1.</span> <span class="toc-text">Reading monitored data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-1-Monitor-CTRL-MON-group-and-subset-of-tasks-in-CTRL-MON-group"><span class="toc-number">30.2.</span> <span class="toc-text">Example 1 (Monitor CTRL_MON group and subset of tasks in CTRL_MON group)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mount-t-resctrl-resctrl-sys-fs-resctrl-3"><span class="toc-number">31.</span> <span class="toc-text">mount -t resctrl resctrl &#x2F;sys&#x2F;fs&#x2F;resctrl</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cd-sys-fs-resctrl-3"><span class="toc-number">32.</span> <span class="toc-text">cd &#x2F;sys&#x2F;fs&#x2F;resctrl</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mkdir-p0-p1-1"><span class="toc-number">33.</span> <span class="toc-text">mkdir p0 p1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%9CL3-0-3-1-c%E2%80%9D-gt-sys-fs-resctrl-p0-schemata"><span class="toc-number">34.</span> <span class="toc-text">echo “L3:0&#x3D;3;1&#x3D;c” &gt; &#x2F;sys&#x2F;fs&#x2F;resctrl&#x2F;p0&#x2F;schemata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%9CL3-0-3-1-3%E2%80%9D-gt-sys-fs-resctrl-p1-schemata"><span class="toc-number">35.</span> <span class="toc-text">echo “L3:0&#x3D;3;1&#x3D;3” &gt; &#x2F;sys&#x2F;fs&#x2F;resctrl&#x2F;p1&#x2F;schemata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-5678-gt-p1-tasks-1"><span class="toc-number">36.</span> <span class="toc-text">echo 5678 &gt; p1&#x2F;tasks</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-5679-gt-p1-tasks"><span class="toc-number">37.</span> <span class="toc-text">echo 5679 &gt; p1&#x2F;tasks</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cd-sys-fs-resctrl-p1-mon-groups"><span class="toc-number">38.</span> <span class="toc-text">cd &#x2F;sys&#x2F;fs&#x2F;resctrl&#x2F;p1&#x2F;mon_groups</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mkdir-m11-m12"><span class="toc-number">39.</span> <span class="toc-text">mkdir m11 m12</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-5678-gt-m11-tasks"><span class="toc-number">40.</span> <span class="toc-text">echo 5678 &gt; m11&#x2F;tasks</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-5679-gt-m12-tasks"><span class="toc-number">41.</span> <span class="toc-text">echo 5679 &gt; m12&#x2F;tasks</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-m11-mon-data-mon-L3-00-llc-occupancy"><span class="toc-number">42.</span> <span class="toc-text">cat m11&#x2F;mon_data&#x2F;mon_L3_00&#x2F;llc_occupancy</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-m11-mon-data-mon-L3-01-llc-occupancy"><span class="toc-number">43.</span> <span class="toc-text">cat m11&#x2F;mon_data&#x2F;mon_L3_01&#x2F;llc_occupancy</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-m12-mon-data-mon-L3-00-llc-occupancy"><span class="toc-number">44.</span> <span class="toc-text">cat m12&#x2F;mon_data&#x2F;mon_L3_00&#x2F;llc_occupancy</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-sys-fs-resctrl-p1-mon-data-mon-l3-00-llc-occupancy"><span class="toc-number">45.</span> <span class="toc-text">cat &#x2F;sys&#x2F;fs&#x2F;resctrl&#x2F;p1&#x2F;mon_data&#x2F;mon_l3_00&#x2F;llc_occupancy</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-2-Monitor-a-task-from-its-creation"><span class="toc-number">45.1.</span> <span class="toc-text">Example 2 (Monitor a task from its creation)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mount-t-resctrl-resctrl-sys-fs-resctrl-4"><span class="toc-number">46.</span> <span class="toc-text">mount -t resctrl resctrl &#x2F;sys&#x2F;fs&#x2F;resctrl</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cd-sys-fs-resctrl-4"><span class="toc-number">47.</span> <span class="toc-text">cd &#x2F;sys&#x2F;fs&#x2F;resctrl</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mkdir-p0-p1-2"><span class="toc-number">48.</span> <span class="toc-text">mkdir p0 p1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-gt-sys-fs-resctrl-p1-tasks"><span class="toc-number">49.</span> <span class="toc-text">echo $$ &gt; &#x2F;sys&#x2F;fs&#x2F;resctrl&#x2F;p1&#x2F;tasks</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">50.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-sys-fs-resctrl-p1-mon-data-mon-l3-00-llc-occupancy-1"><span class="toc-number">51.</span> <span class="toc-text">cat &#x2F;sys&#x2F;fs&#x2F;resctrl&#x2F;p1&#x2F;mon_data&#x2F;mon_l3_00&#x2F;llc_occupancy</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-3-Monitor-without-CAT-support-or-before-creating-CAT-groups"><span class="toc-number">51.1.</span> <span class="toc-text">Example 3 (Monitor without CAT support or before creating CAT groups)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mount-t-resctrl-resctrl-sys-fs-resctrl-5"><span class="toc-number">52.</span> <span class="toc-text">mount -t resctrl resctrl &#x2F;sys&#x2F;fs&#x2F;resctrl</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cd-sys-fs-resctrl-5"><span class="toc-number">53.</span> <span class="toc-text">cd &#x2F;sys&#x2F;fs&#x2F;resctrl</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mkdir-mon-groups-m01"><span class="toc-number">54.</span> <span class="toc-text">mkdir mon_groups&#x2F;m01</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mkdir-mon-groups-m02"><span class="toc-number">55.</span> <span class="toc-text">mkdir mon_groups&#x2F;m02</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-3478-gt-sys-fs-resctrl-mon-groups-m01-tasks"><span class="toc-number">56.</span> <span class="toc-text">echo 3478 &gt; &#x2F;sys&#x2F;fs&#x2F;resctrl&#x2F;mon_groups&#x2F;m01&#x2F;tasks</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-2467-gt-sys-fs-resctrl-mon-groups-m02-tasks"><span class="toc-number">57.</span> <span class="toc-text">echo 2467 &gt; &#x2F;sys&#x2F;fs&#x2F;resctrl&#x2F;mon_groups&#x2F;m02&#x2F;tasks</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-sys-fs-resctrl-mon-groups-m01-mon-L3-00-llc-occupancy"><span class="toc-number">58.</span> <span class="toc-text">cat &#x2F;sys&#x2F;fs&#x2F;resctrl&#x2F;mon_groups&#x2F;m01&#x2F;mon_L3_00&#x2F;llc_occupancy</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-sys-fs-resctrl-mon-groups-m01-mon-L3-01-llc-occupancy"><span class="toc-number">59.</span> <span class="toc-text">cat &#x2F;sys&#x2F;fs&#x2F;resctrl&#x2F;mon_groups&#x2F;m01&#x2F;mon_L3_01&#x2F;llc_occupancy</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-sys-fs-resctrl-mon-groups-m02-mon-L3-00-llc-occupancy"><span class="toc-number">60.</span> <span class="toc-text">cat &#x2F;sys&#x2F;fs&#x2F;resctrl&#x2F;mon_groups&#x2F;m02&#x2F;mon_L3_00&#x2F;llc_occupancy</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-sys-fs-resctrl-mon-groups-m02-mon-L3-01-llc-occupancy"><span class="toc-number">61.</span> <span class="toc-text">cat &#x2F;sys&#x2F;fs&#x2F;resctrl&#x2F;mon_groups&#x2F;m02&#x2F;mon_L3_01&#x2F;llc_occupancy</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-4-Monitor-real-time-tasks"><span class="toc-number">61.1.</span> <span class="toc-text">Example 4 (Monitor real time tasks)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mount-t-resctrl-resctrl-sys-fs-resctrl-6"><span class="toc-number">62.</span> <span class="toc-text">mount -t resctrl resctrl &#x2F;sys&#x2F;fs&#x2F;resctrl</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cd-sys-fs-resctrl-6"><span class="toc-number">63.</span> <span class="toc-text">cd &#x2F;sys&#x2F;fs&#x2F;resctrl</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mkdir-p1-1"><span class="toc-number">64.</span> <span class="toc-text">mkdir p1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-f0-gt-p0-cpus"><span class="toc-number">65.</span> <span class="toc-text">echo f0 &gt; p0&#x2F;cpus</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-sys-fs-resctrl-p1-mon-data-mon-L3-00-llc-occupancy"><span class="toc-number">66.</span> <span class="toc-text">cat &#x2F;sys&#x2F;fs&#x2F;resctrl&#x2F;p1&#x2F;mon_data&#x2F;mon_L3_00&#x2F;llc_occupancy</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-3.10.0-957.el7_intel_rdt_ui" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-3.10.0-957.el7_intel_rdt_ui
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/03/13/Kernel-3.10.0-957.el7_intel_rdt_ui/" class="article-date">
	 published: <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
	</a>
</span>

        
	<a href="/2021/03/13/Kernel-3.10.0-957.el7_intel_rdt_ui/" class="article-date">
	   updated: <time datetime="2021-03-12T16:00:00.000Z" itemprop="dateUpdated">2021-03-13</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/03/13/Kernel-3.10.0-957.el7_intel_rdt_ui/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>User Interface for Resource Allocation in Intel Resource Director Technology</p>
<p>Copyright (C) 2016 Intel Corporation</p>
<p>Fenghua Yu <a href="mailto:&#102;&#x65;&#x6e;&#103;&#104;&#x75;&#x61;&#46;&#121;&#x75;&#x40;&#105;&#110;&#x74;&#x65;&#108;&#46;&#x63;&#111;&#x6d;">&#102;&#x65;&#x6e;&#103;&#104;&#x75;&#x61;&#46;&#121;&#x75;&#x40;&#105;&#110;&#x74;&#x65;&#108;&#46;&#x63;&#111;&#x6d;</a><br>Tony Luck <a href="mailto:&#116;&#x6f;&#x6e;&#x79;&#46;&#x6c;&#x75;&#99;&#x6b;&#x40;&#x69;&#110;&#x74;&#101;&#x6c;&#x2e;&#x63;&#x6f;&#109;">&#116;&#x6f;&#x6e;&#x79;&#46;&#x6c;&#x75;&#99;&#x6b;&#x40;&#x69;&#110;&#x74;&#101;&#x6c;&#x2e;&#x63;&#x6f;&#109;</a><br>Vikas Shivappa <a href="mailto:&#x76;&#x69;&#x6b;&#x61;&#x73;&#x2e;&#x73;&#x68;&#105;&#x76;&#97;&#x70;&#112;&#x61;&#x40;&#105;&#110;&#116;&#101;&#108;&#x2e;&#99;&#x6f;&#x6d;">&#x76;&#x69;&#x6b;&#x61;&#x73;&#x2e;&#x73;&#x68;&#105;&#x76;&#97;&#x70;&#112;&#x61;&#x40;&#105;&#110;&#116;&#101;&#108;&#x2e;&#99;&#x6f;&#x6d;</a></p>
<p>This feature is enabled by the CONFIG_INTEL_RDT Kconfig and the<br>X86 /proc/cpuinfo flag bits:<br>RDT (Resource Director Technology) Allocation - “rdt_a”<br>CAT (Cache Allocation Technology) - “cat_l3”, “cat_l2”<br>CDP (Code and Data Prioritization ) - “cdp_l3”, “cdp_l2”<br>CQM (Cache QoS Monitoring) - “cqm_llc”, “cqm_occup_llc”<br>MBM (Memory Bandwidth Monitoring) - “cqm_mbm_total”, “cqm_mbm_local”<br>MBA (Memory Bandwidth Allocation) - “mba”</p>
<p>To use the feature mount the file system:</p>
<h1 id="mount-t-resctrl-resctrl-o-cdp-cdpl2-sys-fs-resctrl"><a href="#mount-t-resctrl-resctrl-o-cdp-cdpl2-sys-fs-resctrl" class="headerlink" title="mount -t resctrl resctrl [-o cdp[,cdpl2]] /sys/fs/resctrl"></a>mount -t resctrl resctrl [-o cdp[,cdpl2]] /sys/fs/resctrl</h1><p>mount options are:</p>
<p>“cdp”: Enable code/data prioritization in L3 cache allocations.<br>“cdpl2”: Enable code/data prioritization in L2 cache allocations.</p>
<p>L2 and L3 CDP are controlled seperately.</p>
<p>RDT features are orthogonal. A particular system may support only<br>monitoring, only control, or both monitoring and control.</p>
<p>The mount succeeds if either of allocation or monitoring is present, but<br>only those files and directories supported by the system will be created.<br>For more details on the behavior of the interface during monitoring<br>and allocation, see the “Resource alloc and monitor groups” section.</p>
<h2 id="Info-directory"><a href="#Info-directory" class="headerlink" title="Info directory"></a>Info directory</h2><p>The ‘info’ directory contains information about the enabled<br>resources. Each resource has its own subdirectory. The subdirectory<br>names reflect the resource names.</p>
<p>Each subdirectory contains the following files with respect to<br>allocation:</p>
<p>Cache resource(L3/L2)  subdirectory contains the following files<br>related to allocation:</p>
<p>“num_closids”:      The number of CLOSIDs which are valid for this<br>            resource. The kernel uses the smallest number of<br>            CLOSIDs of all enabled resources as limit.</p>
<p>“cbm_mask”:         The bitmask which is valid for this resource.<br>            This mask is equivalent to 100%.</p>
<p>“min_cbm_bits”:     The minimum number of consecutive bits which<br>            must be set when writing a mask.</p>
<p>“shareable_bits”:    Bitmask of shareable resource with other executing<br>            entities (e.g. I/O). User can use this when<br>            setting up exclusive cache partitions. Note that<br>            some platforms support devices that have their<br>            own settings for cache use which can over-ride<br>            these bits.</p>
<p>Memory bandwitdh(MB) subdirectory contains the following files<br>with respect to allocation:</p>
<p>“min_bandwidth”:    The minimum memory bandwidth percentage which<br>            user can request.</p>
<p>“bandwidth_gran”:    The granularity in which the memory bandwidth<br>            percentage is allocated. The allocated<br>            b/w percentage is rounded off to the next<br>            control step available on the hardware. The<br>            available bandwidth control steps are:<br>            min_bandwidth + N * bandwidth_gran.</p>
<p>“delay_linear”:     Indicates if the delay scale is linear or<br>            non-linear. This field is purely informational<br>            only.</p>
<p>If RDT monitoring is available there will be an “L3_MON” directory<br>with the following files:</p>
<p>“num_rmids”:        The number of RMIDs available. This is the<br>            upper bound for how many “CTRL_MON” + “MON”<br>            groups can be created.</p>
<p>“mon_features”:    Lists the monitoring events if<br>            monitoring is enabled for the resource.</p>
<p>“max_threshold_occupancy”:<br>            Read/write file provides the largest value (in<br>            bytes) at which a previously used LLC_occupancy<br>            counter can be considered for re-use.</p>
<p>Finally, in the top level of the “info” directory there is a file<br>named “last_cmd_status”. This is reset with every “command” issued<br>via the file system (making new directories or writing to any of the<br>control files). If the command was successful, it will read as “ok”.<br>If the command failed, it will provide more information that can be<br>conveyed in the error returns from file operations. E.g.</p>
<pre><code># echo L3:0=f7 &gt; schemata
bash: echo: write error: Invalid argument
# cat info/last_cmd_status
mask f7 has non-consecutive 1-bits
</code></pre>
<h2 id="Resource-alloc-and-monitor-groups"><a href="#Resource-alloc-and-monitor-groups" class="headerlink" title="Resource alloc and monitor groups"></a>Resource alloc and monitor groups</h2><p>Resource groups are represented as directories in the resctrl file<br>system.  The default group is the root directory which, immediately<br>after mounting, owns all the tasks and cpus in the system and can make<br>full use of all resources.</p>
<p>On a system with RDT control features additional directories can be<br>created in the root directory that specify different amounts of each<br>resource (see “schemata” below). The root and these additional top level<br>directories are referred to as “CTRL_MON” groups below.</p>
<p>On a system with RDT monitoring the root directory and other top level<br>directories contain a directory named “mon_groups” in which additional<br>directories can be created to monitor subsets of tasks in the CTRL_MON<br>group that is their ancestor. These are called “MON” groups in the rest<br>of this document.</p>
<p>Removing a directory will move all tasks and cpus owned by the group it<br>represents to the parent. Removing one of the created CTRL_MON groups<br>will automatically remove all MON groups below it.</p>
<p>All groups contain the following files:</p>
<p>“tasks”:<br>    Reading this file shows the list of all tasks that belong to<br>    this group. Writing a task id to the file will add a task to the<br>    group. If the group is a CTRL_MON group the task is removed from<br>    whichever previous CTRL_MON group owned the task and also from<br>    any MON group that owned the task. If the group is a MON group,<br>    then the task must already belong to the CTRL_MON parent of this<br>    group. The task is removed from any previous MON group.</p>
<p>“cpus”:<br>    Reading this file shows a bitmask of the logical CPUs owned by<br>    this group. Writing a mask to this file will add and remove<br>    CPUs to/from this group. As with the tasks file a hierarchy is<br>    maintained where MON groups may only include CPUs owned by the<br>    parent CTRL_MON group.</p>
<p>“cpus_list”:<br>    Just like “cpus”, only using ranges of CPUs instead of bitmasks.</p>
<p>When control is enabled all CTRL_MON groups will also contain:</p>
<p>“schemata”:<br>    A list of all the resources available to this group.<br>    Each resource has its own line and format - see below for details.</p>
<p>When monitoring is enabled all MON groups will also contain:</p>
<p>“mon_data”:<br>    This contains a set of files organized by L3 domain and by<br>    RDT event. E.g. on a system with two L3 domains there will<br>    be subdirectories “mon_L3_00” and “mon_L3_01”.    Each of these<br>    directories have one file per event (e.g. “llc_occupancy”,<br>    “mbm_total_bytes”, and “mbm_local_bytes”). In a MON group these<br>    files provide a read out of the current value of the event for<br>    all tasks in the group. In CTRL_MON groups these files provide<br>    the sum for all tasks in the CTRL_MON group and all tasks in<br>    MON groups. Please see example section for more details on usage.</p>
<h2 id="Resource-allocation-rules"><a href="#Resource-allocation-rules" class="headerlink" title="Resource allocation rules"></a>Resource allocation rules</h2><p>When a task is running the following rules define which resources are<br>available to it:</p>
<ol>
<li><p>If the task is a member of a non-default group, then the schemata<br>for that group is used.</p>
</li>
<li><p>Else if the task belongs to the default group, but is running on a<br>CPU that is assigned to some specific group, then the schemata for the<br>CPU’s group is used.</p>
</li>
<li><p>Otherwise the schemata for the default group is used.</p>
</li>
</ol>
<h2 id="Resource-monitoring-rules"><a href="#Resource-monitoring-rules" class="headerlink" title="Resource monitoring rules"></a>Resource monitoring rules</h2><ol>
<li><p>If a task is a member of a MON group, or non-default CTRL_MON group<br>then RDT events for the task will be reported in that group.</p>
</li>
<li><p>If a task is a member of the default CTRL_MON group, but is running<br>on a CPU that is assigned to some specific group, then the RDT events<br>for the task will be reported in that group.</p>
</li>
<li><p>Otherwise RDT events for the task will be reported in the root level<br>“mon_data” group.</p>
</li>
</ol>
<h2 id="Notes-on-cache-occupancy-monitoring-and-control"><a href="#Notes-on-cache-occupancy-monitoring-and-control" class="headerlink" title="Notes on cache occupancy monitoring and control"></a>Notes on cache occupancy monitoring and control</h2><p>When moving a task from one group to another you should remember that<br>this only affects <em>new</em> cache allocations by the task. E.g. you may have<br>a task in a monitor group showing 3 MB of cache occupancy. If you move<br>to a new group and immediately check the occupancy of the old and new<br>groups you will likely see that the old group is still showing 3 MB and<br>the new group zero. When the task accesses locations still in cache from<br>before the move, the h/w does not update any counters. On a busy system<br>you will likely see the occupancy in the old group go down as cache lines<br>are evicted and re-used while the occupancy in the new group rises as<br>the task accesses memory and loads into the cache are counted based on<br>membership in the new group.</p>
<p>The same applies to cache allocation control. Moving a task to a group<br>with a smaller cache partition will not evict any cache lines. The<br>process may continue to use them from the old partition.</p>
<p>Hardware uses CLOSid(Class of service ID) and an RMID(Resource monitoring ID)<br>to identify a control group and a monitoring group respectively. Each of<br>the resource groups are mapped to these IDs based on the kind of group. The<br>number of CLOSid and RMID are limited by the hardware and hence the creation of<br>a “CTRL_MON” directory may fail if we run out of either CLOSID or RMID<br>and creation of “MON” group may fail if we run out of RMIDs.</p>
<h2 id="max-threshold-occupancy-generic-concepts"><a href="#max-threshold-occupancy-generic-concepts" class="headerlink" title="max_threshold_occupancy - generic concepts"></a>max_threshold_occupancy - generic concepts</h2><p>Note that an RMID once freed may not be immediately available for use as<br>the RMID is still tagged the cache lines of the previous user of RMID.<br>Hence such RMIDs are placed on limbo list and checked back if the cache<br>occupancy has gone down. If there is a time when system has a lot of<br>limbo RMIDs but which are not ready to be used, user may see an -EBUSY<br>during mkdir.</p>
<p>max_threshold_occupancy is a user configurable value to determine the<br>occupancy at which an RMID can be freed.</p>
<h2 id="Schemata-files-general-concepts"><a href="#Schemata-files-general-concepts" class="headerlink" title="Schemata files - general concepts"></a>Schemata files - general concepts</h2><p>Each line in the file describes one resource. The line starts with<br>the name of the resource, followed by specific values to be applied<br>in each of the instances of that resource on the system.</p>
<h2 id="Cache-IDs"><a href="#Cache-IDs" class="headerlink" title="Cache IDs"></a>Cache IDs</h2><p>On current generation systems there is one L3 cache per socket and L2<br>caches are generally just shared by the hyperthreads on a core, but this<br>isn’t an architectural requirement. We could have multiple separate L3<br>caches on a socket, multiple cores could share an L2 cache. So instead<br>of using “socket” or “core” to define the set of logical cpus sharing<br>a resource we use a “Cache ID”. At a given cache level this will be a<br>unique number across the whole system (but it isn’t guaranteed to be a<br>contiguous sequence, there may be gaps).  To find the ID for each logical<br>CPU look in /sys/devices/system/cpu/cpu*/cache/index*/id</p>
<h2 id="Cache-Bit-Masks-CBM"><a href="#Cache-Bit-Masks-CBM" class="headerlink" title="Cache Bit Masks (CBM)"></a>Cache Bit Masks (CBM)</h2><p>For cache resources we describe the portion of the cache that is available<br>for allocation using a bitmask. The maximum value of the mask is defined<br>by each cpu model (and may be different for different cache levels). It<br>is found using CPUID, but is also provided in the “info” directory of<br>the resctrl file system in “info/{resource}/cbm_mask”. X86 hardware<br>requires that these masks have all the ‘1’ bits in a contiguous block. So<br>0x3, 0x6 and 0xC are legal 4-bit masks with two bits set, but 0x5, 0x9<br>and 0xA are not.  On a system with a 20-bit mask each bit represents 5%<br>of the capacity of the cache. You could partition the cache into four<br>equal parts with masks: 0x1f, 0x3e0, 0x7c00, 0xf8000.</p>
<h2 id="Memory-bandwidth-b-w-percentage"><a href="#Memory-bandwidth-b-w-percentage" class="headerlink" title="Memory bandwidth(b/w) percentage"></a>Memory bandwidth(b/w) percentage</h2><p>For Memory b/w resource, user controls the resource by indicating the<br>percentage of total memory b/w.</p>
<p>The minimum bandwidth percentage value for each cpu model is predefined<br>and can be looked up through “info/MB/min_bandwidth”. The bandwidth<br>granularity that is allocated is also dependent on the cpu model and can<br>be looked up at “info/MB/bandwidth_gran”. The available bandwidth<br>control steps are: min_bw + N * bw_gran. Intermediate values are rounded<br>to the next control step available on the hardware.</p>
<p>The bandwidth throttling is a core specific mechanism on some of Intel<br>SKUs. Using a high bandwidth and a low bandwidth setting on two threads<br>sharing a core will result in both threads being throttled to use the<br>low bandwidth.</p>
<h2 id="L3-schemata-file-details-code-and-data-prioritization-disabled"><a href="#L3-schemata-file-details-code-and-data-prioritization-disabled" class="headerlink" title="L3 schemata file details (code and data prioritization disabled)"></a>L3 schemata file details (code and data prioritization disabled)</h2><p>With CDP disabled the L3 schemata format is:</p>
<pre><code>L3:&lt;cache_id0&gt;=&lt;cbm&gt;;&lt;cache_id1&gt;=&lt;cbm&gt;;...
</code></pre>
<h2 id="L3-schemata-file-details-CDP-enabled-via-mount-option-to-resctrl"><a href="#L3-schemata-file-details-CDP-enabled-via-mount-option-to-resctrl" class="headerlink" title="L3 schemata file details (CDP enabled via mount option to resctrl)"></a>L3 schemata file details (CDP enabled via mount option to resctrl)</h2><p>When CDP is enabled L3 control is split into two separate resources<br>so you can specify independent masks for code and data like this:</p>
<pre><code>L3data:&lt;cache_id0&gt;=&lt;cbm&gt;;&lt;cache_id1&gt;=&lt;cbm&gt;;...
L3code:&lt;cache_id0&gt;=&lt;cbm&gt;;&lt;cache_id1&gt;=&lt;cbm&gt;;...
</code></pre>
<h2 id="L2-schemata-file-details"><a href="#L2-schemata-file-details" class="headerlink" title="L2 schemata file details"></a>L2 schemata file details</h2><p>L2 cache does not support code and data prioritization, so the<br>schemata format is always:</p>
<pre><code>L2:&lt;cache_id0&gt;=&lt;cbm&gt;;&lt;cache_id1&gt;=&lt;cbm&gt;;...
</code></pre>
<h2 id="Memory-b-w-Allocation-details"><a href="#Memory-b-w-Allocation-details" class="headerlink" title="Memory b/w Allocation details"></a>Memory b/w Allocation details</h2><p>Memory b/w domain is L3 cache.</p>
<pre><code>MB:&lt;cache_id0&gt;=bandwidth0;&lt;cache_id1&gt;=bandwidth1;...
</code></pre>
<h2 id="Reading-writing-the-schemata-file"><a href="#Reading-writing-the-schemata-file" class="headerlink" title="Reading/writing the schemata file"></a>Reading/writing the schemata file</h2><p>Reading the schemata file will show the state of all resources<br>on all domains. When writing you only need to specify those values<br>which you wish to change.  E.g.</p>
<h1 id="cat-schemata"><a href="#cat-schemata" class="headerlink" title="cat schemata"></a>cat schemata</h1><p>L3DATA:0=fffff;1=fffff;2=fffff;3=fffff<br>L3CODE:0=fffff;1=fffff;2=fffff;3=fffff</p>
<h1 id="echo-“L3DATA-2-3c0-”-gt-schemata"><a href="#echo-“L3DATA-2-3c0-”-gt-schemata" class="headerlink" title="echo “L3DATA:2=3c0;” &gt; schemata"></a>echo “L3DATA:2=3c0;” &gt; schemata</h1><h1 id="cat-schemata-1"><a href="#cat-schemata-1" class="headerlink" title="cat schemata"></a>cat schemata</h1><p>L3DATA:0=fffff;1=fffff;2=3c0;3=fffff<br>L3CODE:0=fffff;1=fffff;2=fffff;3=fffff</p>
<p>Examples for RDT allocation usage:</p>
<h2 id="Example-1"><a href="#Example-1" class="headerlink" title="Example 1"></a>Example 1</h2><p>On a two socket machine (one L3 cache per socket) with just four bits<br>for cache bit masks, minimum b/w of 10% with a memory bandwidth<br>granularity of 10%</p>
<h1 id="mount-t-resctrl-resctrl-sys-fs-resctrl"><a href="#mount-t-resctrl-resctrl-sys-fs-resctrl" class="headerlink" title="mount -t resctrl resctrl /sys/fs/resctrl"></a>mount -t resctrl resctrl /sys/fs/resctrl</h1><h1 id="cd-sys-fs-resctrl"><a href="#cd-sys-fs-resctrl" class="headerlink" title="cd /sys/fs/resctrl"></a>cd /sys/fs/resctrl</h1><h1 id="mkdir-p0-p1"><a href="#mkdir-p0-p1" class="headerlink" title="mkdir p0 p1"></a>mkdir p0 p1</h1><h1 id="echo-“L3-0-3-1-c-nMB-0-50-1-50”-gt-sys-fs-resctrl-p0-schemata"><a href="#echo-“L3-0-3-1-c-nMB-0-50-1-50”-gt-sys-fs-resctrl-p0-schemata" class="headerlink" title="echo “L3:0=3;1=c\nMB:0=50;1=50” &gt; /sys/fs/resctrl/p0/schemata"></a>echo “L3:0=3;1=c\nMB:0=50;1=50” &gt; /sys/fs/resctrl/p0/schemata</h1><h1 id="echo-“L3-0-3-1-3-nMB-0-50-1-50”-gt-sys-fs-resctrl-p1-schemata"><a href="#echo-“L3-0-3-1-3-nMB-0-50-1-50”-gt-sys-fs-resctrl-p1-schemata" class="headerlink" title="echo “L3:0=3;1=3\nMB:0=50;1=50” &gt; /sys/fs/resctrl/p1/schemata"></a>echo “L3:0=3;1=3\nMB:0=50;1=50” &gt; /sys/fs/resctrl/p1/schemata</h1><p>The default resource group is unmodified, so we have access to all parts<br>of all caches (its schemata file reads “L3:0=f;1=f”).</p>
<p>Tasks that are under the control of group “p0” may only allocate from the<br>“lower” 50% on cache ID 0, and the “upper” 50% of cache ID 1.<br>Tasks in group “p1” use the “lower” 50% of cache on both sockets.</p>
<p>Similarly, tasks that are under the control of group “p0” may use a<br>maximum memory b/w of 50% on socket0 and 50% on socket 1.<br>Tasks in group “p1” may also use 50% memory b/w on both sockets.<br>Note that unlike cache masks, memory b/w cannot specify whether these<br>allocations can overlap or not. The allocations specifies the maximum<br>b/w that the group may be able to use and the system admin can configure<br>the b/w accordingly.</p>
<h2 id="Example-2"><a href="#Example-2" class="headerlink" title="Example 2"></a>Example 2</h2><p>Again two sockets, but this time with a more realistic 20-bit mask.</p>
<p>Two real time tasks pid=1234 running on processor 0 and pid=5678 running on<br>processor 1 on socket 0 on a 2-socket and dual core machine. To avoid noisy<br>neighbors, each of the two real-time tasks exclusively occupies one quarter<br>of L3 cache on socket 0.</p>
<h1 id="mount-t-resctrl-resctrl-sys-fs-resctrl-1"><a href="#mount-t-resctrl-resctrl-sys-fs-resctrl-1" class="headerlink" title="mount -t resctrl resctrl /sys/fs/resctrl"></a>mount -t resctrl resctrl /sys/fs/resctrl</h1><h1 id="cd-sys-fs-resctrl-1"><a href="#cd-sys-fs-resctrl-1" class="headerlink" title="cd /sys/fs/resctrl"></a>cd /sys/fs/resctrl</h1><p>First we reset the schemata for the default group so that the “upper”<br>50% of the L3 cache on socket 0 and 50% of memory b/w cannot be used by<br>ordinary tasks:</p>
<h1 id="echo-“L3-0-3ff-1-fffff-nMB-0-50-1-100”-gt-schemata"><a href="#echo-“L3-0-3ff-1-fffff-nMB-0-50-1-100”-gt-schemata" class="headerlink" title="echo “L3:0=3ff;1=fffff\nMB:0=50;1=100” &gt; schemata"></a>echo “L3:0=3ff;1=fffff\nMB:0=50;1=100” &gt; schemata</h1><p>Next we make a resource group for our first real time task and give<br>it access to the “top” 25% of the cache on socket 0.</p>
<h1 id="mkdir-p0"><a href="#mkdir-p0" class="headerlink" title="mkdir p0"></a>mkdir p0</h1><h1 id="echo-“L3-0-f8000-1-fffff”-gt-p0-schemata"><a href="#echo-“L3-0-f8000-1-fffff”-gt-p0-schemata" class="headerlink" title="echo “L3:0=f8000;1=fffff” &gt; p0/schemata"></a>echo “L3:0=f8000;1=fffff” &gt; p0/schemata</h1><p>Finally we move our first real time task into this resource group. We<br>also use taskset(1) to ensure the task always runs on a dedicated CPU<br>on socket 0. Most uses of resource groups will also constrain which<br>processors tasks run on.</p>
<h1 id="echo-1234-gt-p0-tasks"><a href="#echo-1234-gt-p0-tasks" class="headerlink" title="echo 1234 &gt; p0/tasks"></a>echo 1234 &gt; p0/tasks</h1><h1 id="taskset-cp-1-1234"><a href="#taskset-cp-1-1234" class="headerlink" title="taskset -cp 1 1234"></a>taskset -cp 1 1234</h1><p>Ditto for the second real time task (with the remaining 25% of cache):</p>
<h1 id="mkdir-p1"><a href="#mkdir-p1" class="headerlink" title="mkdir p1"></a>mkdir p1</h1><h1 id="echo-“L3-0-7c00-1-fffff”-gt-p1-schemata"><a href="#echo-“L3-0-7c00-1-fffff”-gt-p1-schemata" class="headerlink" title="echo “L3:0=7c00;1=fffff” &gt; p1/schemata"></a>echo “L3:0=7c00;1=fffff” &gt; p1/schemata</h1><h1 id="echo-5678-gt-p1-tasks"><a href="#echo-5678-gt-p1-tasks" class="headerlink" title="echo 5678 &gt; p1/tasks"></a>echo 5678 &gt; p1/tasks</h1><h1 id="taskset-cp-2-5678"><a href="#taskset-cp-2-5678" class="headerlink" title="taskset -cp 2 5678"></a>taskset -cp 2 5678</h1><p>For the same 2 socket system with memory b/w resource and CAT L3 the<br>schemata would look like(Assume min_bandwidth 10 and bandwidth_gran is<br>10):</p>
<p>For our first real time task this would request 20% memory b/w on socket<br>0.</p>
<h1 id="echo-e-“L3-0-f8000-1-fffff-nMB-0-20-1-100”-gt-p0-schemata"><a href="#echo-e-“L3-0-f8000-1-fffff-nMB-0-20-1-100”-gt-p0-schemata" class="headerlink" title="echo -e “L3:0=f8000;1=fffff\nMB:0=20;1=100” &gt; p0/schemata"></a>echo -e “L3:0=f8000;1=fffff\nMB:0=20;1=100” &gt; p0/schemata</h1><p>For our second real time task this would request an other 20% memory b/w<br>on socket 0.</p>
<h1 id="echo-e-“L3-0-f8000-1-fffff-nMB-0-20-1-100”-gt-p0-schemata-1"><a href="#echo-e-“L3-0-f8000-1-fffff-nMB-0-20-1-100”-gt-p0-schemata-1" class="headerlink" title="echo -e “L3:0=f8000;1=fffff\nMB:0=20;1=100” &gt; p0/schemata"></a>echo -e “L3:0=f8000;1=fffff\nMB:0=20;1=100” &gt; p0/schemata</h1><h2 id="Example-3"><a href="#Example-3" class="headerlink" title="Example 3"></a>Example 3</h2><p>A single socket system which has real-time tasks running on core 4-7 and<br>non real-time workload assigned to core 0-3. The real-time tasks share text<br>and data, so a per task association is not required and due to interaction<br>with the kernel it’s desired that the kernel on these cores shares L3 with<br>the tasks.</p>
<h1 id="mount-t-resctrl-resctrl-sys-fs-resctrl-2"><a href="#mount-t-resctrl-resctrl-sys-fs-resctrl-2" class="headerlink" title="mount -t resctrl resctrl /sys/fs/resctrl"></a>mount -t resctrl resctrl /sys/fs/resctrl</h1><h1 id="cd-sys-fs-resctrl-2"><a href="#cd-sys-fs-resctrl-2" class="headerlink" title="cd /sys/fs/resctrl"></a>cd /sys/fs/resctrl</h1><p>First we reset the schemata for the default group so that the “upper”<br>50% of the L3 cache on socket 0, and 50% of memory bandwidth on socket 0<br>cannot be used by ordinary tasks:</p>
<h1 id="echo-“L3-0-3ff-nMB-0-50”-gt-schemata"><a href="#echo-“L3-0-3ff-nMB-0-50”-gt-schemata" class="headerlink" title="echo “L3:0=3ff\nMB:0=50” &gt; schemata"></a>echo “L3:0=3ff\nMB:0=50” &gt; schemata</h1><p>Next we make a resource group for our real time cores and give it access<br>to the “top” 50% of the cache on socket 0 and 50% of memory bandwidth on<br>socket 0.</p>
<h1 id="mkdir-p0-1"><a href="#mkdir-p0-1" class="headerlink" title="mkdir p0"></a>mkdir p0</h1><h1 id="echo-“L3-0-ffc00-nMB-0-50”-gt-p0-schemata"><a href="#echo-“L3-0-ffc00-nMB-0-50”-gt-p0-schemata" class="headerlink" title="echo “L3:0=ffc00\nMB:0=50” &gt; p0/schemata"></a>echo “L3:0=ffc00\nMB:0=50” &gt; p0/schemata</h1><p>Finally we move core 4-7 over to the new group and make sure that the<br>kernel and the tasks running there get 50% of the cache. They should<br>also get 50% of memory bandwidth assuming that the cores 4-7 are SMT<br>siblings and only the real time threads are scheduled on the cores 4-7.</p>
<h1 id="echo-F0-gt-p0-cpus"><a href="#echo-F0-gt-p0-cpus" class="headerlink" title="echo F0 &gt; p0/cpus"></a>echo F0 &gt; p0/cpus</h1><ol start="4">
<li>Locking between applications</li>
</ol>
<p>Certain operations on the resctrl filesystem, composed of read/writes<br>to/from multiple files, must be atomic.</p>
<p>As an example, the allocation of an exclusive reservation of L3 cache<br>involves:</p>
<ol>
<li>Read the cbmmasks from each directory</li>
<li>Find a contiguous set of bits in the global CBM bitmask that is clear<br>in any of the directory cbmmasks</li>
<li>Create a new directory</li>
<li>Set the bits found in step 2 to the new directory “schemata” file</li>
</ol>
<p>If two applications attempt to allocate space concurrently then they can<br>end up allocating the same bits so the reservations are shared instead of<br>exclusive.</p>
<p>To coordinate atomic operations on the resctrlfs and to avoid the problem<br>above, the following locking procedure is recommended:</p>
<p>Locking is based on flock, which is available in libc and also as a shell<br>script command</p>
<p>Write lock:</p>
<p> A) Take flock(LOCK_EX) on /sys/fs/resctrl<br> B) Read/write the directory structure.<br> C) funlock</p>
<p>Read lock:</p>
<p> A) Take flock(LOCK_SH) on /sys/fs/resctrl<br> B) If success read the directory structure.<br> C) funlock</p>
<p>Example with bash:</p>
<h1 id="Atomically-read-directory-structure"><a href="#Atomically-read-directory-structure" class="headerlink" title="Atomically read directory structure"></a>Atomically read directory structure</h1><p>$ flock -s /sys/fs/resctrl/ find /sys/fs/resctrl</p>
<h1 id="Read-directory-contents-and-create-new-subdirectory"><a href="#Read-directory-contents-and-create-new-subdirectory" class="headerlink" title="Read directory contents and create new subdirectory"></a>Read directory contents and create new subdirectory</h1><p>$ cat create-dir.sh<br>find /sys/fs/resctrl/ &gt; output.txt<br>mask = function-of(output.txt)<br>mkdir /sys/fs/resctrl/newres/<br>echo mask &gt; /sys/fs/resctrl/newres/schemata</p>
<p>$ flock /sys/fs/resctrl/ ./create-dir.sh</p>
<p>Example with C:</p>
<p>/*</p>
<ul>
<li>Example code do take advisory locks</li>
<li>before accessing resctrl filesystem</li>
<li>/<br>#include &lt;sys/file.h&gt;<br>#include &lt;stdlib.h&gt;</li>
</ul>
<p>void resctrl_take_shared_lock(int fd)<br>{<br>    int ret;</p>
<pre><code>/* take shared lock on resctrl filesystem */
ret = flock(fd, LOCK_SH);
if (ret) &#123;
    perror(&quot;flock&quot;);
    exit(-1);
&#125;
</code></pre>
<p>}</p>
<p>void resctrl_take_exclusive_lock(int fd)<br>{<br>    int ret;</p>
<pre><code>/* release lock on resctrl filesystem */
ret = flock(fd, LOCK_EX);
if (ret) &#123;
    perror(&quot;flock&quot;);
    exit(-1);
&#125;
</code></pre>
<p>}</p>
<p>void resctrl_release_lock(int fd)<br>{<br>    int ret;</p>
<pre><code>/* take shared lock on resctrl filesystem */
ret = flock(fd, LOCK_UN);
if (ret) &#123;
    perror(&quot;flock&quot;);
    exit(-1);
&#125;
</code></pre>
<p>}</p>
<p>void main(void)<br>{<br>    int fd, ret;</p>
<pre><code>fd = open(&quot;/sys/fs/resctrl&quot;, O_DIRECTORY);
if (fd == -1) &#123;
    perror(&quot;open&quot;);
    exit(-1);
&#125;
resctrl_take_shared_lock(fd);
/* code to read directory contents */
resctrl_release_lock(fd);

resctrl_take_exclusive_lock(fd);
/* code to read and write directory contents */
resctrl_release_lock(fd);
</code></pre>
<p>}</p>
<p>Examples for RDT Monitoring along with allocation usage:</p>
<h2 id="Reading-monitored-data"><a href="#Reading-monitored-data" class="headerlink" title="Reading monitored data"></a>Reading monitored data</h2><p>Reading an event file (for ex: mon_data/mon_L3_00/llc_occupancy) would<br>show the current snapshot of LLC occupancy of the corresponding MON<br>group or CTRL_MON group.</p>
<h2 id="Example-1-Monitor-CTRL-MON-group-and-subset-of-tasks-in-CTRL-MON-group"><a href="#Example-1-Monitor-CTRL-MON-group-and-subset-of-tasks-in-CTRL-MON-group" class="headerlink" title="Example 1 (Monitor CTRL_MON group and subset of tasks in CTRL_MON group)"></a>Example 1 (Monitor CTRL_MON group and subset of tasks in CTRL_MON group)</h2><p>On a two socket machine (one L3 cache per socket) with just four bits<br>for cache bit masks</p>
<h1 id="mount-t-resctrl-resctrl-sys-fs-resctrl-3"><a href="#mount-t-resctrl-resctrl-sys-fs-resctrl-3" class="headerlink" title="mount -t resctrl resctrl /sys/fs/resctrl"></a>mount -t resctrl resctrl /sys/fs/resctrl</h1><h1 id="cd-sys-fs-resctrl-3"><a href="#cd-sys-fs-resctrl-3" class="headerlink" title="cd /sys/fs/resctrl"></a>cd /sys/fs/resctrl</h1><h1 id="mkdir-p0-p1-1"><a href="#mkdir-p0-p1-1" class="headerlink" title="mkdir p0 p1"></a>mkdir p0 p1</h1><h1 id="echo-“L3-0-3-1-c”-gt-sys-fs-resctrl-p0-schemata"><a href="#echo-“L3-0-3-1-c”-gt-sys-fs-resctrl-p0-schemata" class="headerlink" title="echo “L3:0=3;1=c” &gt; /sys/fs/resctrl/p0/schemata"></a>echo “L3:0=3;1=c” &gt; /sys/fs/resctrl/p0/schemata</h1><h1 id="echo-“L3-0-3-1-3”-gt-sys-fs-resctrl-p1-schemata"><a href="#echo-“L3-0-3-1-3”-gt-sys-fs-resctrl-p1-schemata" class="headerlink" title="echo “L3:0=3;1=3” &gt; /sys/fs/resctrl/p1/schemata"></a>echo “L3:0=3;1=3” &gt; /sys/fs/resctrl/p1/schemata</h1><h1 id="echo-5678-gt-p1-tasks-1"><a href="#echo-5678-gt-p1-tasks-1" class="headerlink" title="echo 5678 &gt; p1/tasks"></a>echo 5678 &gt; p1/tasks</h1><h1 id="echo-5679-gt-p1-tasks"><a href="#echo-5679-gt-p1-tasks" class="headerlink" title="echo 5679 &gt; p1/tasks"></a>echo 5679 &gt; p1/tasks</h1><p>The default resource group is unmodified, so we have access to all parts<br>of all caches (its schemata file reads “L3:0=f;1=f”).</p>
<p>Tasks that are under the control of group “p0” may only allocate from the<br>“lower” 50% on cache ID 0, and the “upper” 50% of cache ID 1.<br>Tasks in group “p1” use the “lower” 50% of cache on both sockets.</p>
<p>Create monitor groups and assign a subset of tasks to each monitor group.</p>
<h1 id="cd-sys-fs-resctrl-p1-mon-groups"><a href="#cd-sys-fs-resctrl-p1-mon-groups" class="headerlink" title="cd /sys/fs/resctrl/p1/mon_groups"></a>cd /sys/fs/resctrl/p1/mon_groups</h1><h1 id="mkdir-m11-m12"><a href="#mkdir-m11-m12" class="headerlink" title="mkdir m11 m12"></a>mkdir m11 m12</h1><h1 id="echo-5678-gt-m11-tasks"><a href="#echo-5678-gt-m11-tasks" class="headerlink" title="echo 5678 &gt; m11/tasks"></a>echo 5678 &gt; m11/tasks</h1><h1 id="echo-5679-gt-m12-tasks"><a href="#echo-5679-gt-m12-tasks" class="headerlink" title="echo 5679 &gt; m12/tasks"></a>echo 5679 &gt; m12/tasks</h1><p>fetch data (data shown in bytes)</p>
<h1 id="cat-m11-mon-data-mon-L3-00-llc-occupancy"><a href="#cat-m11-mon-data-mon-L3-00-llc-occupancy" class="headerlink" title="cat m11/mon_data/mon_L3_00/llc_occupancy"></a>cat m11/mon_data/mon_L3_00/llc_occupancy</h1><p>16234000</p>
<h1 id="cat-m11-mon-data-mon-L3-01-llc-occupancy"><a href="#cat-m11-mon-data-mon-L3-01-llc-occupancy" class="headerlink" title="cat m11/mon_data/mon_L3_01/llc_occupancy"></a>cat m11/mon_data/mon_L3_01/llc_occupancy</h1><p>14789000</p>
<h1 id="cat-m12-mon-data-mon-L3-00-llc-occupancy"><a href="#cat-m12-mon-data-mon-L3-00-llc-occupancy" class="headerlink" title="cat m12/mon_data/mon_L3_00/llc_occupancy"></a>cat m12/mon_data/mon_L3_00/llc_occupancy</h1><p>16789000</p>
<p>The parent ctrl_mon group shows the aggregated data.</p>
<h1 id="cat-sys-fs-resctrl-p1-mon-data-mon-l3-00-llc-occupancy"><a href="#cat-sys-fs-resctrl-p1-mon-data-mon-l3-00-llc-occupancy" class="headerlink" title="cat /sys/fs/resctrl/p1/mon_data/mon_l3_00/llc_occupancy"></a>cat /sys/fs/resctrl/p1/mon_data/mon_l3_00/llc_occupancy</h1><p>31234000</p>
<h2 id="Example-2-Monitor-a-task-from-its-creation"><a href="#Example-2-Monitor-a-task-from-its-creation" class="headerlink" title="Example 2 (Monitor a task from its creation)"></a>Example 2 (Monitor a task from its creation)</h2><p>On a two socket machine (one L3 cache per socket)</p>
<h1 id="mount-t-resctrl-resctrl-sys-fs-resctrl-4"><a href="#mount-t-resctrl-resctrl-sys-fs-resctrl-4" class="headerlink" title="mount -t resctrl resctrl /sys/fs/resctrl"></a>mount -t resctrl resctrl /sys/fs/resctrl</h1><h1 id="cd-sys-fs-resctrl-4"><a href="#cd-sys-fs-resctrl-4" class="headerlink" title="cd /sys/fs/resctrl"></a>cd /sys/fs/resctrl</h1><h1 id="mkdir-p0-p1-2"><a href="#mkdir-p0-p1-2" class="headerlink" title="mkdir p0 p1"></a>mkdir p0 p1</h1><p>An RMID is allocated to the group once its created and hence the <cmd><br>below is monitored from its creation.</p>
<h1 id="echo-gt-sys-fs-resctrl-p1-tasks"><a href="#echo-gt-sys-fs-resctrl-p1-tasks" class="headerlink" title="echo $$ &gt; /sys/fs/resctrl/p1/tasks"></a>echo $$ &gt; /sys/fs/resctrl/p1/tasks</h1><h1 id=""><a href="#" class="headerlink" title=""></a><cmd></h1><p>Fetch the data</p>
<h1 id="cat-sys-fs-resctrl-p1-mon-data-mon-l3-00-llc-occupancy-1"><a href="#cat-sys-fs-resctrl-p1-mon-data-mon-l3-00-llc-occupancy-1" class="headerlink" title="cat /sys/fs/resctrl/p1/mon_data/mon_l3_00/llc_occupancy"></a>cat /sys/fs/resctrl/p1/mon_data/mon_l3_00/llc_occupancy</h1><p>31789000</p>
<h2 id="Example-3-Monitor-without-CAT-support-or-before-creating-CAT-groups"><a href="#Example-3-Monitor-without-CAT-support-or-before-creating-CAT-groups" class="headerlink" title="Example 3 (Monitor without CAT support or before creating CAT groups)"></a>Example 3 (Monitor without CAT support or before creating CAT groups)</h2><p>Assume a system like HSW has only CQM and no CAT support. In this case<br>the resctrl will still mount but cannot create CTRL_MON directories.<br>But user can create different MON groups within the root group thereby<br>able to monitor all tasks including kernel threads.</p>
<p>This can also be used to profile jobs cache size footprint before being<br>able to allocate them to different allocation groups.</p>
<h1 id="mount-t-resctrl-resctrl-sys-fs-resctrl-5"><a href="#mount-t-resctrl-resctrl-sys-fs-resctrl-5" class="headerlink" title="mount -t resctrl resctrl /sys/fs/resctrl"></a>mount -t resctrl resctrl /sys/fs/resctrl</h1><h1 id="cd-sys-fs-resctrl-5"><a href="#cd-sys-fs-resctrl-5" class="headerlink" title="cd /sys/fs/resctrl"></a>cd /sys/fs/resctrl</h1><h1 id="mkdir-mon-groups-m01"><a href="#mkdir-mon-groups-m01" class="headerlink" title="mkdir mon_groups/m01"></a>mkdir mon_groups/m01</h1><h1 id="mkdir-mon-groups-m02"><a href="#mkdir-mon-groups-m02" class="headerlink" title="mkdir mon_groups/m02"></a>mkdir mon_groups/m02</h1><h1 id="echo-3478-gt-sys-fs-resctrl-mon-groups-m01-tasks"><a href="#echo-3478-gt-sys-fs-resctrl-mon-groups-m01-tasks" class="headerlink" title="echo 3478 &gt; /sys/fs/resctrl/mon_groups/m01/tasks"></a>echo 3478 &gt; /sys/fs/resctrl/mon_groups/m01/tasks</h1><h1 id="echo-2467-gt-sys-fs-resctrl-mon-groups-m02-tasks"><a href="#echo-2467-gt-sys-fs-resctrl-mon-groups-m02-tasks" class="headerlink" title="echo 2467 &gt; /sys/fs/resctrl/mon_groups/m02/tasks"></a>echo 2467 &gt; /sys/fs/resctrl/mon_groups/m02/tasks</h1><p>Monitor the groups separately and also get per domain data. From the<br>below its apparent that the tasks are mostly doing work on<br>domain(socket) 0.</p>
<h1 id="cat-sys-fs-resctrl-mon-groups-m01-mon-L3-00-llc-occupancy"><a href="#cat-sys-fs-resctrl-mon-groups-m01-mon-L3-00-llc-occupancy" class="headerlink" title="cat /sys/fs/resctrl/mon_groups/m01/mon_L3_00/llc_occupancy"></a>cat /sys/fs/resctrl/mon_groups/m01/mon_L3_00/llc_occupancy</h1><p>31234000</p>
<h1 id="cat-sys-fs-resctrl-mon-groups-m01-mon-L3-01-llc-occupancy"><a href="#cat-sys-fs-resctrl-mon-groups-m01-mon-L3-01-llc-occupancy" class="headerlink" title="cat /sys/fs/resctrl/mon_groups/m01/mon_L3_01/llc_occupancy"></a>cat /sys/fs/resctrl/mon_groups/m01/mon_L3_01/llc_occupancy</h1><p>34555</p>
<h1 id="cat-sys-fs-resctrl-mon-groups-m02-mon-L3-00-llc-occupancy"><a href="#cat-sys-fs-resctrl-mon-groups-m02-mon-L3-00-llc-occupancy" class="headerlink" title="cat /sys/fs/resctrl/mon_groups/m02/mon_L3_00/llc_occupancy"></a>cat /sys/fs/resctrl/mon_groups/m02/mon_L3_00/llc_occupancy</h1><p>31234000</p>
<h1 id="cat-sys-fs-resctrl-mon-groups-m02-mon-L3-01-llc-occupancy"><a href="#cat-sys-fs-resctrl-mon-groups-m02-mon-L3-01-llc-occupancy" class="headerlink" title="cat /sys/fs/resctrl/mon_groups/m02/mon_L3_01/llc_occupancy"></a>cat /sys/fs/resctrl/mon_groups/m02/mon_L3_01/llc_occupancy</h1><p>32789</p>
<h2 id="Example-4-Monitor-real-time-tasks"><a href="#Example-4-Monitor-real-time-tasks" class="headerlink" title="Example 4 (Monitor real time tasks)"></a>Example 4 (Monitor real time tasks)</h2><p>A single socket system which has real time tasks running on cores 4-7<br>and non real time tasks on other cpus. We want to monitor the cache<br>occupancy of the real time threads on these cores.</p>
<h1 id="mount-t-resctrl-resctrl-sys-fs-resctrl-6"><a href="#mount-t-resctrl-resctrl-sys-fs-resctrl-6" class="headerlink" title="mount -t resctrl resctrl /sys/fs/resctrl"></a>mount -t resctrl resctrl /sys/fs/resctrl</h1><h1 id="cd-sys-fs-resctrl-6"><a href="#cd-sys-fs-resctrl-6" class="headerlink" title="cd /sys/fs/resctrl"></a>cd /sys/fs/resctrl</h1><h1 id="mkdir-p1-1"><a href="#mkdir-p1-1" class="headerlink" title="mkdir p1"></a>mkdir p1</h1><p>Move the cpus 4-7 over to p1</p>
<h1 id="echo-f0-gt-p0-cpus"><a href="#echo-f0-gt-p0-cpus" class="headerlink" title="echo f0 &gt; p0/cpus"></a>echo f0 &gt; p0/cpus</h1><p>View the llc occupancy snapshot</p>
<h1 id="cat-sys-fs-resctrl-p1-mon-data-mon-L3-00-llc-occupancy"><a href="#cat-sys-fs-resctrl-p1-mon-data-mon-L3-00-llc-occupancy" class="headerlink" title="cat /sys/fs/resctrl/p1/mon_data/mon_L3_00/llc_occupancy"></a>cat /sys/fs/resctrl/p1/mon_data/mon_L3_00/llc_occupancy</h1><p>11234000</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_intel_rdt_ui/" title="Kernel-3.10.0-957.el7_intel_rdt_ui" target="_blank" rel="external">http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_intel_rdt_ui/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/03/13/Kernel-3.10.0-957.el7_ixgb/" title="Kernel-3.10.0-957.el7_ixgb"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/03/13/Kernel-3.10.0-957.el7_intel-ish-hid/" title="Kernel-3.10.0-957.el7_intel-ish-hi"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>