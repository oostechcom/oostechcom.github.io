<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-2.6.32-573.12.1.el6_runtime_p | oosTech.com</title>
  <meta name="description" content="Run-time Power Management Framework for I&#x2F;O Devices (C) 2009 Rafael J. Wysocki &amp;#x72;&amp;#106;&amp;#119;&amp;#x40;&amp;#115;&amp;#x69;&amp;#115;&amp;#107;&amp;#46;&amp;#112;&amp;#108;, Novell Inc.  Introduction  Support for run-time power">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-2.6.32-573.12.1.el6_runtime_p">
<meta property="og:url" content="http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_runtime_pm/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="Run-time Power Management Framework for I&#x2F;O Devices (C) 2009 Rafael J. Wysocki &amp;#x72;&amp;#106;&amp;#119;&amp;#x40;&amp;#115;&amp;#x69;&amp;#115;&amp;#107;&amp;#46;&amp;#112;&amp;#108;, Novell Inc.  Introduction  Support for run-time power">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_runtime_pm/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a><span class="category-list-count">830</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_devices/" class="title">Kernel-2.6.32-573.12.1.el6_devices</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3c509/" class="title">Kernel-3.10.0-957.el7_3c509</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-2.6.32-573.12.1.el6_runtime_pm" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-2.6.32-573.12.1.el6_runtime_p
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_runtime_pm/" class="article-date">
	 published: <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
	</a>
</span>

        
	<a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_runtime_pm/" class="article-date">
	   updated: <time datetime="2021-03-12T16:00:00.000Z" itemprop="dateUpdated">2021-03-13</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_runtime_pm/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>Run-time Power Management Framework for I/O Devices</p>
<p>(C) 2009 Rafael J. Wysocki <a href="mailto:&#x72;&#106;&#119;&#x40;&#115;&#x69;&#115;&#107;&#46;&#112;&#108;">&#x72;&#106;&#119;&#x40;&#115;&#x69;&#115;&#107;&#46;&#112;&#108;</a>, Novell Inc.</p>
<ol>
<li>Introduction</li>
</ol>
<p>Support for run-time power management (run-time PM) of I/O devices is provided<br>at the power management core (PM core) level by means of:</p>
<ul>
<li><p>The power management workqueue pm_wq in which bus types and device drivers can<br>put their PM-related work items.  It is strongly recommended that pm_wq be<br>used for queuing all work items related to run-time PM, because this allows<br>them to be synchronized with system-wide power transitions (suspend to RAM,<br>hibernation and resume from system sleep states).  pm_wq is declared in<br>include/linux/pm_runtime.h and defined in kernel/power/main.c.</p>
</li>
<li><p>A number of run-time PM fields in the ‘power’ member of ‘struct device’ (which<br>is of the type ‘struct dev_pm_info’, defined in include/linux/pm.h) that can<br>be used for synchronizing run-time PM operations with one another.</p>
</li>
<li><p>Three device run-time PM callbacks in ‘struct dev_pm_ops’ (defined in<br>include/linux/pm.h).</p>
</li>
<li><p>A set of helper functions defined in drivers/base/power/runtime.c that can be<br>used for carrying out run-time PM operations in such a way that the<br>synchronization between them is taken care of by the PM core.  Bus types and<br>device drivers are encouraged to use these functions.</p>
</li>
</ul>
<p>The run-time PM callbacks present in ‘struct dev_pm_ops’, the device run-time PM<br>fields of ‘struct dev_pm_info’ and the core helper functions provided for<br>run-time PM are described below.</p>
<ol start="2">
<li>Device Run-time PM Callbacks</li>
</ol>
<p>There are three device run-time PM callbacks defined in ‘struct dev_pm_ops’:</p>
<p>struct dev_pm_ops {<br>    …<br>    int (*runtime_suspend)(struct device *dev);<br>    int (*runtime_resume)(struct device *dev);<br>    void (*runtime_idle)(struct device *dev);<br>    …<br>};</p>
<p>The -&gt;runtime_suspend() callback is executed by the PM core for the bus type of<br>the device being suspended.  The bus type’s callback is then <em>entirely</em><br><em>responsible</em> for handling the device as appropriate, which may, but need not<br>include executing the device driver’s own -&gt;runtime_suspend() callback (from the<br>PM core’s point of view it is not necessary to implement a -&gt;runtime_suspend()<br>callback in a device driver as long as the bus type’s -&gt;runtime_suspend() knows<br>what to do to handle the device).</p>
<ul>
<li><p>Once the bus type’s -&gt;runtime_suspend() callback has completed successfully<br>for given device, the PM core regards the device as suspended, which need<br>not mean that the device has been put into a low power state.  It is<br>supposed to mean, however, that the device will not process data and will<br>not communicate with the CPU(s) and RAM until its bus type’s<br>-&gt;runtime_resume() callback is executed for it.  The run-time PM status of<br>a device after successful execution of its bus type’s -&gt;runtime_suspend()<br>callback is ‘suspended’.</p>
</li>
<li><p>If the bus type’s -&gt;runtime_suspend() callback returns -EBUSY or -EAGAIN,<br>the device’s run-time PM status is supposed to be ‘active’, which means that<br>the device <em>must</em> be fully operational afterwards.</p>
</li>
<li><p>If the bus type’s -&gt;runtime_suspend() callback returns an error code<br>different from -EBUSY or -EAGAIN, the PM core regards this as a fatal<br>error and will refuse to run the helper functions described in Section 4<br>for the device, until the status of it is directly set either to ‘active’<br>or to ‘suspended’ (the PM core provides special helper functions for this<br>purpose).</p>
</li>
</ul>
<p>In particular, if the driver requires remote wakeup capability for proper<br>functioning and device_may_wakeup() returns ‘false’ for the device, then<br>-&gt;runtime_suspend() should return -EBUSY.  On the other hand, if<br>device_may_wakeup() returns ‘true’ for the device and the device is put<br>into a low power state during the execution of its bus type’s<br>-&gt;runtime_suspend(), it is expected that remote wake-up (i.e. hardware mechanism<br>allowing the device to request a change of its power state, such as PCI PME)<br>will be enabled for the device.  Generally, remote wake-up should be enabled<br>for all input devices put into a low power state at run time.</p>
<p>The -&gt;runtime_resume() callback is executed by the PM core for the bus type of<br>the device being woken up.  The bus type’s callback is then <em>entirely</em><br><em>responsible</em> for handling the device as appropriate, which may, but need not<br>include executing the device driver’s own -&gt;runtime_resume() callback (from the<br>PM core’s point of view it is not necessary to implement a -&gt;runtime_resume()<br>callback in a device driver as long as the bus type’s -&gt;runtime_resume() knows<br>what to do to handle the device).</p>
<ul>
<li><p>Once the bus type’s -&gt;runtime_resume() callback has completed successfully,<br>the PM core regards the device as fully operational, which means that the<br>device <em>must</em> be able to complete I/O operations as needed.  The run-time<br>PM status of the device is then ‘active’.</p>
</li>
<li><p>If the bus type’s -&gt;runtime_resume() callback returns an error code, the PM<br>core regards this as a fatal error and will refuse to run the helper<br>functions described in Section 4 for the device, until its status is<br>directly set either to ‘active’ or to ‘suspended’ (the PM core provides<br>special helper functions for this purpose).</p>
</li>
</ul>
<p>The -&gt;runtime_idle() callback is executed by the PM core for the bus type of<br>given device whenever the device appears to be idle, which is indicated to the<br>PM core by two counters, the device’s usage counter and the counter of ‘active’<br>children of the device.</p>
<ul>
<li>If any of these counters is decreased using a helper function provided by<br>the PM core and it turns out to be equal to zero, the other counter is<br>checked.  If that counter also is equal to zero, the PM core executes the<br>device bus type’s -&gt;runtime_idle() callback (with the device as an<br>argument).</li>
</ul>
<p>The action performed by a bus type’s -&gt;runtime_idle() callback is totally<br>dependent on the bus type in question, but the expected and recommended action<br>is to check if the device can be suspended (i.e. if all of the conditions<br>necessary for suspending the device are satisfied) and to queue up a suspend<br>request for the device in that case.</p>
<p>The helper functions provided by the PM core, described in Section 4, guarantee<br>that the following constraints are met with respect to the bus type’s run-time<br>PM callbacks:</p>
<p>(1) The callbacks are mutually exclusive (e.g. it is forbidden to execute<br>    -&gt;runtime_suspend() in parallel with -&gt;runtime_resume() or with another<br>    instance of -&gt;runtime_suspend() for the same device) with the exception that<br>    -&gt;runtime_suspend() or -&gt;runtime_resume() can be executed in parallel with<br>    -&gt;runtime_idle() (although -&gt;runtime_idle() will not be started while any<br>    of the other callbacks is being executed for the same device).</p>
<p>(2) -&gt;runtime_idle() and -&gt;runtime_suspend() can only be executed for ‘active’<br>    devices (i.e. the PM core will only execute -&gt;runtime_idle() or<br>    -&gt;runtime_suspend() for the devices the run-time PM status of which is<br>    ‘active’).</p>
<p>(3) -&gt;runtime_idle() and -&gt;runtime_suspend() can only be executed for a device<br>    the usage counter of which is equal to zero <em>and</em> either the counter of<br>    ‘active’ children of which is equal to zero, or the ‘power.ignore_children’<br>    flag of which is set.</p>
<p>(4) -&gt;runtime_resume() can only be executed for ‘suspended’ devices  (i.e. the<br>    PM core will only execute -&gt;runtime_resume() for the devices the run-time<br>    PM status of which is ‘suspended’).</p>
<p>Additionally, the helper functions provided by the PM core obey the following<br>rules:</p>
<ul>
<li><p>If -&gt;runtime_suspend() is about to be executed or there’s a pending request<br>to execute it, -&gt;runtime_idle() will not be executed for the same device.</p>
</li>
<li><p>A request to execute or to schedule the execution of -&gt;runtime_suspend()<br>will cancel any pending requests to execute -&gt;runtime_idle() for the same<br>device.</p>
</li>
<li><p>If -&gt;runtime_resume() is about to be executed or there’s a pending request<br>to execute it, the other callbacks will not be executed for the same device.</p>
</li>
<li><p>A request to execute -&gt;runtime_resume() will cancel any pending or<br>scheduled requests to execute the other callbacks for the same device.</p>
</li>
</ul>
<ol start="3">
<li>Run-time PM Device Fields</li>
</ol>
<p>The following device run-time PM fields are present in ‘struct dev_pm_info’, as<br>defined in include/linux/pm.h:</p>
<p>  struct timer_list suspend_timer;<br>    - timer used for scheduling (delayed) suspend request</p>
<p>  unsigned long timer_expires;<br>    - timer expiration time, in jiffies (if this is different from zero, the<br>      timer is running and will expire at that time, otherwise the timer is not<br>      running)</p>
<p>  struct work_struct work;<br>    - work structure used for queuing up requests (i.e. work items in pm_wq)</p>
<p>  wait_queue_head_t wait_queue;<br>    - wait queue used if any of the helper functions needs to wait for another<br>      one to complete</p>
<p>  spinlock_t lock;<br>    - lock used for synchronisation</p>
<p>  atomic_t usage_count;<br>    - the usage counter of the device</p>
<p>  atomic_t child_count;<br>    - the count of ‘active’ children of the device</p>
<p>  unsigned int ignore_children;<br>    - if set, the value of child_count is ignored (but still updated)</p>
<p>  unsigned int disable_depth;<br>    - used for disabling the helper funcions (they work normally if this is<br>      equal to zero); the initial value of it is 1 (i.e. run-time PM is<br>      initially disabled for all devices)</p>
<p>  unsigned int runtime_error;<br>    - if set, there was a fatal error (one of the callbacks returned error code<br>      as described in Section 2), so the helper funtions will not work until<br>      this flag is cleared; this is the error code returned by the failing<br>      callback</p>
<p>  unsigned int idle_notification;<br>    - if set, -&gt;runtime_idle() is being executed</p>
<p>  unsigned int request_pending;<br>    - if set, there’s a pending request (i.e. a work item queued up into pm_wq)</p>
<p>  enum rpm_request request;<br>    - type of request that’s pending (valid if request_pending is set)</p>
<p>  unsigned int deferred_resume;<br>    - set if -&gt;runtime_resume() is about to be run while -&gt;runtime_suspend() is<br>      being executed for that device and it is not practical to wait for the<br>      suspend to complete; means “start a resume as soon as you’ve suspended”</p>
<p>  enum rpm_status runtime_status;<br>    - the run-time PM status of the device; this field’s initial value is<br>      RPM_SUSPENDED, which means that each device is initially regarded by the<br>      PM core as ‘suspended’, regardless of its real hardware status</p>
<p>All of the above fields are members of the ‘power’ member of ‘struct device’.</p>
<ol start="4">
<li>Run-time PM Device Helper Functions</li>
</ol>
<p>The following run-time PM helper functions are defined in<br>drivers/base/power/runtime.c and include/linux/pm_runtime.h:</p>
<p>  void pm_runtime_init(struct device *dev);<br>    - initialize the device run-time PM fields in ‘struct dev_pm_info’</p>
<p>  void pm_runtime_remove(struct device *dev);<br>    - make sure that the run-time PM of the device will be disabled after<br>      removing the device from device hierarchy</p>
<p>  int pm_runtime_idle(struct device *dev);<br>    - execute -&gt;runtime_idle() for the device’s bus type; returns 0 on success<br>      or error code on failure, where -EINPROGRESS means that -&gt;runtime_idle()<br>      is already being executed</p>
<p>  int pm_runtime_suspend(struct device *dev);<br>    - execute -&gt;runtime_suspend() for the device’s bus type; returns 0 on<br>      success, 1 if the device’s run-time PM status was already ‘suspended’, or<br>      error code on failure, where -EAGAIN or -EBUSY means it is safe to attempt<br>      to suspend the device again in future</p>
<p>  int pm_runtime_resume(struct device *dev);<br>    - execute -&gt;runtime_resume() for the device’s bus type; returns 0 on<br>      success, 1 if the device’s run-time PM status was already ‘active’ or<br>      error code on failure, where -EAGAIN means it may be safe to attempt to<br>      resume the device again in future, but ‘power.runtime_error’ should be<br>      checked additionally</p>
<p>  int pm_request_idle(struct device *dev);<br>    - submit a request to execute -&gt;runtime_idle() for the device’s bus type<br>      (the request is represented by a work item in pm_wq); returns 0 on success<br>      or error code if the request has not been queued up</p>
<p>  int pm_schedule_suspend(struct device *dev, unsigned int delay);<br>    - schedule the execution of -&gt;runtime_suspend() for the device’s bus type<br>      in future, where ‘delay’ is the time to wait before queuing up a suspend<br>      work item in pm_wq, in milliseconds (if ‘delay’ is zero, the work item is<br>      queued up immediately); returns 0 on success, 1 if the device’s PM<br>      run-time status was already ‘suspended’, or error code if the request<br>      hasn’t been scheduled (or queued up if ‘delay’ is 0); if the execution of<br>      -&gt;runtime_suspend() is already scheduled and not yet expired, the new<br>      value of ‘delay’ will be used as the time to wait</p>
<p>  int pm_request_resume(struct device *dev);<br>    - submit a request to execute -&gt;runtime_resume() for the device’s bus type<br>      (the request is represented by a work item in pm_wq); returns 0 on<br>      success, 1 if the device’s run-time PM status was already ‘active’, or<br>      error code if the request hasn’t been queued up</p>
<p>  void pm_runtime_get_noresume(struct device *dev);<br>    - increment the device’s usage counter</p>
<p>  int pm_runtime_get(struct device *dev);<br>    - increment the device’s usage counter, run pm_request_resume(dev) and<br>      return its result</p>
<p>  int pm_runtime_get_sync(struct device *dev);<br>    - increment the device’s usage counter, run pm_runtime_resume(dev) and<br>      return its result</p>
<p>  void pm_runtime_put_noidle(struct device *dev);<br>    - decrement the device’s usage counter</p>
<p>  int pm_runtime_put(struct device *dev);<br>    - decrement the device’s usage counter, run pm_request_idle(dev) and return<br>      its result</p>
<p>  int pm_runtime_put_sync(struct device *dev);<br>    - decrement the device’s usage counter, run pm_runtime_idle(dev) and return<br>      its result</p>
<p>  void pm_runtime_enable(struct device *dev);<br>    - enable the run-time PM helper functions to run the device bus type’s<br>      run-time PM callbacks described in Section 2</p>
<p>  int pm_runtime_disable(struct device *dev);<br>    - prevent the run-time PM helper functions from running the device bus<br>      type’s run-time PM callbacks, make sure that all of the pending run-time<br>      PM operations on the device are either completed or canceled; returns<br>      1 if there was a resume request pending and it was necessary to execute<br>      -&gt;runtime_resume() for the device’s bus type to satisfy that request,<br>      otherwise 0 is returned</p>
<p>  void pm_suspend_ignore_children(struct device *dev, bool enable);<br>    - set/unset the power.ignore_children flag of the device</p>
<p>  int pm_runtime_set_active(struct device *dev);<br>    - clear the device’s ‘power.runtime_error’ flag, set the device’s run-time<br>      PM status to ‘active’ and update its parent’s counter of ‘active’<br>      children as appropriate (it is only valid to use this function if<br>      ‘power.runtime_error’ is set or ‘power.disable_depth’ is greater than<br>      zero); it will fail and return error code if the device has a parent<br>      which is not active and the ‘power.ignore_children’ flag of which is unset</p>
<p>  void pm_runtime_set_suspended(struct device *dev);<br>    - clear the device’s ‘power.runtime_error’ flag, set the device’s run-time<br>      PM status to ‘suspended’ and update its parent’s counter of ‘active’<br>      children as appropriate (it is only valid to use this function if<br>      ‘power.runtime_error’ is set or ‘power.disable_depth’ is greater than<br>      zero)</p>
<p>It is safe to execute the following helper functions from interrupt context:</p>
<p>pm_request_idle()<br>pm_schedule_suspend()<br>pm_request_resume()<br>pm_runtime_get_noresume()<br>pm_runtime_get()<br>pm_runtime_put_noidle()<br>pm_runtime_put()<br>pm_suspend_ignore_children()<br>pm_runtime_set_active()<br>pm_runtime_set_suspended()<br>pm_runtime_enable()</p>
<ol start="5">
<li>Run-time PM Initialization, Device Probing and Removal</li>
</ol>
<p>Initially, the run-time PM is disabled for all devices, which means that the<br>majority of the run-time PM helper funtions described in Section 4 will return<br>-EAGAIN until pm_runtime_enable() is called for the device.</p>
<p>In addition to that, the initial run-time PM status of all devices is<br>‘suspended’, but it need not reflect the actual physical state of the device.<br>Thus, if the device is initially active (i.e. it is able to process I/O), its<br>run-time PM status must be changed to ‘active’, with the help of<br>pm_runtime_set_active(), before pm_runtime_enable() is called for the device.</p>
<p>However, if the device has a parent and the parent’s run-time PM is enabled,<br>calling pm_runtime_set_active() for the device will affect the parent, unless<br>the parent’s ‘power.ignore_children’ flag is set.  Namely, in that case the<br>parent won’t be able to suspend at run time, using the PM core’s helper<br>functions, as long as the child’s status is ‘active’, even if the child’s<br>run-time PM is still disabled (i.e. pm_runtime_enable() hasn’t been called for<br>the child yet or pm_runtime_disable() has been called for it).  For this reason,<br>once pm_runtime_set_active() has been called for the device, pm_runtime_enable()<br>should be called for it too as soon as reasonably possible or its run-time PM<br>status should be changed back to ‘suspended’ with the help of<br>pm_runtime_set_suspended().</p>
<p>If the default initial run-time PM status of the device (i.e. ‘suspended’)<br>reflects the actual state of the device, its bus type’s or its driver’s<br>-&gt;probe() callback will likely need to wake it up using one of the PM core’s<br>helper functions described in Section 4.  In that case, pm_runtime_resume()<br>should be used.  Of course, for this purpose the device’s run-time PM has to be<br>enabled earlier by calling pm_runtime_enable().</p>
<p>If the device bus type’s or driver’s -&gt;probe() or -&gt;remove() callback runs<br>pm_runtime_suspend() or pm_runtime_idle() or their asynchronous counterparts,<br>they will fail returning -EAGAIN, because the device’s usage counter is<br>incremented by the core before executing -&gt;probe() and -&gt;remove().  Still, it<br>may be desirable to suspend the device as soon as -&gt;probe() or -&gt;remove() has<br>finished, so the PM core uses pm_runtime_idle_sync() to invoke the device bus<br>type’s -&gt;runtime_idle() callback at that time.</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_runtime_pm/" title="Kernel-2.6.32-573.12.1.el6_runtime_p" target="_blank" rel="external">http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_runtime_pm/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_s390dbf/" title="Kernel-2.6.32-573.12.1.el6_s390dbf"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_rtc/" title="Kernel-2.6.32-573.12.1.el6_rtc"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>