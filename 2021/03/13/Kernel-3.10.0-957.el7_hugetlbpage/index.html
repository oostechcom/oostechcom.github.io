<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-3.10.0-957.el7_hugetlbpage | oosTech.com</title>
  <meta name="description" content="The intent of this file is to give a brief summary of hugetlbpage support inthe Linux kernel.  This support is built on top of multiple page size supportthat is provided by most modern architectures.">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-3.10.0-957.el7_hugetlbpage">
<meta property="og:url" content="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_hugetlbpage/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="The intent of this file is to give a brief summary of hugetlbpage support inthe Linux kernel.  This support is built on top of multiple page size supportthat is provided by most modern architectures.">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_hugetlbpage/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_mpc5200/" class="title">Kernel-3.10.0-957.el7_mpc5200</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_6pack/" class="title">Kernel-3.10.0-957.el7_6pack</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-3.10.0-957.el7_hugetlbpage" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-3.10.0-957.el7_hugetlbpage
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/03/13/Kernel-3.10.0-957.el7_hugetlbpage/" class="article-date">
	 published: <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
	</a>
</span>

        
	<a href="/2021/03/13/Kernel-3.10.0-957.el7_hugetlbpage/" class="article-date">
	   updated: <time datetime="2021-03-12T16:00:00.000Z" itemprop="dateUpdated">2021-03-13</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/03/13/Kernel-3.10.0-957.el7_hugetlbpage/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>The intent of this file is to give a brief summary of hugetlbpage support in<br>the Linux kernel.  This support is built on top of multiple page size support<br>that is provided by most modern architectures.  For example, i386<br>architecture supports 4K and 4M (2M in PAE mode) page sizes, ia64<br>architecture supports multiple page sizes 4K, 8K, 64K, 256K, 1M, 4M, 16M,<br>256M and ppc64 supports 4K and 16M.  A TLB is a cache of virtual-to-physical<br>translations.  Typically this is a very scarce resource on processor.<br>Operating systems try to make best use of limited number of TLB resources.<br>This optimization is more critical now as bigger and bigger physical memories<br>(several GBs) are more readily available.</p>
<p>Users can use the huge page support in Linux kernel by either using the mmap<br>system call or standard SYSV shared memory system calls (shmget, shmat).</p>
<p>First the Linux kernel needs to be built with the CONFIG_HUGETLBFS<br>(present under “File systems”) and CONFIG_HUGETLB_PAGE (selected<br>automatically when CONFIG_HUGETLBFS is selected) configuration<br>options.</p>
<p>The /proc/meminfo file provides information about the total number of<br>persistent hugetlb pages in the kernel’s huge page pool.  It also displays<br>information about the number of free, reserved and surplus huge pages and the<br>default huge page size.  The huge page size is needed for generating the<br>proper alignment and size of the arguments to system calls that map huge page<br>regions.</p>
<p>The output of “cat /proc/meminfo” will include lines like:</p>
<p>…..<br>HugePages_Total: vvv<br>HugePages_Free:  www<br>HugePages_Rsvd:  xxx<br>HugePages_Surp:  yyy<br>Hugepagesize:    zzz kB</p>
<p>where:<br>HugePages_Total is the size of the pool of huge pages.<br>HugePages_Free  is the number of huge pages in the pool that are not yet<br>                allocated.<br>HugePages_Rsvd  is short for “reserved,” and is the number of huge pages for<br>                which a commitment to allocate from the pool has been made,<br>                but no allocation has yet been made.  Reserved huge pages<br>                guarantee that an application will be able to allocate a<br>                huge page from the pool of huge pages at fault time.<br>HugePages_Surp  is short for “surplus,” and is the number of huge pages in<br>                the pool above the value in /proc/sys/vm/nr_hugepages. The<br>                maximum number of surplus huge pages is controlled by<br>                /proc/sys/vm/nr_overcommit_hugepages.</p>
<p>/proc/filesystems should also show a filesystem of type “hugetlbfs” configured<br>in the kernel.</p>
<p>/proc/sys/vm/nr_hugepages indicates the current number of “persistent” huge<br>pages in the kernel’s huge page pool.  “Persistent” huge pages will be<br>returned to the huge page pool when freed by a task.  A user with root<br>privileges can dynamically allocate more or free some persistent huge pages<br>by increasing or decreasing the value of ‘nr_hugepages’.</p>
<p>Pages that are used as huge pages are reserved inside the kernel and cannot<br>be used for other purposes.  Huge pages cannot be swapped out under<br>memory pressure.</p>
<p>Once a number of huge pages have been pre-allocated to the kernel huge page<br>pool, a user with appropriate privilege can use either the mmap system call<br>or shared memory system calls to use the huge pages.  See the discussion of<br>Using Huge Pages, below.</p>
<p>The administrator can allocate persistent huge pages on the kernel boot<br>command line by specifying the “hugepages=N” parameter, where ‘N’ = the<br>number of huge pages requested.  This is the most reliable method of<br>allocating huge pages as memory has not yet become fragmented.</p>
<p>Some platforms support multiple huge page sizes.  To allocate huge pages<br>of a specific size, one must precede the huge pages boot command parameters<br>with a huge page size selection parameter “hugepagesz=<size>“.  <size> must<br>be specified in bytes with optional scale suffix [kKmMgG].  The default huge<br>page size may be selected with the “default_hugepagesz=<size>“ boot parameter.</p>
<p>When multiple huge page sizes are supported, /proc/sys/vm/nr_hugepages<br>indicates the current number of pre-allocated huge pages of the default size.<br>Thus, one can use the following command to dynamically allocate/deallocate<br>default sized persistent huge pages:</p>
<pre><code>echo 20 &gt; /proc/sys/vm/nr_hugepages
</code></pre>
<p>This command will try to adjust the number of default sized huge pages in the<br>huge page pool to 20, allocating or freeing huge pages, as required.</p>
<p>On a NUMA platform, the kernel will attempt to distribute the huge page pool<br>over all the set of allowed nodes specified by the NUMA memory policy of the<br>task that modifies nr_hugepages.  The default for the allowed nodes–when the<br>task has default memory policy–is all on-line nodes with memory.  Allowed<br>nodes with insufficient available, contiguous memory for a huge page will be<br>silently skipped when allocating persistent huge pages.  See the discussion<br>below of the interaction of task memory policy, cpusets and per node attributes<br>with the allocation and freeing of persistent huge pages.</p>
<p>The success or failure of huge page allocation depends on the amount of<br>physically contiguous memory that is present in system at the time of the<br>allocation attempt.  If the kernel is unable to allocate huge pages from<br>some nodes in a NUMA system, it will attempt to make up the difference by<br>allocating extra pages on other nodes with sufficient available contiguous<br>memory, if any.</p>
<p>System administrators may want to put this command in one of the local rc<br>init files.  This will enable the kernel to allocate huge pages early in<br>the boot process when the possibility of getting physical contiguous pages<br>is still very high.  Administrators can verify the number of huge pages<br>actually allocated by checking the sysctl or meminfo.  To check the per node<br>distribution of huge pages in a NUMA system, use:</p>
<pre><code>cat /sys/devices/system/node/node*/meminfo | fgrep Huge
</code></pre>
<p>/proc/sys/vm/nr_overcommit_hugepages specifies how large the pool of<br>huge pages can grow, if more huge pages than /proc/sys/vm/nr_hugepages are<br>requested by applications.  Writing any non-zero value into this file<br>indicates that the hugetlb subsystem is allowed to try to obtain that<br>number of “surplus” huge pages from the kernel’s normal page pool, when the<br>persistent huge page pool is exhausted. As these surplus huge pages become<br>unused, they are freed back to the kernel’s normal page pool.</p>
<p>When increasing the huge page pool size via nr_hugepages, any existing surplus<br>pages will first be promoted to persistent huge pages.  Then, additional<br>huge pages will be allocated, if necessary and if possible, to fulfill<br>the new persistent huge page pool size.</p>
<p>The administrator may shrink the pool of persistent huge pages for<br>the default huge page size by setting the nr_hugepages sysctl to a<br>smaller value.  The kernel will attempt to balance the freeing of huge pages<br>across all nodes in the memory policy of the task modifying nr_hugepages.<br>Any free huge pages on the selected nodes will be freed back to the kernel’s<br>normal page pool.</p>
<p>Caveat: Shrinking the persistent huge page pool via nr_hugepages such that<br>it becomes less than the number of huge pages in use will convert the balance<br>of the in-use huge pages to surplus huge pages.  This will occur even if<br>the number of surplus pages it would exceed the overcommit value.  As long as<br>this condition holds–that is, until nr_hugepages+nr_overcommit_hugepages is<br>increased sufficiently, or the surplus huge pages go out of use and are freed–<br>no more surplus huge pages will be allowed to be allocated.</p>
<p>With support for multiple huge page pools at run-time available, much of<br>the huge page userspace interface in /proc/sys/vm has been duplicated in sysfs.<br>The /proc interfaces discussed above have been retained for backwards<br>compatibility. The root huge page control directory in sysfs is:</p>
<pre><code>/sys/kernel/mm/hugepages
</code></pre>
<p>For each huge page size supported by the running kernel, a subdirectory<br>will exist, of the form:</p>
<pre><code>hugepages-$&#123;size&#125;kB
</code></pre>
<p>Inside each of these directories, the same set of files will exist:</p>
<pre><code>nr_hugepages
nr_hugepages_mempolicy
nr_overcommit_hugepages
free_hugepages
resv_hugepages
surplus_hugepages
</code></pre>
<p>which function as described above for the default huge page-sized case.</p>
<p>Interaction of Task Memory Policy with Huge Page Allocation/Freeing</p>
<p>Whether huge pages are allocated and freed via the /proc interface or<br>the /sysfs interface using the nr_hugepages_mempolicy attribute, the NUMA<br>nodes from which huge pages are allocated or freed are controlled by the<br>NUMA memory policy of the task that modifies the nr_hugepages_mempolicy<br>sysctl or attribute.  When the nr_hugepages attribute is used, mempolicy<br>is ignored.</p>
<p>The recommended method to allocate or free huge pages to/from the kernel<br>huge page pool, using the nr_hugepages example above, is:</p>
<pre><code>numactl --interleave &lt;node-list&gt; echo 20 \
            &gt;/proc/sys/vm/nr_hugepages_mempolicy
</code></pre>
<p>or, more succinctly:</p>
<pre><code>numactl -m &lt;node-list&gt; echo 20 &gt;/proc/sys/vm/nr_hugepages_mempolicy
</code></pre>
<p>This will allocate or free abs(20 - nr_hugepages) to or from the nodes<br>specified in <node-list>, depending on whether number of persistent huge pages<br>is initially less than or greater than 20, respectively.  No huge pages will be<br>allocated nor freed on any node not included in the specified <node-list>.</p>
<p>When adjusting the persistent hugepage count via nr_hugepages_mempolicy, any<br>memory policy mode–bind, preferred, local or interleave–may be used.  The<br>resulting effect on persistent huge page allocation is as follows:</p>
<ol>
<li><p>Regardless of mempolicy mode [see Documentation/vm/numa_memory_policy.txt],<br>persistent huge pages will be distributed across the node or nodes<br>specified in the mempolicy as if “interleave” had been specified.<br>However, if a node in the policy does not contain sufficient contiguous<br>memory for a huge page, the allocation will not “fallback” to the nearest<br>neighbor node with sufficient contiguous memory.  To do this would cause<br>undesirable imbalance in the distribution of the huge page pool, or<br>possibly, allocation of persistent huge pages on nodes not allowed by<br>the task’s memory policy.</p>
</li>
<li><p>One or more nodes may be specified with the bind or interleave policy.<br>If more than one node is specified with the preferred policy, only the<br>lowest numeric id will be used.  Local policy will select the node where<br>the task is running at the time the nodes_allowed mask is constructed.<br>For local policy to be deterministic, the task must be bound to a cpu or<br>cpus in a single node.  Otherwise, the task could be migrated to some<br>other node at any time after launch and the resulting node will be<br>indeterminate.  Thus, local policy is not very useful for this purpose.<br>Any of the other mempolicy modes may be used to specify a single node.</p>
</li>
<li><p>The nodes allowed mask will be derived from any non-default task mempolicy,<br>whether this policy was set explicitly by the task itself or one of its<br>ancestors, such as numactl.  This means that if the task is invoked from a<br>shell with non-default policy, that policy will be used.  One can specify a<br>node list of “all” with numactl –interleave or –membind [-m] to achieve<br>interleaving over all nodes in the system or cpuset.</p>
</li>
<li><p>Any task mempolicy specifed–e.g., using numactl–will be constrained by<br>the resource limits of any cpuset in which the task runs.  Thus, there will<br>be no way for a task with non-default policy running in a cpuset with a<br>subset of the system nodes to allocate huge pages outside the cpuset<br>without first moving to a cpuset that contains all of the desired nodes.</p>
</li>
<li><p>Boot-time huge page allocation attempts to distribute the requested number<br>of huge pages over all on-lines nodes with memory.</p>
</li>
</ol>
<p>Per Node Hugepages Attributes</p>
<p>A subset of the contents of the root huge page control directory in sysfs,<br>described above, will be replicated under each the system device of each<br>NUMA node with memory in:</p>
<pre><code>/sys/devices/system/node/node[0-9]*/hugepages/
</code></pre>
<p>Under this directory, the subdirectory for each supported huge page size<br>contains the following attribute files:</p>
<pre><code>nr_hugepages
free_hugepages
surplus_hugepages
</code></pre>
<p>The free_’ and surplus_’ attribute files are read-only.  They return the number<br>of free and surplus [overcommitted] huge pages, respectively, on the parent<br>node.</p>
<p>The nr_hugepages attribute returns the total number of huge pages on the<br>specified node.  When this attribute is written, the number of persistent huge<br>pages on the parent node will be adjusted to the specified value, if sufficient<br>resources exist, regardless of the task’s mempolicy or cpuset constraints.</p>
<p>Note that the number of overcommit and reserve pages remain global quantities,<br>as we don’t know until fault time, when the faulting task’s mempolicy is<br>applied, from which node the huge page allocation will be attempted.</p>
<p>Using Huge Pages</p>
<p>If the user applications are going to request huge pages using mmap system<br>call, then it is required that system administrator mount a file system of<br>type hugetlbfs:</p>
<p>  mount -t hugetlbfs <br>    -o uid=<value>,gid=<value>,mode=<value>,size=<value>,nr_inodes=<value> <br>    none /mnt/huge</p>
<p>This command mounts a (pseudo) filesystem of type hugetlbfs on the directory<br>/mnt/huge.  Any files created on /mnt/huge uses huge pages.  The uid and gid<br>options sets the owner and group of the root of the file system.  By default<br>the uid and gid of the current process are taken.  The mode option sets the<br>mode of root of file system to value &amp; 0777.  This value is given in octal.<br>By default the value 0755 is picked. The size option sets the maximum value of<br>memory (huge pages) allowed for that filesystem (/mnt/huge). The size is<br>rounded down to HPAGE_SIZE.  The option nr_inodes sets the maximum number of<br>inodes that /mnt/huge can use.  If the size or nr_inodes option is not<br>provided on command line then no limits are set.  For size and nr_inodes<br>options, you can use [G|g]/[M|m]/[K|k] to represent giga/mega/kilo. For<br>example, size=2K has the same meaning as size=2048.</p>
<p>While read system calls are supported on files that reside on hugetlb<br>file systems, write system calls are not.</p>
<p>Regular chown, chgrp, and chmod commands (with right permissions) could be<br>used to change the file attributes on hugetlbfs.</p>
<p>Also, it is important to note that no such mount command is required if the<br>applications are going to use only shmat/shmget system calls or mmap with<br>MAP_HUGETLB.  Users who wish to use hugetlb page via shared memory segment<br>should be a member of a supplementary group and system admin needs to<br>configure that gid into /proc/sys/vm/hugetlb_shm_group.  It is possible for<br>same or different applications to use any combination of mmaps and shm*<br>calls, though the mount of filesystem will be required for using mmap calls<br>without MAP_HUGETLB.  For an example of how to use mmap with MAP_HUGETLB see<br>map_hugetlb.c.</p>
<hr>
<p>/*</p>
<ul>
<li>map_hugetlb: see tools/testing/selftests/vm/map_hugetlb.c</li>
<li>/</li>
</ul>
<hr>
<p>/*</p>
<ul>
<li>hugepage-shm:  see tools/testing/selftests/vm/hugepage-shm.c</li>
<li>/</li>
</ul>
<hr>
<p>/*</p>
<ul>
<li>hugepage-mmap:  see tools/testing/selftests/vm/hugepage-mmap.c</li>
<li>/</li>
</ul>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_hugetlbpage/" title="Kernel-3.10.0-957.el7_hugetlbpage" target="_blank" rel="external">http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_hugetlbpage/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/03/13/Kernel-3.10.0-957.el7_hugetlb/" title="Kernel-3.10.0-957.el7_hugetlb"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/03/13/Kernel-3.10.0-957.el7_hw_random/" title="Kernel-3.10.0-957.el7_hw_rando"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>