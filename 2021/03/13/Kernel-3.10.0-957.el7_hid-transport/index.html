<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-3.10.0-957.el7_hid-transport | oosTech.com</title>
  <meta name="description" content="HID I&#x2F;O Transport Drivers                      &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  The HID subsystem is independent of the underlying transport driver. Initially,only USB was supported,">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-3.10.0-957.el7_hid-transport">
<meta property="og:url" content="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_hid-transport/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="HID I&#x2F;O Transport Drivers                      &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  The HID subsystem is independent of the underlying transport driver. Initially,only USB was supported,">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_hid-transport/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_mpc5200/" class="title">Kernel-3.10.0-957.el7_mpc5200</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_6pack/" class="title">Kernel-3.10.0-957.el7_6pack</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HID-Bus"><span class="toc-number">1.</span> <span class="toc-text">HID Bus</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-Device-Setup"><span class="toc-number">1.1.</span> <span class="toc-text">1.1) Device Setup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-Transport-Driver-Requirements"><span class="toc-number">1.2.</span> <span class="toc-text">1.2) Transport Driver Requirements</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HID-API"><span class="toc-number">2.</span> <span class="toc-text">HID API</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-Initialization"><span class="toc-number">2.1.</span> <span class="toc-text">2.1) Initialization</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-hid-ll-driver-operations"><span class="toc-number">2.2.</span> <span class="toc-text">2.2) hid_ll_driver operations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Data-Path"><span class="toc-number">2.3.</span> <span class="toc-text">2.3) Data Path</span></a></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-3.10.0-957.el7_hid-transport" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-3.10.0-957.el7_hid-transport
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/03/13/Kernel-3.10.0-957.el7_hid-transport/" class="article-date">
	 published: <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
	</a>
</span>

        
	<a href="/2021/03/13/Kernel-3.10.0-957.el7_hid-transport/" class="article-date">
	   updated: <time datetime="2021-03-12T16:00:00.000Z" itemprop="dateUpdated">2021-03-13</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/03/13/Kernel-3.10.0-957.el7_hid-transport/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <pre><code>                      HID I/O Transport Drivers
                     ===========================
</code></pre>
<p>The HID subsystem is independent of the underlying transport driver. Initially,<br>only USB was supported, but other specifications adopted the HID design and<br>provided new transport drivers. The kernel includes at least support for USB,<br>Bluetooth, I2C and user-space I/O drivers.</p>
<ol>
<li><h1 id="HID-Bus"><a href="#HID-Bus" class="headerlink" title="HID Bus"></a>HID Bus</h1></li>
</ol>
<p>The HID subsystem is designed as a bus. Any I/O subsystem may provide HID<br>devices and register them with the HID bus. HID core then loads generic device<br>drivers on top of it. The transport drivers are responsible of raw data<br>transport and device setup/management. HID core is responsible of<br>report-parsing, report interpretation and the user-space API. Device specifics<br>and quirks are handled by all layers depending on the quirk.</p>
<p> +———–+  +———–+            +———–+  +———–+<br> | Device #1 |  | Device #i |            | Device #j |  | Device #k |<br> +———–+  +———–+            +———–+  +———–+<br>          \      //                              \      //<br>        +————+                          +————+<br>        | I/O Driver |                          | I/O Driver |<br>        +————+                          +————+<br>              ||                                      ||<br>     +——————+                    +——————+<br>     | Transport Driver |                    | Transport Driver |<br>     +——————+                    +——————+<br>                       ___                <strong><em>/<br>                           \              /<br>                          +—————-+<br>                          |    HID Core    |<br>                          +—————-+<br>                           /  |        |  <br>                          /   |        |   <br>             <strong><strong>____</strong></strong>/    |        |    ______________</em></strong><br>            /                 |        |                      <br>           /                  |        |                       <br> +—————-+  +———–+  +——————+  +——————+<br> | Generic Driver |  | MT Driver |  | Custom Driver #1 |  | Custom Driver #2 |<br> +—————-+  +———–+  +——————+  +——————+</p>
<p>Example Drivers:<br>  I/O: USB, I2C, Bluetooth-l2cap<br>  Transport: USB-HID, I2C-HID, BT-HIDP</p>
<p>Everything below “HID Core” is simplified in this graph as it is only of<br>interest to HID device drivers. Transport drivers do not need to know the<br>specifics.</p>
<h2 id="1-1-Device-Setup"><a href="#1-1-Device-Setup" class="headerlink" title="1.1) Device Setup"></a>1.1) Device Setup</h2><p>I/O drivers normally provide hotplug detection or device enumeration APIs to the<br>transport drivers. Transport drivers use this to find any suitable HID device.<br>They allocate HID device objects and register them with HID core. Transport<br>drivers are not required to register themselves with HID core. HID core is never<br>aware of which transport drivers are available and is not interested in it. It<br>is only interested in devices.</p>
<p>Transport drivers attach a constant “struct hid_ll_driver” object with each<br>device. Once a device is registered with HID core, the callbacks provided via<br>this struct are used by HID core to communicate with the device.</p>
<p>Transport drivers are responsible of detecting device failures and unplugging.<br>HID core will operate a device as long as it is registered regardless of any<br>device failures. Once transport drivers detect unplug or failure events, they<br>must unregister the device from HID core and HID core will stop using the<br>provided callbacks.</p>
<h2 id="1-2-Transport-Driver-Requirements"><a href="#1-2-Transport-Driver-Requirements" class="headerlink" title="1.2) Transport Driver Requirements"></a>1.2) Transport Driver Requirements</h2><p>The terms “asynchronous” and “synchronous” in this document describe the<br>transmission behavior regarding acknowledgements. An asynchronous channel must<br>not perform any synchronous operations like waiting for acknowledgements or<br>verifications. Generally, HID calls operating on asynchronous channels must be<br>running in atomic-context just fine.<br>On the other hand, synchronous channels can be implemented by the transport<br>driver in whatever way they like. They might just be the same as asynchronous<br>channels, but they can also provide acknowledgement reports, automatic<br>retransmission on failure, etc. in a blocking manner. If such functionality is<br>required on asynchronous channels, a transport-driver must implement that via<br>its own worker threads.</p>
<p>HID core requires transport drivers to follow a given design. A Transport<br>driver must provide two bi-directional I/O channels to each HID device. These<br>channels must not necessarily be bi-directional in the hardware itself. A<br>transport driver might just provide 4 uni-directional channels. Or it might<br>multiplex all four on a single physical channel. However, in this document we<br>will describe them as two bi-directional channels as they have several<br>properties in common.</p>
<ul>
<li>Interrupt Channel (intr): The intr channel is used for asynchronous data<br>reports. No management commands or data acknowledgements are sent on this<br>channel. Any unrequested incoming or outgoing data report must be sent on<br>this channel and is never acknowledged by the remote side. Devices usually<br>send their input events on this channel. Outgoing events are normally<br>not send via intr, except if high throughput is required.</li>
<li>Control Channel (ctrl): The ctrl channel is used for synchronous requests and<br>device management. Unrequested data input events must not be sent on this<br>channel and are normally ignored. Instead, devices only send management<br>events or answers to host requests on this channel.<br>The control-channel is used for direct blocking queries to the device<br>independent of any events on the intr-channel.<br>Outgoing reports are usually sent on the ctrl channel via synchronous<br>SET_REPORT requests.</li>
</ul>
<p>Communication between devices and HID core is mostly done via HID reports. A<br>report can be of one of three types:</p>
<ul>
<li>INPUT Report: Input reports provide data from device to host. This<br>data may include button events, axis events, battery status or more. This<br>data is generated by the device and sent to the host with or without<br>requiring explicit requests. Devices can choose to send data continuously or<br>only on change.</li>
<li>OUTPUT Report: Output reports change device states. They are sent from host<br>to device and may include LED requests, rumble requests or more. Output<br>reports are never sent from device to host, but a host can retrieve their<br>current state.<br>Hosts may choose to send output reports either continuously or only on<br>change.</li>
<li>FEATURE Report: Feature reports are used for specific static device features<br>and never reported spontaneously. A host can read and/or write them to access<br>data like battery-state or device-settings.<br>Feature reports are never sent without requests. A host must explicitly set<br>or retrieve a feature report. This also means, feature reports are never sent<br>on the intr channel as this channel is asynchronous.</li>
</ul>
<p>INPUT and OUTPUT reports can be sent as pure data reports on the intr channel.<br>For INPUT reports this is the usual operational mode. But for OUTPUT reports,<br>this is rarely done as OUTPUT reports are normally quite scarce. But devices are<br>free to make excessive use of asynchronous OUTPUT reports (for instance, custom<br>HID audio speakers make great use of it).</p>
<p>Plain reports must not be sent on the ctrl channel, though. Instead, the ctrl<br>channel provides synchronous GET/SET_REPORT requests. Plain reports are only<br>allowed on the intr channel and are the only means of data there.</p>
<ul>
<li>GET_REPORT: A GET_REPORT request has a report ID as payload and is sent<br>from host to device. The device must answer with a data report for the<br>requested report ID on the ctrl channel as a synchronous acknowledgement.<br>Only one GET_REPORT request can be pending for each device. This restriction<br>is enforced by HID core as several transport drivers don’t allow multiple<br>simultaneous GET_REPORT requests.<br>Note that data reports which are sent as answer to a GET_REPORT request are<br>not handled as generic device events. That is, if a device does not operate<br>in continuous data reporting mode, an answer to GET_REPORT does not replace<br>the raw data report on the intr channel on state change.<br>GET_REPORT is only used by custom HID device drivers to query device state.<br>Normally, HID core caches any device state so this request is not necessary<br>on devices that follow the HID specs except during device initialization to<br>retrieve the current state.<br>GET_REPORT requests can be sent for any of the 3 report types and shall<br>return the current report state of the device. However, OUTPUT reports as<br>payload may be blocked by the underlying transport driver if the<br>specification does not allow them.</li>
<li>SET_REPORT: A SET_REPORT request has a report ID plus data as payload. It is<br>sent from host to device and a device must update it’s current report state<br>according to the given data. Any of the 3 report types can be used. However,<br>INPUT reports as payload might be blocked by the underlying transport driver<br>if the specification does not allow them.<br>A device must answer with a synchronous acknowledgement. However, HID core<br>does not require transport drivers to forward this acknowledgement to HID<br>core.<br>Same as for GET_REPORT, only one SET_REPORT can be pending at a time. This<br>restriction is enforced by HID core as some transport drivers do not support<br>multiple synchronous SET_REPORT requests.</li>
</ul>
<p>Other ctrl-channel requests are supported by USB-HID but are not available<br>(or deprecated) in most other transport level specifications:</p>
<ul>
<li>GET/SET_IDLE: Only used by USB-HID and I2C-HID.</li>
<li>GET/SET_PROTOCOL: Not used by HID core.</li>
<li>RESET: Used by I2C-HID, not hooked up in HID core.</li>
<li>SET_POWER: Used by I2C-HID, not hooked up in HID core.</li>
</ul>
<ol start="2">
<li><h1 id="HID-API"><a href="#HID-API" class="headerlink" title="HID API"></a>HID API</h1></li>
</ol>
<h2 id="2-1-Initialization"><a href="#2-1-Initialization" class="headerlink" title="2.1) Initialization"></a>2.1) Initialization</h2><p>Transport drivers normally use the following procedure to register a new device<br>with HID core:</p>
<pre><code>struct hid_device *hid;
int ret;

hid = hid_allocate_device();
if (IS_ERR(hid)) &#123;
    ret = PTR_ERR(hid);
    goto err_&lt;...&gt;;
&#125;

strlcpy(hid-&gt;name, &lt;device-name-src&gt;, 127);
strlcpy(hid-&gt;phys, &lt;device-phys-src&gt;, 63);
strlcpy(hid-&gt;uniq, &lt;device-uniq-src&gt;, 63);

hid-&gt;ll_driver = &amp;custom_ll_driver;
hid-&gt;bus = &lt;device-bus&gt;;
hid-&gt;vendor = &lt;device-vendor&gt;;
hid-&gt;product = &lt;device-product&gt;;
hid-&gt;version = &lt;device-version&gt;;
hid-&gt;country = &lt;device-country&gt;;
hid-&gt;dev.parent = &lt;pointer-to-parent-device&gt;;
hid-&gt;driver_data = &lt;transport-driver-data-field&gt;;

ret = hid_add_device(hid);
if (ret)
    goto err_&lt;...&gt;;
</code></pre>
<p>Once hid_add_device() is entered, HID core might use the callbacks provided in<br>“custom_ll_driver”. Note that fields like “country” can be ignored by underlying<br>transport-drivers if not supported.</p>
<p>To unregister a device, use:</p>
<pre><code>hid_destroy_device(hid);
</code></pre>
<p>Once hid_destroy_device() returns, HID core will no longer make use of any<br>driver callbacks.</p>
<h2 id="2-2-hid-ll-driver-operations"><a href="#2-2-hid-ll-driver-operations" class="headerlink" title="2.2) hid_ll_driver operations"></a>2.2) hid_ll_driver operations</h2><p>The available HID callbacks are:</p>
<ul>
<li><p>int (*start) (struct hid_device *hdev)<br>Called from HID device drivers once they want to use the device. Transport<br>drivers can choose to setup their device in this callback. However, normally<br>devices are already set up before transport drivers register them to HID core<br>so this is mostly only used by USB-HID.</p>
</li>
<li><p>void (*stop) (struct hid_device *hdev)<br>Called from HID device drivers once they are done with a device. Transport<br>drivers can free any buffers and deinitialize the device. But note that<br>-&gt;start() might be called again if another HID device driver is loaded on the<br>device.<br>Transport drivers are free to ignore it and deinitialize devices after they<br>destroyed them via hid_destroy_device().</p>
</li>
<li><p>int (*open) (struct hid_device *hdev)<br>Called from HID device drivers once they are interested in data reports.<br>Usually, while user-space didn’t open any input API/etc., device drivers are<br>not interested in device data and transport drivers can put devices asleep.<br>However, once -&gt;open() is called, transport drivers must be ready for I/O.<br>-&gt;open() calls are nested for each client that opens the HID device.</p>
</li>
<li><p>void (*close) (struct hid_device *hdev)<br>Called from HID device drivers after -&gt;open() was called but they are no<br>longer interested in device reports. (Usually if user-space closed any input<br>devices of the driver).<br>Transport drivers can put devices asleep and terminate any I/O of all<br>-&gt;open() calls have been followed by a -&gt;close() call. However, -&gt;start() may<br>be called again if the device driver is interested in input reports again.</p>
</li>
<li><p>int (*parse) (struct hid_device *hdev)<br>Called once during device setup after -&gt;start() has been called. Transport<br>drivers must read the HID report-descriptor from the device and tell HID core<br>about it via hid_parse_report().</p>
</li>
<li><p>int (*power) (struct hid_device *hdev, int level)<br>Called by HID core to give PM hints to transport drivers. Usually this is<br>analogical to the -&gt;open() and -&gt;close() hints and redundant.</p>
</li>
<li><p>void (*request) (struct hid_device *hdev, struct hid_report *report,</p>
<pre><code>             int reqtype)
</code></pre>
<p>Send an HID request on the ctrl channel. “report” contains the report that<br>should be sent and “reqtype” the request type. Request-type can be<br>HID_REQ_SET_REPORT or HID_REQ_GET_REPORT.<br>This callback is optional. If not provided, HID core will assemble a raw<br>report following the HID specs and send it via the -&gt;raw_request() callback.<br>The transport driver is free to implement this asynchronously.</p>
</li>
<li><p>int (*wait) (struct hid_device *hdev)<br>Used by HID core before calling -&gt;request() again. A transport driver can use<br>it to wait for any pending requests to complete if only one request is<br>allowed at a time.</p>
</li>
<li><p>int (*raw_request) (struct hid_device *hdev, unsigned char reportnum,</p>
<pre><code>                __u8 *buf, size_t count, unsigned char rtype,
                int reqtype)
</code></pre>
<p>Same as -&gt;request() but provides the report as raw buffer. This request shall<br>be synchronous. A transport driver must not use -&gt;wait() to complete such<br>requests. This request is mandatory and hid core will reject the device if<br>it is missing.</p>
</li>
<li><p>int (*output_report) (struct hid_device *hdev, __u8 *buf, size_t len)<br>Send raw output report via intr channel. Used by some HID device drivers<br>which require high throughput for outgoing requests on the intr channel. This<br>must not cause SET_REPORT calls! This must be implemented as asynchronous<br>output report on the intr channel!</p>
</li>
<li><p>int (*idle) (struct hid_device *hdev, int report, int idle, int reqtype)<br>Perform SET/GET_IDLE request. Only used by USB-HID, do not implement!</p>
</li>
</ul>
<h2 id="2-3-Data-Path"><a href="#2-3-Data-Path" class="headerlink" title="2.3) Data Path"></a>2.3) Data Path</h2><p>Transport drivers are responsible of reading data from I/O devices. They must<br>handle any I/O-related state-tracking themselves. HID core does not implement<br>protocol handshakes or other management commands which can be required by the<br>given HID transport specification.</p>
<p>Every raw data packet read from a device must be fed into HID core via<br>hid_input_report(). You must specify the channel-type (intr or ctrl) and report<br>type (input/output/feature). Under normal conditions, only input reports are<br>provided via this API.</p>
<p>Responses to GET_REPORT requests via -&gt;request() must also be provided via this<br>API. Responses to -&gt;raw_request() are synchronous and must be intercepted by the<br>transport driver and not passed to hid_input_report().<br>Acknowledgements to SET_REPORT requests are not of interest to HID core.</p>
<hr>
<p>Written 2013, David Herrmann <a href="mailto:&#x64;&#104;&#46;&#x68;&#101;&#x72;&#114;&#109;&#x61;&#110;&#110;&#x40;&#103;&#x6d;&#97;&#105;&#108;&#x2e;&#x63;&#111;&#109;">&#x64;&#104;&#46;&#x68;&#101;&#x72;&#114;&#109;&#x61;&#110;&#110;&#x40;&#103;&#x6d;&#97;&#105;&#108;&#x2e;&#x63;&#111;&#109;</a></p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_hid-transport/" title="Kernel-3.10.0-957.el7_hid-transport" target="_blank" rel="external">http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_hid-transport/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/03/13/Kernel-3.10.0-957.el7_hid-sensor/" title="Kernel-3.10.0-957.el7_hid-sensor"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/03/13/Kernel-3.10.0-957.el7_hiddev/" title="Kernel-3.10.0-957.el7_hiddev"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>