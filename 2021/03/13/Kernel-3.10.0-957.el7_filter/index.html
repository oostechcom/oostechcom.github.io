<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-3.10.0-957.el7_filter | oosTech.com</title>
  <meta name="description" content="Linux Socket Filtering aka Berkeley Packet Filter (BPF)IntroductionLinux Socket Filtering (LSF) is derived from the Berkeley Packet Filter.Though there are some distinct differences between the BSD an">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-3.10.0-957.el7_filter">
<meta property="og:url" content="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_filter/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="Linux Socket Filtering aka Berkeley Packet Filter (BPF)IntroductionLinux Socket Filtering (LSF) is derived from the Berkeley Packet Filter.Though there are some distinct differences between the BSD an">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_filter/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a><span class="category-list-count">830</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_devices/" class="title">Kernel-2.6.32-573.12.1.el6_devices</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3c509/" class="title">Kernel-3.10.0-957.el7_3c509</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Linux-Socket-Filtering-aka-Berkeley-Packet-Filter-BPF"><span class="toc-number">1.</span> <span class="toc-text">Linux Socket Filtering aka Berkeley Packet Filter (BPF)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introduction"><span class="toc-number">1.1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Structure"><span class="toc-number">1.2.</span> <span class="toc-text">Structure</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example"><span class="toc-number">1.3.</span> <span class="toc-text">Example</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BPF-engine-and-instruction-set"><span class="toc-number">1.4.</span> <span class="toc-text">BPF engine and instruction set</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bpf-dbg"><span class="toc-number">2.</span> <span class="toc-text">.&#x2F;bpf_dbg</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JIT-compiler"><span class="toc-number">2.1.</span> <span class="toc-text">JIT compiler</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bpf-jit-disasm"><span class="toc-number">3.</span> <span class="toc-text">.&#x2F;bpf_jit_disasm</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bpf-jit-disasm-o"><span class="toc-number">4.</span> <span class="toc-text">.&#x2F;bpf_jit_disasm -o</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">4.1.</span> <span class="toc-text">Misc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Written-by"><span class="toc-number">4.2.</span> <span class="toc-text">Written by</span></a></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-3.10.0-957.el7_filter" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-3.10.0-957.el7_filter
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/03/13/Kernel-3.10.0-957.el7_filter/" class="article-date">
	 published: <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
	</a>
</span>

        
	<a href="/2021/03/13/Kernel-3.10.0-957.el7_filter/" class="article-date">
	   updated: <time datetime="2021-03-12T16:00:00.000Z" itemprop="dateUpdated">2021-03-13</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/03/13/Kernel-3.10.0-957.el7_filter/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="Linux-Socket-Filtering-aka-Berkeley-Packet-Filter-BPF"><a href="#Linux-Socket-Filtering-aka-Berkeley-Packet-Filter-BPF" class="headerlink" title="Linux Socket Filtering aka Berkeley Packet Filter (BPF)"></a>Linux Socket Filtering aka Berkeley Packet Filter (BPF)</h1><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Linux Socket Filtering (LSF) is derived from the Berkeley Packet Filter.<br>Though there are some distinct differences between the BSD and Linux<br>Kernel filtering, but when we speak of BPF or LSF in Linux context, we<br>mean the very same mechanism of filtering in the Linux kernel.</p>
<p>BPF allows a user-space program to attach a filter onto any socket and<br>allow or disallow certain types of data to come through the socket. LSF<br>follows exactly the same filter code structure as BSD’s BPF, so referring<br>to the BSD bpf.4 manpage is very helpful in creating filters.</p>
<p>On Linux, BPF is much simpler than on BSD. One does not have to worry<br>about devices or anything like that. You simply create your filter code,<br>send it to the kernel via the SO_ATTACH_FILTER option and if your filter<br>code passes the kernel check on it, you then immediately begin filtering<br>data on that socket.</p>
<p>You can also detach filters from your socket via the SO_DETACH_FILTER<br>option. This will probably not be used much since when you close a socket<br>that has a filter on it the filter is automagically removed. The other<br>less common case may be adding a different filter on the same socket where<br>you had another filter that is still running: the kernel takes care of<br>removing the old one and placing your new one in its place, assuming your<br>filter has passed the checks, otherwise if it fails the old filter will<br>remain on that socket.</p>
<p>SO_LOCK_FILTER option allows to lock the filter attached to a socket. Once<br>set, a filter cannot be removed or changed. This allows one process to<br>setup a socket, attach a filter, lock it then drop privileges and be<br>assured that the filter will be kept until the socket is closed.</p>
<p>The biggest user of this construct might be libpcap. Issuing a high-level<br>filter command like <code>tcpdump -i em1 port 22</code> passes through the libpcap<br>internal compiler that generates a structure that can eventually be loaded<br>via SO_ATTACH_FILTER to the kernel. <code>tcpdump -i em1 port 22 -ddd</code><br>displays what is being placed into this structure.</p>
<p>Although we were only speaking about sockets here, BPF in Linux is used<br>in many more places. There’s xt_bpf for netfilter, cls_bpf in the kernel<br>qdisc layer, SECCOMP-BPF (SECure COMPuting [1]), and lots of other places<br>such as team driver, PTP code, etc where BPF is being used.</p>
<p> [1] Documentation/prctl/seccomp_filter.txt</p>
<p>Original BPF paper:</p>
<p>Steven McCanne and Van Jacobson. 1993. The BSD packet filter: a new<br>architecture for user-level packet capture. In Proceedings of the<br>USENIX Winter 1993 Conference Proceedings on USENIX Winter 1993<br>Conference Proceedings (USENIX’93). USENIX Association, Berkeley,<br>CA, USA, 2-2. [<a target="_blank" rel="noopener" href="http://www.tcpdump.org/papers/bpf-usenix93.pdf]">http://www.tcpdump.org/papers/bpf-usenix93.pdf]</a></p>
<h2 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h2><p>User space applications include &lt;linux/filter.h&gt; which contains the<br>following relevant structures:</p>
<p>struct sock_filter {    /* Filter block <em>/<br>    __u16    code;   /</em> Actual filter code <em>/<br>    __u8    jt;    /</em> Jump true <em>/<br>    __u8    jf;    /</em> Jump false <em>/<br>    __u32    k;      /</em> Generic multiuse field */<br>};</p>
<p>Such a structure is assembled as an array of 4-tuples, that contains<br>a code, jt, jf and k value. jt and jf are jump offsets and k a generic<br>value to be used for a provided code.</p>
<p>struct sock_fprog {            /* Required for SO_ATTACH_FILTER. <em>/<br>    unsigned short           len;    /</em> Number of filter blocks */<br>    struct sock_filter __user *filter;<br>};</p>
<p>For socket filtering, a pointer to this structure (as shown in<br>follow-up example) is being passed to the kernel through setsockopt(2).</p>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><p>#include &lt;sys/socket.h&gt;<br>#include &lt;sys/types.h&gt;<br>#include &lt;arpa/inet.h&gt;<br>#include &lt;linux/if_ether.h&gt;<br>/* … */</p>
<p>/* From the example above: tcpdump -i em1 port 22 -dd */<br>struct sock_filter code[] = {<br>    { 0x28,  0,  0, 0x0000000c },<br>    { 0x15,  0,  8, 0x000086dd },<br>    { 0x30,  0,  0, 0x00000014 },<br>    { 0x15,  2,  0, 0x00000084 },<br>    { 0x15,  1,  0, 0x00000006 },<br>    { 0x15,  0, 17, 0x00000011 },<br>    { 0x28,  0,  0, 0x00000036 },<br>    { 0x15, 14,  0, 0x00000016 },<br>    { 0x28,  0,  0, 0x00000038 },<br>    { 0x15, 12, 13, 0x00000016 },<br>    { 0x15,  0, 12, 0x00000800 },<br>    { 0x30,  0,  0, 0x00000017 },<br>    { 0x15,  2,  0, 0x00000084 },<br>    { 0x15,  1,  0, 0x00000006 },<br>    { 0x15,  0,  8, 0x00000011 },<br>    { 0x28,  0,  0, 0x00000014 },<br>    { 0x45,  6,  0, 0x00001fff },<br>    { 0xb1,  0,  0, 0x0000000e },<br>    { 0x48,  0,  0, 0x0000000e },<br>    { 0x15,  2,  0, 0x00000016 },<br>    { 0x48,  0,  0, 0x00000010 },<br>    { 0x15,  0,  1, 0x00000016 },<br>    { 0x06,  0,  0, 0x0000ffff },<br>    { 0x06,  0,  0, 0x00000000 },<br>};</p>
<p>struct sock_fprog bpf = {<br>    .len = ARRAY_SIZE(code),<br>    .filter = code,<br>};</p>
<p>sock = socket(PF_PACKET, SOCK_RAW, htons(ETH_P_ALL));<br>if (sock &lt; 0)<br>    /* … bail out … */</p>
<p>ret = setsockopt(sock, SOL_SOCKET, SO_ATTACH_FILTER, &amp;bpf, sizeof(bpf));<br>if (ret &lt; 0)<br>    /* … bail out … */</p>
<p>/* … */<br>close(sock);</p>
<p>The above example code attaches a socket filter for a PF_PACKET socket<br>in order to let all IPv4/IPv6 packets with port 22 pass. The rest will<br>be dropped for this socket.</p>
<p>The setsockopt(2) call to SO_DETACH_FILTER doesn’t need any arguments<br>and SO_LOCK_FILTER for preventing the filter to be detached, takes an<br>integer value with 0 or 1.</p>
<p>Note that socket filters are not restricted to PF_PACKET sockets only,<br>but can also be used on other socket families.</p>
<p>Summary of system calls:</p>
<ul>
<li>setsockopt(sockfd, SOL_SOCKET, SO_ATTACH_FILTER, &amp;val, sizeof(val));</li>
<li>setsockopt(sockfd, SOL_SOCKET, SO_DETACH_FILTER, &amp;val, sizeof(val));</li>
<li>setsockopt(sockfd, SOL_SOCKET, SO_LOCK_FILTER,   &amp;val, sizeof(val));</li>
</ul>
<p>Normally, most use cases for socket filtering on packet sockets will be<br>covered by libpcap in high-level syntax, so as an application developer<br>you should stick to that. libpcap wraps its own layer around all that.</p>
<p>Unless i) using/linking to libpcap is not an option, ii) the required BPF<br>filters use Linux extensions that are not supported by libpcap’s compiler,<br>iii) a filter might be more complex and not cleanly implementable with<br>libpcap’s compiler, or iv) particular filter codes should be optimized<br>differently than libpcap’s internal compiler does; then in such cases<br>writing such a filter “by hand” can be of an alternative. For example,<br>xt_bpf and cls_bpf users might have requirements that could result in<br>more complex filter code, or one that cannot be expressed with libpcap<br>(e.g. different return codes for various code paths). Moreover, BPF JIT<br>implementors may wish to manually write test cases and thus need low-level<br>access to BPF code as well.</p>
<h2 id="BPF-engine-and-instruction-set"><a href="#BPF-engine-and-instruction-set" class="headerlink" title="BPF engine and instruction set"></a>BPF engine and instruction set</h2><p>Under tools/net/ there’s a small helper tool called bpf_asm which can<br>be used to write low-level filters for example scenarios mentioned in the<br>previous section. Asm-like syntax mentioned here has been implemented in<br>bpf_asm and will be used for further explanations (instead of dealing with<br>less readable opcodes directly, principles are the same). The syntax is<br>closely modelled after Steven McCanne’s and Van Jacobson’s BPF paper.</p>
<p>The BPF architecture consists of the following basic elements:</p>
<p>  Element          Description</p>
<p>  A                32 bit wide accumulator<br>  X                32 bit wide X register<br>  M[]              16 x 32 bit wide misc registers aka “scratch memory<br>                   store”, addressable from 0 to 15</p>
<p>A program, that is translated by bpf_asm into “opcodes” is an array that<br>consists of the following elements (as already mentioned):</p>
<p>  op:16, jt:8, jf:8, k:32</p>
<p>The element op is a 16 bit wide opcode that has a particular instruction<br>encoded. jt and jf are two 8 bit wide jump targets, one for condition<br>“jump if true”, the other one “jump if false”. Eventually, element k<br>contains a miscellaneous argument that can be interpreted in different<br>ways depending on the given instruction in op.</p>
<p>The instruction set consists of load, store, branch, alu, miscellaneous<br>and return instructions that are also represented in bpf_asm syntax. This<br>table lists all bpf_asm instructions available resp. what their underlying<br>opcodes as defined in linux/filter.h stand for:</p>
<p>  Instruction      Addressing mode      Description</p>
<p>  ld               1, 2, 3, 4, 10       Load word into A<br>  ldi              4                    Load word into A<br>  ldh              1, 2                 Load half-word into A<br>  ldb              1, 2                 Load byte into A<br>  ldx              3, 4, 5, 10          Load word into X<br>  ldxi             4                    Load word into X<br>  ldxb             5                    Load byte into X</p>
<p>  st               3                    Store A into M[]<br>  stx              3                    Store X into M[]</p>
<p>  jmp              6                    Jump to label<br>  ja               6                    Jump to label<br>  jeq              7, 8                 Jump on k == A<br>  jneq             8                    Jump on k != A<br>  jne              8                    Jump on k != A<br>  jlt              8                    Jump on k &lt; A<br>  jle              8                    Jump on k &lt;= A<br>  jgt              7, 8                 Jump on k &gt; A<br>  jge              7, 8                 Jump on k &gt;= A<br>  jset             7, 8                 Jump on k &amp; A</p>
<p>  add              0, 4                 A + <x><br>  sub              0, 4                 A - <x><br>  mul              0, 4                 A * <x><br>  div              0, 4                 A / <x><br>  mod              0, 4                 A % <x><br>  neg              0, 4                 !A<br>  and              0, 4                 A &amp; <x><br>  or               0, 4                 A | <x><br>  xor              0, 4                 A ^ <x><br>  lsh              0, 4                 A &lt;&lt; <x><br>  rsh              0, 4                 A &gt;&gt; <x></p>
<p>  tax                                   Copy A into X<br>  txa                                   Copy X into A</p>
<p>  ret              4, 9                 Return</p>
<p>The next table shows addressing formats from the 2nd column:</p>
<p>  Addressing mode  Syntax               Description</p>
<p>   0               x/%x                 Register X<br>   1               [k]                  BHW at byte offset k in the packet<br>   2               [x + k]              BHW at the offset X + k in the packet<br>   3               M[k]                 Word at offset k in M[]<br>   4               #k                   Literal value stored in k<br>   5               4*([k]&amp;0xf)          Lower nibble * 4 at byte offset k in the packet<br>   6               L                    Jump label L<br>   7               #k,Lt,Lf             Jump to Lt if true, otherwise jump to Lf<br>   8               #k,Lt                Jump to Lt if predicate is true<br>   9               a/%a                 Accumulator A<br>  10               extension            BPF extension</p>
<p>The Linux kernel also has a couple of BPF extensions that are used along<br>with the class of load instructions by “overloading” the k argument with<br>a negative offset + a particular extension offset. The result of such BPF<br>extensions are loaded into A.</p>
<p>Possible BPF extensions are shown in the following table:</p>
<p>  Extension                             Description</p>
<p>  len                                   skb-&gt;len<br>  proto                                 skb-&gt;protocol<br>  type                                  skb-&gt;pkt_type<br>  poff                                  Payload start offset<br>  ifidx                                 skb-&gt;dev-&gt;ifindex<br>  nla                                   Netlink attribute of type X with offset A<br>  nlan                                  Nested Netlink attribute of type X with offset A<br>  mark                                  skb-&gt;mark<br>  queue                                 skb-&gt;queue_mapping<br>  hatype                                skb-&gt;dev-&gt;type<br>  rxhash                                skb-&gt;rxhash<br>  cpu                                   raw_smp_processor_id()<br>  vlan_tci                              skb_vlan_tag_get(skb)<br>  vlan_pr                               skb_vlan_tag_present(skb)</p>
<p>These extensions can also be prefixed with ‘#’.<br>Examples for low-level BPF:</p>
<p>** ARP packets:</p>
<p>  ldh [12]<br>  jne #0x806, drop<br>  ret #-1<br>  drop: ret #0</p>
<p>** IPv4 TCP packets:</p>
<p>  ldh [12]<br>  jne #0x800, drop<br>  ldb [23]<br>  jneq #6, drop<br>  ret #-1<br>  drop: ret #0</p>
<p>** (Accelerated) VLAN w/ id 10:</p>
<p>  ld vlan_tci<br>  jneq #10, drop<br>  ret #-1<br>  drop: ret #0</p>
<p>** SECCOMP filter example:</p>
<p>  ld [4]                  /* offsetof(struct seccomp_data, arch) <em>/<br>  jne #0xc000003e, bad    /</em> AUDIT_ARCH_X86_64 <em>/<br>  ld [0]                  /</em> offsetof(struct seccomp_data, nr) <em>/<br>  jeq #15, good           /</em> __NR_rt_sigreturn <em>/<br>  jeq #231, good          /</em> __NR_exit_group <em>/<br>  jeq #60, good           /</em> __NR_exit <em>/<br>  jeq #0, good            /</em> __NR_read <em>/<br>  jeq #1, good            /</em> __NR_write <em>/<br>  jeq #5, good            /</em> __NR_fstat <em>/<br>  jeq #9, good            /</em> __NR_mmap <em>/<br>  jeq #14, good           /</em> __NR_rt_sigprocmask <em>/<br>  jeq #13, good           /</em> __NR_rt_sigaction <em>/<br>  jeq #35, good           /</em> __NR_nanosleep <em>/<br>  bad: ret #0             /</em> SECCOMP_RET_KILL <em>/<br>  good: ret #0x7fff0000   /</em> SECCOMP_RET_ALLOW */</p>
<p>The above example code can be placed into a file (here called “foo”), and<br>then be passed to the bpf_asm tool for generating opcodes, output that xt_bpf<br>and cls_bpf understands and can directly be loaded with. Example with above<br>ARP code:</p>
<p>$ ./bpf_asm foo<br>4,40 0 0 12,21 0 1 2054,6 0 0 4294967295,6 0 0 0,</p>
<p>In copy and paste C-like output:</p>
<p>$ ./bpf_asm -c foo<br>{ 0x28,  0,  0, 0x0000000c },<br>{ 0x15,  0,  1, 0x00000806 },<br>{ 0x06,  0,  0, 0xffffffff },<br>{ 0x06,  0,  0, 0000000000 },</p>
<p>In particular, as usage with xt_bpf or cls_bpf can result in more complex BPF<br>filters that might not be obvious at first, it’s good to test filters before<br>attaching to a live system. For that purpose, there’s a small tool called<br>bpf_dbg under tools/net/ in the kernel source directory. This debugger allows<br>for testing BPF filters against given pcap files, single stepping through the<br>BPF code on the pcap’s packets and to do BPF machine register dumps.</p>
<p>Starting bpf_dbg is trivial and just requires issuing:</p>
<h1 id="bpf-dbg"><a href="#bpf-dbg" class="headerlink" title="./bpf_dbg"></a>./bpf_dbg</h1><p>In case input and output do not equal stdin/stdout, bpf_dbg takes an<br>alternative stdin source as a first argument, and an alternative stdout<br>sink as a second one, e.g. <code>./bpf_dbg test_in.txt test_out.txt</code>.</p>
<p>Other than that, a particular libreadline configuration can be set via<br>file “<del>/.bpf_dbg_init” and the command history is stored in the file<br>“</del>/.bpf_dbg_history”.</p>
<p>Interaction in bpf_dbg happens through a shell that also has auto-completion<br>support (follow-up example commands starting with ‘&gt;’ denote bpf_dbg shell).<br>The usual workflow would be to …</p>
<blockquote>
<p>load bpf 6,40 0 0 12,21 0 3 2048,48 0 0 23,21 0 1 1,6 0 0 65535,6 0 0 0<br>  Loads a BPF filter from standard output of bpf_asm, or transformed via<br>  e.g. <code>tcpdump -iem1 -ddd port 22 | tr &#39;\n&#39; &#39;,&#39;</code>. Note that for JIT<br>  debugging (next section), this command creates a temporary socket and<br>  loads the BPF code into the kernel. Thus, this will also be useful for<br>  JIT developers.</p>
</blockquote>
<blockquote>
<p>load pcap foo.pcap<br>  Loads standard tcpdump pcap file.</p>
</blockquote>
<blockquote>
<p>run [<n>]<br>bpf passes:1 fails:9<br>  Runs through all packets from a pcap to account how many passes and fails<br>  the filter will generate. A limit of packets to traverse can be given.</p>
</blockquote>
<blockquote>
<p>disassemble<br>l0:    ldh [12]<br>l1:    jeq #0x800, l2, l5<br>l2:    ldb [23]<br>l3:    jeq #0x1, l4, l5<br>l4:    ret #0xffff<br>l5:    ret #0<br>  Prints out BPF code disassembly.</p>
</blockquote>
<blockquote>
<p>dump<br>/* { op, jt, jf, k }, */<br>{ 0x28,  0,  0, 0x0000000c },<br>{ 0x15,  0,  3, 0x00000800 },<br>{ 0x30,  0,  0, 0x00000017 },<br>{ 0x15,  0,  1, 0x00000001 },<br>{ 0x06,  0,  0, 0x0000ffff },<br>{ 0x06,  0,  0, 0000000000 },<br>  Prints out C-style BPF code dump.</p>
</blockquote>
<blockquote>
<p>breakpoint 0<br>breakpoint at: l0:    ldh [12]<br>breakpoint 1<br>breakpoint at: l1:    jeq #0x800, l2, l5<br>  …<br>  Sets breakpoints at particular BPF instructions. Issuing a <code>run</code> command<br>  will walk through the pcap file continuing from the current packet and<br>  break when a breakpoint is being hit (another <code>run</code> will continue from<br>  the currently active breakpoint executing next instructions):</p>
</blockquote>
<blockquote>
<p>run<br>  – register dump –<br>  pc:       [0]                       &lt;– program counter<br>  code:     [40] jt[0] jf[0] k[12]    &lt;– plain BPF code of current instruction<br>  curr:     l0:    ldh [12]              &lt;– disassembly of current instruction<br>  A:        [00000000][0]             &lt;– content of A (hex, decimal)<br>  X:        [00000000][0]             &lt;– content of X (hex, decimal)<br>  M[0,15]:  [00000000][0]             &lt;– folded content of M (hex, decimal)<br>  – packet dump –                   &lt;– Current packet from pcap (hex)<br>  len: 42<br>    0: 00 19 cb 55 55 a4 00 14 a4 43 78 69 08 06 00 01<br>   16: 08 00 06 04 00 01 00 14 a4 43 78 69 0a 3b 01 26<br>   32: 00 00 00 00 00 00 0a 3b 01 01<br>  (breakpoint)</p>
</blockquote>
<blockquote>
<p>breakpoint<br>breakpoints: 0 1<br>  Prints currently set breakpoints.</p>
</blockquote>
<blockquote>
<p>step [-<n>, +<n>]<br>  Performs single stepping through the BPF program from the current pc<br>  offset. Thus, on each step invocation, above register dump is issued.<br>  This can go forwards and backwards in time, a plain <code>step</code> will break<br>  on the next BPF instruction, thus +1. (No <code>run</code> needs to be issued here.)</p>
</blockquote>
<blockquote>
<p>select <n><br>  Selects a given packet from the pcap file to continue from. Thus, on<br>  the next <code>run</code> or <code>step</code>, the BPF program is being evaluated against<br>  the user pre-selected packet. Numbering starts just as in Wireshark<br>  with index 1.</p>
</blockquote>
<blockquote>
<p>quit<br>#<br>  Exits bpf_dbg.</p>
</blockquote>
<h2 id="JIT-compiler"><a href="#JIT-compiler" class="headerlink" title="JIT compiler"></a>JIT compiler</h2><p>The Linux kernel has a built-in BPF JIT compiler for x86_64, SPARC, PowerPC,<br>ARM and s390 and can be enabled through CONFIG_BPF_JIT. The JIT compiler is<br>transparently invoked for each attached filter from user space or for internal<br>kernel users if it has been previously enabled by root:</p>
<p>  echo 1 &gt; /proc/sys/net/core/bpf_jit_enable</p>
<p>For JIT developers, doing audits etc, each compile run can output the generated<br>opcode image into the kernel log via:</p>
<p>  echo 2 &gt; /proc/sys/net/core/bpf_jit_enable</p>
<p>Example output from dmesg:</p>
<p>[ 3389.935842] flen=6 proglen=70 pass=3 image=ffffffffa0069c8f<br>[ 3389.935847] JIT code: 00000000: 55 48 89 e5 48 83 ec 60 48 89 5d f8 44 8b 4f 68<br>[ 3389.935849] JIT code: 00000010: 44 2b 4f 6c 4c 8b 87 d8 00 00 00 be 0c 00 00 00<br>[ 3389.935850] JIT code: 00000020: e8 1d 94 ff e0 3d 00 08 00 00 75 16 be 17 00 00<br>[ 3389.935851] JIT code: 00000030: 00 e8 28 94 ff e0 83 f8 01 75 07 b8 ff ff 00 00<br>[ 3389.935852] JIT code: 00000040: eb 02 31 c0 c9 c3</p>
<p>In the kernel source tree under tools/net/, there’s bpf_jit_disasm for<br>generating disassembly out of the kernel log’s hexdump:</p>
<h1 id="bpf-jit-disasm"><a href="#bpf-jit-disasm" class="headerlink" title="./bpf_jit_disasm"></a>./bpf_jit_disasm</h1><p>70 bytes emitted from JIT compiler (pass:3, flen:6)<br>ffffffffa0069c8f + <x>:<br>   0:    push   %rbp<br>   1:    mov    %rsp,%rbp<br>   4:    sub    $0x60,%rsp<br>   8:    mov    %rbx,-0x8(%rbp)<br>   c:    mov    0x68(%rdi),%r9d<br>  10:    sub    0x6c(%rdi),%r9d<br>  14:    mov    0xd8(%rdi),%r8<br>  1b:    mov    $0xc,%esi<br>  20:    callq  0xffffffffe0ff9442<br>  25:    cmp    $0x800,%eax<br>  2a:    jne    0x0000000000000042<br>  2c:    mov    $0x17,%esi<br>  31:    callq  0xffffffffe0ff945e<br>  36:    cmp    $0x1,%eax<br>  39:    jne    0x0000000000000042<br>  3b:    mov    $0xffff,%eax<br>  40:    jmp    0x0000000000000044<br>  42:    xor    %eax,%eax<br>  44:    leaveq<br>  45:    retq</p>
<p>Issuing option <code>-o</code> will “annotate” opcodes to resulting assembler<br>instructions, which can be very useful for JIT developers:</p>
<h1 id="bpf-jit-disasm-o"><a href="#bpf-jit-disasm-o" class="headerlink" title="./bpf_jit_disasm -o"></a>./bpf_jit_disasm -o</h1><p>70 bytes emitted from JIT compiler (pass:3, flen:6)<br>ffffffffa0069c8f + <x>:<br>   0:    push   %rbp<br>    55<br>   1:    mov    %rsp,%rbp<br>    48 89 e5<br>   4:    sub    $0x60,%rsp<br>    48 83 ec 60<br>   8:    mov    %rbx,-0x8(%rbp)<br>    48 89 5d f8<br>   c:    mov    0x68(%rdi),%r9d<br>    44 8b 4f 68<br>  10:    sub    0x6c(%rdi),%r9d<br>    44 2b 4f 6c<br>  14:    mov    0xd8(%rdi),%r8<br>    4c 8b 87 d8 00 00 00<br>  1b:    mov    $0xc,%esi<br>    be 0c 00 00 00<br>  20:    callq  0xffffffffe0ff9442<br>    e8 1d 94 ff e0<br>  25:    cmp    $0x800,%eax<br>    3d 00 08 00 00<br>  2a:    jne    0x0000000000000042<br>    75 16<br>  2c:    mov    $0x17,%esi<br>    be 17 00 00 00<br>  31:    callq  0xffffffffe0ff945e<br>    e8 28 94 ff e0<br>  36:    cmp    $0x1,%eax<br>    83 f8 01<br>  39:    jne    0x0000000000000042<br>    75 07<br>  3b:    mov    $0xffff,%eax<br>    b8 ff ff 00 00<br>  40:    jmp    0x0000000000000044<br>    eb 02<br>  42:    xor    %eax,%eax<br>    31 c0<br>  44:    leaveq<br>    c9<br>  45:    retq<br>    c3</p>
<p>For BPF JIT developers, bpf_jit_disasm, bpf_asm and bpf_dbg provides a useful<br>toolchain for developing and testing the kernel’s JIT compiler.</p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><p>Also trinity, the Linux syscall fuzzer, has built-in support for BPF and<br>SECCOMP-BPF kernel fuzzing.</p>
<h2 id="Written-by"><a href="#Written-by" class="headerlink" title="Written by"></a>Written by</h2><p>The document was written in the hope that it is found useful and in order<br>to give potential BPF hackers or security auditors a better overview of<br>the underlying architecture.</p>
<p>Jay Schulist <a href="mailto:&#x6a;&#115;&#99;&#x68;&#108;&#x73;&#116;&#64;&#x73;&#x61;&#x6d;&#x62;&#x61;&#46;&#111;&#x72;&#x67;">&#x6a;&#115;&#99;&#x68;&#108;&#x73;&#116;&#64;&#x73;&#x61;&#x6d;&#x62;&#x61;&#46;&#111;&#x72;&#x67;</a><br>Daniel Borkmann <a href="mailto:&#100;&#x62;&#x6f;&#114;&#x6b;&#109;&#97;&#110;&#x40;&#x72;&#x65;&#x64;&#104;&#x61;&#x74;&#46;&#x63;&#111;&#109;">&#100;&#x62;&#x6f;&#114;&#x6b;&#109;&#97;&#110;&#x40;&#x72;&#x65;&#x64;&#104;&#x61;&#x74;&#46;&#x63;&#111;&#109;</a></p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_filter/" title="Kernel-3.10.0-957.el7_filter" target="_blank" rel="external">http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_filter/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/03/13/Kernel-3.10.0-957.el7_fscache/" title="Kernel-3.10.0-957.el7_fscache"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/03/13/Kernel-3.10.0-957.el7_f2fs/" title="Kernel-3.10.0-957.el7_f2fs"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>