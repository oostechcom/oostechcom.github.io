<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-2.6.32-573.12.1.el6_Smack | oosTech.com</title>
  <meta name="description" content="&quot;Good for you, you&#39;ve decided to clean the elevator!&quot; - The Elevator, from Dark Star  Smack is the the Simplified Mandatory Access Control Kernel.Smack is a kernel based implementation o">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-2.6.32-573.12.1.el6_Smack">
<meta property="og:url" content="http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_Smack/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="&quot;Good for you, you&#39;ve decided to clean the elevator!&quot; - The Elevator, from Dark Star  Smack is the the Simplified Mandatory Access Control Kernel.Smack is a kernel based implementation o">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_Smack/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a><span class="category-list-count">830</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_devices/" class="title">Kernel-2.6.32-573.12.1.el6_devices</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3c509/" class="title">Kernel-3.10.0-957.el7_3c509</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-2.6.32-573.12.1.el6_Smack" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-2.6.32-573.12.1.el6_Smack
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_Smack/" class="article-date">
	 published: <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
	</a>
</span>

        
	<a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_Smack/" class="article-date">
	   updated: <time datetime="2021-03-12T16:00:00.000Z" itemprop="dateUpdated">2021-03-13</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_Smack/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <pre><code>&quot;Good for you, you&#39;ve decided to clean the elevator!&quot;
- The Elevator, from Dark Star
</code></pre>
<p>Smack is the the Simplified Mandatory Access Control Kernel.<br>Smack is a kernel based implementation of mandatory access<br>control that includes simplicity in its primary design goals.</p>
<p>Smack is not the only Mandatory Access Control scheme<br>available for Linux. Those new to Mandatory Access Control<br>are encouraged to compare Smack with the other mechanisms<br>available to determine which is best suited to the problem<br>at hand.</p>
<p>Smack consists of three major components:<br>    - The kernel<br>    - A start-up script and a few modified applications<br>    - Configuration data</p>
<p>The kernel component of Smack is implemented as a Linux<br>Security Modules (LSM) module. It requires netlabel and<br>works best with file systems that support extended attributes,<br>although xattr support is not strictly required.<br>It is safe to run a Smack kernel under a “vanilla” distribution.<br>Smack kernels use the CIPSO IP option. Some network<br>configurations are intolerant of IP options and can impede<br>access to systems that use them as Smack does.</p>
<p>The startup script etc-init.d-smack should be installed<br>in /etc/init.d/smack and should be invoked early in the<br>start-up process. On Fedora rc5.d/S02smack is recommended.<br>This script ensures that certain devices have the correct<br>Smack attributes and loads the Smack configuration if<br>any is defined. This script invokes two programs that<br>ensure configuration data is properly formatted. These<br>programs are /usr/sbin/smackload and /usr/sin/smackcipso.<br>The system will run just fine without these programs,<br>but it will be difficult to set access rules properly.</p>
<p>A version of “ls” that provides a “-M” option to display<br>Smack labels on long listing is available.</p>
<p>A hacked version of sshd that allows network logins by users<br>with specific Smack labels is available. This version does<br>not work for scp. You must set the /etc/ssh/sshd_config<br>line:<br>   UsePrivilegeSeparation no</p>
<p>The format of /etc/smack/usr is:</p>
<p>   username smack</p>
<p>In keeping with the intent of Smack, configuration data is<br>minimal and not strictly required. The most important<br>configuration step is mounting the smackfs pseudo filesystem.</p>
<p>Add this line to /etc/fstab:</p>
<pre><code>smackfs /smack smackfs smackfsdef=* 0 0
</code></pre>
<p>and create the /smack directory for mounting.</p>
<p>Smack uses extended attributes (xattrs) to store file labels.<br>The command to set a Smack label on a file is:</p>
<pre><code># attr -S -s SMACK64 -V &quot;value&quot; path
</code></pre>
<p>NOTE: Smack labels are limited to 23 characters. The attr command<br>      does not enforce this restriction and can be used to set<br>      invalid Smack labels on files.</p>
<p>If you don’t do anything special all users will get the floor (“_”)<br>label when they log in. If you do want to log in via the hacked ssh<br>at other labels use the attr command to set the smack value on the<br>home directory and it’s contents.</p>
<p>You can add access rules in /etc/smack/accesses. They take the form:</p>
<pre><code>subjectlabel objectlabel access
</code></pre>
<p>access is a combination of the letters rwxa which specify the<br>kind of access permitted a subject with subjectlabel on an<br>object with objectlabel. If there is no rule no access is allowed.</p>
<p>A process can see the smack label it is running with by<br>reading /proc/self/attr/current. A privileged process can<br>set the process smack by writing there.</p>
<p>Look for additional programs on <a target="_blank" rel="noopener" href="http://schaufler-ca.com/">http://schaufler-ca.com</a></p>
<p>From the Smack Whitepaper:</p>
<p>The Simplified Mandatory Access Control Kernel</p>
<p>Casey Schaufler<br><a href="mailto:&#x63;&#97;&#x73;&#101;&#x79;&#x40;&#115;&#x63;&#x68;&#97;&#117;&#102;&#108;&#101;&#x72;&#x2d;&#99;&#97;&#46;&#x63;&#111;&#x6d;">&#x63;&#97;&#x73;&#101;&#x79;&#x40;&#115;&#x63;&#x68;&#97;&#117;&#102;&#108;&#101;&#x72;&#x2d;&#99;&#97;&#46;&#x63;&#111;&#x6d;</a></p>
<p>Mandatory Access Control</p>
<p>Computer systems employ a variety of schemes to constrain how information is<br>shared among the people and services using the machine. Some of these schemes<br>allow the program or user to decide what other programs or users are allowed<br>access to pieces of data. These schemes are called discretionary access<br>control mechanisms because the access control is specified at the discretion<br>of the user. Other schemes do not leave the decision regarding what a user or<br>program can access up to users or programs. These schemes are called mandatory<br>access control mechanisms because you don’t have a choice regarding the users<br>or programs that have access to pieces of data.</p>
<p>Bell &amp; LaPadula</p>
<p>From the middle of the 1980’s until the turn of the century Mandatory Access<br>Control (MAC) was very closely associated with the Bell &amp; LaPadula security<br>model, a mathematical description of the United States Department of Defense<br>policy for marking paper documents. MAC in this form enjoyed a following<br>within the Capital Beltway and Scandinavian supercomputer centers but was<br>often sited as failing to address general needs.</p>
<p>Domain Type Enforcement</p>
<p>Around the turn of the century Domain Type Enforcement (DTE) became popular.<br>This scheme organizes users, programs, and data into domains that are<br>protected from each other. This scheme has been widely deployed as a component<br>of popular Linux distributions. The administrative overhead required to<br>maintain this scheme and the detailed understanding of the whole system<br>necessary to provide a secure domain mapping leads to the scheme being<br>disabled or used in limited ways in the majority of cases.</p>
<p>Smack</p>
<p>Smack is a Mandatory Access Control mechanism designed to provide useful MAC<br>while avoiding the pitfalls of its predecessors. The limitations of Bell &amp;<br>LaPadula are addressed by providing a scheme whereby access can be controlled<br>according to the requirements of the system and its purpose rather than those<br>imposed by an arcane government policy. The complexity of Domain Type<br>Enforcement and avoided by defining access controls in terms of the access<br>modes already in use.</p>
<p>Smack Terminology</p>
<p>The jargon used to talk about Smack will be familiar to those who have dealt<br>with other MAC systems and shouldn’t be too difficult for the uninitiated to<br>pick up. There are four terms that are used in a specific way and that are<br>especially important:</p>
<pre><code>Subject: A subject is an active entity on the computer system.
On Smack a subject is a task, which is in turn the basic unit
of execution.

Object: An object is a passive entity on the computer system.
On Smack files of all types, IPC, and tasks can be objects.

Access: Any attempt by a subject to put information into or get
information from an object is an access.

Label: Data that identifies the Mandatory Access Control
characteristics of a subject or an object.
</code></pre>
<p>These definitions are consistent with the traditional use in the security<br>community. There are also some terms from Linux that are likely to crop up:</p>
<pre><code>Capability: A task that possesses a capability has permission to
violate an aspect of the system security policy, as identified by
the specific capability. A task that possesses one or more
capabilities is a privileged task, whereas a task with no
capabilities is an unprivileged task.

Privilege: A task that is allowed to violate the system security
policy is said to have privilege. As of this writing a task can
have privilege either by possessing capabilities or by having an
effective user of root.
</code></pre>
<p>Smack Basics</p>
<p>Smack is an extension to a Linux system. It enforces additional restrictions<br>on what subjects can access which objects, based on the labels attached to<br>each of the subject and the object.</p>
<p>Labels</p>
<p>Smack labels are ASCII character strings, one to twenty-three characters in<br>length. Single character labels using special characters, that being anything<br>other than a letter or digit, are reserved for use by the Smack development<br>team. Smack labels are unstructured, case sensitive, and the only operation<br>ever performed on them is comparison for equality. Smack labels cannot<br>contain unprintable characters, the “/“ (slash), the “&quot; (backslash), the “‘“<br>(quote) and ‘“‘ (double-quote) characters.<br>Smack labels cannot begin with a ‘-‘, which is reserved for special options.</p>
<p>There are some predefined labels:</p>
<pre><code>_     Pronounced &quot;floor&quot;, a single underscore character.
^     Pronounced &quot;hat&quot;, a single circumflex character.
*     Pronounced &quot;star&quot;, a single asterisk character.
?     Pronounced &quot;huh&quot;, a single question mark character.
@     Pronounced &quot;Internet&quot;, a single at sign character.
</code></pre>
<p>Every task on a Smack system is assigned a label. System tasks, such as<br>init(8) and systems daemons, are run with the floor (“_”) label. User tasks<br>are assigned labels according to the specification found in the<br>/etc/smack/user configuration file.</p>
<p>Access Rules</p>
<p>Smack uses the traditional access modes of Linux. These modes are read,<br>execute, write, and occasionally append. There are a few cases where the<br>access mode may not be obvious. These include:</p>
<pre><code>Signals: A signal is a write operation from the subject task to
the object task.
Internet Domain IPC: Transmission of a packet is considered a
write operation from the source task to the destination task.
</code></pre>
<p>Smack restricts access based on the label attached to a subject and the label<br>attached to the object it is trying to access. The rules enforced are, in<br>order:</p>
<pre><code>1. Any access requested by a task labeled &quot;*&quot; is denied.
2. A read or execute access requested by a task labeled &quot;^&quot;
   is permitted.
3. A read or execute access requested on an object labeled &quot;_&quot;
   is permitted.
4. Any access requested on an object labeled &quot;*&quot; is permitted.
5. Any access requested by a task on an object with the same
   label is permitted.
6. Any access requested that is explicitly defined in the loaded
   rule set is permitted.
7. Any other access is denied.
</code></pre>
<p>Smack Access Rules</p>
<p>With the isolation provided by Smack access separation is simple. There are<br>many interesting cases where limited access by subjects to objects with<br>different labels is desired. One example is the familiar spy model of<br>sensitivity, where a scientist working on a highly classified project would be<br>able to read documents of lower classifications and anything she writes will<br>be “born” highly classified. To accommodate such schemes Smack includes a<br>mechanism for specifying rules allowing access between labels.</p>
<p>Access Rule Format</p>
<p>The format of an access rule is:</p>
<pre><code>subject-label object-label access
</code></pre>
<p>Where subject-label is the Smack label of the task, object-label is the Smack<br>label of the thing being accessed, and access is a string specifying the sort<br>of access allowed. The Smack labels are limited to 23 characters. The access<br>specification is searched for letters that describe access modes:</p>
<pre><code>a: indicates that append access should be granted.
r: indicates that read access should be granted.
w: indicates that write access should be granted.
x: indicates that execute access should be granted.
</code></pre>
<p>Uppercase values for the specification letters are allowed as well.<br>Access mode specifications can be in any order. Examples of acceptable rules<br>are:</p>
<pre><code>TopSecret Secret  rx
Secret    Unclass R
Manager   Game    x
User      HR      w
New       Old     rRrRr
Closed    Off     -
</code></pre>
<p>Examples of unacceptable rules are:</p>
<pre><code>Top Secret Secret     rx
Ace        Ace        r
Odd        spells     waxbeans
</code></pre>
<p>Spaces are not allowed in labels. Since a subject always has access to files<br>with the same label specifying a rule for that case is pointless. Only<br>valid letters (rwxaRWXA) and the dash (‘-‘) character are allowed in<br>access specifications. The dash is a placeholder, so “a-r” is the same<br>as “ar”. A lone dash is used to specify that no access should be allowed.</p>
<p>Applying Access Rules</p>
<p>The developers of Linux rarely define new sorts of things, usually importing<br>schemes and concepts from other systems. Most often, the other systems are<br>variants of Unix. Unix has many endearing properties, but consistency of<br>access control models is not one of them. Smack strives to treat accesses as<br>uniformly as is sensible while keeping with the spirit of the underlying<br>mechanism.</p>
<p>File system objects including files, directories, named pipes, symbolic links,<br>and devices require access permissions that closely match those used by mode<br>bit access. To open a file for reading read access is required on the file. To<br>search a directory requires execute access. Creating a file with write access<br>requires both read and write access on the containing directory. Deleting a<br>file requires read and write access to the file and to the containing<br>directory. It is possible that a user may be able to see that a file exists<br>but not any of its attributes by the circumstance of having read access to the<br>containing directory but not to the differently labeled file. This is an<br>artifact of the file name being data in the directory, not a part of the file.</p>
<p>IPC objects, message queues, semaphore sets, and memory segments exist in flat<br>namespaces and access requests are only required to match the object in<br>question.</p>
<p>Process objects reflect tasks on the system and the Smack label used to access<br>them is the same Smack label that the task would use for its own access<br>attempts. Sending a signal via the kill() system call is a write operation<br>from the signaler to the recipient. Debugging a process requires both reading<br>and writing. Creating a new task is an internal operation that results in two<br>tasks with identical Smack labels and requires no access checks.</p>
<p>Sockets are data structures attached to processes and sending a packet from<br>one process to another requires that the sender have write access to the<br>receiver. The receiver is not required to have read access to the sender.</p>
<p>Setting Access Rules</p>
<p>The configuration file /etc/smack/accesses contains the rules to be set at<br>system startup. The contents are written to the special file /smack/load.<br>Rules can be written to /smack/load at any time and take effect immediately.<br>For any pair of subject and object labels there can be only one rule, with the<br>most recently specified overriding any earlier specification.</p>
<p>The program smackload is provided to ensure data is formatted<br>properly when written to /smack/load. This program reads lines<br>of the form</p>
<pre><code>subjectlabel objectlabel mode.
</code></pre>
<p>Task Attribute</p>
<p>The Smack label of a process can be read from /proc/<pid>/attr/current. A<br>process can read its own Smack label from /proc/self/attr/current. A<br>privileged process can change its own Smack label by writing to<br>/proc/self/attr/current but not the label of another process.</p>
<p>File Attribute</p>
<p>The Smack label of a filesystem object is stored as an extended attribute<br>named SMACK64 on the file. This attribute is in the security namespace. It can<br>only be changed by a process with privilege.</p>
<p>Privilege</p>
<p>A process with CAP_MAC_OVERRIDE is privileged.</p>
<p>Smack Networking</p>
<p>As mentioned before, Smack enforces access control on network protocol<br>transmissions. Every packet sent by a Smack process is tagged with its Smack<br>label. This is done by adding a CIPSO tag to the header of the IP packet. Each<br>packet received is expected to have a CIPSO tag that identifies the label and<br>if it lacks such a tag the network ambient label is assumed. Before the packet<br>is delivered a check is made to determine that a subject with the label on the<br>packet has write access to the receiving process and if that is not the case<br>the packet is dropped.</p>
<p>CIPSO Configuration</p>
<p>It is normally unnecessary to specify the CIPSO configuration. The default<br>values used by the system handle all internal cases. Smack will compose CIPSO<br>label values to match the Smack labels being used without administrative<br>intervention. Unlabeled packets that come into the system will be given the<br>ambient label.</p>
<p>Smack requires configuration in the case where packets from a system that is<br>not smack that speaks CIPSO may be encountered. Usually this will be a Trusted<br>Solaris system, but there are other, less widely deployed systems out there.<br>CIPSO provides 3 important values, a Domain Of Interpretation (DOI), a level,<br>and a category set with each packet. The DOI is intended to identify a group<br>of systems that use compatible labeling schemes, and the DOI specified on the<br>smack system must match that of the remote system or packets will be<br>discarded. The DOI is 3 by default. The value can be read from /smack/doi and<br>can be changed by writing to /smack/doi.</p>
<p>The label and category set are mapped to a Smack label as defined in<br>/etc/smack/cipso.</p>
<p>A Smack/CIPSO mapping has the form:</p>
<pre><code>smack level [category [category]*]
</code></pre>
<p>Smack does not expect the level or category sets to be related in any<br>particular way and does not assume or assign accesses based on them. Some<br>examples of mappings:</p>
<pre><code>TopSecret 7
TS:A,B    7 1 2
SecBDE    5 2 4 6
RAFTERS   7 12 26
</code></pre>
<p>The “:” and “,” characters are permitted in a Smack label but have no special<br>meaning.</p>
<p>The mapping of Smack labels to CIPSO values is defined by writing to<br>/smack/cipso. Again, the format of data written to this special file<br>is highly restrictive, so the program smackcipso is provided to<br>ensure the writes are done properly. This program takes mappings<br>on the standard input and sends them to /smack/cipso properly.</p>
<p>In addition to explicit mappings Smack supports direct CIPSO mappings. One<br>CIPSO level is used to indicate that the category set passed in the packet is<br>in fact an encoding of the Smack label. The level used is 250 by default. The<br>value can be read from /smack/direct and changed by writing to /smack/direct.</p>
<p>Socket Attributes</p>
<p>There are two attributes that are associated with sockets. These attributes<br>can only be set by privileged tasks, but any task can read them for their own<br>sockets.</p>
<pre><code>SMACK64IPIN: The Smack label of the task object. A privileged
program that will enforce policy may set this to the star label.

SMACK64IPOUT: The Smack label transmitted with outgoing packets.
A privileged program may set this to match the label of another
task with which it hopes to communicate.
</code></pre>
<p>Smack Netlabel Exceptions</p>
<p>You will often find that your labeled application has to talk to the outside,<br>unlabeled world. To do this there’s a special file /smack/netlabel where you can<br>add some exceptions in the form of :<br>@IP1       LABEL1 or<br>@IP2/MASK  LABEL2</p>
<p>It means that your application will have unlabeled access to @IP1 if it has<br>write access on LABEL1, and access to the subnet @IP2/MASK if it has write<br>access on LABEL2.</p>
<p>Entries in the /smack/netlabel file are matched by longest mask first, like in<br>classless IPv4 routing.</p>
<p>A special label ‘@’ and an option ‘-CIPSO’ can be used there :<br>@      means Internet, any application with any label has access to it<br>-CIPSO means standard CIPSO networking</p>
<p>If you don’t know what CIPSO is and don’t plan to use it, you can just do :<br>echo 127.0.0.1 -CIPSO &gt; /smack/netlabel<br>echo 0.0.0.0/0 @      &gt; /smack/netlabel</p>
<p>If you use CIPSO on your 192.168.0.0/16 local network and need also unlabeled<br>Internet access, you can have :<br>echo 127.0.0.1      -CIPSO &gt; /smack/netlabel<br>echo 192.168.0.0/16 -CIPSO &gt; /smack/netlabel<br>echo 0.0.0.0/0      @      &gt; /smack/netlabel</p>
<p>Writing Applications for Smack</p>
<p>There are three sorts of applications that will run on a Smack system. How an<br>application interacts with Smack will determine what it will have to do to<br>work properly under Smack.</p>
<p>Smack Ignorant Applications</p>
<p>By far the majority of applications have no reason whatever to care about the<br>unique properties of Smack. Since invoking a program has no impact on the<br>Smack label associated with the process the only concern likely to arise is<br>whether the process has execute access to the program.</p>
<p>Smack Relevant Applications</p>
<p>Some programs can be improved by teaching them about Smack, but do not make<br>any security decisions themselves. The utility ls(1) is one example of such a<br>program.</p>
<p>Smack Enforcing Applications</p>
<p>These are special programs that not only know about Smack, but participate in<br>the enforcement of system policy. In most cases these are the programs that<br>set up user sessions. There are also network services that provide information<br>to processes running with various labels.</p>
<p>File System Interfaces</p>
<p>Smack maintains labels on file system objects using extended attributes. The<br>Smack label of a file, directory, or other file system object can be obtained<br>using getxattr(2).</p>
<pre><code>len = getxattr(&quot;/&quot;, &quot;security.SMACK64&quot;, value, sizeof (value));
</code></pre>
<p>will put the Smack label of the root directory into value. A privileged<br>process can set the Smack label of a file system object with setxattr(2).</p>
<pre><code>len = strlen(&quot;Rubble&quot;);
rc = setxattr(&quot;/foo&quot;, &quot;security.SMACK64&quot;, &quot;Rubble&quot;, len, 0);
</code></pre>
<p>will set the Smack label of /foo to “Rubble” if the program has appropriate<br>privilege.</p>
<p>Socket Interfaces</p>
<p>The socket attributes can be read using fgetxattr(2).</p>
<p>A privileged process can set the Smack label of outgoing packets with<br>fsetxattr(2).</p>
<pre><code>len = strlen(&quot;Rubble&quot;);
rc = fsetxattr(fd, &quot;security.SMACK64IPOUT&quot;, &quot;Rubble&quot;, len, 0);
</code></pre>
<p>will set the Smack label “Rubble” on packets going out from the socket if the<br>program has appropriate privilege.</p>
<pre><code>rc = fsetxattr(fd, &quot;security.SMACK64IPIN, &quot;*&quot;, strlen(&quot;*&quot;), 0);
</code></pre>
<p>will set the Smack label “*” as the object label against which incoming<br>packets will be checked if the program has appropriate privilege.</p>
<p>Administration</p>
<p>Smack supports some mount options:</p>
<pre><code>smackfsdef=label: specifies the label to give files that lack
the Smack label extended attribute.

smackfsroot=label: specifies the label to assign the root of the
file system if it lacks the Smack extended attribute.

smackfshat=label: specifies a label that must have read access to
all labels set on the filesystem. Not yet enforced.

smackfsfloor=label: specifies a label to which all labels set on the
filesystem must have read access. Not yet enforced.
</code></pre>
<p>These mount options apply to all file system types.</p>
<p>Smack auditing</p>
<p>If you want Smack auditing of security events, you need to set CONFIG_AUDIT<br>in your kernel configuration.<br>By default, all denied events will be audited. You can change this behavior by<br>writing a single character to the /smack/logging file :<br>0 : no logging<br>1 : log denied (default)<br>2 : log accepted<br>3 : log denied &amp; accepted</p>
<p>Events are logged as ‘key=value’ pairs, for each event you at least will get<br>the subjet, the object, the rights requested, the action, the kernel function<br>that triggered the event, plus other pairs depending on the type of event<br>audited.</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_Smack/" title="Kernel-2.6.32-573.12.1.el6_Smack" target="_blank" rel="external">http://www.oostech.com/2021/03/13/Kernel-2.6.32-573.12.1.el6_Smack/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_WUSB-Design-overview/" title="Kernel-2.6.32-573.12.1.el6_WUSB-Design-overview"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_RTFP/" title="Kernel-2.6.32-573.12.1.el6_RTFP"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>