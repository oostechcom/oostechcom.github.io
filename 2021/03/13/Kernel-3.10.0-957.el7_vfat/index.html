<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-3.10.0-957.el7_vfat | oosTech.com</title>
  <meta name="description" content="USING VFATTo use the vfat filesystem, use the filesystem type ‘vfat’.  i.e.  mount -t vfat &#x2F;dev&#x2F;fd0 &#x2F;mnt No special partition formatter is required.  mkdosfs will work fineif you want to format from w">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-3.10.0-957.el7_vfat">
<meta property="og:url" content="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_vfat/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="USING VFATTo use the vfat filesystem, use the filesystem type ‘vfat’.  i.e.  mount -t vfat &#x2F;dev&#x2F;fd0 &#x2F;mnt No special partition formatter is required.  mkdosfs will work fineif you want to format from w">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_vfat/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a><span class="category-list-count">830</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_devices/" class="title">Kernel-2.6.32-573.12.1.el6_devices</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3c509/" class="title">Kernel-3.10.0-957.el7_3c509</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#USING-VFAT"><span class="toc-number">1.</span> <span class="toc-text">USING VFAT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VFAT-MOUNT-OPTIONS"><span class="toc-number">2.</span> <span class="toc-text">VFAT MOUNT OPTIONS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TODO"><span class="toc-number">3.</span> <span class="toc-text">TODO</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#POSSIBLE-PROBLEMS"><span class="toc-number">4.</span> <span class="toc-text">POSSIBLE PROBLEMS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BUG-REPORTS"><span class="toc-number">5.</span> <span class="toc-text">BUG REPORTS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TEST-SUITE"><span class="toc-number">6.</span> <span class="toc-text">TEST SUITE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NOTES-ON-THE-STRUCTURE-OF-THE-VFAT-FILESYSTEM"><span class="toc-number">7.</span> <span class="toc-text">NOTES ON THE STRUCTURE OF THE VFAT FILESYSTEM</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-3.10.0-957.el7_vfat" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-3.10.0-957.el7_vfat
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/03/13/Kernel-3.10.0-957.el7_vfat/" class="article-date">
	 published: <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
	</a>
</span>

        
	<a href="/2021/03/13/Kernel-3.10.0-957.el7_vfat/" class="article-date">
	   updated: <time datetime="2021-03-12T16:00:00.000Z" itemprop="dateUpdated">2021-03-13</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/03/13/Kernel-3.10.0-957.el7_vfat/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h2 id="USING-VFAT"><a href="#USING-VFAT" class="headerlink" title="USING VFAT"></a>USING VFAT</h2><p>To use the vfat filesystem, use the filesystem type ‘vfat’.  i.e.<br>  mount -t vfat /dev/fd0 /mnt</p>
<p>No special partition formatter is required.  mkdosfs will work fine<br>if you want to format from within Linux.</p>
<h2 id="VFAT-MOUNT-OPTIONS"><a href="#VFAT-MOUNT-OPTIONS" class="headerlink" title="VFAT MOUNT OPTIONS"></a>VFAT MOUNT OPTIONS</h2><p>uid=###       – Set the owner of all files on this filesystem.<br>         The default is the uid of current process.</p>
<p>gid=###       – Set the group of all files on this filesystem.<br>         The default is the gid of current process.</p>
<p>umask=###     – The permission mask (for files and directories, see umask(1)).<br>                 The default is the umask of current process.</p>
<p>dmask=###     – The permission mask for the directory.<br>                 The default is the umask of current process.</p>
<p>fmask=###     – The permission mask for files.<br>                 The default is the umask of current process.</p>
<p>allow_utime=### – This option controls the permission check of mtime/atime.</p>
<pre><code>              20 - If current process is in group of file&#39;s group ID,
                   you can change timestamp.
               2 - Other users can change timestamp.

             The default is set from `dmask&#39; option. (If the directory is
             writable, utime(2) is also allowed. I.e. ~dmask &amp; 022)

             Normally utime(2) checks current process is owner of
             the file, or it has CAP_FOWNER capability.  But FAT
             filesystem doesn&#39;t have uid/gid on disk, so normal
             check is too unflexible. With this option you can
             relax it.
</code></pre>
<p>codepage=###  – Sets the codepage number for converting to shortname<br>         characters on FAT filesystem.<br>         By default, FAT_DEFAULT_CODEPAGE setting is used.</p>
<p>iocharset=<name> – Character set to use for converting between the<br>         encoding is used for user visible filename and 16 bit<br>         Unicode characters. Long filenames are stored on disk<br>         in Unicode format, but Unix for the most part doesn’t<br>         know how to deal with Unicode.<br>         By default, FAT_DEFAULT_IOCHARSET setting is used.</p>
<pre><code>     There is also an option of doing UTF-8 translations
     with the utf8 option.

     NOTE: &quot;iocharset=utf8&quot; is not recommended. If unsure,
     you should consider the following option instead.
</code></pre>
<p>utf8=<bool>   – UTF-8 is the filesystem safe version of Unicode that<br>         is used by the console.  It can be enabled for the<br>         filesystem with this option. If ‘uni_xlate’ gets set,<br>         UTF-8 gets disabled.</p>
<p>uni_xlate=<bool> – Translate unhandled Unicode characters to special<br>         escaped sequences.  This would let you backup and<br>         restore filenames that are created with any Unicode<br>         characters.  Until Linux supports Unicode for real,<br>         this gives you an alternative.  Without this option,<br>         a ‘?’ is used when no translation is possible.  The<br>         escape character is ‘:’ because it is otherwise<br>         illegal on the vfat filesystem.  The escape sequence<br>         that gets used is ‘:’ and the four digits of hexadecimal<br>         unicode.</p>
<p>nonumtail=<bool> – When creating 8.3 aliases, normally the alias will<br>                 end in ‘<del>1’ or tilde followed by some number.  If this<br>                 option is set, then if the filename is<br>                 “longfilename.txt” and “longfile.txt” does not<br>                 currently exist in the directory, ‘longfile.txt’ will<br>                 be the short alias instead of ‘longfi</del>1.txt’. </p>
<p>usefree       – Use the “free clusters” value stored on FSINFO. It’ll<br>                 be used to determine number of free clusters without<br>                 scanning disk. But it’s not used by default, because<br>                 recent Windows don’t update it correctly in some<br>                 case. If you are sure the “free clusters” on FSINFO is<br>                 correct, by this option you can avoid scanning disk.</p>
<p>quiet         – Stops printing certain warning messages.</p>
<p>check=s|r|n   – Case sensitivity checking setting.<br>                 s: strict, case sensitive<br>                 r: relaxed, case insensitive<br>                 n: normal, default setting, currently case insensitive</p>
<p>nocase        – This was deprecated for vfat. Use shortname=win95 instead.</p>
<p>shortname=lower|win95|winnt|mixed<br>          – Shortname display/create setting.<br>         lower: convert to lowercase for display,<br>            emulate the Windows 95 rule for create.<br>         win95: emulate the Windows 95 rule for display/create.<br>         winnt: emulate the Windows NT rule for display/create.<br>         mixed: emulate the Windows NT rule for display,<br>            emulate the Windows 95 rule for create.<br>         Default setting is `mixed’.</p>
<p>tz=UTC        – Interpret timestamps as UTC rather than local time.<br>                 This option disables the conversion of timestamps<br>                 between local time (as used by Windows on FAT) and UTC<br>                 (which Linux uses internally).  This is particularly<br>                 useful when mounting devices (like digital cameras)<br>                 that are set to UTC in order to avoid the pitfalls of<br>                 local time.<br>time_offset=minutes<br>          – Set offset for conversion of timestamps from local time<br>         used by FAT to UTC. I.e. <minutes> minutes will be subtracted<br>         from each timestamp to convert it to UTC used internally by<br>         Linux. This is useful when time zone set in sys_tz is<br>         not the time zone used by the filesystem. Note that this<br>         option still does not provide correct time stamps in all<br>         cases in presence of DST - time stamps in a different DST<br>         setting will be off by one hour.</p>
<p>showexec      – If set, the execute permission bits of the file will be<br>         allowed only if the extension part of the name is .EXE,<br>         .COM, or .BAT. Not set by default.</p>
<p>debug         – Can be set, but unused by the current implementation.</p>
<p>sys_immutable – If set, ATTR_SYS attribute on FAT is handled as<br>         IMMUTABLE flag on Linux. Not set by default.</p>
<p>flush         – If set, the filesystem will try to flush to disk more<br>         early than normal. Not set by default.</p>
<p>rodir          – FAT has the ATTR_RO (read-only) attribute. On Windows,<br>         the ATTR_RO of the directory will just be ignored,<br>         and is used only by applications as a flag (e.g. it’s set<br>         for the customized folder).</p>
<pre><code>     If you want to use ATTR_RO as read-only flag even for
     the directory, set this option.
</code></pre>
<p>errors=panic|continue|remount-ro<br>          – specify FAT behavior on critical errors: panic, continue<br>         without doing anything or remount the partition in<br>         read-only mode (default behavior).</p>
<p>discard       – If set, issues discard/TRIM commands to the block<br>         device when blocks are freed. This is useful for SSD devices<br>         and sparse/thinly-provisoned LUNs.</p>
<p>nfs=stale_rw|nostale_ro<br>        Enable this only if you want to export the FAT filesystem<br>        over NFS.</p>
<pre><code>    stale_rw: This option maintains an index (cache) of directory
    inodes by i_logstart which is used by the nfs-related code to
    improve look-ups. Full file operations (read/write) over NFS is
    supported but with cache eviction at NFS server, this could
    result in ESTALE issues.

    nostale_ro: This option bases the inode number and filehandle
    on the on-disk location of a file in the MS-DOS directory entry.
    This ensures that ESTALE will not be returned after a file is
    evicted from the inode cache. However, it means that operations
    such as rename, create and unlink could cause filehandles that
    previously pointed at one file to point at a different file,
    potentially causing data corruption. For this reason, this
    option also mounts the filesystem readonly.

    To maintain backward compatibility, &#39;-o nfs&#39; is also accepted,
    defaulting to stale_rw
</code></pre>
<p><bool>: 0,1,yes,no,true,false</p>
<h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><ul>
<li>Need to get rid of the raw scanning stuff.  Instead, always use<br>a get next directory entry approach.  The only thing left that uses<br>raw scanning is the directory renaming code.</li>
</ul>
<h2 id="POSSIBLE-PROBLEMS"><a href="#POSSIBLE-PROBLEMS" class="headerlink" title="POSSIBLE PROBLEMS"></a>POSSIBLE PROBLEMS</h2><ul>
<li>vfat_valid_longname does not properly checked reserved names.</li>
<li>When a volume name is the same as a directory name in the root<br>directory of the filesystem, the directory name sometimes shows<br>up as an empty file.</li>
<li>autoconv option does not work correctly.</li>
</ul>
<h2 id="BUG-REPORTS"><a href="#BUG-REPORTS" class="headerlink" title="BUG REPORTS"></a>BUG REPORTS</h2><p>If you have trouble with the VFAT filesystem, mail bug reports to<br><a href="mailto:&#99;&#x68;&#x61;&#x66;&#x66;&#x65;&#x65;&#x40;&#x62;&#109;&#114;&#99;&#46;&#x63;&#x73;&#x2e;&#x62;&#x65;&#114;&#107;&#x65;&#108;&#101;&#121;&#46;&#101;&#100;&#x75;">&#99;&#x68;&#x61;&#x66;&#x66;&#x65;&#x65;&#x40;&#x62;&#109;&#114;&#99;&#46;&#x63;&#x73;&#x2e;&#x62;&#x65;&#114;&#107;&#x65;&#108;&#101;&#121;&#46;&#101;&#100;&#x75;</a>.  Please specify the filename<br>and the operation that gave you trouble.</p>
<h2 id="TEST-SUITE"><a href="#TEST-SUITE" class="headerlink" title="TEST SUITE"></a>TEST SUITE</h2><p>If you plan to make any modifications to the vfat filesystem, please<br>get the test suite that comes with the vfat distribution at</p>
<p>  <a target="_blank" rel="noopener" href="http://web.archive.org/web/*/http://bmrc.berkeley.edu/">http://web.archive.org/web/*/http://bmrc.berkeley.edu/</a><br>  people/chaffee/vfat.html</p>
<p>This tests quite a few parts of the vfat filesystem and additional<br>tests for new features or untested features would be appreciated.</p>
<h2 id="NOTES-ON-THE-STRUCTURE-OF-THE-VFAT-FILESYSTEM"><a href="#NOTES-ON-THE-STRUCTURE-OF-THE-VFAT-FILESYSTEM" class="headerlink" title="NOTES ON THE STRUCTURE OF THE VFAT FILESYSTEM"></a>NOTES ON THE STRUCTURE OF THE VFAT FILESYSTEM</h2><p>(This documentation was provided by Galen C. Hunt <a href="mailto:&#103;&#x63;&#104;&#117;&#110;&#116;&#64;&#99;&#x73;&#46;&#x72;&#x6f;&#x63;&#x68;&#101;&#115;&#116;&#x65;&#114;&#x2e;&#101;&#100;&#117;">&#103;&#x63;&#104;&#117;&#110;&#116;&#64;&#99;&#x73;&#46;&#x72;&#x6f;&#x63;&#x68;&#101;&#115;&#116;&#x65;&#114;&#x2e;&#101;&#100;&#117;</a><br> and lightly annotated by Gordon Chaffee).</p>
<p>This document presents a very rough, technical overview of my<br>knowledge of the extended FAT file system used in Windows NT 3.5 and<br>Windows 95.  I don’t guarantee that any of the following is correct,<br>but it appears to be so.</p>
<p>The extended FAT file system is almost identical to the FAT<br>file system used in DOS versions up to and including 6.223410239847<br>:-).  The significant change has been the addition of long file names.<br>These names support up to 255 characters including spaces and lower<br>case characters as opposed to the traditional 8.3 short names.</p>
<p>Here is the description of the traditional FAT entry in the current<br>Windows 95 filesystem:</p>
<pre><code>    struct directory &#123; // Short 8.3 names 
            unsigned char name[8];          // file name 
            unsigned char ext[3];           // file extension 
            unsigned char attr;             // attribute byte 
    unsigned char lcase;        // Case for base and extension
    unsigned char ctime_ms;        // Creation time, milliseconds
    unsigned char ctime[2];        // Creation time
    unsigned char cdate[2];        // Creation date
    unsigned char adate[2];        // Last access date
    unsigned char reserved[2];    // reserved values (ignored) 
            unsigned char time[2];          // time stamp 
            unsigned char date[2];          // date stamp 
            unsigned char start[2];         // starting cluster number 
            unsigned char size[4];          // size of the file 
    &#125;;
</code></pre>
<p>The lcase field specifies if the base and/or the extension of an 8.3<br>name should be capitalized.  This field does not seem to be used by<br>Windows 95 but it is used by Windows NT.  The case of filenames is not<br>completely compatible from Windows NT to Windows 95.  It is not completely<br>compatible in the reverse direction, however.  Filenames that fit in<br>the 8.3 namespace and are written on Windows NT to be lowercase will<br>show up as uppercase on Windows 95.</p>
<p>Note that the “start” and “size” values are actually little<br>endian integer values.  The descriptions of the fields in this<br>structure are public knowledge and can be found elsewhere.</p>
<p>With the extended FAT system, Microsoft has inserted extra<br>directory entries for any files with extended names.  (Any name which<br>legally fits within the old 8.3 encoding scheme does not have extra<br>entries.)  I call these extra entries slots.  Basically, a slot is a<br>specially formatted directory entry which holds up to 13 characters of<br>a file’s extended name.  Think of slots as additional labeling for the<br>directory entry of the file to which they correspond.  Microsoft<br>prefers to refer to the 8.3 entry for a file as its alias and the<br>extended slot directory entries as the file name. </p>
<p>The C structure for a slot directory entry follows:</p>
<pre><code>    struct slot &#123; // Up to 13 characters of a long name 
            unsigned char id;               // sequence number for slot 
            unsigned char name0_4[10];      // first 5 characters in name 
            unsigned char attr;             // attribute byte
            unsigned char reserved;         // always 0 
            unsigned char alias_checksum;   // checksum for 8.3 alias 
            unsigned char name5_10[12];     // 6 more characters in name
            unsigned char start[2];         // starting cluster number
            unsigned char name11_12[4];     // last 2 characters in name
    &#125;;
</code></pre>
<p>If the layout of the slots looks a little odd, it’s only<br>because of Microsoft’s efforts to maintain compatibility with old<br>software.  The slots must be disguised to prevent old software from<br>panicking.  To this end, a number of measures are taken:</p>
<pre><code>    1) The attribute byte for a slot directory entry is always set
       to 0x0f.  This corresponds to an old directory entry with
       attributes of &quot;hidden&quot;, &quot;system&quot;, &quot;read-only&quot;, and &quot;volume
       label&quot;.  Most old software will ignore any directory
       entries with the &quot;volume label&quot; bit set.  Real volume label
       entries don&#39;t have the other three bits set.

    2) The starting cluster is always set to 0, an impossible
       value for a DOS file.
</code></pre>
<p>Because the extended FAT system is backward compatible, it is<br>possible for old software to modify directory entries.  Measures must<br>be taken to ensure the validity of slots.  An extended FAT system can<br>verify that a slot does in fact belong to an 8.3 directory entry by<br>the following:</p>
<pre><code>    1) Positioning.  Slots for a file always immediately proceed
       their corresponding 8.3 directory entry.  In addition, each
       slot has an id which marks its order in the extended file
       name.  Here is a very abbreviated view of an 8.3 directory
       entry and its corresponding long name slots for the file
       &quot;My Big File.Extension which is long&quot;:

            &lt;proceeding files...&gt;
            &lt;slot #3, id = 0x43, characters = &quot;h is long&quot;&gt;
            &lt;slot #2, id = 0x02, characters = &quot;xtension whic&quot;&gt;
            &lt;slot #1, id = 0x01, characters = &quot;My Big File.E&quot;&gt;
            &lt;directory entry, name = &quot;MYBIGFIL.EXT&quot;&gt;

       Note that the slots are stored from last to first.  Slots
       are numbered from 1 to N.  The Nth slot is or&#39;ed with 0x40
       to mark it as the last one.

    2) Checksum.  Each slot has an &quot;alias_checksum&quot; value.  The
       checksum is calculated from the 8.3 name using the
       following algorithm:

            for (sum = i = 0; i &lt; 11; i++) &#123;
                    sum = (((sum&amp;1)&lt;&lt;7)|((sum&amp;0xfe)&gt;&gt;1)) + name[i]
            &#125;

3) If there is free space in the final slot, a Unicode NULL (0x0000) 
   is stored after the final character.  After that, all unused 
   characters in the final slot are set to Unicode 0xFFFF.
</code></pre>
<p>Finally, note that the extended name is stored in Unicode.  Each Unicode<br>character takes two bytes.</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_vfat/" title="Kernel-3.10.0-957.el7_vfat" target="_blank" rel="external">http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_vfat/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/03/13/Kernel-3.10.0-957.el7_vexpress/" title="Kernel-3.10.0-957.el7_vexpress"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/03/13/Kernel-3.10.0-957.el7_vfio-mediated-device/" title="Kernel-3.10.0-957.el7_vfio-mediated-device"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>