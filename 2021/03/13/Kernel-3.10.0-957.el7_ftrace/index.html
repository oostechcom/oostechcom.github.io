<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-3.10.0-957.el7_ftrace | oosTech.com</title>
  <meta name="description" content="ftrace - Function Tracer     &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  Copyright 2008 Red Hat Inc.   Author:   Steven Rostedt &amp;#x73;&amp;#114;&amp;#x6f;&amp;#115;&amp;#116;&amp;#101;&amp;#x64;&amp;#x74;&amp;#64;&amp;#114;&amp;#101;&amp;#100;&amp;#x68;&amp;#x61;&amp;#x">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-3.10.0-957.el7_ftrace">
<meta property="og:url" content="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_ftrace/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="ftrace - Function Tracer     &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  Copyright 2008 Red Hat Inc.   Author:   Steven Rostedt &amp;#x73;&amp;#114;&amp;#x6f;&amp;#115;&amp;#116;&amp;#101;&amp;#x64;&amp;#x74;&amp;#64;&amp;#114;&amp;#101;&amp;#100;&amp;#x68;&amp;#x61;&amp;#x">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_ftrace/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_mpc5200/" class="title">Kernel-3.10.0-957.el7_mpc5200</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_6pack/" class="title">Kernel-3.10.0-957.el7_6pack</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Implementation-Details"><span class="toc-number">2.</span> <span class="toc-text">Implementation Details</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-File-System"><span class="toc-number">3.</span> <span class="toc-text">The File System</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Tracers"><span class="toc-number">4.</span> <span class="toc-text">The Tracers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Examples-of-using-the-tracer"><span class="toc-number">5.</span> <span class="toc-text">Examples of using the tracer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Output-format"><span class="toc-number">6.</span> <span class="toc-text">Output format:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-function"><span class="toc-number"></span> <span class="toc-text">tracer: function</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#entries-in-buffer-entries-written-140080-250280-P-4"><span class="toc-number"></span> <span class="toc-text">entries-in-buffer&#x2F;entries-written: 140080&#x2F;250280   #P:4</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-1"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off"><span class="toc-number"></span> <span class="toc-text">_—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay"><span class="toc-number"></span> <span class="toc-text">||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TASK-PID-CPU-TIMESTAMP-FUNCTION"><span class="toc-number"></span> <span class="toc-text">TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-2"><span class="toc-number"></span> <span class="toc-text">| |       |   ||||       |         |</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Latency-trace-format"><span class="toc-number">1.</span> <span class="toc-text">Latency trace format</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-irqsoff"><span class="toc-number"></span> <span class="toc-text">tracer: irqsoff</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-3"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#irqsoff-latency-trace-v1-1-5-on-3-8-0-test"><span class="toc-number"></span> <span class="toc-text">irqsoff latency trace v1.1.5 on 3.8.0-test+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93"><span class="toc-number"></span> <span class="toc-text">——————————————————————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#latency-259-us-4-4-CPU-2-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><span class="toc-number"></span> <span class="toc-text">latency: 259 us, #4&#x2F;4, CPU#2 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#task-ps-6143-uid-0-nice-0-policy-0-rt-prio-0"><span class="toc-number"></span> <span class="toc-text">| task: ps-6143 (uid:0 nice:0 policy:0 rt_prio:0)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-1"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gt-started-at-lock-task-sighand"><span class="toc-number"></span> <span class="toc-text">&#x3D;&gt; started at: __lock_task_sighand</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gt-ended-at-raw-spin-unlock-irqrestore"><span class="toc-number"></span> <span class="toc-text">&#x3D;&gt; ended at:   _raw_spin_unlock_irqrestore</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-4"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-5"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94-gt-CPU"><span class="toc-number"></span> <span class="toc-text">_——&#x3D;&gt; CPU#</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-1"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-1"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-1"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-1"><span class="toc-number"></span> <span class="toc-text">||| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-1"><span class="toc-number"></span> <span class="toc-text">|||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cmd-pid-time-caller"><span class="toc-number"></span> <span class="toc-text">cmd     pid   ||||| time  |   caller</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-6"><span class="toc-number"></span> <span class="toc-text">\   &#x2F;      |||||  \    |   &#x2F;</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#trace-options"><span class="toc-number">1.</span> <span class="toc-text">trace_options</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#CPU-2-buffer-started"><span class="toc-number">1.0.0.1.</span> <span class="toc-text">CPU 2 buffer started</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-function-1"><span class="toc-number"></span> <span class="toc-text">tracer: function</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-7"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#entries-in-buffer-entries-written-144405-9452052-P-4"><span class="toc-number"></span> <span class="toc-text">entries-in-buffer&#x2F;entries-written: 144405&#x2F;9452052   #P:4</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-8"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-1"><span class="toc-number"></span> <span class="toc-text">TASK-PID   CPU#      TIMESTAMP  FUNCTION</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-9"><span class="toc-number"></span> <span class="toc-text">| |       |          |         |</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#irqsoff"><span class="toc-number">1.</span> <span class="toc-text">irqsoff</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-options-function-trace"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; options&#x2F;function-trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-irqsoff-gt-current-tracer"><span class="toc-number"></span> <span class="toc-text">echo irqsoff &gt; current_tracer</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-tracing-on"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-tracing-max-latency"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; tracing_max_latency</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ls-ltr"><span class="toc-number"></span> <span class="toc-text">ls -ltr</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-tracing-on"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-trace"><span class="toc-number"></span> <span class="toc-text">cat trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-irqsoff-1"><span class="toc-number"></span> <span class="toc-text">tracer: irqsoff</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-10"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#irqsoff-latency-trace-v1-1-5-on-3-8-0-test-1"><span class="toc-number"></span> <span class="toc-text">irqsoff latency trace v1.1.5 on 3.8.0-test+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-1"><span class="toc-number"></span> <span class="toc-text">——————————————————————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#latency-16-us-4-4-CPU-0-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><span class="toc-number"></span> <span class="toc-text">latency: 16 us, #4&#x2F;4, CPU#0 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-2"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#task-swapper-0-0-uid-0-nice-0-policy-0-rt-prio-0"><span class="toc-number"></span> <span class="toc-text">| task: swapper&#x2F;0-0 (uid:0 nice:0 policy:0 rt_prio:0)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-3"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gt-started-at-run-timer-softirq"><span class="toc-number"></span> <span class="toc-text">&#x3D;&gt; started at: run_timer_softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gt-ended-at-run-timer-softirq"><span class="toc-number"></span> <span class="toc-text">&#x3D;&gt; ended at:   run_timer_softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-11"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-12"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94-gt-CPU-1"><span class="toc-number"></span> <span class="toc-text">_——&#x3D;&gt; CPU#</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-2"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-2"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-2"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-2"><span class="toc-number"></span> <span class="toc-text">||| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-2"><span class="toc-number"></span> <span class="toc-text">|||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cmd-pid-time-caller-1"><span class="toc-number"></span> <span class="toc-text">cmd     pid   ||||| time  |   caller</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-13"><span class="toc-number"></span> <span class="toc-text">\   &#x2F;      |||||  \    |   &#x2F;</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-irqsoff-2"><span class="toc-number"></span> <span class="toc-text">tracer: irqsoff</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-14"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#irqsoff-latency-trace-v1-1-5-on-3-8-0-test-2"><span class="toc-number"></span> <span class="toc-text">irqsoff latency trace v1.1.5 on 3.8.0-test+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-2"><span class="toc-number"></span> <span class="toc-text">——————————————————————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#latency-71-us-168-168-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><span class="toc-number"></span> <span class="toc-text">latency: 71 us, #168&#x2F;168, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-4"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#task-bash-2042-uid-0-nice-0-policy-0-rt-prio-0"><span class="toc-number"></span> <span class="toc-text">| task: bash-2042 (uid:0 nice:0 policy:0 rt_prio:0)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-5"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gt-started-at-ata-scsi-queuecmd"><span class="toc-number"></span> <span class="toc-text">&#x3D;&gt; started at: ata_scsi_queuecmd</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gt-ended-at-ata-scsi-queuecmd"><span class="toc-number"></span> <span class="toc-text">&#x3D;&gt; ended at:   ata_scsi_queuecmd</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-15"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-16"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94-gt-CPU-2"><span class="toc-number"></span> <span class="toc-text">_——&#x3D;&gt; CPU#</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-3"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-3"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-3"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-3"><span class="toc-number"></span> <span class="toc-text">||| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-3"><span class="toc-number"></span> <span class="toc-text">|||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cmd-pid-time-caller-2"><span class="toc-number"></span> <span class="toc-text">cmd     pid   ||||| time  |   caller</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-17"><span class="toc-number"></span> <span class="toc-text">\   &#x2F;      |||||  \    |   &#x2F;</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#preemptoff"><span class="toc-number">1.</span> <span class="toc-text">preemptoff</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-options-function-trace-1"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; options&#x2F;function-trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-preemptoff-gt-current-tracer"><span class="toc-number"></span> <span class="toc-text">echo preemptoff &gt; current_tracer</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-tracing-on-1"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-tracing-max-latency-1"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; tracing_max_latency</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ls-ltr-1"><span class="toc-number"></span> <span class="toc-text">ls -ltr</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-tracing-on-1"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-trace-1"><span class="toc-number"></span> <span class="toc-text">cat trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-preemptoff"><span class="toc-number"></span> <span class="toc-text">tracer: preemptoff</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-18"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#preemptoff-latency-trace-v1-1-5-on-3-8-0-test"><span class="toc-number"></span> <span class="toc-text">preemptoff latency trace v1.1.5 on 3.8.0-test+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-3"><span class="toc-number"></span> <span class="toc-text">——————————————————————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#latency-46-us-4-4-CPU-1-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><span class="toc-number"></span> <span class="toc-text">latency: 46 us, #4&#x2F;4, CPU#1 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-6"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#task-sshd-1991-uid-0-nice-0-policy-0-rt-prio-0"><span class="toc-number"></span> <span class="toc-text">| task: sshd-1991 (uid:0 nice:0 policy:0 rt_prio:0)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-7"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gt-started-at-do-IRQ"><span class="toc-number"></span> <span class="toc-text">&#x3D;&gt; started at: do_IRQ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gt-ended-at-do-IRQ"><span class="toc-number"></span> <span class="toc-text">&#x3D;&gt; ended at:   do_IRQ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-19"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-20"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94-gt-CPU-3"><span class="toc-number"></span> <span class="toc-text">_——&#x3D;&gt; CPU#</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-4"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-4"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-4"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-4"><span class="toc-number"></span> <span class="toc-text">||| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-4"><span class="toc-number"></span> <span class="toc-text">|||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cmd-pid-time-caller-3"><span class="toc-number"></span> <span class="toc-text">cmd     pid   ||||| time  |   caller</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-21"><span class="toc-number"></span> <span class="toc-text">\   &#x2F;      |||||  \    |   &#x2F;</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-preemptoff-1"><span class="toc-number"></span> <span class="toc-text">tracer: preemptoff</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-22"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#preemptoff-latency-trace-v1-1-5-on-3-8-0-test-1"><span class="toc-number"></span> <span class="toc-text">preemptoff latency trace v1.1.5 on 3.8.0-test+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-4"><span class="toc-number"></span> <span class="toc-text">——————————————————————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#latency-83-us-241-241-CPU-1-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><span class="toc-number"></span> <span class="toc-text">latency: 83 us, #241&#x2F;241, CPU#1 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-8"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#task-bash-1994-uid-0-nice-0-policy-0-rt-prio-0"><span class="toc-number"></span> <span class="toc-text">| task: bash-1994 (uid:0 nice:0 policy:0 rt_prio:0)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-9"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gt-started-at-wake-up-new-task"><span class="toc-number"></span> <span class="toc-text">&#x3D;&gt; started at: wake_up_new_task</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gt-ended-at-task-rq-unlock"><span class="toc-number"></span> <span class="toc-text">&#x3D;&gt; ended at:   task_rq_unlock</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-23"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-24"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94-gt-CPU-4"><span class="toc-number"></span> <span class="toc-text">_——&#x3D;&gt; CPU#</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-5"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-5"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-5"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-5"><span class="toc-number"></span> <span class="toc-text">||| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-5"><span class="toc-number"></span> <span class="toc-text">|||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cmd-pid-time-caller-4"><span class="toc-number"></span> <span class="toc-text">cmd     pid   ||||| time  |   caller</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-25"><span class="toc-number"></span> <span class="toc-text">\   &#x2F;      |||||  \    |   &#x2F;</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#preemptirqsoff"><span class="toc-number">1.</span> <span class="toc-text">preemptirqsoff</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-options-function-trace-2"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; options&#x2F;function-trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-preemptirqsoff-gt-current-tracer"><span class="toc-number"></span> <span class="toc-text">echo preemptirqsoff &gt; current_tracer</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-tracing-on-2"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-tracing-max-latency-2"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; tracing_max_latency</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ls-ltr-2"><span class="toc-number"></span> <span class="toc-text">ls -ltr</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-tracing-on-2"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-trace-2"><span class="toc-number"></span> <span class="toc-text">cat trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-preemptirqsoff"><span class="toc-number"></span> <span class="toc-text">tracer: preemptirqsoff</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-26"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#preemptirqsoff-latency-trace-v1-1-5-on-3-8-0-test"><span class="toc-number"></span> <span class="toc-text">preemptirqsoff latency trace v1.1.5 on 3.8.0-test+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-5"><span class="toc-number"></span> <span class="toc-text">——————————————————————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#latency-100-us-4-4-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><span class="toc-number"></span> <span class="toc-text">latency: 100 us, #4&#x2F;4, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-10"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#task-ls-2230-uid-0-nice-0-policy-0-rt-prio-0"><span class="toc-number"></span> <span class="toc-text">| task: ls-2230 (uid:0 nice:0 policy:0 rt_prio:0)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-11"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gt-started-at-ata-scsi-queuecmd-1"><span class="toc-number"></span> <span class="toc-text">&#x3D;&gt; started at: ata_scsi_queuecmd</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gt-ended-at-ata-scsi-queuecmd-1"><span class="toc-number"></span> <span class="toc-text">&#x3D;&gt; ended at:   ata_scsi_queuecmd</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-27"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-28"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94-gt-CPU-5"><span class="toc-number"></span> <span class="toc-text">_——&#x3D;&gt; CPU#</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-6"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-6"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-6"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-6"><span class="toc-number"></span> <span class="toc-text">||| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-6"><span class="toc-number"></span> <span class="toc-text">|||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cmd-pid-time-caller-5"><span class="toc-number"></span> <span class="toc-text">cmd     pid   ||||| time  |   caller</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-29"><span class="toc-number"></span> <span class="toc-text">\   &#x2F;      |||||  \    |   &#x2F;</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-preemptirqsoff-1"><span class="toc-number"></span> <span class="toc-text">tracer: preemptirqsoff</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-30"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#preemptirqsoff-latency-trace-v1-1-5-on-3-8-0-test-1"><span class="toc-number"></span> <span class="toc-text">preemptirqsoff latency trace v1.1.5 on 3.8.0-test+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-6"><span class="toc-number"></span> <span class="toc-text">——————————————————————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#latency-161-us-339-339-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><span class="toc-number"></span> <span class="toc-text">latency: 161 us, #339&#x2F;339, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-12"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#task-ls-2269-uid-0-nice-0-policy-0-rt-prio-0"><span class="toc-number"></span> <span class="toc-text">| task: ls-2269 (uid:0 nice:0 policy:0 rt_prio:0)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-13"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gt-started-at-schedule"><span class="toc-number"></span> <span class="toc-text">&#x3D;&gt; started at: schedule</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gt-ended-at-mutex-unlock"><span class="toc-number"></span> <span class="toc-text">&#x3D;&gt; ended at:   mutex_unlock</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-31"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-32"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94-gt-CPU-6"><span class="toc-number"></span> <span class="toc-text">_——&#x3D;&gt; CPU#</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-7"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-7"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-7"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-7"><span class="toc-number"></span> <span class="toc-text">||| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-7"><span class="toc-number"></span> <span class="toc-text">|||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cmd-pid-time-caller-6"><span class="toc-number"></span> <span class="toc-text">cmd     pid   ||||| time  |   caller</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-33"><span class="toc-number"></span> <span class="toc-text">\   &#x2F;      |||||  \    |   &#x2F;</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#wakeup"><span class="toc-number">1.</span> <span class="toc-text">wakeup</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-options-function-trace-3"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; options&#x2F;function-trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-wakeup-gt-current-tracer"><span class="toc-number"></span> <span class="toc-text">echo wakeup &gt; current_tracer</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-tracing-on-3"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-tracing-max-latency-3"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; tracing_max_latency</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#chrt-f-5-sleep-1"><span class="toc-number"></span> <span class="toc-text">chrt -f 5 sleep 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-tracing-on-3"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-trace-3"><span class="toc-number"></span> <span class="toc-text">cat trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-wakeup"><span class="toc-number"></span> <span class="toc-text">tracer: wakeup</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-34"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#wakeup-latency-trace-v1-1-5-on-3-8-0-test"><span class="toc-number"></span> <span class="toc-text">wakeup latency trace v1.1.5 on 3.8.0-test+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-7"><span class="toc-number"></span> <span class="toc-text">——————————————————————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#latency-15-us-4-4-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><span class="toc-number"></span> <span class="toc-text">latency: 15 us, #4&#x2F;4, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-14"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#task-kworker-3-1H-312-uid-0-nice-20-policy-0-rt-prio-0"><span class="toc-number"></span> <span class="toc-text">| task: kworker&#x2F;3:1H-312 (uid:0 nice:-20 policy:0 rt_prio:0)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-15"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-35"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94-gt-CPU-7"><span class="toc-number"></span> <span class="toc-text">_——&#x3D;&gt; CPU#</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-8"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-8"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-8"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-8"><span class="toc-number"></span> <span class="toc-text">||| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-8"><span class="toc-number"></span> <span class="toc-text">|||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cmd-pid-time-caller-7"><span class="toc-number"></span> <span class="toc-text">cmd     pid   ||||| time  |   caller</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-36"><span class="toc-number"></span> <span class="toc-text">\   &#x2F;      |||||  \    |   &#x2F;</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#wakeup-rt"><span class="toc-number">1.</span> <span class="toc-text">wakeup_rt</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-options-function-trace-4"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; options&#x2F;function-trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-wakeup-rt-gt-current-tracer"><span class="toc-number"></span> <span class="toc-text">echo wakeup_rt &gt; current_tracer</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-tracing-on-4"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-tracing-max-latency-4"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; tracing_max_latency</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#chrt-f-5-sleep-1-1"><span class="toc-number"></span> <span class="toc-text">chrt -f 5 sleep 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-tracing-on-4"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-trace-4"><span class="toc-number"></span> <span class="toc-text">cat trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-wakeup-1"><span class="toc-number"></span> <span class="toc-text">tracer: wakeup</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-37"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-wakeup-rt"><span class="toc-number"></span> <span class="toc-text">tracer: wakeup_rt</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-38"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#wakeup-rt-latency-trace-v1-1-5-on-3-8-0-test"><span class="toc-number"></span> <span class="toc-text">wakeup_rt latency trace v1.1.5 on 3.8.0-test+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-8"><span class="toc-number"></span> <span class="toc-text">——————————————————————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#latency-5-us-4-4-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><span class="toc-number"></span> <span class="toc-text">latency: 5 us, #4&#x2F;4, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-16"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#task-sleep-2389-uid-0-nice-0-policy-1-rt-prio-5"><span class="toc-number"></span> <span class="toc-text">| task: sleep-2389 (uid:0 nice:0 policy:1 rt_prio:5)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-17"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-39"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94-gt-CPU-8"><span class="toc-number"></span> <span class="toc-text">_——&#x3D;&gt; CPU#</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-9"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-9"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-9"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-9"><span class="toc-number"></span> <span class="toc-text">||| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-9"><span class="toc-number"></span> <span class="toc-text">|||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cmd-pid-time-caller-8"><span class="toc-number"></span> <span class="toc-text">cmd     pid   ||||| time  |   caller</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-40"><span class="toc-number"></span> <span class="toc-text">\   &#x2F;      |||||  \    |   &#x2F;</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-wakeup-rt-1"><span class="toc-number"></span> <span class="toc-text">tracer: wakeup_rt</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-41"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#wakeup-rt-latency-trace-v1-1-5-on-3-8-0-test-1"><span class="toc-number"></span> <span class="toc-text">wakeup_rt latency trace v1.1.5 on 3.8.0-test+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-9"><span class="toc-number"></span> <span class="toc-text">——————————————————————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#latency-29-us-85-85-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><span class="toc-number"></span> <span class="toc-text">latency: 29 us, #85&#x2F;85, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-18"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#task-sleep-2448-uid-0-nice-0-policy-1-rt-prio-5"><span class="toc-number"></span> <span class="toc-text">| task: sleep-2448 (uid:0 nice:0 policy:1 rt_prio:5)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-19"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-42"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94-gt-CPU-9"><span class="toc-number"></span> <span class="toc-text">_——&#x3D;&gt; CPU#</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-10"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-10"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-10"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-10"><span class="toc-number"></span> <span class="toc-text">||| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-10"><span class="toc-number"></span> <span class="toc-text">|||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cmd-pid-time-caller-9"><span class="toc-number"></span> <span class="toc-text">cmd     pid   ||||| time  |   caller</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-43"><span class="toc-number"></span> <span class="toc-text">\   &#x2F;      |||||  \    |   &#x2F;</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Latency-tracing-and-events"><span class="toc-number">1.</span> <span class="toc-text">Latency tracing and events</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-options-function-trace-5"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; options&#x2F;function-trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-wakeup-rt-gt-current-tracer-1"><span class="toc-number"></span> <span class="toc-text">echo wakeup_rt &gt; current_tracer</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-events-enable"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; events&#x2F;enable</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-tracing-on-5"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-tracing-max-latency-5"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; tracing_max_latency</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#chrt-f-5-sleep-1-2"><span class="toc-number"></span> <span class="toc-text">chrt -f 5 sleep 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-tracing-on-5"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-trace-5"><span class="toc-number"></span> <span class="toc-text">cat trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-wakeup-rt-2"><span class="toc-number"></span> <span class="toc-text">tracer: wakeup_rt</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-44"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#wakeup-rt-latency-trace-v1-1-5-on-3-8-0-test-2"><span class="toc-number"></span> <span class="toc-text">wakeup_rt latency trace v1.1.5 on 3.8.0-test+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-10"><span class="toc-number"></span> <span class="toc-text">——————————————————————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#latency-6-us-12-12-CPU-2-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><span class="toc-number"></span> <span class="toc-text">latency: 6 us, #12&#x2F;12, CPU#2 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-20"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#task-sleep-5882-uid-0-nice-0-policy-1-rt-prio-5"><span class="toc-number"></span> <span class="toc-text">| task: sleep-5882 (uid:0 nice:0 policy:1 rt_prio:5)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%93-21"><span class="toc-number"></span> <span class="toc-text">—————–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-45"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94-gt-CPU-10"><span class="toc-number"></span> <span class="toc-text">_——&#x3D;&gt; CPU#</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-11"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-11"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-11"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-11"><span class="toc-number"></span> <span class="toc-text">||| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-11"><span class="toc-number"></span> <span class="toc-text">|||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cmd-pid-time-caller-10"><span class="toc-number"></span> <span class="toc-text">cmd     pid   ||||| time  |   caller</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-46"><span class="toc-number"></span> <span class="toc-text">\   &#x2F;      |||||  \    |   &#x2F;</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#function"><span class="toc-number">1.</span> <span class="toc-text">function</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sysctl-kernel-ftrace-enabled-1"><span class="toc-number"></span> <span class="toc-text">sysctl kernel.ftrace_enabled&#x3D;1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-function-gt-current-tracer"><span class="toc-number"></span> <span class="toc-text">echo function &gt; current_tracer</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-tracing-on-6"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#usleep-1"><span class="toc-number"></span> <span class="toc-text">usleep 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-tracing-on-6"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-trace-6"><span class="toc-number"></span> <span class="toc-text">cat trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-function-2"><span class="toc-number"></span> <span class="toc-text">tracer: function</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-47"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#entries-in-buffer-entries-written-24799-24799-P-4"><span class="toc-number"></span> <span class="toc-text">entries-in-buffer&#x2F;entries-written: 24799&#x2F;24799   #P:4</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-48"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-12"><span class="toc-number"></span> <span class="toc-text">_—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-12"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-12"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-12"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-12"><span class="toc-number"></span> <span class="toc-text">||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-2"><span class="toc-number"></span> <span class="toc-text">TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-49"><span class="toc-number"></span> <span class="toc-text">| |       |   ||||       |         |</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Single-thread-tracing"><span class="toc-number">1.</span> <span class="toc-text">Single thread tracing</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-set-ftrace-pid"><span class="toc-number"></span> <span class="toc-text">cat set_ftrace_pid</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-3111-gt-set-ftrace-pid"><span class="toc-number"></span> <span class="toc-text">echo 3111 &gt; set_ftrace_pid</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-set-ftrace-pid-1"><span class="toc-number"></span> <span class="toc-text">cat set_ftrace_pid</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-function-gt-current-tracer-1"><span class="toc-number"></span> <span class="toc-text">echo function &gt; current_tracer</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-trace-head"><span class="toc-number"></span> <span class="toc-text">cat trace | head</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-function-3"><span class="toc-number"></span> <span class="toc-text">tracer: function</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-50"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-3"><span class="toc-number"></span> <span class="toc-text">TASK-PID    CPU#    TIMESTAMP  FUNCTION</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-51"><span class="toc-number"></span> <span class="toc-text">| |       |          |         |</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-set-ftrace-pid"><span class="toc-number"></span> <span class="toc-text">echo -1 &gt; set_ftrace_pid</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-trace-head-1"><span class="toc-number"></span> <span class="toc-text">cat trace |head</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-function-4"><span class="toc-number"></span> <span class="toc-text">tracer: function</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-52"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-4"><span class="toc-number"></span> <span class="toc-text">TASK-PID    CPU#    TIMESTAMP  FUNCTION</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-53"><span class="toc-number"></span> <span class="toc-text">| |       |          |         |</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#CPU-3-buffer-started"><span class="toc-number">0.0.0.1.</span> <span class="toc-text">CPU 3 buffer started</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#function-graph-tracer"><span class="toc-number">1.</span> <span class="toc-text">function graph tracer</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-function-graph"><span class="toc-number"></span> <span class="toc-text">tracer: function_graph</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-54"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CPU-DURATION-FUNCTION-CALLS"><span class="toc-number"></span> <span class="toc-text">CPU  DURATION                  FUNCTION CALLS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-55"><span class="toc-number"></span> <span class="toc-text">|     |   |                     |   |   |   |</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-function-graph-1"><span class="toc-number"></span> <span class="toc-text">tracer: function_graph</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-56"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CPU-TASK-PID-DURATION-FUNCTION-CALLS"><span class="toc-number"></span> <span class="toc-text">CPU  TASK&#x2F;PID        DURATION                  FUNCTION CALLS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-57"><span class="toc-number"></span> <span class="toc-text">|    |    |           |   |                     |   |   |   |</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-58"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TIME-CPU-DURATION-FUNCTION-CALLS"><span class="toc-number"></span> <span class="toc-text">TIME       CPU  DURATION                  FUNCTION CALLS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-59"><span class="toc-number"></span> <span class="toc-text">|         |     |   |                     |   |   |   |</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#dynamic-ftrace"><span class="toc-number">1.</span> <span class="toc-text">dynamic ftrace</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-available-filter-functions"><span class="toc-number"></span> <span class="toc-text">cat available_filter_functions</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-sys-nanosleep-hrtimer-interrupt-gt-set-ftrace-filter"><span class="toc-number"></span> <span class="toc-text">echo sys_nanosleep hrtimer_interrupt &gt; set_ftrace_filter</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-function-gt-current-tracer-2"><span class="toc-number"></span> <span class="toc-text">echo function &gt; current_tracer</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-tracing-on-7"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#usleep-1-1"><span class="toc-number"></span> <span class="toc-text">usleep 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-tracing-on-7"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-trace-7"><span class="toc-number"></span> <span class="toc-text">cat trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-function-5"><span class="toc-number"></span> <span class="toc-text">tracer: function</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-60"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#entries-in-buffer-entries-written-5-5-P-4"><span class="toc-number"></span> <span class="toc-text">entries-in-buffer&#x2F;entries-written: 5&#x2F;5   #P:4</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-61"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-13"><span class="toc-number"></span> <span class="toc-text">_—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-13"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-13"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-13"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-13"><span class="toc-number"></span> <span class="toc-text">||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-5"><span class="toc-number"></span> <span class="toc-text">TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-62"><span class="toc-number"></span> <span class="toc-text">| |       |   ||||       |         |</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-set-ftrace-filter"><span class="toc-number"></span> <span class="toc-text">cat set_ftrace_filter</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hrtimer-%E2%80%99-gt-set-ftrace-filter"><span class="toc-number"></span> <span class="toc-text">echo ‘hrtimer_*’ &gt; set_ftrace_filter</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-function-6"><span class="toc-number"></span> <span class="toc-text">tracer: function</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-63"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#entries-in-buffer-entries-written-897-897-P-4"><span class="toc-number"></span> <span class="toc-text">entries-in-buffer&#x2F;entries-written: 897&#x2F;897   #P:4</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-64"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-14"><span class="toc-number"></span> <span class="toc-text">_—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-14"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-14"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-14"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-14"><span class="toc-number"></span> <span class="toc-text">||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-6"><span class="toc-number"></span> <span class="toc-text">TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-65"><span class="toc-number"></span> <span class="toc-text">| |       |   ||||       |         |</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-set-ftrace-filter-1"><span class="toc-number"></span> <span class="toc-text">cat set_ftrace_filter</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-gt-set-ftrace-filter"><span class="toc-number"></span> <span class="toc-text">echo &gt; set_ftrace_filter</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-set-ftrace-filter-2"><span class="toc-number"></span> <span class="toc-text">cat set_ftrace_filter</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-66"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-sys-nanosleep-gt-set-ftrace-filter"><span class="toc-number"></span> <span class="toc-text">echo sys_nanosleep &gt; set_ftrace_filter</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-set-ftrace-filter-3"><span class="toc-number"></span> <span class="toc-text">cat set_ftrace_filter</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98hrtimer-%E2%80%99-gt-gt-set-ftrace-filter"><span class="toc-number"></span> <span class="toc-text">echo ‘hrtimer_*’ &gt;&gt; set_ftrace_filter</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-set-ftrace-filter-4"><span class="toc-number"></span> <span class="toc-text">cat set_ftrace_filter</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-%E2%80%98preempt%E2%80%98-%E2%80%98lock%E2%80%98-gt-set-ftrace-notrace"><span class="toc-number"></span> <span class="toc-text">echo ‘preempt‘ ‘lock‘ &gt; set_ftrace_notrace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-function-7"><span class="toc-number"></span> <span class="toc-text">tracer: function</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-67"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#entries-in-buffer-entries-written-39608-39608-P-4"><span class="toc-number"></span> <span class="toc-text">entries-in-buffer&#x2F;entries-written: 39608&#x2F;39608   #P:4</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-68"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-15"><span class="toc-number"></span> <span class="toc-text">_—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-15"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-15"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-15"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-15"><span class="toc-number"></span> <span class="toc-text">||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-7"><span class="toc-number"></span> <span class="toc-text">TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-69"><span class="toc-number"></span> <span class="toc-text">| |       |   ||||       |         |</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Dynamic-ftrace-with-the-function-graph-tracer"><span class="toc-number">1.</span> <span class="toc-text">Dynamic ftrace with the function graph tracer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ftrace-enabled"><span class="toc-number">2.</span> <span class="toc-text">ftrace_enabled</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Filter-commands"><span class="toc-number">3.</span> <span class="toc-text">Filter commands</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#trace-pipe"><span class="toc-number">4.</span> <span class="toc-text">trace_pipe</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-function-gt-current-tracer-3"><span class="toc-number"></span> <span class="toc-text">echo function &gt; current_tracer</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-trace-pipe-gt-tmp-trace-out-amp"><span class="toc-number"></span> <span class="toc-text">cat trace_pipe &gt; &#x2F;tmp&#x2F;trace.out &amp;</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-tracing-on-8"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#usleep-1-2"><span class="toc-number"></span> <span class="toc-text">usleep 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-0-gt-tracing-on-8"><span class="toc-number"></span> <span class="toc-text">echo 0 &gt; tracing_on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-trace-8"><span class="toc-number"></span> <span class="toc-text">cat trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-function-8"><span class="toc-number"></span> <span class="toc-text">tracer: function</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-70"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#entries-in-buffer-entries-written-0-0-P-4"><span class="toc-number"></span> <span class="toc-text">entries-in-buffer&#x2F;entries-written: 0&#x2F;0   #P:4</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-71"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-16"><span class="toc-number"></span> <span class="toc-text">_—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-16"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-16"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-16"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-16"><span class="toc-number"></span> <span class="toc-text">||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-8"><span class="toc-number"></span> <span class="toc-text">TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-72"><span class="toc-number"></span> <span class="toc-text">| |       |   ||||       |         |</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-73"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-tmp-trace-out"><span class="toc-number"></span> <span class="toc-text">cat &#x2F;tmp&#x2F;trace.out</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#trace-entries"><span class="toc-number">1.</span> <span class="toc-text">trace entries</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-buffer-size-kb"><span class="toc-number"></span> <span class="toc-text">cat buffer_size_kb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-buffer-total-size-kb"><span class="toc-number"></span> <span class="toc-text">cat buffer_total_size_kb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-10000-gt-buffer-size-kb"><span class="toc-number"></span> <span class="toc-text">echo 10000 &gt; buffer_size_kb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-buffer-size-kb-1"><span class="toc-number"></span> <span class="toc-text">cat buffer_size_kb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1000000000000-gt-buffer-size-kb"><span class="toc-number"></span> <span class="toc-text">echo 1000000000000 &gt; buffer_size_kb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-buffer-size-kb-2"><span class="toc-number"></span> <span class="toc-text">cat buffer_size_kb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-10000-gt-per-cpu-cpu0-buffer-size-kb"><span class="toc-number"></span> <span class="toc-text">echo 10000 &gt; per_cpu&#x2F;cpu0&#x2F;buffer_size_kb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-100-gt-per-cpu-cpu1-buffer-size-kb"><span class="toc-number"></span> <span class="toc-text">echo 100 &gt; per_cpu&#x2F;cpu1&#x2F;buffer_size_kb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-buffer-size-kb-3"><span class="toc-number"></span> <span class="toc-text">cat buffer_size_kb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-buffer-total-size-kb-1"><span class="toc-number"></span> <span class="toc-text">cat buffer_total_size_kb</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Snapshot"><span class="toc-number">1.</span> <span class="toc-text">Snapshot</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-events-sched-enable"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; events&#x2F;sched&#x2F;enable</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-snapshot"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; snapshot</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-snapshot"><span class="toc-number"></span> <span class="toc-text">cat snapshot</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-nop"><span class="toc-number"></span> <span class="toc-text">tracer: nop</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-74"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#entries-in-buffer-entries-written-71-71-P-8"><span class="toc-number"></span> <span class="toc-text">entries-in-buffer&#x2F;entries-written: 71&#x2F;71   #P:8</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-75"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-17"><span class="toc-number"></span> <span class="toc-text">_—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-17"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-17"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-17"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-17"><span class="toc-number"></span> <span class="toc-text">||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-9"><span class="toc-number"></span> <span class="toc-text">TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-76"><span class="toc-number"></span> <span class="toc-text">| |       |   ||||       |         |</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-trace-9"><span class="toc-number"></span> <span class="toc-text">cat trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-nop-1"><span class="toc-number"></span> <span class="toc-text">tracer: nop</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-77"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#entries-in-buffer-entries-written-77-77-P-8"><span class="toc-number"></span> <span class="toc-text">entries-in-buffer&#x2F;entries-written: 77&#x2F;77   #P:8</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-78"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-18"><span class="toc-number"></span> <span class="toc-text">_—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-18"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-18"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-18"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-18"><span class="toc-number"></span> <span class="toc-text">||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-10"><span class="toc-number"></span> <span class="toc-text">TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-79"><span class="toc-number"></span> <span class="toc-text">| |       |   ||||       |         |</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-wakeup-gt-current-tracer-1"><span class="toc-number"></span> <span class="toc-text">echo wakeup &gt; current_tracer</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-snapshot-1"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; snapshot</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-snapshot-1"><span class="toc-number"></span> <span class="toc-text">cat snapshot</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Instances"><span class="toc-number">1.</span> <span class="toc-text">Instances</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mkdir-instances-foo"><span class="toc-number"></span> <span class="toc-text">mkdir instances&#x2F;foo</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ls-instances-foo"><span class="toc-number"></span> <span class="toc-text">ls instances&#x2F;foo</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mkdir-instances-foo-1"><span class="toc-number"></span> <span class="toc-text">mkdir instances&#x2F;foo</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mkdir-instances-bar"><span class="toc-number"></span> <span class="toc-text">mkdir instances&#x2F;bar</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mkdir-instances-zoot"><span class="toc-number"></span> <span class="toc-text">mkdir instances&#x2F;zoot</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-100000-gt-buffer-size-kb"><span class="toc-number"></span> <span class="toc-text">echo 100000 &gt; buffer_size_kb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1000-gt-instances-foo-buffer-size-kb"><span class="toc-number"></span> <span class="toc-text">echo 1000 &gt; instances&#x2F;foo&#x2F;buffer_size_kb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-5000-gt-instances-bar-per-cpu-cpu1-buffer-size-kb"><span class="toc-number"></span> <span class="toc-text">echo 5000 &gt; instances&#x2F;bar&#x2F;per_cpu&#x2F;cpu1&#x2F;buffer_size_kb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-function-gt-current-trace"><span class="toc-number"></span> <span class="toc-text">echo function &gt; current_trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-instances-foo-events-sched-sched-wakeup-enable"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; instances&#x2F;foo&#x2F;events&#x2F;sched&#x2F;sched_wakeup&#x2F;enable</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-instances-foo-events-sched-sched-wakeup-new-enable"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; instances&#x2F;foo&#x2F;events&#x2F;sched&#x2F;sched_wakeup_new&#x2F;enable</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-instances-foo-events-sched-sched-switch-enable"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; instances&#x2F;foo&#x2F;events&#x2F;sched&#x2F;sched_switch&#x2F;enable</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-instances-bar-events-irq-enable"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; instances&#x2F;bar&#x2F;events&#x2F;irq&#x2F;enable</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-instances-zoot-events-syscalls-enable"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; instances&#x2F;zoot&#x2F;events&#x2F;syscalls&#x2F;enable</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-trace-pipe"><span class="toc-number"></span> <span class="toc-text">cat trace_pipe</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-instances-foo-trace-pipe"><span class="toc-number"></span> <span class="toc-text">cat instances&#x2F;foo&#x2F;trace_pipe</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-instances-bar-trace-pipe"><span class="toc-number"></span> <span class="toc-text">cat instances&#x2F;bar&#x2F;trace_pipe</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-instances-zoot-trace"><span class="toc-number"></span> <span class="toc-text">cat instances&#x2F;zoot&#x2F;trace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tracer-nop-2"><span class="toc-number"></span> <span class="toc-text">tracer: nop</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-80"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#entries-in-buffer-entries-written-18996-18996-P-4"><span class="toc-number"></span> <span class="toc-text">entries-in-buffer&#x2F;entries-written: 18996&#x2F;18996   #P:4</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-81"><span class="toc-number"></span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%93-gt-irqs-off-19"><span class="toc-number"></span> <span class="toc-text">_—–&#x3D;&gt; irqs-off</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-need-resched-19"><span class="toc-number"></span> <span class="toc-text">&#x2F; _—-&#x3D;&gt; need-resched</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94-gt-hardirq-softirq-19"><span class="toc-number"></span> <span class="toc-text">| &#x2F; _—&#x3D;&gt; hardirq&#x2F;softirq</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%93-gt-preempt-depth-19"><span class="toc-number"></span> <span class="toc-text">|| &#x2F; _–&#x3D;&gt; preempt-depth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delay-19"><span class="toc-number"></span> <span class="toc-text">||| &#x2F;     delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-11"><span class="toc-number"></span> <span class="toc-text">TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-82"><span class="toc-number"></span> <span class="toc-text">| |       |   ||||       |         |</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rmdir-instances-foo"><span class="toc-number"></span> <span class="toc-text">rmdir instances&#x2F;foo</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rmdir-instances-bar"><span class="toc-number"></span> <span class="toc-text">rmdir instances&#x2F;bar</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rmdir-instances-zoot"><span class="toc-number"></span> <span class="toc-text">rmdir instances&#x2F;zoot</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Stack-trace"><span class="toc-number">1.</span> <span class="toc-text">Stack trace</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#echo-1-gt-proc-sys-kernel-stack-tracer-enabled"><span class="toc-number"></span> <span class="toc-text">echo 1 &gt; &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;stack_tracer_enabled</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-stack-max-size"><span class="toc-number"></span> <span class="toc-text">cat stack_max_size</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cat-stack-trace"><span class="toc-number"></span> <span class="toc-text">cat stack_trace</span></a>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-3.10.0-957.el7_ftrace" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-3.10.0-957.el7_ftrace
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/03/13/Kernel-3.10.0-957.el7_ftrace/" class="article-date">
	 published: <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
	</a>
</span>

        
	<a href="/2021/03/13/Kernel-3.10.0-957.el7_ftrace/" class="article-date">
	   updated: <time datetime="2021-03-12T16:00:00.000Z" itemprop="dateUpdated">2021-03-13</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/03/13/Kernel-3.10.0-957.el7_ftrace/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <pre><code>    ftrace - Function Tracer
    ========================
</code></pre>
<p>Copyright 2008 Red Hat Inc.<br>   Author:   Steven Rostedt <a href="mailto:&#x73;&#114;&#x6f;&#115;&#116;&#101;&#x64;&#x74;&#64;&#114;&#101;&#100;&#x68;&#x61;&#x74;&#46;&#x63;&#x6f;&#109;">&#x73;&#114;&#x6f;&#115;&#116;&#101;&#x64;&#x74;&#64;&#114;&#101;&#100;&#x68;&#x61;&#x74;&#46;&#x63;&#x6f;&#109;</a><br>  License:   The GNU Free Documentation License, Version 1.2<br>               (dual licensed under the GPL v2)<br>Reviewers:   Elias Oltmanns, Randy Dunlap, Andrew Morton,<br>         John Kacur, and David Teigland.<br>Written for: 2.6.28-rc2<br>Updated for: 3.10</p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Ftrace is an internal tracer designed to help out developers and<br>designers of systems to find what is going on inside the kernel.<br>It can be used for debugging or analyzing latencies and<br>performance issues that take place outside of user-space.</p>
<p>Although ftrace is typically considered the function tracer, it<br>is really a frame work of several assorted tracing utilities.<br>There’s latency tracing to examine what occurs between interrupts<br>disabled and enabled, as well as for preemption and from a time<br>a task is woken to the task is actually scheduled in.</p>
<p>One of the most common uses of ftrace is the event tracing.<br>Through out the kernel is hundreds of static event points that<br>can be enabled via the debugfs file system to see what is<br>going on in certain parts of the kernel.</p>
<h2 id="Implementation-Details"><a href="#Implementation-Details" class="headerlink" title="Implementation Details"></a>Implementation Details</h2><p>See ftrace-design.txt for details for arch porters and such.</p>
<h2 id="The-File-System"><a href="#The-File-System" class="headerlink" title="The File System"></a>The File System</h2><p>Ftrace uses the debugfs file system to hold the control files as<br>well as the files to display output.</p>
<p>When debugfs is configured into the kernel (which selecting any ftrace<br>option will do) the directory /sys/kernel/debug will be created. To mount<br>this directory, you can add to your /etc/fstab file:</p>
<p> debugfs       /sys/kernel/debug          debugfs defaults        0       0</p>
<p>Or you can mount it at run time with:</p>
<p> mount -t debugfs nodev /sys/kernel/debug</p>
<p>For quicker access to that directory you may want to make a soft link to<br>it:</p>
<p> ln -s /sys/kernel/debug /debug</p>
<p>Any selected ftrace option will also create a directory called tracing<br>within the debugfs. The rest of the document will assume that you are in<br>the ftrace directory (cd /sys/kernel/debug/tracing) and will only concentrate<br>on the files within that directory and not distract from the content with<br>the extended “/sys/kernel/debug/tracing” path name.</p>
<p>That’s it! (assuming that you have ftrace configured into your kernel)</p>
<p>After mounting debugfs, you can see a directory called<br>“tracing”.  This directory contains the control and output files<br>of ftrace. Here is a list of some of the key files:</p>
<p> Note: all time values are in microseconds.</p>
<p>  current_tracer:</p>
<pre><code>This is used to set or display the current tracer
that is configured.
</code></pre>
<p>  available_tracers:</p>
<pre><code>This holds the different types of tracers that
have been compiled into the kernel. The
tracers listed here can be configured by
echoing their name into current_tracer.
</code></pre>
<p>  tracing_on:</p>
<pre><code>This sets or displays whether writing to the trace
ring buffer is enabled. Echo 0 into this file to disable
the tracer or 1 to enable it. Note, this only disables
writing to the ring buffer, the tracing overhead may
still be occurring.
</code></pre>
<p>  trace:</p>
<pre><code>This file holds the output of the trace in a human
readable format (described below).
</code></pre>
<p>  trace_pipe:</p>
<pre><code>The output is the same as the &quot;trace&quot; file but this
file is meant to be streamed with live tracing.
Reads from this file will block until new data is
retrieved.  Unlike the &quot;trace&quot; file, this file is a
consumer. This means reading from this file causes
sequential reads to display more current data. Once
data is read from this file, it is consumed, and
will not be read again with a sequential read. The
&quot;trace&quot; file is static, and if the tracer is not
adding more data,they will display the same
information every time they are read.
</code></pre>
<p>  trace_options:</p>
<pre><code>This file lets the user control the amount of data
that is displayed in one of the above output
files. Options also exist to modify how a tracer
or events work (stack traces, timestamps, etc).
</code></pre>
<p>  options:</p>
<pre><code>This is a directory that has a file for every available
trace option (also in trace_options). Options may also be set
or cleared by writing a &quot;1&quot; or &quot;0&quot; respectively into the
corresponding file with the option name.
</code></pre>
<p>  tracing_max_latency:</p>
<pre><code>Some of the tracers record the max latency.
For example, the time interrupts are disabled.
This time is saved in this file. The max trace
will also be stored, and displayed by &quot;trace&quot;.
A new max trace will only be recorded if the
latency is greater than the value in this
file. (in microseconds)
</code></pre>
<p>  tracing_thresh:</p>
<pre><code>Some latency tracers will record a trace whenever the
latency is greater than the number in this file.
Only active when the file contains a number greater than 0.
(in microseconds)
</code></pre>
<p>  buffer_size_kb:</p>
<pre><code>This sets or displays the number of kilobytes each CPU
buffer holds. By default, the trace buffers are the same size
for each CPU. The displayed number is the size of the
CPU buffer and not total size of all buffers. The
trace buffers are allocated in pages (blocks of memory
that the kernel uses for allocation, usually 4 KB in size).
If the last page allocated has room for more bytes
than requested, the rest of the page will be used,
making the actual allocation bigger than requested.
( Note, the size may not be a multiple of the page size
  due to buffer management meta-data. )
</code></pre>
<p>  buffer_total_size_kb:</p>
<pre><code>This displays the total combined size of all the trace buffers.
</code></pre>
<p>  free_buffer:</p>
<pre><code>If a process is performing the tracing, and the ring buffer
should be shrunk &quot;freed&quot; when the process is finished, even
if it were to be killed by a signal, this file can be used
for that purpose. On close of this file, the ring buffer will
be resized to its minimum size. Having a process that is tracing
also open this file, when the process exits its file descriptor
for this file will be closed, and in doing so, the ring buffer
will be &quot;freed&quot;.

It may also stop tracing if disable_on_free option is set.
</code></pre>
<p>  tracing_cpumask:</p>
<pre><code>This is a mask that lets the user only trace
on specified CPUs. The format is a hex string
representing the CPUs.
</code></pre>
<p>  set_ftrace_filter:</p>
<pre><code>When dynamic ftrace is configured in (see the
section below &quot;dynamic ftrace&quot;), the code is dynamically
modified (code text rewrite) to disable calling of the
function profiler (mcount). This lets tracing be configured
in with practically no overhead in performance.  This also
has a side effect of enabling or disabling specific functions
to be traced. Echoing names of functions into this file
will limit the trace to only those functions.

This interface also allows for commands to be used. See the
&quot;Filter commands&quot; section for more details.
</code></pre>
<p>  set_ftrace_notrace:</p>
<pre><code>This has an effect opposite to that of
set_ftrace_filter. Any function that is added here will not
be traced. If a function exists in both set_ftrace_filter
and set_ftrace_notrace,    the function will _not_ be traced.
</code></pre>
<p>  set_ftrace_pid:</p>
<pre><code>Have the function tracer only trace a single thread.
</code></pre>
<p>  set_graph_function:</p>
<pre><code>Set a &quot;trigger&quot; function where tracing should start
with the function graph tracer (See the section
&quot;dynamic ftrace&quot; for more details).
</code></pre>
<p>  available_filter_functions:</p>
<pre><code>This lists the functions that ftrace
has processed and can trace. These are the function
names that you can pass to &quot;set_ftrace_filter&quot; or
&quot;set_ftrace_notrace&quot;. (See the section &quot;dynamic ftrace&quot;
below for more details.)
</code></pre>
<p>  enabled_functions:</p>
<pre><code>This file is more for debugging ftrace, but can also be useful
in seeing if any function has a callback attached to it.
Not only does the trace infrastructure use ftrace function
trace utility, but other subsystems might too. This file
displays all functions that have a callback attached to them
as well as the number of callbacks that have been attached.
Note, a callback may also call multiple functions which will
not be listed in this count.

If the callback registered to be traced by a function with
the &quot;save regs&quot; attribute (thus even more overhead), a &#39;R&#39;
will be displayed on the same line as the function that
is returning registers.

If the callback registered to be traced by a function with
the &quot;ip modify&quot; attribute (thus the regs-&gt;ip can be changed),
an &#39;I&#39; will be displayed on the same line as the function that
can be overridden.
</code></pre>
<p>  function_profile_enabled:</p>
<pre><code>When set it will enable all functions with either the function
tracer, or if enabled, the function graph tracer. It will
keep a histogram of the number of functions that were called
and if run with the function graph tracer, it will also keep
track of the time spent in those functions. The histogram
content can be displayed in the files:

trace_stats/function&lt;cpu&gt; ( function0, function1, etc).
</code></pre>
<p>  trace_stats:</p>
<pre><code>A directory that holds different tracing stats.
</code></pre>
<p>  kprobe_events:</p>
<pre><code>Enable dynamic trace points. See kprobetrace.txt.
</code></pre>
<p>  kprobe_profile:</p>
<pre><code>Dynamic trace points stats. See kprobetrace.txt.
</code></pre>
<p>  max_graph_depth:</p>
<pre><code>Used with the function graph tracer. This is the max depth
it will trace into a function. Setting this to a value of
one will show only the first kernel function that is called
from user space.
</code></pre>
<p>  printk_formats:</p>
<pre><code>This is for tools that read the raw format files. If an event in
the ring buffer references a string (currently only trace_printk()
does this), only a pointer to the string is recorded into the buffer
and not the string itself. This prevents tools from knowing what
that string was. This file displays the string and address for
the string allowing tools to map the pointers to what the
strings were.
</code></pre>
<p>  saved_cmdlines:</p>
<pre><code>Only the pid of the task is recorded in a trace event unless
the event specifically saves the task comm as well. Ftrace
makes a cache of pid mappings to comms to try to display
comms for events. If a pid for a comm is not listed, then
&quot;&lt;...&gt;&quot; is displayed in the output.
</code></pre>
<p>  snapshot:</p>
<pre><code>This displays the &quot;snapshot&quot; buffer and also lets the user
take a snapshot of the current running trace.
See the &quot;Snapshot&quot; section below for more details.
</code></pre>
<p>  stack_max_size:</p>
<pre><code>When the stack tracer is activated, this will display the
maximum stack size it has encountered.
See the &quot;Stack Trace&quot; section below.
</code></pre>
<p>  stack_trace:</p>
<pre><code>This displays the stack back trace of the largest stack
that was encountered when the stack tracer is activated.
See the &quot;Stack Trace&quot; section below.
</code></pre>
<p>  stack_trace_filter:</p>
<pre><code>This is similar to &quot;set_ftrace_filter&quot; but it limits what
functions the stack tracer will check.
</code></pre>
<p>  trace_clock:</p>
<pre><code>Whenever an event is recorded into the ring buffer, a
&quot;timestamp&quot; is added. This stamp comes from a specified
clock. By default, ftrace uses the &quot;local&quot; clock. This
clock is very fast and strictly per cpu, but on some
systems it may not be monotonic with respect to other
CPUs. In other words, the local clocks may not be in sync
with local clocks on other CPUs.

Usual clocks for tracing:

  # cat trace_clock
  [local] global counter x86-tsc

  local: Default clock, but may not be in sync across CPUs

  global: This clock is in sync with all CPUs but may
        be a bit slower than the local clock.

  counter: This is not a clock at all, but literally an atomic
         counter. It counts up one by one, but is in sync
       with all CPUs. This is useful when you need to
       know exactly the order events occurred with respect to
       each other on different CPUs.

  uptime: This uses the jiffies counter and the time stamp
        is relative to the time since boot up.

  perf: This makes ftrace use the same clock that perf uses.
      Eventually perf will be able to read ftrace buffers
    and this will help out in interleaving the data.

  x86-tsc: Architectures may define their own clocks. For
         example, x86 uses its own TSC cycle clock here.

To set a clock, simply echo the clock name into this file.

  echo global &gt; trace_clock
</code></pre>
<p>  trace_marker:</p>
<pre><code>This is a very useful file for synchronizing user space
with events happening in the kernel. Writing strings into
this file will be written into the ftrace buffer.

It is useful in applications to open this file at the start
of the application and just reference the file descriptor
for the file.

void trace_write(const char *fmt, ...)
&#123;
    va_list ap;
    char buf[256];
    int n;

    if (trace_fd &lt; 0)
        return;

    va_start(ap, fmt);
    n = vsnprintf(buf, 256, fmt, ap);
    va_end(ap);

    write(trace_fd, buf, n);
&#125;

start:

    trace_fd = open(&quot;trace_marker&quot;, WR_ONLY);
</code></pre>
<p>  uprobe_events:</p>
<pre><code>Add dynamic tracepoints in programs.
See uprobetracer.txt
</code></pre>
<p>  uprobe_profile:</p>
<pre><code>Uprobe statistics. See uprobetrace.txt
</code></pre>
<p>  instances:</p>
<pre><code>This is a way to make multiple trace buffers where different
events can be recorded in different buffers.
See &quot;Instances&quot; section below.
</code></pre>
<p>  events:</p>
<pre><code>This is the trace event directory. It holds event tracepoints
(also known as static tracepoints) that have been compiled
into the kernel. It shows what event tracepoints exist
and how they are grouped by system. There are &quot;enable&quot;
files at various levels that can enable the tracepoints
when a &quot;1&quot; is written to them.

See events.txt for more information.
</code></pre>
<p>  per_cpu:</p>
<pre><code>This is a directory that contains the trace per_cpu information.
</code></pre>
<p>  per_cpu/cpu0/buffer_size_kb:</p>
<pre><code>The ftrace buffer is defined per_cpu. That is, there&#39;s a separate
buffer for each CPU to allow writes to be done atomically,
and free from cache bouncing. These buffers may have different
size buffers. This file is similar to the buffer_size_kb
file, but it only displays or sets the buffer size for the
specific CPU. (here cpu0).
</code></pre>
<p>  per_cpu/cpu0/trace:</p>
<pre><code>This is similar to the &quot;trace&quot; file, but it will only display
the data specific for the CPU. If written to, it only clears
the specific CPU buffer.
</code></pre>
<p>  per_cpu/cpu0/trace_pipe</p>
<pre><code>This is similar to the &quot;trace_pipe&quot; file, and is a consuming
read, but it will only display (and consume) the data specific
for the CPU.
</code></pre>
<p>  per_cpu/cpu0/trace_pipe_raw</p>
<pre><code>For tools that can parse the ftrace ring buffer binary format,
the trace_pipe_raw file can be used to extract the data
from the ring buffer directly. With the use of the splice()
system call, the buffer data can be quickly transferred to
a file or to the network where a server is collecting the
data.

Like trace_pipe, this is a consuming reader, where multiple
reads will always produce different data.
</code></pre>
<p>  per_cpu/cpu0/snapshot:</p>
<pre><code>This is similar to the main &quot;snapshot&quot; file, but will only
snapshot the current CPU (if supported). It only displays
the content of the snapshot for a given CPU, and if
written to, only clears this CPU buffer.
</code></pre>
<p>  per_cpu/cpu0/snapshot_raw:</p>
<pre><code>Similar to the trace_pipe_raw, but will read the binary format
from the snapshot buffer for the given CPU.
</code></pre>
<p>  per_cpu/cpu0/stats:</p>
<pre><code>This displays certain stats about the ring buffer:

 entries: The number of events that are still in the buffer.

 overrun: The number of lost events due to overwriting when
       the buffer was full.

 commit overrun: Should always be zero.
     This gets set if so many events happened within a nested
    event (ring buffer is re-entrant), that it fills the
    buffer and starts dropping events.

 bytes: Bytes actually read (not overwritten).

 oldest event ts: The oldest timestamp in the buffer

 now ts: The current timestamp

 dropped events: Events lost due to overwrite option being off.

 read events: The number of events read.
</code></pre>
<h2 id="The-Tracers"><a href="#The-Tracers" class="headerlink" title="The Tracers"></a>The Tracers</h2><p>Here is the list of current tracers that may be configured.</p>
<p>  “function”</p>
<pre><code>Function call tracer to trace all kernel functions.
</code></pre>
<p>  “function_graph”</p>
<pre><code>Similar to the function tracer except that the
function tracer probes the functions on their entry
whereas the function graph tracer traces on both entry
and exit of the functions. It then provides the ability
to draw a graph of function calls similar to C code
source.
</code></pre>
<p>  “irqsoff”</p>
<pre><code>Traces the areas that disable interrupts and saves
the trace with the longest max latency.
See tracing_max_latency. When a new max is recorded,
it replaces the old trace. It is best to view this
trace with the latency-format option enabled.
</code></pre>
<p>  “preemptoff”</p>
<pre><code>Similar to irqsoff but traces and records the amount of
time for which preemption is disabled.
</code></pre>
<p>  “preemptirqsoff”</p>
<pre><code>Similar to irqsoff and preemptoff, but traces and
records the largest time for which irqs and/or preemption
is disabled.
</code></pre>
<p>  “wakeup”</p>
<pre><code>Traces and records the max latency that it takes for
the highest priority task to get scheduled after
it has been woken up.
    Traces all tasks as an average developer would expect.
</code></pre>
<p>  “wakeup_rt”</p>
<pre><code>    Traces and records the max latency that it takes for just
    RT tasks (as the current &quot;wakeup&quot; does). This is useful
    for those interested in wake up timings of RT tasks.
</code></pre>
<p>  “nop”</p>
<pre><code>This is the &quot;trace nothing&quot; tracer. To remove all
tracers from tracing simply echo &quot;nop&quot; into
current_tracer.
</code></pre>
<h2 id="Examples-of-using-the-tracer"><a href="#Examples-of-using-the-tracer" class="headerlink" title="Examples of using the tracer"></a>Examples of using the tracer</h2><p>Here are typical examples of using the tracers when controlling<br>them only with the debugfs interface (without using any<br>user-land utilities).</p>
<h2 id="Output-format"><a href="#Output-format" class="headerlink" title="Output format:"></a>Output format:</h2><p>Here is an example of the output format of the file “trace”</p>
<pre><code>                         --------
</code></pre>
<h1 id="tracer-function"><a href="#tracer-function" class="headerlink" title="tracer: function"></a>tracer: function</h1><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="entries-in-buffer-entries-written-140080-250280-P-4"><a href="#entries-in-buffer-entries-written-140080-250280-P-4" class="headerlink" title="entries-in-buffer/entries-written: 140080/250280   #P:4"></a>entries-in-buffer/entries-written: 140080/250280   #P:4</h1><h1 id="-1"><a href="#-1" class="headerlink" title=""></a></h1><h1 id="—–-gt-irqs-off"><a href="#—–-gt-irqs-off" class="headerlink" title="_—–=&gt; irqs-off"></a>_—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched"><a href="#—-gt-need-resched" class="headerlink" title="/ _—-=&gt; need-resched"></a>/ _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq"><a href="#—-gt-hardirq-softirq" class="headerlink" title="| / _—=&gt; hardirq/softirq"></a>| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth"><a href="#–-gt-preempt-depth" class="headerlink" title="|| / _–=&gt; preempt-depth"></a>|| / _–=&gt; preempt-depth</h1><h1 id="delay"><a href="#delay" class="headerlink" title="||| /     delay"></a>||| /     delay</h1><h1 id="TASK-PID-CPU-TIMESTAMP-FUNCTION"><a href="#TASK-PID-CPU-TIMESTAMP-FUNCTION" class="headerlink" title="TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION"></a>TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</h1><h1 id="-2"><a href="#-2" class="headerlink" title="| |       |   ||||       |         |"></a>| |       |   ||||       |         |</h1><pre><code>        bash-1977  [000] .... 17284.993652: sys_close &lt;-system_call_fastpath
        bash-1977  [000] .... 17284.993653: __close_fd &lt;-sys_close
        bash-1977  [000] .... 17284.993653: _raw_spin_lock &lt;-__close_fd
        sshd-1974  [003] .... 17284.993653: __srcu_read_unlock &lt;-fsnotify
        bash-1977  [000] .... 17284.993654: add_preempt_count &lt;-_raw_spin_lock
        bash-1977  [000] ...1 17284.993655: _raw_spin_unlock &lt;-__close_fd
        bash-1977  [000] ...1 17284.993656: sub_preempt_count &lt;-_raw_spin_unlock
        bash-1977  [000] .... 17284.993657: filp_close &lt;-__close_fd
        bash-1977  [000] .... 17284.993657: dnotify_flush &lt;-filp_close
        sshd-1974  [003] .... 17284.993658: sys_select &lt;-system_call_fastpath
                         --------
</code></pre>
<p>A header is printed with the tracer name that is represented by<br>the trace. In this case the tracer is “function”. Then it shows the<br>number of events in the buffer as well as the total number of entries<br>that were written. The difference is the number of entries that were<br>lost due to the buffer filling up (250280 - 140080 = 110200 events<br>lost).</p>
<p>The header explains the content of the events. Task name “bash”, the task<br>PID “1977”, the CPU that it was running on “000”, the latency format<br>(explained below), the timestamp in <secs>.<usecs> format, the<br>function name that was traced “sys_close” and the parent function that<br>called this function “system_call_fastpath”. The timestamp is the time<br>at which the function was entered.</p>
<h2 id="Latency-trace-format"><a href="#Latency-trace-format" class="headerlink" title="Latency trace format"></a>Latency trace format</h2><p>When the latency-format option is enabled or when one of the latency<br>tracers is set, the trace file gives somewhat more information to see<br>why a latency happened. Here is a typical trace.</p>
<h1 id="tracer-irqsoff"><a href="#tracer-irqsoff" class="headerlink" title="tracer: irqsoff"></a>tracer: irqsoff</h1><h1 id="-3"><a href="#-3" class="headerlink" title=""></a></h1><h1 id="irqsoff-latency-trace-v1-1-5-on-3-8-0-test"><a href="#irqsoff-latency-trace-v1-1-5-on-3-8-0-test" class="headerlink" title="irqsoff latency trace v1.1.5 on 3.8.0-test+"></a>irqsoff latency trace v1.1.5 on 3.8.0-test+</h1><h1 id="——————————————————————–"><a href="#——————————————————————–" class="headerlink" title="——————————————————————–"></a>——————————————————————–</h1><h1 id="latency-259-us-4-4-CPU-2-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><a href="#latency-259-us-4-4-CPU-2-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4" class="headerlink" title="latency: 259 us, #4/4, CPU#2 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)"></a>latency: 259 us, #4/4, CPU#2 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</h1><h1 id="—————–"><a href="#—————–" class="headerlink" title="—————–"></a>—————–</h1><h1 id="task-ps-6143-uid-0-nice-0-policy-0-rt-prio-0"><a href="#task-ps-6143-uid-0-nice-0-policy-0-rt-prio-0" class="headerlink" title="| task: ps-6143 (uid:0 nice:0 policy:0 rt_prio:0)"></a>| task: ps-6143 (uid:0 nice:0 policy:0 rt_prio:0)</h1><h1 id="—————–-1"><a href="#—————–-1" class="headerlink" title="—————–"></a>—————–</h1><h1 id="gt-started-at-lock-task-sighand"><a href="#gt-started-at-lock-task-sighand" class="headerlink" title="=&gt; started at: __lock_task_sighand"></a>=&gt; started at: __lock_task_sighand</h1><h1 id="gt-ended-at-raw-spin-unlock-irqrestore"><a href="#gt-ended-at-raw-spin-unlock-irqrestore" class="headerlink" title="=&gt; ended at:   _raw_spin_unlock_irqrestore"></a>=&gt; ended at:   _raw_spin_unlock_irqrestore</h1><h1 id="-4"><a href="#-4" class="headerlink" title=""></a></h1><h1 id="-5"><a href="#-5" class="headerlink" title=""></a></h1><h1 id="——-gt-CPU"><a href="#——-gt-CPU" class="headerlink" title="_——=&gt; CPU#"></a>_——=&gt; CPU#</h1><h1 id="—–-gt-irqs-off-1"><a href="#—–-gt-irqs-off-1" class="headerlink" title="/ _—–=&gt; irqs-off"></a>/ _—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-1"><a href="#—-gt-need-resched-1" class="headerlink" title="| / _—-=&gt; need-resched"></a>| / _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-1"><a href="#—-gt-hardirq-softirq-1" class="headerlink" title="|| / _—=&gt; hardirq/softirq"></a>|| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-1"><a href="#–-gt-preempt-depth-1" class="headerlink" title="||| / _–=&gt; preempt-depth"></a>||| / _–=&gt; preempt-depth</h1><h1 id="delay-1"><a href="#delay-1" class="headerlink" title="|||| /     delay"></a>|||| /     delay</h1><h1 id="cmd-pid-time-caller"><a href="#cmd-pid-time-caller" class="headerlink" title="cmd     pid   ||||| time  |   caller"></a>cmd     pid   ||||| time  |   caller</h1><h1 id="-6"><a href="#-6" class="headerlink" title="\   /      |||||  \    |   /"></a>\   /      |||||  \    |   /</h1><pre><code>  ps-6143    2d...    0us!: trace_hardirqs_off &lt;-__lock_task_sighand
  ps-6143    2d..1  259us+: trace_hardirqs_on &lt;-_raw_spin_unlock_irqrestore
  ps-6143    2d..1  263us+: time_hardirqs_on &lt;-_raw_spin_unlock_irqrestore
  ps-6143    2d..1  306us : &lt;stack trace&gt;
</code></pre>
<p> =&gt; trace_hardirqs_on_caller<br> =&gt; trace_hardirqs_on<br> =&gt; _raw_spin_unlock_irqrestore<br> =&gt; do_task_stat<br> =&gt; proc_tgid_stat<br> =&gt; proc_single_show<br> =&gt; seq_read<br> =&gt; vfs_read<br> =&gt; sys_read<br> =&gt; system_call_fastpath</p>
<p>This shows that the current tracer is “irqsoff” tracing the time<br>for which interrupts were disabled. It gives the trace version (which<br>never changes) and the version of the kernel upon which this was executed on<br>(3.10). Then it displays the max latency in microseconds (259 us). The number<br>of trace entries displayed and the total number (both are four: #4/4).<br>VP, KP, SP, and HP are always zero and are reserved for later use.<br>#P is the number of online CPUs (#P:4).</p>
<p>The task is the process that was running when the latency<br>occurred. (ps pid: 6143).</p>
<p>The start and stop (the functions in which the interrupts were<br>disabled and enabled respectively) that caused the latencies:</p>
<p> __lock_task_sighand is where the interrupts were disabled.<br> _raw_spin_unlock_irqrestore is where they were enabled again.</p>
<p>The next lines after the header are the trace itself. The header<br>explains which is which.</p>
<p>  cmd: The name of the process in the trace.</p>
<p>  pid: The PID of that process.</p>
<p>  CPU#: The CPU which the process was running on.</p>
<p>  irqs-off: ‘d’ interrupts are disabled. ‘.’ otherwise.<br>        Note: If the architecture does not support a way to<br>          read the irq flags variable, an ‘X’ will always<br>          be printed here.</p>
<p>  need-resched: ‘N’ task need_resched is set, ‘.’ otherwise.</p>
<p>  hardirq/softirq:<br>    ‘H’ - hard irq occurred inside a softirq.<br>    ‘h’ - hard irq is running<br>    ‘s’ - soft irq is running<br>    ‘.’ - normal context.</p>
<p>  preempt-depth: The level of preempt_disabled</p>
<p>The above is mostly meaningful for kernel developers.</p>
<p>  time: When the latency-format option is enabled, the trace file<br>    output includes a timestamp relative to the start of the<br>    trace. This differs from the output when latency-format<br>    is disabled, which includes an absolute timestamp.</p>
<p>  delay: This is just to help catch your eye a bit better. And<br>     needs to be fixed to be only relative to the same CPU.<br>     The marks are determined by the difference between this<br>     current trace and the next trace.<br>      ‘!’ - greater than preempt_mark_thresh (default 100)<br>      ‘+’ - greater than 1 microsecond<br>      ‘ ‘ - less than or equal to 1 microsecond.</p>
<p>  The rest is the same as the ‘trace’ file.</p>
<p>  Note, the latency tracers will usually end with a back trace<br>  to easily find where the latency occurred.</p>
<h2 id="trace-options"><a href="#trace-options" class="headerlink" title="trace_options"></a>trace_options</h2><p>The trace_options file (or the options directory) is used to control<br>what gets printed in the trace output, or manipulate the tracers.<br>To see what is available, simply cat the file:</p>
<p>  cat trace_options<br>print-parent<br>nosym-offset<br>nosym-addr<br>noverbose<br>noraw<br>nohex<br>nobin<br>noblock<br>nostacktrace<br>trace_printk<br>noftrace_preempt<br>nobranch<br>annotate<br>nouserstacktrace<br>nosym-userobj<br>noprintk-msg-only<br>context-info<br>latency-format<br>sleep-time<br>graph-time<br>record-cmd<br>overwrite<br>nodisable_on_free<br>irq-info<br>markers<br>function-trace</p>
<p>To disable one of the options, echo in the option prepended with<br>“no”.</p>
<p>  echo noprint-parent &gt; trace_options</p>
<p>To enable an option, leave off the “no”.</p>
<p>  echo sym-offset &gt; trace_options</p>
<p>Here are the available options:</p>
<p>  print-parent - On function traces, display the calling (parent)<br>         function as well as the function being traced.</p>
<p>  print-parent:<br>   bash-4000  [01]  1477.606694: simple_strtoul &lt;-kstrtoul</p>
<p>  noprint-parent:<br>   bash-4000  [01]  1477.606694: simple_strtoul</p>
<p>  sym-offset - Display not only the function name, but also the<br>           offset in the function. For example, instead of<br>           seeing just “ktime_get”, you will see<br>           “ktime_get+0xb/0x20”.</p>
<p>  sym-offset:<br>   bash-4000  [01]  1477.606694: simple_strtoul+0x6/0xa0</p>
<p>  sym-addr - this will also display the function address as well<br>         as the function name.</p>
<p>  sym-addr:<br>   bash-4000  [01]  1477.606694: simple_strtoul <c0339346></p>
<p>  verbose - This deals with the trace file when the<br>            latency-format option is enabled.</p>
<pre><code>bash  4000 1 0 00000000 00010a95 [58127d26] 1720.415ms \
(+0.000ms): simple_strtoul (kstrtoul)
</code></pre>
<p>  raw - This will display raw numbers. This option is best for<br>    use with user applications that can translate the raw<br>    numbers better than having it done in the kernel.</p>
<p>  hex - Similar to raw, but the numbers will be in a hexadecimal<br>    format.</p>
<p>  bin - This will print out the formats in raw binary.</p>
<p>  block - When set, reading trace_pipe will not block when polled.</p>
<p>  stacktrace - This is one of the options that changes the trace<br>           itself. When a trace is recorded, so is the stack<br>           of functions. This allows for back traces of<br>           trace sites.</p>
<p>  trace_printk - Can disable trace_printk() from writing into the buffer.</p>
<p>  branch - Enable branch tracing with the tracer.</p>
<p>  annotate - It is sometimes confusing when the CPU buffers are full<br>           and one CPU buffer had a lot of events recently, thus<br>         a shorter time frame, were another CPU may have only had<br>         a few events, which lets it have older events. When<br>         the trace is reported, it shows the oldest events first,<br>         and it may look like only one CPU ran (the one with the<br>         oldest events). When the annotate option is set, it will<br>         display when a new CPU buffer started:</p>
<pre><code>      &lt;idle&gt;-0     [001] dNs4 21169.031481: wake_up_idle_cpu &lt;-add_timer_on
      &lt;idle&gt;-0     [001] dNs4 21169.031482: _raw_spin_unlock_irqrestore &lt;-add_timer_on
      &lt;idle&gt;-0     [001] .Ns4 21169.031484: sub_preempt_count &lt;-_raw_spin_unlock_irqrestore
</code></pre>
<h5 id="CPU-2-buffer-started"><a href="#CPU-2-buffer-started" class="headerlink" title="CPU 2 buffer started"></a>CPU 2 buffer started</h5><pre><code>      &lt;idle&gt;-0     [002] .N.1 21169.031484: rcu_idle_exit &lt;-cpu_idle
      &lt;idle&gt;-0     [001] .Ns3 21169.031484: _raw_spin_unlock &lt;-clocksource_watchdog
      &lt;idle&gt;-0     [001] .Ns3 21169.031485: sub_preempt_count &lt;-_raw_spin_unlock
</code></pre>
<p>  userstacktrace - This option changes the trace. It records a<br>           stacktrace of the current userspace thread.</p>
<p>  sym-userobj - when user stacktrace are enabled, look up which<br>        object the address belongs to, and print a<br>        relative address. This is especially useful when<br>        ASLR is on, otherwise you don’t get a chance to<br>        resolve the address to object/file/line after<br>        the app is no longer running</p>
<pre><code>    The lookup is performed when you read
    trace,trace_pipe. Example:

    a.out-1623  [000] 40874.465068: /root/a.out[+0x480] &lt;-/root/a.out[+0
</code></pre>
<p>x494] &lt;- /root/a.out[+0x4a8] &lt;- /lib/libc-2.7.so[+0x1e1a6]</p>
<p>  printk-msg-only - When set, trace_printk()s will only show the format<br>              and not their parameters (if trace_bprintk() or<br>            trace_bputs() was used to save the trace_printk()).</p>
<p>  context-info - Show only the event data. Hides the comm, PID,<br>               timestamp, CPU, and other useful data.</p>
<p>  latency-format - This option changes the trace. When<br>                   it is enabled, the trace displays<br>                   additional information about the<br>                   latencies, as described in “Latency<br>                   trace format”.</p>
<p>  sleep-time - When running function graph tracer, to include<br>             the time a task schedules out in its function.<br>           When enabled, it will account time the task has been<br>           scheduled out as part of the function call.</p>
<p>  graph-time - When running function graph tracer, to include the<br>             time to call nested functions. When this is not set,<br>           the time reported for the function will only include<br>           the time the function itself executed for, not the time<br>           for functions that it called.</p>
<p>  record-cmd - When any event or tracer is enabled, a hook is enabled<br>             in the sched_switch trace point to fill comm cache<br>           with mapped pids and comms. But this may cause some<br>           overhead, and if you only care about pids, and not the<br>           name of the task, disabling this option can lower the<br>           impact of tracing.</p>
<p>  overwrite - This controls what happens when the trace buffer is<br>              full. If “1” (default), the oldest events are<br>              discarded and overwritten. If “0”, then the newest<br>              events are discarded.<br>            (see per_cpu/cpu0/stats for overrun and dropped)</p>
<p>  disable_on_free - When the free_buffer is closed, tracing will<br>              stop (tracing_on set to 0).</p>
<p>  irq-info - Shows the interrupt, preempt count, need resched data.<br>           When disabled, the trace looks like:</p>
<h1 id="tracer-function-1"><a href="#tracer-function-1" class="headerlink" title="tracer: function"></a>tracer: function</h1><h1 id="-7"><a href="#-7" class="headerlink" title=""></a></h1><h1 id="entries-in-buffer-entries-written-144405-9452052-P-4"><a href="#entries-in-buffer-entries-written-144405-9452052-P-4" class="headerlink" title="entries-in-buffer/entries-written: 144405/9452052   #P:4"></a>entries-in-buffer/entries-written: 144405/9452052   #P:4</h1><h1 id="-8"><a href="#-8" class="headerlink" title=""></a></h1><h1 id="TASK-PID-CPU-TIMESTAMP-FUNCTION-1"><a href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-1" class="headerlink" title="TASK-PID   CPU#      TIMESTAMP  FUNCTION"></a>TASK-PID   CPU#      TIMESTAMP  FUNCTION</h1><h1 id="-9"><a href="#-9" class="headerlink" title="| |       |          |         |"></a>| |       |          |         |</h1><pre><code>      &lt;idle&gt;-0     [002]  23636.756054: ttwu_do_activate.constprop.89 &lt;-try_to_wake_up
      &lt;idle&gt;-0     [002]  23636.756054: activate_task &lt;-ttwu_do_activate.constprop.89
      &lt;idle&gt;-0     [002]  23636.756055: enqueue_task &lt;-activate_task
</code></pre>
<p>  markers - When set, the trace_marker is writable (only by root).<br>          When disabled, the trace_marker will error with EINVAL<br>        on write.</p>
<p>  function-trace - The latency tracers will enable function tracing<br>          if this option is enabled (default it is). When<br>        it is disabled, the latency tracers do not trace<br>        functions. This keeps the overhead of the tracer down<br>        when performing latency tests.</p>
<p> Note: Some tracers have their own options. They only appear<br>       when the tracer is active.</p>
<h2 id="irqsoff"><a href="#irqsoff" class="headerlink" title="irqsoff"></a>irqsoff</h2><p>When interrupts are disabled, the CPU can not react to any other<br>external event (besides NMIs and SMIs). This prevents the timer<br>interrupt from triggering or the mouse interrupt from letting<br>the kernel know of a new mouse event. The result is a latency<br>with the reaction time.</p>
<p>The irqsoff tracer tracks the time for which interrupts are<br>disabled. When a new maximum latency is hit, the tracer saves<br>the trace leading up to that latency point so that every time a<br>new maximum is reached, the old saved trace is discarded and the<br>new trace is saved.</p>
<p>To reset the maximum, echo 0 into tracing_max_latency. Here is<br>an example:</p>
<h1 id="echo-0-gt-options-function-trace"><a href="#echo-0-gt-options-function-trace" class="headerlink" title="echo 0 &gt; options/function-trace"></a>echo 0 &gt; options/function-trace</h1><h1 id="echo-irqsoff-gt-current-tracer"><a href="#echo-irqsoff-gt-current-tracer" class="headerlink" title="echo irqsoff &gt; current_tracer"></a>echo irqsoff &gt; current_tracer</h1><h1 id="echo-1-gt-tracing-on"><a href="#echo-1-gt-tracing-on" class="headerlink" title="echo 1 &gt; tracing_on"></a>echo 1 &gt; tracing_on</h1><h1 id="echo-0-gt-tracing-max-latency"><a href="#echo-0-gt-tracing-max-latency" class="headerlink" title="echo 0 &gt; tracing_max_latency"></a>echo 0 &gt; tracing_max_latency</h1><h1 id="ls-ltr"><a href="#ls-ltr" class="headerlink" title="ls -ltr"></a>ls -ltr</h1><p> […]</p>
<h1 id="echo-0-gt-tracing-on"><a href="#echo-0-gt-tracing-on" class="headerlink" title="echo 0 &gt; tracing_on"></a>echo 0 &gt; tracing_on</h1><h1 id="cat-trace"><a href="#cat-trace" class="headerlink" title="cat trace"></a>cat trace</h1><h1 id="tracer-irqsoff-1"><a href="#tracer-irqsoff-1" class="headerlink" title="tracer: irqsoff"></a>tracer: irqsoff</h1><h1 id="-10"><a href="#-10" class="headerlink" title=""></a></h1><h1 id="irqsoff-latency-trace-v1-1-5-on-3-8-0-test-1"><a href="#irqsoff-latency-trace-v1-1-5-on-3-8-0-test-1" class="headerlink" title="irqsoff latency trace v1.1.5 on 3.8.0-test+"></a>irqsoff latency trace v1.1.5 on 3.8.0-test+</h1><h1 id="——————————————————————–-1"><a href="#——————————————————————–-1" class="headerlink" title="——————————————————————–"></a>——————————————————————–</h1><h1 id="latency-16-us-4-4-CPU-0-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><a href="#latency-16-us-4-4-CPU-0-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4" class="headerlink" title="latency: 16 us, #4/4, CPU#0 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)"></a>latency: 16 us, #4/4, CPU#0 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</h1><h1 id="—————–-2"><a href="#—————–-2" class="headerlink" title="—————–"></a>—————–</h1><h1 id="task-swapper-0-0-uid-0-nice-0-policy-0-rt-prio-0"><a href="#task-swapper-0-0-uid-0-nice-0-policy-0-rt-prio-0" class="headerlink" title="| task: swapper/0-0 (uid:0 nice:0 policy:0 rt_prio:0)"></a>| task: swapper/0-0 (uid:0 nice:0 policy:0 rt_prio:0)</h1><h1 id="—————–-3"><a href="#—————–-3" class="headerlink" title="—————–"></a>—————–</h1><h1 id="gt-started-at-run-timer-softirq"><a href="#gt-started-at-run-timer-softirq" class="headerlink" title="=&gt; started at: run_timer_softirq"></a>=&gt; started at: run_timer_softirq</h1><h1 id="gt-ended-at-run-timer-softirq"><a href="#gt-ended-at-run-timer-softirq" class="headerlink" title="=&gt; ended at:   run_timer_softirq"></a>=&gt; ended at:   run_timer_softirq</h1><h1 id="-11"><a href="#-11" class="headerlink" title=""></a></h1><h1 id="-12"><a href="#-12" class="headerlink" title=""></a></h1><h1 id="——-gt-CPU-1"><a href="#——-gt-CPU-1" class="headerlink" title="_——=&gt; CPU#"></a>_——=&gt; CPU#</h1><h1 id="—–-gt-irqs-off-2"><a href="#—–-gt-irqs-off-2" class="headerlink" title="/ _—–=&gt; irqs-off"></a>/ _—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-2"><a href="#—-gt-need-resched-2" class="headerlink" title="| / _—-=&gt; need-resched"></a>| / _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-2"><a href="#—-gt-hardirq-softirq-2" class="headerlink" title="|| / _—=&gt; hardirq/softirq"></a>|| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-2"><a href="#–-gt-preempt-depth-2" class="headerlink" title="||| / _–=&gt; preempt-depth"></a>||| / _–=&gt; preempt-depth</h1><h1 id="delay-2"><a href="#delay-2" class="headerlink" title="|||| /     delay"></a>|||| /     delay</h1><h1 id="cmd-pid-time-caller-1"><a href="#cmd-pid-time-caller-1" class="headerlink" title="cmd     pid   ||||| time  |   caller"></a>cmd     pid   ||||| time  |   caller</h1><h1 id="-13"><a href="#-13" class="headerlink" title="\   /      |||||  \    |   /"></a>\   /      |||||  \    |   /</h1><p>  <idle>-0       0d.s2    0us+: _raw_spin_lock_irq &lt;-run_timer_softirq<br>  <idle>-0       0dNs3   17us : _raw_spin_unlock_irq &lt;-run_timer_softirq<br>  <idle>-0       0dNs3   17us+: trace_hardirqs_on &lt;-run_timer_softirq<br>  <idle>-0       0dNs3   25us : <stack trace><br> =&gt; _raw_spin_unlock_irq<br> =&gt; run_timer_softirq<br> =&gt; __do_softirq<br> =&gt; call_softirq<br> =&gt; do_softirq<br> =&gt; irq_exit<br> =&gt; smp_apic_timer_interrupt<br> =&gt; apic_timer_interrupt<br> =&gt; rcu_idle_exit<br> =&gt; cpu_idle<br> =&gt; rest_init<br> =&gt; start_kernel<br> =&gt; x86_64_start_reservations<br> =&gt; x86_64_start_kernel</p>
<p>Here we see that that we had a latency of 16 microseconds (which is<br>very good). The _raw_spin_lock_irq in run_timer_softirq disabled<br>interrupts. The difference between the 16 and the displayed<br>timestamp 25us occurred because the clock was incremented<br>between the time of recording the max latency and the time of<br>recording the function that had that latency.</p>
<p>Note the above example had function-trace not set. If we set<br>function-trace, we get a much larger output:</p>
<p> with echo 1 &gt; options/function-trace</p>
<h1 id="tracer-irqsoff-2"><a href="#tracer-irqsoff-2" class="headerlink" title="tracer: irqsoff"></a>tracer: irqsoff</h1><h1 id="-14"><a href="#-14" class="headerlink" title=""></a></h1><h1 id="irqsoff-latency-trace-v1-1-5-on-3-8-0-test-2"><a href="#irqsoff-latency-trace-v1-1-5-on-3-8-0-test-2" class="headerlink" title="irqsoff latency trace v1.1.5 on 3.8.0-test+"></a>irqsoff latency trace v1.1.5 on 3.8.0-test+</h1><h1 id="——————————————————————–-2"><a href="#——————————————————————–-2" class="headerlink" title="——————————————————————–"></a>——————————————————————–</h1><h1 id="latency-71-us-168-168-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><a href="#latency-71-us-168-168-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4" class="headerlink" title="latency: 71 us, #168/168, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)"></a>latency: 71 us, #168/168, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</h1><h1 id="—————–-4"><a href="#—————–-4" class="headerlink" title="—————–"></a>—————–</h1><h1 id="task-bash-2042-uid-0-nice-0-policy-0-rt-prio-0"><a href="#task-bash-2042-uid-0-nice-0-policy-0-rt-prio-0" class="headerlink" title="| task: bash-2042 (uid:0 nice:0 policy:0 rt_prio:0)"></a>| task: bash-2042 (uid:0 nice:0 policy:0 rt_prio:0)</h1><h1 id="—————–-5"><a href="#—————–-5" class="headerlink" title="—————–"></a>—————–</h1><h1 id="gt-started-at-ata-scsi-queuecmd"><a href="#gt-started-at-ata-scsi-queuecmd" class="headerlink" title="=&gt; started at: ata_scsi_queuecmd"></a>=&gt; started at: ata_scsi_queuecmd</h1><h1 id="gt-ended-at-ata-scsi-queuecmd"><a href="#gt-ended-at-ata-scsi-queuecmd" class="headerlink" title="=&gt; ended at:   ata_scsi_queuecmd"></a>=&gt; ended at:   ata_scsi_queuecmd</h1><h1 id="-15"><a href="#-15" class="headerlink" title=""></a></h1><h1 id="-16"><a href="#-16" class="headerlink" title=""></a></h1><h1 id="——-gt-CPU-2"><a href="#——-gt-CPU-2" class="headerlink" title="_——=&gt; CPU#"></a>_——=&gt; CPU#</h1><h1 id="—–-gt-irqs-off-3"><a href="#—–-gt-irqs-off-3" class="headerlink" title="/ _—–=&gt; irqs-off"></a>/ _—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-3"><a href="#—-gt-need-resched-3" class="headerlink" title="| / _—-=&gt; need-resched"></a>| / _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-3"><a href="#—-gt-hardirq-softirq-3" class="headerlink" title="|| / _—=&gt; hardirq/softirq"></a>|| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-3"><a href="#–-gt-preempt-depth-3" class="headerlink" title="||| / _–=&gt; preempt-depth"></a>||| / _–=&gt; preempt-depth</h1><h1 id="delay-3"><a href="#delay-3" class="headerlink" title="|||| /     delay"></a>|||| /     delay</h1><h1 id="cmd-pid-time-caller-2"><a href="#cmd-pid-time-caller-2" class="headerlink" title="cmd     pid   ||||| time  |   caller"></a>cmd     pid   ||||| time  |   caller</h1><h1 id="-17"><a href="#-17" class="headerlink" title="\   /      |||||  \    |   /"></a>\   /      |||||  \    |   /</h1><pre><code>bash-2042    3d...    0us : _raw_spin_lock_irqsave &lt;-ata_scsi_queuecmd
bash-2042    3d...    0us : add_preempt_count &lt;-_raw_spin_lock_irqsave
bash-2042    3d..1    1us : ata_scsi_find_dev &lt;-ata_scsi_queuecmd
bash-2042    3d..1    1us : __ata_scsi_find_dev &lt;-ata_scsi_find_dev
bash-2042    3d..1    2us : ata_find_dev.part.14 &lt;-__ata_scsi_find_dev
bash-2042    3d..1    2us : ata_qc_new_init &lt;-__ata_scsi_queuecmd
bash-2042    3d..1    3us : ata_sg_init &lt;-__ata_scsi_queuecmd
bash-2042    3d..1    4us : ata_scsi_rw_xlat &lt;-__ata_scsi_queuecmd
bash-2042    3d..1    4us : ata_build_rw_tf &lt;-ata_scsi_rw_xlat
</code></pre>
<p>[…]<br>    bash-2042    3d..1   67us : delay_tsc &lt;-__delay<br>    bash-2042    3d..1   67us : add_preempt_count &lt;-delay_tsc<br>    bash-2042    3d..2   67us : sub_preempt_count &lt;-delay_tsc<br>    bash-2042    3d..1   67us : add_preempt_count &lt;-delay_tsc<br>    bash-2042    3d..2   68us : sub_preempt_count &lt;-delay_tsc<br>    bash-2042    3d..1   68us+: ata_bmdma_start &lt;-ata_bmdma_qc_issue<br>    bash-2042    3d..1   71us : _raw_spin_unlock_irqrestore &lt;-ata_scsi_queuecmd<br>    bash-2042    3d..1   71us : _raw_spin_unlock_irqrestore &lt;-ata_scsi_queuecmd<br>    bash-2042    3d..1   72us+: trace_hardirqs_on &lt;-ata_scsi_queuecmd<br>    bash-2042    3d..1  120us : <stack trace><br> =&gt; _raw_spin_unlock_irqrestore<br> =&gt; ata_scsi_queuecmd<br> =&gt; scsi_dispatch_cmd<br> =&gt; scsi_request_fn<br> =&gt; __blk_run_queue_uncond<br> =&gt; __blk_run_queue<br> =&gt; blk_queue_bio<br> =&gt; generic_make_request<br> =&gt; submit_bio<br> =&gt; submit_bh<br> =&gt; __ext3_get_inode_loc<br> =&gt; ext3_iget<br> =&gt; ext3_lookup<br> =&gt; lookup_real<br> =&gt; __lookup_hash<br> =&gt; walk_component<br> =&gt; lookup_last<br> =&gt; path_lookupat<br> =&gt; filename_lookup<br> =&gt; user_path_at_empty<br> =&gt; user_path_at<br> =&gt; vfs_fstatat<br> =&gt; vfs_stat<br> =&gt; sys_newstat<br> =&gt; system_call_fastpath</p>
<p>Here we traced a 71 microsecond latency. But we also see all the<br>functions that were called during that time. Note that by<br>enabling function tracing, we incur an added overhead. This<br>overhead may extend the latency times. But nevertheless, this<br>trace has provided some very helpful debugging information.</p>
<h2 id="preemptoff"><a href="#preemptoff" class="headerlink" title="preemptoff"></a>preemptoff</h2><p>When preemption is disabled, we may be able to receive<br>interrupts but the task cannot be preempted and a higher<br>priority task must wait for preemption to be enabled again<br>before it can preempt a lower priority task.</p>
<p>The preemptoff tracer traces the places that disable preemption.<br>Like the irqsoff tracer, it records the maximum latency for<br>which preemption was disabled. The control of preemptoff tracer<br>is much like the irqsoff tracer.</p>
<h1 id="echo-0-gt-options-function-trace-1"><a href="#echo-0-gt-options-function-trace-1" class="headerlink" title="echo 0 &gt; options/function-trace"></a>echo 0 &gt; options/function-trace</h1><h1 id="echo-preemptoff-gt-current-tracer"><a href="#echo-preemptoff-gt-current-tracer" class="headerlink" title="echo preemptoff &gt; current_tracer"></a>echo preemptoff &gt; current_tracer</h1><h1 id="echo-1-gt-tracing-on-1"><a href="#echo-1-gt-tracing-on-1" class="headerlink" title="echo 1 &gt; tracing_on"></a>echo 1 &gt; tracing_on</h1><h1 id="echo-0-gt-tracing-max-latency-1"><a href="#echo-0-gt-tracing-max-latency-1" class="headerlink" title="echo 0 &gt; tracing_max_latency"></a>echo 0 &gt; tracing_max_latency</h1><h1 id="ls-ltr-1"><a href="#ls-ltr-1" class="headerlink" title="ls -ltr"></a>ls -ltr</h1><p> […]</p>
<h1 id="echo-0-gt-tracing-on-1"><a href="#echo-0-gt-tracing-on-1" class="headerlink" title="echo 0 &gt; tracing_on"></a>echo 0 &gt; tracing_on</h1><h1 id="cat-trace-1"><a href="#cat-trace-1" class="headerlink" title="cat trace"></a>cat trace</h1><h1 id="tracer-preemptoff"><a href="#tracer-preemptoff" class="headerlink" title="tracer: preemptoff"></a>tracer: preemptoff</h1><h1 id="-18"><a href="#-18" class="headerlink" title=""></a></h1><h1 id="preemptoff-latency-trace-v1-1-5-on-3-8-0-test"><a href="#preemptoff-latency-trace-v1-1-5-on-3-8-0-test" class="headerlink" title="preemptoff latency trace v1.1.5 on 3.8.0-test+"></a>preemptoff latency trace v1.1.5 on 3.8.0-test+</h1><h1 id="——————————————————————–-3"><a href="#——————————————————————–-3" class="headerlink" title="——————————————————————–"></a>——————————————————————–</h1><h1 id="latency-46-us-4-4-CPU-1-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><a href="#latency-46-us-4-4-CPU-1-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4" class="headerlink" title="latency: 46 us, #4/4, CPU#1 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)"></a>latency: 46 us, #4/4, CPU#1 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</h1><h1 id="—————–-6"><a href="#—————–-6" class="headerlink" title="—————–"></a>—————–</h1><h1 id="task-sshd-1991-uid-0-nice-0-policy-0-rt-prio-0"><a href="#task-sshd-1991-uid-0-nice-0-policy-0-rt-prio-0" class="headerlink" title="| task: sshd-1991 (uid:0 nice:0 policy:0 rt_prio:0)"></a>| task: sshd-1991 (uid:0 nice:0 policy:0 rt_prio:0)</h1><h1 id="—————–-7"><a href="#—————–-7" class="headerlink" title="—————–"></a>—————–</h1><h1 id="gt-started-at-do-IRQ"><a href="#gt-started-at-do-IRQ" class="headerlink" title="=&gt; started at: do_IRQ"></a>=&gt; started at: do_IRQ</h1><h1 id="gt-ended-at-do-IRQ"><a href="#gt-ended-at-do-IRQ" class="headerlink" title="=&gt; ended at:   do_IRQ"></a>=&gt; ended at:   do_IRQ</h1><h1 id="-19"><a href="#-19" class="headerlink" title=""></a></h1><h1 id="-20"><a href="#-20" class="headerlink" title=""></a></h1><h1 id="——-gt-CPU-3"><a href="#——-gt-CPU-3" class="headerlink" title="_——=&gt; CPU#"></a>_——=&gt; CPU#</h1><h1 id="—–-gt-irqs-off-4"><a href="#—–-gt-irqs-off-4" class="headerlink" title="/ _—–=&gt; irqs-off"></a>/ _—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-4"><a href="#—-gt-need-resched-4" class="headerlink" title="| / _—-=&gt; need-resched"></a>| / _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-4"><a href="#—-gt-hardirq-softirq-4" class="headerlink" title="|| / _—=&gt; hardirq/softirq"></a>|| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-4"><a href="#–-gt-preempt-depth-4" class="headerlink" title="||| / _–=&gt; preempt-depth"></a>||| / _–=&gt; preempt-depth</h1><h1 id="delay-4"><a href="#delay-4" class="headerlink" title="|||| /     delay"></a>|||| /     delay</h1><h1 id="cmd-pid-time-caller-3"><a href="#cmd-pid-time-caller-3" class="headerlink" title="cmd     pid   ||||| time  |   caller"></a>cmd     pid   ||||| time  |   caller</h1><h1 id="-21"><a href="#-21" class="headerlink" title="\   /      |||||  \    |   /"></a>\   /      |||||  \    |   /</h1><pre><code>sshd-1991    1d.h.    0us+: irq_enter &lt;-do_IRQ
sshd-1991    1d..1   46us : irq_exit &lt;-do_IRQ
sshd-1991    1d..1   47us+: trace_preempt_on &lt;-do_IRQ
sshd-1991    1d..1   52us : &lt;stack trace&gt;
</code></pre>
<p> =&gt; sub_preempt_count<br> =&gt; irq_exit<br> =&gt; do_IRQ<br> =&gt; ret_from_intr</p>
<p>This has some more changes. Preemption was disabled when an<br>interrupt came in (notice the ‘h’), and was enabled on exit.<br>But we also see that interrupts have been disabled when entering<br>the preempt off section and leaving it (the ‘d’). We do not know if<br>interrupts were enabled in the mean time or shortly after this<br>was over.</p>
<h1 id="tracer-preemptoff-1"><a href="#tracer-preemptoff-1" class="headerlink" title="tracer: preemptoff"></a>tracer: preemptoff</h1><h1 id="-22"><a href="#-22" class="headerlink" title=""></a></h1><h1 id="preemptoff-latency-trace-v1-1-5-on-3-8-0-test-1"><a href="#preemptoff-latency-trace-v1-1-5-on-3-8-0-test-1" class="headerlink" title="preemptoff latency trace v1.1.5 on 3.8.0-test+"></a>preemptoff latency trace v1.1.5 on 3.8.0-test+</h1><h1 id="——————————————————————–-4"><a href="#——————————————————————–-4" class="headerlink" title="——————————————————————–"></a>——————————————————————–</h1><h1 id="latency-83-us-241-241-CPU-1-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><a href="#latency-83-us-241-241-CPU-1-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4" class="headerlink" title="latency: 83 us, #241/241, CPU#1 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)"></a>latency: 83 us, #241/241, CPU#1 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</h1><h1 id="—————–-8"><a href="#—————–-8" class="headerlink" title="—————–"></a>—————–</h1><h1 id="task-bash-1994-uid-0-nice-0-policy-0-rt-prio-0"><a href="#task-bash-1994-uid-0-nice-0-policy-0-rt-prio-0" class="headerlink" title="| task: bash-1994 (uid:0 nice:0 policy:0 rt_prio:0)"></a>| task: bash-1994 (uid:0 nice:0 policy:0 rt_prio:0)</h1><h1 id="—————–-9"><a href="#—————–-9" class="headerlink" title="—————–"></a>—————–</h1><h1 id="gt-started-at-wake-up-new-task"><a href="#gt-started-at-wake-up-new-task" class="headerlink" title="=&gt; started at: wake_up_new_task"></a>=&gt; started at: wake_up_new_task</h1><h1 id="gt-ended-at-task-rq-unlock"><a href="#gt-ended-at-task-rq-unlock" class="headerlink" title="=&gt; ended at:   task_rq_unlock"></a>=&gt; ended at:   task_rq_unlock</h1><h1 id="-23"><a href="#-23" class="headerlink" title=""></a></h1><h1 id="-24"><a href="#-24" class="headerlink" title=""></a></h1><h1 id="——-gt-CPU-4"><a href="#——-gt-CPU-4" class="headerlink" title="_——=&gt; CPU#"></a>_——=&gt; CPU#</h1><h1 id="—–-gt-irqs-off-5"><a href="#—–-gt-irqs-off-5" class="headerlink" title="/ _—–=&gt; irqs-off"></a>/ _—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-5"><a href="#—-gt-need-resched-5" class="headerlink" title="| / _—-=&gt; need-resched"></a>| / _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-5"><a href="#—-gt-hardirq-softirq-5" class="headerlink" title="|| / _—=&gt; hardirq/softirq"></a>|| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-5"><a href="#–-gt-preempt-depth-5" class="headerlink" title="||| / _–=&gt; preempt-depth"></a>||| / _–=&gt; preempt-depth</h1><h1 id="delay-5"><a href="#delay-5" class="headerlink" title="|||| /     delay"></a>|||| /     delay</h1><h1 id="cmd-pid-time-caller-4"><a href="#cmd-pid-time-caller-4" class="headerlink" title="cmd     pid   ||||| time  |   caller"></a>cmd     pid   ||||| time  |   caller</h1><h1 id="-25"><a href="#-25" class="headerlink" title="\   /      |||||  \    |   /"></a>\   /      |||||  \    |   /</h1><pre><code>bash-1994    1d..1    0us : _raw_spin_lock_irqsave &lt;-wake_up_new_task
bash-1994    1d..1    0us : select_task_rq_fair &lt;-select_task_rq
bash-1994    1d..1    1us : __rcu_read_lock &lt;-select_task_rq_fair
bash-1994    1d..1    1us : source_load &lt;-select_task_rq_fair
bash-1994    1d..1    1us : source_load &lt;-select_task_rq_fair
</code></pre>
<p>[…]<br>    bash-1994    1d..1   12us : irq_enter &lt;-smp_apic_timer_interrupt<br>    bash-1994    1d..1   12us : rcu_irq_enter &lt;-irq_enter<br>    bash-1994    1d..1   13us : add_preempt_count &lt;-irq_enter<br>    bash-1994    1d.h1   13us : exit_idle &lt;-smp_apic_timer_interrupt<br>    bash-1994    1d.h1   13us : hrtimer_interrupt &lt;-smp_apic_timer_interrupt<br>    bash-1994    1d.h1   13us : _raw_spin_lock &lt;-hrtimer_interrupt<br>    bash-1994    1d.h1   14us : add_preempt_count &lt;-_raw_spin_lock<br>    bash-1994    1d.h2   14us : ktime_get_update_offsets &lt;-hrtimer_interrupt<br>[…]<br>    bash-1994    1d.h1   35us : lapic_next_event &lt;-clockevents_program_event<br>    bash-1994    1d.h1   35us : irq_exit &lt;-smp_apic_timer_interrupt<br>    bash-1994    1d.h1   36us : sub_preempt_count &lt;-irq_exit<br>    bash-1994    1d..2   36us : do_softirq &lt;-irq_exit<br>    bash-1994    1d..2   36us : __do_softirq &lt;-call_softirq<br>    bash-1994    1d..2   36us : __local_bh_disable &lt;-__do_softirq<br>    bash-1994    1d.s2   37us : add_preempt_count &lt;-_raw_spin_lock_irq<br>    bash-1994    1d.s3   38us : _raw_spin_unlock &lt;-run_timer_softirq<br>    bash-1994    1d.s3   39us : sub_preempt_count &lt;-_raw_spin_unlock<br>    bash-1994    1d.s2   39us : call_timer_fn &lt;-run_timer_softirq<br>[…]<br>    bash-1994    1dNs2   81us : cpu_needs_another_gp &lt;-rcu_process_callbacks<br>    bash-1994    1dNs2   82us : __local_bh_enable &lt;-__do_softirq<br>    bash-1994    1dNs2   82us : sub_preempt_count &lt;-__local_bh_enable<br>    bash-1994    1dN.2   82us : idle_cpu &lt;-irq_exit<br>    bash-1994    1dN.2   83us : rcu_irq_exit &lt;-irq_exit<br>    bash-1994    1dN.2   83us : sub_preempt_count &lt;-irq_exit<br>    bash-1994    1.N.1   84us : _raw_spin_unlock_irqrestore &lt;-task_rq_unlock<br>    bash-1994    1.N.1   84us+: trace_preempt_on &lt;-task_rq_unlock<br>    bash-1994    1.N.1  104us : <stack trace><br> =&gt; sub_preempt_count<br> =&gt; _raw_spin_unlock_irqrestore<br> =&gt; task_rq_unlock<br> =&gt; wake_up_new_task<br> =&gt; do_fork<br> =&gt; sys_clone<br> =&gt; stub_clone</p>
<p>The above is an example of the preemptoff trace with<br>function-trace set. Here we see that interrupts were not disabled<br>the entire time. The irq_enter code lets us know that we entered<br>an interrupt ‘h’. Before that, the functions being traced still<br>show that it is not in an interrupt, but we can see from the<br>functions themselves that this is not the case.</p>
<h2 id="preemptirqsoff"><a href="#preemptirqsoff" class="headerlink" title="preemptirqsoff"></a>preemptirqsoff</h2><p>Knowing the locations that have interrupts disabled or<br>preemption disabled for the longest times is helpful. But<br>sometimes we would like to know when either preemption and/or<br>interrupts are disabled.</p>
<p>Consider the following code:</p>
<pre><code>local_irq_disable();
call_function_with_irqs_off();
preempt_disable();
call_function_with_irqs_and_preemption_off();
local_irq_enable();
call_function_with_preemption_off();
preempt_enable();
</code></pre>
<p>The irqsoff tracer will record the total length of<br>call_function_with_irqs_off() and<br>call_function_with_irqs_and_preemption_off().</p>
<p>The preemptoff tracer will record the total length of<br>call_function_with_irqs_and_preemption_off() and<br>call_function_with_preemption_off().</p>
<p>But neither will trace the time that interrupts and/or<br>preemption is disabled. This total time is the time that we can<br>not schedule. To record this time, use the preemptirqsoff<br>tracer.</p>
<p>Again, using this trace is much like the irqsoff and preemptoff<br>tracers.</p>
<h1 id="echo-0-gt-options-function-trace-2"><a href="#echo-0-gt-options-function-trace-2" class="headerlink" title="echo 0 &gt; options/function-trace"></a>echo 0 &gt; options/function-trace</h1><h1 id="echo-preemptirqsoff-gt-current-tracer"><a href="#echo-preemptirqsoff-gt-current-tracer" class="headerlink" title="echo preemptirqsoff &gt; current_tracer"></a>echo preemptirqsoff &gt; current_tracer</h1><h1 id="echo-1-gt-tracing-on-2"><a href="#echo-1-gt-tracing-on-2" class="headerlink" title="echo 1 &gt; tracing_on"></a>echo 1 &gt; tracing_on</h1><h1 id="echo-0-gt-tracing-max-latency-2"><a href="#echo-0-gt-tracing-max-latency-2" class="headerlink" title="echo 0 &gt; tracing_max_latency"></a>echo 0 &gt; tracing_max_latency</h1><h1 id="ls-ltr-2"><a href="#ls-ltr-2" class="headerlink" title="ls -ltr"></a>ls -ltr</h1><p> […]</p>
<h1 id="echo-0-gt-tracing-on-2"><a href="#echo-0-gt-tracing-on-2" class="headerlink" title="echo 0 &gt; tracing_on"></a>echo 0 &gt; tracing_on</h1><h1 id="cat-trace-2"><a href="#cat-trace-2" class="headerlink" title="cat trace"></a>cat trace</h1><h1 id="tracer-preemptirqsoff"><a href="#tracer-preemptirqsoff" class="headerlink" title="tracer: preemptirqsoff"></a>tracer: preemptirqsoff</h1><h1 id="-26"><a href="#-26" class="headerlink" title=""></a></h1><h1 id="preemptirqsoff-latency-trace-v1-1-5-on-3-8-0-test"><a href="#preemptirqsoff-latency-trace-v1-1-5-on-3-8-0-test" class="headerlink" title="preemptirqsoff latency trace v1.1.5 on 3.8.0-test+"></a>preemptirqsoff latency trace v1.1.5 on 3.8.0-test+</h1><h1 id="——————————————————————–-5"><a href="#——————————————————————–-5" class="headerlink" title="——————————————————————–"></a>——————————————————————–</h1><h1 id="latency-100-us-4-4-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><a href="#latency-100-us-4-4-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4" class="headerlink" title="latency: 100 us, #4/4, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)"></a>latency: 100 us, #4/4, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</h1><h1 id="—————–-10"><a href="#—————–-10" class="headerlink" title="—————–"></a>—————–</h1><h1 id="task-ls-2230-uid-0-nice-0-policy-0-rt-prio-0"><a href="#task-ls-2230-uid-0-nice-0-policy-0-rt-prio-0" class="headerlink" title="| task: ls-2230 (uid:0 nice:0 policy:0 rt_prio:0)"></a>| task: ls-2230 (uid:0 nice:0 policy:0 rt_prio:0)</h1><h1 id="—————–-11"><a href="#—————–-11" class="headerlink" title="—————–"></a>—————–</h1><h1 id="gt-started-at-ata-scsi-queuecmd-1"><a href="#gt-started-at-ata-scsi-queuecmd-1" class="headerlink" title="=&gt; started at: ata_scsi_queuecmd"></a>=&gt; started at: ata_scsi_queuecmd</h1><h1 id="gt-ended-at-ata-scsi-queuecmd-1"><a href="#gt-ended-at-ata-scsi-queuecmd-1" class="headerlink" title="=&gt; ended at:   ata_scsi_queuecmd"></a>=&gt; ended at:   ata_scsi_queuecmd</h1><h1 id="-27"><a href="#-27" class="headerlink" title=""></a></h1><h1 id="-28"><a href="#-28" class="headerlink" title=""></a></h1><h1 id="——-gt-CPU-5"><a href="#——-gt-CPU-5" class="headerlink" title="_——=&gt; CPU#"></a>_——=&gt; CPU#</h1><h1 id="—–-gt-irqs-off-6"><a href="#—–-gt-irqs-off-6" class="headerlink" title="/ _—–=&gt; irqs-off"></a>/ _—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-6"><a href="#—-gt-need-resched-6" class="headerlink" title="| / _—-=&gt; need-resched"></a>| / _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-6"><a href="#—-gt-hardirq-softirq-6" class="headerlink" title="|| / _—=&gt; hardirq/softirq"></a>|| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-6"><a href="#–-gt-preempt-depth-6" class="headerlink" title="||| / _–=&gt; preempt-depth"></a>||| / _–=&gt; preempt-depth</h1><h1 id="delay-6"><a href="#delay-6" class="headerlink" title="|||| /     delay"></a>|||| /     delay</h1><h1 id="cmd-pid-time-caller-5"><a href="#cmd-pid-time-caller-5" class="headerlink" title="cmd     pid   ||||| time  |   caller"></a>cmd     pid   ||||| time  |   caller</h1><h1 id="-29"><a href="#-29" class="headerlink" title="\   /      |||||  \    |   /"></a>\   /      |||||  \    |   /</h1><pre><code>  ls-2230    3d...    0us+: _raw_spin_lock_irqsave &lt;-ata_scsi_queuecmd
  ls-2230    3...1  100us : _raw_spin_unlock_irqrestore &lt;-ata_scsi_queuecmd
  ls-2230    3...1  101us+: trace_preempt_on &lt;-ata_scsi_queuecmd
  ls-2230    3...1  111us : &lt;stack trace&gt;
</code></pre>
<p> =&gt; sub_preempt_count<br> =&gt; _raw_spin_unlock_irqrestore<br> =&gt; ata_scsi_queuecmd<br> =&gt; scsi_dispatch_cmd<br> =&gt; scsi_request_fn<br> =&gt; __blk_run_queue_uncond<br> =&gt; __blk_run_queue<br> =&gt; blk_queue_bio<br> =&gt; generic_make_request<br> =&gt; submit_bio<br> =&gt; submit_bh<br> =&gt; ext3_bread<br> =&gt; ext3_dir_bread<br> =&gt; htree_dirblock_to_tree<br> =&gt; ext3_htree_fill_tree<br> =&gt; ext3_readdir<br> =&gt; vfs_readdir<br> =&gt; sys_getdents<br> =&gt; system_call_fastpath</p>
<p>The trace_hardirqs_off_thunk is called from assembly on x86 when<br>interrupts are disabled in the assembly code. Without the<br>function tracing, we do not know if interrupts were enabled<br>within the preemption points. We do see that it started with<br>preemption enabled.</p>
<p>Here is a trace with function-trace set:</p>
<h1 id="tracer-preemptirqsoff-1"><a href="#tracer-preemptirqsoff-1" class="headerlink" title="tracer: preemptirqsoff"></a>tracer: preemptirqsoff</h1><h1 id="-30"><a href="#-30" class="headerlink" title=""></a></h1><h1 id="preemptirqsoff-latency-trace-v1-1-5-on-3-8-0-test-1"><a href="#preemptirqsoff-latency-trace-v1-1-5-on-3-8-0-test-1" class="headerlink" title="preemptirqsoff latency trace v1.1.5 on 3.8.0-test+"></a>preemptirqsoff latency trace v1.1.5 on 3.8.0-test+</h1><h1 id="——————————————————————–-6"><a href="#——————————————————————–-6" class="headerlink" title="——————————————————————–"></a>——————————————————————–</h1><h1 id="latency-161-us-339-339-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><a href="#latency-161-us-339-339-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4" class="headerlink" title="latency: 161 us, #339/339, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)"></a>latency: 161 us, #339/339, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</h1><h1 id="—————–-12"><a href="#—————–-12" class="headerlink" title="—————–"></a>—————–</h1><h1 id="task-ls-2269-uid-0-nice-0-policy-0-rt-prio-0"><a href="#task-ls-2269-uid-0-nice-0-policy-0-rt-prio-0" class="headerlink" title="| task: ls-2269 (uid:0 nice:0 policy:0 rt_prio:0)"></a>| task: ls-2269 (uid:0 nice:0 policy:0 rt_prio:0)</h1><h1 id="—————–-13"><a href="#—————–-13" class="headerlink" title="—————–"></a>—————–</h1><h1 id="gt-started-at-schedule"><a href="#gt-started-at-schedule" class="headerlink" title="=&gt; started at: schedule"></a>=&gt; started at: schedule</h1><h1 id="gt-ended-at-mutex-unlock"><a href="#gt-ended-at-mutex-unlock" class="headerlink" title="=&gt; ended at:   mutex_unlock"></a>=&gt; ended at:   mutex_unlock</h1><h1 id="-31"><a href="#-31" class="headerlink" title=""></a></h1><h1 id="-32"><a href="#-32" class="headerlink" title=""></a></h1><h1 id="——-gt-CPU-6"><a href="#——-gt-CPU-6" class="headerlink" title="_——=&gt; CPU#"></a>_——=&gt; CPU#</h1><h1 id="—–-gt-irqs-off-7"><a href="#—–-gt-irqs-off-7" class="headerlink" title="/ _—–=&gt; irqs-off"></a>/ _—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-7"><a href="#—-gt-need-resched-7" class="headerlink" title="| / _—-=&gt; need-resched"></a>| / _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-7"><a href="#—-gt-hardirq-softirq-7" class="headerlink" title="|| / _—=&gt; hardirq/softirq"></a>|| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-7"><a href="#–-gt-preempt-depth-7" class="headerlink" title="||| / _–=&gt; preempt-depth"></a>||| / _–=&gt; preempt-depth</h1><h1 id="delay-7"><a href="#delay-7" class="headerlink" title="|||| /     delay"></a>|||| /     delay</h1><h1 id="cmd-pid-time-caller-6"><a href="#cmd-pid-time-caller-6" class="headerlink" title="cmd     pid   ||||| time  |   caller"></a>cmd     pid   ||||| time  |   caller</h1><h1 id="-33"><a href="#-33" class="headerlink" title="\   /      |||||  \    |   /"></a>\   /      |||||  \    |   /</h1><p>kworker/-59      3…1    0us : __schedule &lt;-schedule<br>kworker/-59      3d..1    0us : rcu_preempt_qs &lt;-rcu_note_context_switch<br>kworker/-59      3d..1    1us : add_preempt_count &lt;-_raw_spin_lock_irq<br>kworker/-59      3d..2    1us : deactivate_task &lt;-__schedule<br>kworker/-59      3d..2    1us : dequeue_task &lt;-deactivate_task<br>kworker/-59      3d..2    2us : update_rq_clock &lt;-dequeue_task<br>kworker/-59      3d..2    2us : dequeue_task_fair &lt;-dequeue_task<br>kworker/-59      3d..2    2us : update_curr &lt;-dequeue_task_fair<br>kworker/-59      3d..2    2us : update_min_vruntime &lt;-update_curr<br>kworker/-59      3d..2    3us : cpuacct_charge &lt;-update_curr<br>kworker/-59      3d..2    3us : __rcu_read_lock &lt;-cpuacct_charge<br>kworker/-59      3d..2    3us : __rcu_read_unlock &lt;-cpuacct_charge<br>kworker/-59      3d..2    3us : update_cfs_rq_blocked_load &lt;-dequeue_task_fair<br>kworker/-59      3d..2    4us : clear_buddies &lt;-dequeue_task_fair<br>kworker/-59      3d..2    4us : account_entity_dequeue &lt;-dequeue_task_fair<br>kworker/-59      3d..2    4us : update_min_vruntime &lt;-dequeue_task_fair<br>kworker/-59      3d..2    4us : update_cfs_shares &lt;-dequeue_task_fair<br>kworker/-59      3d..2    5us : hrtick_update &lt;-dequeue_task_fair<br>kworker/-59      3d..2    5us : wq_worker_sleeping &lt;-__schedule<br>kworker/-59      3d..2    5us : kthread_data &lt;-wq_worker_sleeping<br>kworker/-59      3d..2    5us : put_prev_task_fair &lt;-__schedule<br>kworker/-59      3d..2    6us : pick_next_task_fair &lt;-pick_next_task<br>kworker/-59      3d..2    6us : clear_buddies &lt;-pick_next_task_fair<br>kworker/-59      3d..2    6us : set_next_entity &lt;-pick_next_task_fair<br>kworker/-59      3d..2    6us : update_stats_wait_end &lt;-set_next_entity<br>      ls-2269    3d..2    7us : finish_task_switch &lt;-__schedule<br>      ls-2269    3d..2    7us : _raw_spin_unlock_irq &lt;-finish_task_switch<br>      ls-2269    3d..2    8us : do_IRQ &lt;-ret_from_intr<br>      ls-2269    3d..2    8us : irq_enter &lt;-do_IRQ<br>      ls-2269    3d..2    8us : rcu_irq_enter &lt;-irq_enter<br>      ls-2269    3d..2    9us : add_preempt_count &lt;-irq_enter<br>      ls-2269    3d.h2    9us : exit_idle &lt;-do_IRQ<br>[…]<br>      ls-2269    3d.h3   20us : sub_preempt_count &lt;-_raw_spin_unlock<br>      ls-2269    3d.h2   20us : irq_exit &lt;-do_IRQ<br>      ls-2269    3d.h2   21us : sub_preempt_count &lt;-irq_exit<br>      ls-2269    3d..3   21us : do_softirq &lt;-irq_exit<br>      ls-2269    3d..3   21us : __do_softirq &lt;-call_softirq<br>      ls-2269    3d..3   21us+: __local_bh_disable &lt;-__do_softirq<br>      ls-2269    3d.s4   29us : sub_preempt_count &lt;-_local_bh_enable_ip<br>      ls-2269    3d.s5   29us : sub_preempt_count &lt;-_local_bh_enable_ip<br>      ls-2269    3d.s5   31us : do_IRQ &lt;-ret_from_intr<br>      ls-2269    3d.s5   31us : irq_enter &lt;-do_IRQ<br>      ls-2269    3d.s5   31us : rcu_irq_enter &lt;-irq_enter<br>[…]<br>      ls-2269    3d.s5   31us : rcu_irq_enter &lt;-irq_enter<br>      ls-2269    3d.s5   32us : add_preempt_count &lt;-irq_enter<br>      ls-2269    3d.H5   32us : exit_idle &lt;-do_IRQ<br>      ls-2269    3d.H5   32us : handle_irq &lt;-do_IRQ<br>      ls-2269    3d.H5   32us : irq_to_desc &lt;-handle_irq<br>      ls-2269    3d.H5   33us : handle_fasteoi_irq &lt;-handle_irq<br>[…]<br>      ls-2269    3d.s5  158us : _raw_spin_unlock_irqrestore &lt;-rtl8139_poll<br>      ls-2269    3d.s3  158us : net_rps_action_and_irq_enable.isra.65 &lt;-net_rx_action<br>      ls-2269    3d.s3  159us : __local_bh_enable &lt;-__do_softirq<br>      ls-2269    3d.s3  159us : sub_preempt_count &lt;-__local_bh_enable<br>      ls-2269    3d..3  159us : idle_cpu &lt;-irq_exit<br>      ls-2269    3d..3  159us : rcu_irq_exit &lt;-irq_exit<br>      ls-2269    3d..3  160us : sub_preempt_count &lt;-irq_exit<br>      ls-2269    3d…  161us : __mutex_unlock_slowpath &lt;-mutex_unlock<br>      ls-2269    3d…  162us+: trace_hardirqs_on &lt;-mutex_unlock<br>      ls-2269    3d…  186us : <stack trace><br> =&gt; __mutex_unlock_slowpath<br> =&gt; mutex_unlock<br> =&gt; process_output<br> =&gt; n_tty_write<br> =&gt; tty_write<br> =&gt; vfs_write<br> =&gt; sys_write<br> =&gt; system_call_fastpath</p>
<p>This is an interesting trace. It started with kworker running and<br>scheduling out and ls taking over. But as soon as ls released the<br>rq lock and enabled interrupts (but not preemption) an interrupt<br>triggered. When the interrupt finished, it started running softirqs.<br>But while the softirq was running, another interrupt triggered.<br>When an interrupt is running inside a softirq, the annotation is ‘H’.</p>
<h2 id="wakeup"><a href="#wakeup" class="headerlink" title="wakeup"></a>wakeup</h2><p>One common case that people are interested in tracing is the<br>time it takes for a task that is woken to actually wake up.<br>Now for non Real-Time tasks, this can be arbitrary. But tracing<br>it none the less can be interesting. </p>
<p>Without function tracing:</p>
<h1 id="echo-0-gt-options-function-trace-3"><a href="#echo-0-gt-options-function-trace-3" class="headerlink" title="echo 0 &gt; options/function-trace"></a>echo 0 &gt; options/function-trace</h1><h1 id="echo-wakeup-gt-current-tracer"><a href="#echo-wakeup-gt-current-tracer" class="headerlink" title="echo wakeup &gt; current_tracer"></a>echo wakeup &gt; current_tracer</h1><h1 id="echo-1-gt-tracing-on-3"><a href="#echo-1-gt-tracing-on-3" class="headerlink" title="echo 1 &gt; tracing_on"></a>echo 1 &gt; tracing_on</h1><h1 id="echo-0-gt-tracing-max-latency-3"><a href="#echo-0-gt-tracing-max-latency-3" class="headerlink" title="echo 0 &gt; tracing_max_latency"></a>echo 0 &gt; tracing_max_latency</h1><h1 id="chrt-f-5-sleep-1"><a href="#chrt-f-5-sleep-1" class="headerlink" title="chrt -f 5 sleep 1"></a>chrt -f 5 sleep 1</h1><h1 id="echo-0-gt-tracing-on-3"><a href="#echo-0-gt-tracing-on-3" class="headerlink" title="echo 0 &gt; tracing_on"></a>echo 0 &gt; tracing_on</h1><h1 id="cat-trace-3"><a href="#cat-trace-3" class="headerlink" title="cat trace"></a>cat trace</h1><h1 id="tracer-wakeup"><a href="#tracer-wakeup" class="headerlink" title="tracer: wakeup"></a>tracer: wakeup</h1><h1 id="-34"><a href="#-34" class="headerlink" title=""></a></h1><h1 id="wakeup-latency-trace-v1-1-5-on-3-8-0-test"><a href="#wakeup-latency-trace-v1-1-5-on-3-8-0-test" class="headerlink" title="wakeup latency trace v1.1.5 on 3.8.0-test+"></a>wakeup latency trace v1.1.5 on 3.8.0-test+</h1><h1 id="——————————————————————–-7"><a href="#——————————————————————–-7" class="headerlink" title="——————————————————————–"></a>——————————————————————–</h1><h1 id="latency-15-us-4-4-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><a href="#latency-15-us-4-4-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4" class="headerlink" title="latency: 15 us, #4/4, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)"></a>latency: 15 us, #4/4, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</h1><h1 id="—————–-14"><a href="#—————–-14" class="headerlink" title="—————–"></a>—————–</h1><h1 id="task-kworker-3-1H-312-uid-0-nice-20-policy-0-rt-prio-0"><a href="#task-kworker-3-1H-312-uid-0-nice-20-policy-0-rt-prio-0" class="headerlink" title="| task: kworker/3:1H-312 (uid:0 nice:-20 policy:0 rt_prio:0)"></a>| task: kworker/3:1H-312 (uid:0 nice:-20 policy:0 rt_prio:0)</h1><h1 id="—————–-15"><a href="#—————–-15" class="headerlink" title="—————–"></a>—————–</h1><h1 id="-35"><a href="#-35" class="headerlink" title=""></a></h1><h1 id="——-gt-CPU-7"><a href="#——-gt-CPU-7" class="headerlink" title="_——=&gt; CPU#"></a>_——=&gt; CPU#</h1><h1 id="—–-gt-irqs-off-8"><a href="#—–-gt-irqs-off-8" class="headerlink" title="/ _—–=&gt; irqs-off"></a>/ _—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-8"><a href="#—-gt-need-resched-8" class="headerlink" title="| / _—-=&gt; need-resched"></a>| / _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-8"><a href="#—-gt-hardirq-softirq-8" class="headerlink" title="|| / _—=&gt; hardirq/softirq"></a>|| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-8"><a href="#–-gt-preempt-depth-8" class="headerlink" title="||| / _–=&gt; preempt-depth"></a>||| / _–=&gt; preempt-depth</h1><h1 id="delay-8"><a href="#delay-8" class="headerlink" title="|||| /     delay"></a>|||| /     delay</h1><h1 id="cmd-pid-time-caller-7"><a href="#cmd-pid-time-caller-7" class="headerlink" title="cmd     pid   ||||| time  |   caller"></a>cmd     pid   ||||| time  |   caller</h1><h1 id="-36"><a href="#-36" class="headerlink" title="\   /      |||||  \    |   /"></a>\   /      |||||  \    |   /</h1><p>  <idle>-0       3dNs7    0us :      0:120:R   + [003]   312:100:R kworker/3:1H<br>  <idle>-0       3dNs7    1us+: ttwu_do_activate.constprop.87 &lt;-try_to_wake_up<br>  <idle>-0       3d..3   15us : __schedule &lt;-schedule<br>  <idle>-0       3d..3   15us :      0:120:R ==&gt; [003]   312:100:R kworker/3:1H</p>
<p>The tracer only traces the highest priority task in the system<br>to avoid tracing the normal circumstances. Here we see that<br>the kworker with a nice priority of -20 (not very nice), took<br>just 15 microseconds from the time it woke up, to the time it<br>ran.</p>
<p>Non Real-Time tasks are not that interesting. A more interesting<br>trace is to concentrate only on Real-Time tasks.</p>
<h2 id="wakeup-rt"><a href="#wakeup-rt" class="headerlink" title="wakeup_rt"></a>wakeup_rt</h2><p>In a Real-Time environment it is very important to know the<br>wakeup time it takes for the highest priority task that is woken<br>up to the time that it executes. This is also known as “schedule<br>latency”. I stress the point that this is about RT tasks. It is<br>also important to know the scheduling latency of non-RT tasks,<br>but the average schedule latency is better for non-RT tasks.<br>Tools like LatencyTop are more appropriate for such<br>measurements.</p>
<p>Real-Time environments are interested in the worst case latency.<br>That is the longest latency it takes for something to happen,<br>and not the average. We can have a very fast scheduler that may<br>only have a large latency once in a while, but that would not<br>work well with Real-Time tasks.  The wakeup_rt tracer was designed<br>to record the worst case wakeups of RT tasks. Non-RT tasks are<br>not recorded because the tracer only records one worst case and<br>tracing non-RT tasks that are unpredictable will overwrite the<br>worst case latency of RT tasks (just run the normal wakeup<br>tracer for a while to see that effect).</p>
<p>Since this tracer only deals with RT tasks, we will run this<br>slightly differently than we did with the previous tracers.<br>Instead of performing an ‘ls’, we will run ‘sleep 1’ under<br>‘chrt’ which changes the priority of the task.</p>
<h1 id="echo-0-gt-options-function-trace-4"><a href="#echo-0-gt-options-function-trace-4" class="headerlink" title="echo 0 &gt; options/function-trace"></a>echo 0 &gt; options/function-trace</h1><h1 id="echo-wakeup-rt-gt-current-tracer"><a href="#echo-wakeup-rt-gt-current-tracer" class="headerlink" title="echo wakeup_rt &gt; current_tracer"></a>echo wakeup_rt &gt; current_tracer</h1><h1 id="echo-1-gt-tracing-on-4"><a href="#echo-1-gt-tracing-on-4" class="headerlink" title="echo 1 &gt; tracing_on"></a>echo 1 &gt; tracing_on</h1><h1 id="echo-0-gt-tracing-max-latency-4"><a href="#echo-0-gt-tracing-max-latency-4" class="headerlink" title="echo 0 &gt; tracing_max_latency"></a>echo 0 &gt; tracing_max_latency</h1><h1 id="chrt-f-5-sleep-1-1"><a href="#chrt-f-5-sleep-1-1" class="headerlink" title="chrt -f 5 sleep 1"></a>chrt -f 5 sleep 1</h1><h1 id="echo-0-gt-tracing-on-4"><a href="#echo-0-gt-tracing-on-4" class="headerlink" title="echo 0 &gt; tracing_on"></a>echo 0 &gt; tracing_on</h1><h1 id="cat-trace-4"><a href="#cat-trace-4" class="headerlink" title="cat trace"></a>cat trace</h1><h1 id="tracer-wakeup-1"><a href="#tracer-wakeup-1" class="headerlink" title="tracer: wakeup"></a>tracer: wakeup</h1><h1 id="-37"><a href="#-37" class="headerlink" title=""></a></h1><h1 id="tracer-wakeup-rt"><a href="#tracer-wakeup-rt" class="headerlink" title="tracer: wakeup_rt"></a>tracer: wakeup_rt</h1><h1 id="-38"><a href="#-38" class="headerlink" title=""></a></h1><h1 id="wakeup-rt-latency-trace-v1-1-5-on-3-8-0-test"><a href="#wakeup-rt-latency-trace-v1-1-5-on-3-8-0-test" class="headerlink" title="wakeup_rt latency trace v1.1.5 on 3.8.0-test+"></a>wakeup_rt latency trace v1.1.5 on 3.8.0-test+</h1><h1 id="——————————————————————–-8"><a href="#——————————————————————–-8" class="headerlink" title="——————————————————————–"></a>——————————————————————–</h1><h1 id="latency-5-us-4-4-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><a href="#latency-5-us-4-4-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4" class="headerlink" title="latency: 5 us, #4/4, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)"></a>latency: 5 us, #4/4, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</h1><h1 id="—————–-16"><a href="#—————–-16" class="headerlink" title="—————–"></a>—————–</h1><h1 id="task-sleep-2389-uid-0-nice-0-policy-1-rt-prio-5"><a href="#task-sleep-2389-uid-0-nice-0-policy-1-rt-prio-5" class="headerlink" title="| task: sleep-2389 (uid:0 nice:0 policy:1 rt_prio:5)"></a>| task: sleep-2389 (uid:0 nice:0 policy:1 rt_prio:5)</h1><h1 id="—————–-17"><a href="#—————–-17" class="headerlink" title="—————–"></a>—————–</h1><h1 id="-39"><a href="#-39" class="headerlink" title=""></a></h1><h1 id="——-gt-CPU-8"><a href="#——-gt-CPU-8" class="headerlink" title="_——=&gt; CPU#"></a>_——=&gt; CPU#</h1><h1 id="—–-gt-irqs-off-9"><a href="#—–-gt-irqs-off-9" class="headerlink" title="/ _—–=&gt; irqs-off"></a>/ _—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-9"><a href="#—-gt-need-resched-9" class="headerlink" title="| / _—-=&gt; need-resched"></a>| / _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-9"><a href="#—-gt-hardirq-softirq-9" class="headerlink" title="|| / _—=&gt; hardirq/softirq"></a>|| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-9"><a href="#–-gt-preempt-depth-9" class="headerlink" title="||| / _–=&gt; preempt-depth"></a>||| / _–=&gt; preempt-depth</h1><h1 id="delay-9"><a href="#delay-9" class="headerlink" title="|||| /     delay"></a>|||| /     delay</h1><h1 id="cmd-pid-time-caller-8"><a href="#cmd-pid-time-caller-8" class="headerlink" title="cmd     pid   ||||| time  |   caller"></a>cmd     pid   ||||| time  |   caller</h1><h1 id="-40"><a href="#-40" class="headerlink" title="\   /      |||||  \    |   /"></a>\   /      |||||  \    |   /</h1><p>  <idle>-0       3d.h4    0us :      0:120:R   + [003]  2389: 94:R sleep<br>  <idle>-0       3d.h4    1us+: ttwu_do_activate.constprop.87 &lt;-try_to_wake_up<br>  <idle>-0       3d..3    5us : __schedule &lt;-schedule<br>  <idle>-0       3d..3    5us :      0:120:R ==&gt; [003]  2389: 94:R sleep</p>
<p>Running this on an idle system, we see that it only took 5 microseconds<br>to perform the task switch.  Note, since the trace point in the schedule<br>is before the actual “switch”, we stop the tracing when the recorded task<br>is about to schedule in. This may change if we add a new marker at the<br>end of the scheduler.</p>
<p>Notice that the recorded task is ‘sleep’ with the PID of 2389<br>and it has an rt_prio of 5. This priority is user-space priority<br>and not the internal kernel priority. The policy is 1 for<br>SCHED_FIFO and 2 for SCHED_RR.</p>
<p>Note, that the trace data shows the internal priority (99 - rtprio).</p>
<p>  <idle>-0       3d..3    5us :      0:120:R ==&gt; [003]  2389: 94:R sleep</p>
<p>The 0:120:R means idle was running with a nice priority of 0 (120 - 20)<br>and in the running state ‘R’. The sleep task was scheduled in with<br>2389: 94:R. That is the priority is the kernel rtprio (99 - 5 = 94)<br>and it too is in the running state.</p>
<p>Doing the same with chrt -r 5 and function-trace set.</p>
<p>  echo 1 &gt; options/function-trace</p>
<h1 id="tracer-wakeup-rt-1"><a href="#tracer-wakeup-rt-1" class="headerlink" title="tracer: wakeup_rt"></a>tracer: wakeup_rt</h1><h1 id="-41"><a href="#-41" class="headerlink" title=""></a></h1><h1 id="wakeup-rt-latency-trace-v1-1-5-on-3-8-0-test-1"><a href="#wakeup-rt-latency-trace-v1-1-5-on-3-8-0-test-1" class="headerlink" title="wakeup_rt latency trace v1.1.5 on 3.8.0-test+"></a>wakeup_rt latency trace v1.1.5 on 3.8.0-test+</h1><h1 id="——————————————————————–-9"><a href="#——————————————————————–-9" class="headerlink" title="——————————————————————–"></a>——————————————————————–</h1><h1 id="latency-29-us-85-85-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><a href="#latency-29-us-85-85-CPU-3-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4" class="headerlink" title="latency: 29 us, #85/85, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)"></a>latency: 29 us, #85/85, CPU#3 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</h1><h1 id="—————–-18"><a href="#—————–-18" class="headerlink" title="—————–"></a>—————–</h1><h1 id="task-sleep-2448-uid-0-nice-0-policy-1-rt-prio-5"><a href="#task-sleep-2448-uid-0-nice-0-policy-1-rt-prio-5" class="headerlink" title="| task: sleep-2448 (uid:0 nice:0 policy:1 rt_prio:5)"></a>| task: sleep-2448 (uid:0 nice:0 policy:1 rt_prio:5)</h1><h1 id="—————–-19"><a href="#—————–-19" class="headerlink" title="—————–"></a>—————–</h1><h1 id="-42"><a href="#-42" class="headerlink" title=""></a></h1><h1 id="——-gt-CPU-9"><a href="#——-gt-CPU-9" class="headerlink" title="_——=&gt; CPU#"></a>_——=&gt; CPU#</h1><h1 id="—–-gt-irqs-off-10"><a href="#—–-gt-irqs-off-10" class="headerlink" title="/ _—–=&gt; irqs-off"></a>/ _—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-10"><a href="#—-gt-need-resched-10" class="headerlink" title="| / _—-=&gt; need-resched"></a>| / _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-10"><a href="#—-gt-hardirq-softirq-10" class="headerlink" title="|| / _—=&gt; hardirq/softirq"></a>|| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-10"><a href="#–-gt-preempt-depth-10" class="headerlink" title="||| / _–=&gt; preempt-depth"></a>||| / _–=&gt; preempt-depth</h1><h1 id="delay-10"><a href="#delay-10" class="headerlink" title="|||| /     delay"></a>|||| /     delay</h1><h1 id="cmd-pid-time-caller-9"><a href="#cmd-pid-time-caller-9" class="headerlink" title="cmd     pid   ||||| time  |   caller"></a>cmd     pid   ||||| time  |   caller</h1><h1 id="-43"><a href="#-43" class="headerlink" title="\   /      |||||  \    |   /"></a>\   /      |||||  \    |   /</h1><p>  <idle>-0       3d.h4    1us+:      0:120:R   + [003]  2448: 94:R sleep<br>  <idle>-0       3d.h4    2us : ttwu_do_activate.constprop.87 &lt;-try_to_wake_up<br>  <idle>-0       3d.h3    3us : check_preempt_curr &lt;-ttwu_do_wakeup<br>  <idle>-0       3d.h3    3us : resched_curr &lt;-check_preempt_curr<br>  <idle>-0       3dNh3    4us : task_woken_rt &lt;-ttwu_do_wakeup<br>  <idle>-0       3dNh3    4us : _raw_spin_unlock &lt;-try_to_wake_up<br>  <idle>-0       3dNh3    4us : sub_preempt_count &lt;-_raw_spin_unlock<br>  <idle>-0       3dNh2    5us : ttwu_stat &lt;-try_to_wake_up<br>  <idle>-0       3dNh2    5us : _raw_spin_unlock_irqrestore &lt;-try_to_wake_up<br>  <idle>-0       3dNh2    6us : sub_preempt_count &lt;-_raw_spin_unlock_irqrestore<br>  <idle>-0       3dNh1    6us : _raw_spin_lock &lt;-__run_hrtimer<br>  <idle>-0       3dNh1    6us : add_preempt_count &lt;-_raw_spin_lock<br>  <idle>-0       3dNh2    7us : _raw_spin_unlock &lt;-hrtimer_interrupt<br>  <idle>-0       3dNh2    7us : sub_preempt_count &lt;-_raw_spin_unlock<br>  <idle>-0       3dNh1    7us : tick_program_event &lt;-hrtimer_interrupt<br>  <idle>-0       3dNh1    7us : clockevents_program_event &lt;-tick_program_event<br>  <idle>-0       3dNh1    8us : ktime_get &lt;-clockevents_program_event<br>  <idle>-0       3dNh1    8us : lapic_next_event &lt;-clockevents_program_event<br>  <idle>-0       3dNh1    8us : irq_exit &lt;-smp_apic_timer_interrupt<br>  <idle>-0       3dNh1    9us : sub_preempt_count &lt;-irq_exit<br>  <idle>-0       3dN.2    9us : idle_cpu &lt;-irq_exit<br>  <idle>-0       3dN.2    9us : rcu_irq_exit &lt;-irq_exit<br>  <idle>-0       3dN.2   10us : rcu_eqs_enter_common.isra.45 &lt;-rcu_irq_exit<br>  <idle>-0       3dN.2   10us : sub_preempt_count &lt;-irq_exit<br>  <idle>-0       3.N.1   11us : rcu_idle_exit &lt;-cpu_idle<br>  <idle>-0       3dN.1   11us : rcu_eqs_exit_common.isra.43 &lt;-rcu_idle_exit<br>  <idle>-0       3.N.1   11us : tick_nohz_idle_exit &lt;-cpu_idle<br>  <idle>-0       3dN.1   12us : menu_hrtimer_cancel &lt;-tick_nohz_idle_exit<br>  <idle>-0       3dN.1   12us : ktime_get &lt;-tick_nohz_idle_exit<br>  <idle>-0       3dN.1   12us : tick_do_update_jiffies64 &lt;-tick_nohz_idle_exit<br>  <idle>-0       3dN.1   13us : update_cpu_load_nohz &lt;-tick_nohz_idle_exit<br>  <idle>-0       3dN.1   13us : _raw_spin_lock &lt;-update_cpu_load_nohz<br>  <idle>-0       3dN.1   13us : add_preempt_count &lt;-_raw_spin_lock<br>  <idle>-0       3dN.2   13us : __update_cpu_load &lt;-update_cpu_load_nohz<br>  <idle>-0       3dN.2   14us : sched_avg_update &lt;-__update_cpu_load<br>  <idle>-0       3dN.2   14us : _raw_spin_unlock &lt;-update_cpu_load_nohz<br>  <idle>-0       3dN.2   14us : sub_preempt_count &lt;-_raw_spin_unlock<br>  <idle>-0       3dN.1   15us : calc_load_exit_idle &lt;-tick_nohz_idle_exit<br>  <idle>-0       3dN.1   15us : touch_softlockup_watchdog &lt;-tick_nohz_idle_exit<br>  <idle>-0       3dN.1   15us : hrtimer_cancel &lt;-tick_nohz_idle_exit<br>  <idle>-0       3dN.1   15us : hrtimer_try_to_cancel &lt;-hrtimer_cancel<br>  <idle>-0       3dN.1   16us : lock_hrtimer_base.isra.18 &lt;-hrtimer_try_to_cancel<br>  <idle>-0       3dN.1   16us : _raw_spin_lock_irqsave &lt;-lock_hrtimer_base.isra.18<br>  <idle>-0       3dN.1   16us : add_preempt_count &lt;-_raw_spin_lock_irqsave<br>  <idle>-0       3dN.2   17us : __remove_hrtimer &lt;-remove_hrtimer.part.16<br>  <idle>-0       3dN.2   17us : hrtimer_force_reprogram &lt;-__remove_hrtimer<br>  <idle>-0       3dN.2   17us : tick_program_event &lt;-hrtimer_force_reprogram<br>  <idle>-0       3dN.2   18us : clockevents_program_event &lt;-tick_program_event<br>  <idle>-0       3dN.2   18us : ktime_get &lt;-clockevents_program_event<br>  <idle>-0       3dN.2   18us : lapic_next_event &lt;-clockevents_program_event<br>  <idle>-0       3dN.2   19us : _raw_spin_unlock_irqrestore &lt;-hrtimer_try_to_cancel<br>  <idle>-0       3dN.2   19us : sub_preempt_count &lt;-_raw_spin_unlock_irqrestore<br>  <idle>-0       3dN.1   19us : hrtimer_forward &lt;-tick_nohz_idle_exit<br>  <idle>-0       3dN.1   20us : ktime_add_safe &lt;-hrtimer_forward<br>  <idle>-0       3dN.1   20us : ktime_add_safe &lt;-hrtimer_forward<br>  <idle>-0       3dN.1   20us : hrtimer_start_range_ns &lt;-hrtimer_start_expires.constprop.11<br>  <idle>-0       3dN.1   20us : __hrtimer_start_range_ns &lt;-hrtimer_start_range_ns<br>  <idle>-0       3dN.1   21us : lock_hrtimer_base.isra.18 &lt;-__hrtimer_start_range_ns<br>  <idle>-0       3dN.1   21us : _raw_spin_lock_irqsave &lt;-lock_hrtimer_base.isra.18<br>  <idle>-0       3dN.1   21us : add_preempt_count &lt;-_raw_spin_lock_irqsave<br>  <idle>-0       3dN.2   22us : ktime_add_safe &lt;-__hrtimer_start_range_ns<br>  <idle>-0       3dN.2   22us : enqueue_hrtimer &lt;-__hrtimer_start_range_ns<br>  <idle>-0       3dN.2   22us : tick_program_event &lt;-__hrtimer_start_range_ns<br>  <idle>-0       3dN.2   23us : clockevents_program_event &lt;-tick_program_event<br>  <idle>-0       3dN.2   23us : ktime_get &lt;-clockevents_program_event<br>  <idle>-0       3dN.2   23us : lapic_next_event &lt;-clockevents_program_event<br>  <idle>-0       3dN.2   24us : _raw_spin_unlock_irqrestore &lt;-__hrtimer_start_range_ns<br>  <idle>-0       3dN.2   24us : sub_preempt_count &lt;-_raw_spin_unlock_irqrestore<br>  <idle>-0       3dN.1   24us : account_idle_ticks &lt;-tick_nohz_idle_exit<br>  <idle>-0       3dN.1   24us : account_idle_time &lt;-account_idle_ticks<br>  <idle>-0       3.N.1   25us : sub_preempt_count &lt;-cpu_idle<br>  <idle>-0       3.N..   25us : schedule &lt;-cpu_idle<br>  <idle>-0       3.N..   25us : __schedule &lt;-preempt_schedule<br>  <idle>-0       3.N..   26us : add_preempt_count &lt;-__schedule<br>  <idle>-0       3.N.1   26us : rcu_note_context_switch &lt;-__schedule<br>  <idle>-0       3.N.1   26us : rcu_sched_qs &lt;-rcu_note_context_switch<br>  <idle>-0       3dN.1   27us : rcu_preempt_qs &lt;-rcu_note_context_switch<br>  <idle>-0       3.N.1   27us : _raw_spin_lock_irq &lt;-__schedule<br>  <idle>-0       3dN.1   27us : add_preempt_count &lt;-_raw_spin_lock_irq<br>  <idle>-0       3dN.2   28us : put_prev_task_idle &lt;-__schedule<br>  <idle>-0       3dN.2   28us : pick_next_task_stop &lt;-pick_next_task<br>  <idle>-0       3dN.2   28us : pick_next_task_rt &lt;-pick_next_task<br>  <idle>-0       3dN.2   29us : dequeue_pushable_task &lt;-pick_next_task_rt<br>  <idle>-0       3d..3   29us : __schedule &lt;-preempt_schedule<br>  <idle>-0       3d..3   30us :      0:120:R ==&gt; [003]  2448: 94:R sleep</p>
<p>This isn’t that big of a trace, even with function tracing enabled,<br>so I included the entire trace.</p>
<p>The interrupt went off while when the system was idle. Somewhere<br>before task_woken_rt() was called, the NEED_RESCHED flag was set,<br>this is indicated by the first occurrence of the ‘N’ flag.</p>
<h2 id="Latency-tracing-and-events"><a href="#Latency-tracing-and-events" class="headerlink" title="Latency tracing and events"></a>Latency tracing and events</h2><p>As function tracing can induce a much larger latency, but without<br>seeing what happens within the latency it is hard to know what<br>caused it. There is a middle ground, and that is with enabling<br>events.</p>
<h1 id="echo-0-gt-options-function-trace-5"><a href="#echo-0-gt-options-function-trace-5" class="headerlink" title="echo 0 &gt; options/function-trace"></a>echo 0 &gt; options/function-trace</h1><h1 id="echo-wakeup-rt-gt-current-tracer-1"><a href="#echo-wakeup-rt-gt-current-tracer-1" class="headerlink" title="echo wakeup_rt &gt; current_tracer"></a>echo wakeup_rt &gt; current_tracer</h1><h1 id="echo-1-gt-events-enable"><a href="#echo-1-gt-events-enable" class="headerlink" title="echo 1 &gt; events/enable"></a>echo 1 &gt; events/enable</h1><h1 id="echo-1-gt-tracing-on-5"><a href="#echo-1-gt-tracing-on-5" class="headerlink" title="echo 1 &gt; tracing_on"></a>echo 1 &gt; tracing_on</h1><h1 id="echo-0-gt-tracing-max-latency-5"><a href="#echo-0-gt-tracing-max-latency-5" class="headerlink" title="echo 0 &gt; tracing_max_latency"></a>echo 0 &gt; tracing_max_latency</h1><h1 id="chrt-f-5-sleep-1-2"><a href="#chrt-f-5-sleep-1-2" class="headerlink" title="chrt -f 5 sleep 1"></a>chrt -f 5 sleep 1</h1><h1 id="echo-0-gt-tracing-on-5"><a href="#echo-0-gt-tracing-on-5" class="headerlink" title="echo 0 &gt; tracing_on"></a>echo 0 &gt; tracing_on</h1><h1 id="cat-trace-5"><a href="#cat-trace-5" class="headerlink" title="cat trace"></a>cat trace</h1><h1 id="tracer-wakeup-rt-2"><a href="#tracer-wakeup-rt-2" class="headerlink" title="tracer: wakeup_rt"></a>tracer: wakeup_rt</h1><h1 id="-44"><a href="#-44" class="headerlink" title=""></a></h1><h1 id="wakeup-rt-latency-trace-v1-1-5-on-3-8-0-test-2"><a href="#wakeup-rt-latency-trace-v1-1-5-on-3-8-0-test-2" class="headerlink" title="wakeup_rt latency trace v1.1.5 on 3.8.0-test+"></a>wakeup_rt latency trace v1.1.5 on 3.8.0-test+</h1><h1 id="——————————————————————–-10"><a href="#——————————————————————–-10" class="headerlink" title="——————————————————————–"></a>——————————————————————–</h1><h1 id="latency-6-us-12-12-CPU-2-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4"><a href="#latency-6-us-12-12-CPU-2-M-preempt-VP-0-KP-0-SP-0-HP-0-P-4" class="headerlink" title="latency: 6 us, #12/12, CPU#2 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)"></a>latency: 6 us, #12/12, CPU#2 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</h1><h1 id="—————–-20"><a href="#—————–-20" class="headerlink" title="—————–"></a>—————–</h1><h1 id="task-sleep-5882-uid-0-nice-0-policy-1-rt-prio-5"><a href="#task-sleep-5882-uid-0-nice-0-policy-1-rt-prio-5" class="headerlink" title="| task: sleep-5882 (uid:0 nice:0 policy:1 rt_prio:5)"></a>| task: sleep-5882 (uid:0 nice:0 policy:1 rt_prio:5)</h1><h1 id="—————–-21"><a href="#—————–-21" class="headerlink" title="—————–"></a>—————–</h1><h1 id="-45"><a href="#-45" class="headerlink" title=""></a></h1><h1 id="——-gt-CPU-10"><a href="#——-gt-CPU-10" class="headerlink" title="_——=&gt; CPU#"></a>_——=&gt; CPU#</h1><h1 id="—–-gt-irqs-off-11"><a href="#—–-gt-irqs-off-11" class="headerlink" title="/ _—–=&gt; irqs-off"></a>/ _—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-11"><a href="#—-gt-need-resched-11" class="headerlink" title="| / _—-=&gt; need-resched"></a>| / _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-11"><a href="#—-gt-hardirq-softirq-11" class="headerlink" title="|| / _—=&gt; hardirq/softirq"></a>|| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-11"><a href="#–-gt-preempt-depth-11" class="headerlink" title="||| / _–=&gt; preempt-depth"></a>||| / _–=&gt; preempt-depth</h1><h1 id="delay-11"><a href="#delay-11" class="headerlink" title="|||| /     delay"></a>|||| /     delay</h1><h1 id="cmd-pid-time-caller-10"><a href="#cmd-pid-time-caller-10" class="headerlink" title="cmd     pid   ||||| time  |   caller"></a>cmd     pid   ||||| time  |   caller</h1><h1 id="-46"><a href="#-46" class="headerlink" title="\   /      |||||  \    |   /"></a>\   /      |||||  \    |   /</h1><p>  <idle>-0       2d.h4    0us :      0:120:R   + [002]  5882: 94:R sleep<br>  <idle>-0       2d.h4    0us : ttwu_do_activate.constprop.87 &lt;-try_to_wake_up<br>  <idle>-0       2d.h4    1us : sched_wakeup: comm=sleep pid=5882 prio=94 success=1 target_cpu=002<br>  <idle>-0       2dNh2    1us : hrtimer_expire_exit: hrtimer=ffff88007796feb8<br>  <idle>-0       2.N.2    2us : power_end: cpu_id=2<br>  <idle>-0       2.N.2    3us : cpu_idle: state=4294967295 cpu_id=2<br>  <idle>-0       2dN.3    4us : hrtimer_cancel: hrtimer=ffff88007d50d5e0<br>  <idle>-0       2dN.3    4us : hrtimer_start: hrtimer=ffff88007d50d5e0 function=tick_sched_timer expires=34311211000000 softexpires=34311211000000<br>  <idle>-0       2.N.2    5us : rcu_utilization: Start context switch<br>  <idle>-0       2.N.2    5us : rcu_utilization: End context switch<br>  <idle>-0       2d..3    6us : __schedule &lt;-schedule<br>  <idle>-0       2d..3    6us :      0:120:R ==&gt; [002]  5882: 94:R sleep</p>
<h2 id="function"><a href="#function" class="headerlink" title="function"></a>function</h2><p>This tracer is the function tracer. Enabling the function tracer<br>can be done from the debug file system. Make sure the<br>ftrace_enabled is set; otherwise this tracer is a nop.<br>See the “ftrace_enabled” section below.</p>
<h1 id="sysctl-kernel-ftrace-enabled-1"><a href="#sysctl-kernel-ftrace-enabled-1" class="headerlink" title="sysctl kernel.ftrace_enabled=1"></a>sysctl kernel.ftrace_enabled=1</h1><h1 id="echo-function-gt-current-tracer"><a href="#echo-function-gt-current-tracer" class="headerlink" title="echo function &gt; current_tracer"></a>echo function &gt; current_tracer</h1><h1 id="echo-1-gt-tracing-on-6"><a href="#echo-1-gt-tracing-on-6" class="headerlink" title="echo 1 &gt; tracing_on"></a>echo 1 &gt; tracing_on</h1><h1 id="usleep-1"><a href="#usleep-1" class="headerlink" title="usleep 1"></a>usleep 1</h1><h1 id="echo-0-gt-tracing-on-6"><a href="#echo-0-gt-tracing-on-6" class="headerlink" title="echo 0 &gt; tracing_on"></a>echo 0 &gt; tracing_on</h1><h1 id="cat-trace-6"><a href="#cat-trace-6" class="headerlink" title="cat trace"></a>cat trace</h1><h1 id="tracer-function-2"><a href="#tracer-function-2" class="headerlink" title="tracer: function"></a>tracer: function</h1><h1 id="-47"><a href="#-47" class="headerlink" title=""></a></h1><h1 id="entries-in-buffer-entries-written-24799-24799-P-4"><a href="#entries-in-buffer-entries-written-24799-24799-P-4" class="headerlink" title="entries-in-buffer/entries-written: 24799/24799   #P:4"></a>entries-in-buffer/entries-written: 24799/24799   #P:4</h1><h1 id="-48"><a href="#-48" class="headerlink" title=""></a></h1><h1 id="—–-gt-irqs-off-12"><a href="#—–-gt-irqs-off-12" class="headerlink" title="_—–=&gt; irqs-off"></a>_—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-12"><a href="#—-gt-need-resched-12" class="headerlink" title="/ _—-=&gt; need-resched"></a>/ _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-12"><a href="#—-gt-hardirq-softirq-12" class="headerlink" title="| / _—=&gt; hardirq/softirq"></a>| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-12"><a href="#–-gt-preempt-depth-12" class="headerlink" title="|| / _–=&gt; preempt-depth"></a>|| / _–=&gt; preempt-depth</h1><h1 id="delay-12"><a href="#delay-12" class="headerlink" title="||| /     delay"></a>||| /     delay</h1><h1 id="TASK-PID-CPU-TIMESTAMP-FUNCTION-2"><a href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-2" class="headerlink" title="TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION"></a>TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</h1><h1 id="-49"><a href="#-49" class="headerlink" title="| |       |   ||||       |         |"></a>| |       |   ||||       |         |</h1><pre><code>        bash-1994  [002] ....  3082.063030: mutex_unlock &lt;-rb_simple_write
        bash-1994  [002] ....  3082.063031: __mutex_unlock_slowpath &lt;-mutex_unlock
        bash-1994  [002] ....  3082.063031: __fsnotify_parent &lt;-fsnotify_modify
        bash-1994  [002] ....  3082.063032: fsnotify &lt;-fsnotify_modify
        bash-1994  [002] ....  3082.063032: __srcu_read_lock &lt;-fsnotify
        bash-1994  [002] ....  3082.063032: add_preempt_count &lt;-__srcu_read_lock
        bash-1994  [002] ...1  3082.063032: sub_preempt_count &lt;-__srcu_read_lock
        bash-1994  [002] ....  3082.063033: __srcu_read_unlock &lt;-fsnotify
</code></pre>
<p>[…]</p>
<p>Note: function tracer uses ring buffers to store the above<br>entries. The newest data may overwrite the oldest data.<br>Sometimes using echo to stop the trace is not sufficient because<br>the tracing could have overwritten the data that you wanted to<br>record. For this reason, it is sometimes better to disable<br>tracing directly from a program. This allows you to stop the<br>tracing at the point that you hit the part that you are<br>interested in. To disable the tracing directly from a C program,<br>something like following code snippet can be used:</p>
<p>int trace_fd;<br>[…]<br>int main(int argc, char *argv[]) {<br>    […]<br>    trace_fd = open(tracing_file(“tracing_on”), O_WRONLY);<br>    […]<br>    if (condition_hit()) {<br>        write(trace_fd, “0”, 1);<br>    }<br>    […]<br>}</p>
<h2 id="Single-thread-tracing"><a href="#Single-thread-tracing" class="headerlink" title="Single thread tracing"></a>Single thread tracing</h2><p>By writing into set_ftrace_pid you can trace a<br>single thread. For example:</p>
<h1 id="cat-set-ftrace-pid"><a href="#cat-set-ftrace-pid" class="headerlink" title="cat set_ftrace_pid"></a>cat set_ftrace_pid</h1><p>no pid</p>
<h1 id="echo-3111-gt-set-ftrace-pid"><a href="#echo-3111-gt-set-ftrace-pid" class="headerlink" title="echo 3111 &gt; set_ftrace_pid"></a>echo 3111 &gt; set_ftrace_pid</h1><h1 id="cat-set-ftrace-pid-1"><a href="#cat-set-ftrace-pid-1" class="headerlink" title="cat set_ftrace_pid"></a>cat set_ftrace_pid</h1><p>3111</p>
<h1 id="echo-function-gt-current-tracer-1"><a href="#echo-function-gt-current-tracer-1" class="headerlink" title="echo function &gt; current_tracer"></a>echo function &gt; current_tracer</h1><h1 id="cat-trace-head"><a href="#cat-trace-head" class="headerlink" title="cat trace | head"></a>cat trace | head</h1><h1 id="tracer-function-3"><a href="#tracer-function-3" class="headerlink" title="tracer: function"></a>tracer: function</h1><h1 id="-50"><a href="#-50" class="headerlink" title=""></a></h1><h1 id="TASK-PID-CPU-TIMESTAMP-FUNCTION-3"><a href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-3" class="headerlink" title="TASK-PID    CPU#    TIMESTAMP  FUNCTION"></a>TASK-PID    CPU#    TIMESTAMP  FUNCTION</h1><h1 id="-51"><a href="#-51" class="headerlink" title="| |       |          |         |"></a>| |       |          |         |</h1><pre><code> yum-updatesd-3111  [003]  1637.254676: finish_task_switch &lt;-thread_return
 yum-updatesd-3111  [003]  1637.254681: hrtimer_cancel &lt;-schedule_hrtimeout_range
 yum-updatesd-3111  [003]  1637.254682: hrtimer_try_to_cancel &lt;-hrtimer_cancel
 yum-updatesd-3111  [003]  1637.254683: lock_hrtimer_base &lt;-hrtimer_try_to_cancel
 yum-updatesd-3111  [003]  1637.254685: fget_light &lt;-do_sys_poll
 yum-updatesd-3111  [003]  1637.254686: pipe_poll &lt;-do_sys_poll
</code></pre>
<h1 id="echo-1-gt-set-ftrace-pid"><a href="#echo-1-gt-set-ftrace-pid" class="headerlink" title="echo -1 &gt; set_ftrace_pid"></a>echo -1 &gt; set_ftrace_pid</h1><h1 id="cat-trace-head-1"><a href="#cat-trace-head-1" class="headerlink" title="cat trace |head"></a>cat trace |head</h1><h1 id="tracer-function-4"><a href="#tracer-function-4" class="headerlink" title="tracer: function"></a>tracer: function</h1><h1 id="-52"><a href="#-52" class="headerlink" title=""></a></h1><h1 id="TASK-PID-CPU-TIMESTAMP-FUNCTION-4"><a href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-4" class="headerlink" title="TASK-PID    CPU#    TIMESTAMP  FUNCTION"></a>TASK-PID    CPU#    TIMESTAMP  FUNCTION</h1><h1 id="-53"><a href="#-53" class="headerlink" title="| |       |          |         |"></a>| |       |          |         |</h1><h5 id="CPU-3-buffer-started"><a href="#CPU-3-buffer-started" class="headerlink" title="CPU 3 buffer started"></a>CPU 3 buffer started</h5><pre><code> yum-updatesd-3111  [003]  1701.957688: free_poll_entry &lt;-poll_freewait
 yum-updatesd-3111  [003]  1701.957689: remove_wait_queue &lt;-free_poll_entry
 yum-updatesd-3111  [003]  1701.957691: fput &lt;-free_poll_entry
 yum-updatesd-3111  [003]  1701.957692: audit_syscall_exit &lt;-sysret_audit
 yum-updatesd-3111  [003]  1701.957693: path_put &lt;-audit_syscall_exit
</code></pre>
<p>If you want to trace a function when executing, you could use<br>something like this simple program:</p>
<p>#include &lt;stdio.h&gt;<br>#include &lt;stdlib.h&gt;<br>#include &lt;sys/types.h&gt;<br>#include &lt;sys/stat.h&gt;<br>#include &lt;fcntl.h&gt;<br>#include &lt;unistd.h&gt;<br>#include &lt;string.h&gt;</p>
<p>#define _STR(x) #x<br>#define STR(x) _STR(x)<br>#define MAX_PATH 256</p>
<p>const char *find_debugfs(void)<br>{<br>       static char debugfs[MAX_PATH+1];<br>       static int debugfs_found;<br>       char type[100];<br>       FILE *fp;</p>
<pre><code>   if (debugfs_found)
           return debugfs;

   if ((fp = fopen(&quot;/proc/mounts&quot;,&quot;r&quot;)) == NULL) &#123;
           perror(&quot;/proc/mounts&quot;);
           return NULL;
   &#125;

   while (fscanf(fp, &quot;%*s %&quot;
                 STR(MAX_PATH)
                 &quot;s %99s %*s %*d %*d\n&quot;,
                 debugfs, type) == 2) &#123;
           if (strcmp(type, &quot;debugfs&quot;) == 0)
                   break;
   &#125;
   fclose(fp);

   if (strcmp(type, &quot;debugfs&quot;) != 0) &#123;
           fprintf(stderr, &quot;debugfs not mounted&quot;);
           return NULL;
   &#125;

   strcat(debugfs, &quot;/tracing/&quot;);
   debugfs_found = 1;

   return debugfs;
</code></pre>
<p>}</p>
<p>const char *tracing_file(const char *file_name)<br>{<br>       static char trace_file[MAX_PATH+1];<br>       snprintf(trace_file, MAX_PATH, “%s/%s”, find_debugfs(), file_name);<br>       return trace_file;<br>}</p>
<p>int main (int argc, char **argv)<br>{<br>        if (argc &lt; 1)<br>                exit(-1);</p>
<pre><code>    if (fork() &gt; 0) &#123;
            int fd, ffd;
            char line[64];
            int s;

            ffd = open(tracing_file(&quot;current_tracer&quot;), O_WRONLY);
            if (ffd &lt; 0)
                    exit(-1);
            write(ffd, &quot;nop&quot;, 3);

            fd = open(tracing_file(&quot;set_ftrace_pid&quot;), O_WRONLY);
            s = sprintf(line, &quot;%d\n&quot;, getpid());
            write(fd, line, s);

            write(ffd, &quot;function&quot;, 8);

            close(fd);
            close(ffd);

            execvp(argv[1], argv+1);
    &#125;

    return 0;
</code></pre>
<p>}</p>
<p>Or this simple script!</p>
<hr>
<p>#!/bin/bash</p>
<p>debugfs=<code>sed -ne &#39;s/^debugfs \(.*\) debugfs.*/\1/p&#39; /proc/mounts</code><br>echo nop &gt; $debugfs/tracing/current_tracer<br>echo 0 &gt; $debugfs/tracing/tracing_on<br>echo $$ &gt; $debugfs/tracing/set_ftrace_pid<br>echo function &gt; $debugfs/tracing/current_tracer<br>echo 1 &gt; $debugfs/tracing/tracing_on<br>exec “$@”</p>
<hr>
<h2 id="function-graph-tracer"><a href="#function-graph-tracer" class="headerlink" title="function graph tracer"></a>function graph tracer</h2><p>This tracer is similar to the function tracer except that it<br>probes a function on its entry and its exit. This is done by<br>using a dynamically allocated stack of return addresses in each<br>task_struct. On function entry the tracer overwrites the return<br>address of each function traced to set a custom probe. Thus the<br>original return address is stored on the stack of return address<br>in the task_struct.</p>
<p>Probing on both ends of a function leads to special features<br>such as:</p>
<ul>
<li>measure of a function’s time execution</li>
<li>having a reliable call stack to draw function calls graph</li>
</ul>
<p>This tracer is useful in several situations:</p>
<ul>
<li><p>you want to find the reason of a strange kernel behavior and<br>need to see what happens in detail on any areas (or specific<br>ones).</p>
</li>
<li><p>you are experiencing weird latencies but it’s difficult to<br>find its origin.</p>
</li>
<li><p>you want to find quickly which path is taken by a specific<br>function</p>
</li>
<li><p>you just want to peek inside a working kernel and want to see<br>what happens there.</p>
</li>
</ul>
<h1 id="tracer-function-graph"><a href="#tracer-function-graph" class="headerlink" title="tracer: function_graph"></a>tracer: function_graph</h1><h1 id="-54"><a href="#-54" class="headerlink" title=""></a></h1><h1 id="CPU-DURATION-FUNCTION-CALLS"><a href="#CPU-DURATION-FUNCTION-CALLS" class="headerlink" title="CPU  DURATION                  FUNCTION CALLS"></a>CPU  DURATION                  FUNCTION CALLS</h1><h1 id="-55"><a href="#-55" class="headerlink" title="|     |   |                     |   |   |   |"></a>|     |   |                     |   |   |   |</h1><ol start="0">
<li><pre><code>          |  sys_open() &#123;
</code></pre>
</li>
<li><pre><code>          |    do_sys_open() &#123;
</code></pre>
</li>
<li><pre><code>          |      getname() &#123;
</code></pre>
</li>
<li><pre><code>          |        kmem_cache_alloc() &#123;
</code></pre>
</li>
<li>  1.382 us    |          __might_sleep();</li>
<li>  2.478 us    |        }</li>
<li><pre><code>          |        strncpy_from_user() &#123;
</code></pre>
</li>
<li><pre><code>          |          might_fault() &#123;
</code></pre>
</li>
<li>  1.389 us    |            __might_sleep();</li>
<li>  2.553 us    |          }</li>
<li>  3.807 us    |        }</li>
<li>  7.876 us    |      }</li>
<li><pre><code>          |      alloc_fd() &#123;
</code></pre>
</li>
<li>  0.668 us    |        _spin_lock();</li>
<li>  0.570 us    |        expand_files();</li>
<li>  0.586 us    |        _spin_unlock();</li>
</ol>
<p>There are several columns that can be dynamically<br>enabled/disabled. You can use every combination of options you<br>want, depending on your needs.</p>
<ul>
<li><p>The cpu number on which the function executed is default<br>enabled.  It is sometimes better to only trace one cpu (see<br>tracing_cpu_mask file) or you might sometimes see unordered<br>function calls while cpu tracing switch.</p>
<p>  hide: echo nofuncgraph-cpu &gt; trace_options<br>  show: echo funcgraph-cpu &gt; trace_options</p>
</li>
<li><p>The duration (function’s time of execution) is displayed on<br>the closing bracket line of a function or on the same line<br>than the current function in case of a leaf one. It is default<br>enabled.</p>
<p>  hide: echo nofuncgraph-duration &gt; trace_options<br>  show: echo funcgraph-duration &gt; trace_options</p>
</li>
<li><p>The overhead field precedes the duration field in case of<br>reached duration thresholds.</p>
<p>  hide: echo nofuncgraph-overhead &gt; trace_options<br>  show: echo funcgraph-overhead &gt; trace_options<br>  depends on: funcgraph-duration</p>
<p>ie:</p>
<ol start="0">
<li><pre><code>          |    up_write() &#123;
</code></pre>
</li>
<li>  0.646 us    |      _spin_lock_irqsave();</li>
<li>  0.684 us    |      _spin_unlock_irqrestore();</li>
<li>  3.123 us    |    }</li>
<li>  0.548 us    |    fput();</li>
<li><ul>
<li>58.628 us   |  }</li>
</ul>
</li>
</ol>
<p>[…]</p>
<ol start="0">
<li><pre><code>          |      putname() &#123;
</code></pre>
</li>
<li><pre><code>          |        kmem_cache_free() &#123;
</code></pre>
</li>
<li>  0.518 us    |          __phys_addr();</li>
<li>  1.757 us    |        }</li>
<li>  2.861 us    |      }</li>
<li>! 115.305 us  |    }</li>
<li>! 116.402 us  |  }</li>
</ol>
<ul>
<li>means that the function exceeded 10 usecs.<br>! means that the function exceeded 100 usecs.</li>
</ul>
</li>
</ul>
<ul>
<li><p>The task/pid field displays the thread cmdline and pid which<br>executed the function. It is default disabled.</p>
<p>  hide: echo nofuncgraph-proc &gt; trace_options<br>  show: echo funcgraph-proc &gt; trace_options</p>
<p>ie:</p>
<h1 id="tracer-function-graph-1"><a href="#tracer-function-graph-1" class="headerlink" title="tracer: function_graph"></a>tracer: function_graph</h1><h1 id="-56"><a href="#-56" class="headerlink" title=""></a></h1><h1 id="CPU-TASK-PID-DURATION-FUNCTION-CALLS"><a href="#CPU-TASK-PID-DURATION-FUNCTION-CALLS" class="headerlink" title="CPU  TASK/PID        DURATION                  FUNCTION CALLS"></a>CPU  TASK/PID        DURATION                  FUNCTION CALLS</h1><h1 id="-57"><a href="#-57" class="headerlink" title="|    |    |           |   |                     |   |   |   |"></a>|    |    |           |   |                     |   |   |   |</h1><ol start="0">
<li>   sh-4802     |               |                  d_free() {</li>
<li>   sh-4802     |               |                    call_rcu() {</li>
<li>   sh-4802     |               |                      __call_rcu() {</li>
<li>   sh-4802     |   0.616 us    |                        rcu_process_gp_end();</li>
<li>   sh-4802     |   0.586 us    |                        check_for_new_grace_period();</li>
<li>   sh-4802     |   2.899 us    |                      }</li>
<li>   sh-4802     |   4.040 us    |                    }</li>
<li>   sh-4802     |   5.151 us    |                  }</li>
<li>   sh-4802     | + 49.370 us   |                }</li>
</ol>
</li>
</ul>
<ul>
<li><p>The absolute time field is an absolute timestamp given by the<br>system clock since it started. A snapshot of this time is<br>given on each entry/exit of functions</p>
<p>  hide: echo nofuncgraph-abstime &gt; trace_options<br>  show: echo funcgraph-abstime &gt; trace_options</p>
<p>ie:</p>
<h1 id="-58"><a href="#-58" class="headerlink" title=""></a></h1><h1 id="TIME-CPU-DURATION-FUNCTION-CALLS"><a href="#TIME-CPU-DURATION-FUNCTION-CALLS" class="headerlink" title="TIME       CPU  DURATION                  FUNCTION CALLS"></a>TIME       CPU  DURATION                  FUNCTION CALLS</h1><h1 id="-59"><a href="#-59" class="headerlink" title="|         |     |   |                     |   |   |   |"></a>|         |     |   |                     |   |   |   |</h1><p>360.774522 |   1)   0.541 us    |                                          }<br>360.774522 |   1)   4.663 us    |                                        }<br>360.774523 |   1)   0.541 us    |                                        __wake_up_bit();<br>360.774524 |   1)   6.796 us    |                                      }<br>360.774524 |   1)   7.952 us    |                                    }<br>360.774525 |   1)   9.063 us    |                                  }<br>360.774525 |   1)   0.615 us    |                                  journal_mark_dirty();<br>360.774527 |   1)   0.578 us    |                                  __brelse();<br>360.774528 |   1)               |                                  reiserfs_prepare_for_journal() {<br>360.774528 |   1)               |                                    unlock_buffer() {<br>360.774529 |   1)               |                                      wake_up_bit() {<br>360.774529 |   1)               |                                        bit_waitqueue() {<br>360.774530 |   1)   0.594 us    |                                          __phys_addr();</p>
</li>
</ul>
<p>You can put some comments on specific functions by using<br>trace_printk() For example, if you want to put a comment inside<br>the __might_sleep() function, you just have to include<br>&lt;linux/ftrace.h&gt; and call trace_printk() inside __might_sleep()</p>
<p>trace_printk(“I’m a comment!\n”)</p>
<p>will produce:</p>
<ol>
<li><pre><code>          |             __might_sleep() &#123;
</code></pre>
</li>
<li><pre><code>          |                /* I&#39;m a comment! */
</code></pre>
</li>
<li>  1.449 us    |             }</li>
</ol>
<p>You might find other useful features for this tracer in the<br>following “dynamic ftrace” section such as tracing only specific<br>functions or tasks.</p>
<h2 id="dynamic-ftrace"><a href="#dynamic-ftrace" class="headerlink" title="dynamic ftrace"></a>dynamic ftrace</h2><p>If CONFIG_DYNAMIC_FTRACE is set, the system will run with<br>virtually no overhead when function tracing is disabled. The way<br>this works is the mcount function call (placed at the start of<br>every kernel function, produced by the -pg switch in gcc),<br>starts of pointing to a simple return. (Enabling FTRACE will<br>include the -pg switch in the compiling of the kernel.)</p>
<p>At compile time every C file object is run through the<br>recordmcount program (located in the scripts directory). This<br>program will parse the ELF headers in the C object to find all<br>the locations in the .text section that call mcount. (Note, only<br>white listed .text sections are processed, since processing other<br>sections like .init.text may cause races due to those sections<br>being freed unexpectedly).</p>
<p>A new section called “__mcount_loc” is created that holds<br>references to all the mcount call sites in the .text section.<br>The recordmcount program re-links this section back into the<br>original object. The final linking stage of the kernel will add all these<br>references into a single table.</p>
<p>On boot up, before SMP is initialized, the dynamic ftrace code<br>scans this table and updates all the locations into nops. It<br>also records the locations, which are added to the<br>available_filter_functions list.  Modules are processed as they<br>are loaded and before they are executed.  When a module is<br>unloaded, it also removes its functions from the ftrace function<br>list. This is automatic in the module unload code, and the<br>module author does not need to worry about it.</p>
<p>When tracing is enabled, the process of modifying the function<br>tracepoints is dependent on architecture. The old method is to use<br>kstop_machine to prevent races with the CPUs executing code being<br>modified (which can cause the CPU to do undesirable things, especially<br>if the modified code crosses cache (or page) boundaries), and the nops are<br>patched back to calls. But this time, they do not call mcount<br>(which is just a function stub). They now call into the ftrace<br>infrastructure.</p>
<p>The new method of modifying the function tracepoints is to place<br>a breakpoint at the location to be modified, sync all CPUs, modify<br>the rest of the instruction not covered by the breakpoint. Sync<br>all CPUs again, and then remove the breakpoint with the finished<br>version to the ftrace call site.</p>
<p>Some archs do not even need to monkey around with the synchronization,<br>and can just slap the new code on top of the old without any<br>problems with other CPUs executing it at the same time.</p>
<p>One special side-effect to the recording of the functions being<br>traced is that we can now selectively choose which functions we<br>wish to trace and which ones we want the mcount calls to remain<br>as nops.</p>
<p>Two files are used, one for enabling and one for disabling the<br>tracing of specified functions. They are:</p>
<p>  set_ftrace_filter</p>
<p>and</p>
<p>  set_ftrace_notrace</p>
<p>A list of available functions that you can add to these files is<br>listed in:</p>
<p>   available_filter_functions</p>
<h1 id="cat-available-filter-functions"><a href="#cat-available-filter-functions" class="headerlink" title="cat available_filter_functions"></a>cat available_filter_functions</h1><p>put_prev_task_idle<br>kmem_cache_create<br>pick_next_task_rt<br>get_online_cpus<br>pick_next_task_fair<br>mutex_lock<br>[…]</p>
<p>If I am only interested in sys_nanosleep and hrtimer_interrupt:</p>
<h1 id="echo-sys-nanosleep-hrtimer-interrupt-gt-set-ftrace-filter"><a href="#echo-sys-nanosleep-hrtimer-interrupt-gt-set-ftrace-filter" class="headerlink" title="echo sys_nanosleep hrtimer_interrupt &gt; set_ftrace_filter"></a>echo sys_nanosleep hrtimer_interrupt &gt; set_ftrace_filter</h1><h1 id="echo-function-gt-current-tracer-2"><a href="#echo-function-gt-current-tracer-2" class="headerlink" title="echo function &gt; current_tracer"></a>echo function &gt; current_tracer</h1><h1 id="echo-1-gt-tracing-on-7"><a href="#echo-1-gt-tracing-on-7" class="headerlink" title="echo 1 &gt; tracing_on"></a>echo 1 &gt; tracing_on</h1><h1 id="usleep-1-1"><a href="#usleep-1-1" class="headerlink" title="usleep 1"></a>usleep 1</h1><h1 id="echo-0-gt-tracing-on-7"><a href="#echo-0-gt-tracing-on-7" class="headerlink" title="echo 0 &gt; tracing_on"></a>echo 0 &gt; tracing_on</h1><h1 id="cat-trace-7"><a href="#cat-trace-7" class="headerlink" title="cat trace"></a>cat trace</h1><h1 id="tracer-function-5"><a href="#tracer-function-5" class="headerlink" title="tracer: function"></a>tracer: function</h1><h1 id="-60"><a href="#-60" class="headerlink" title=""></a></h1><h1 id="entries-in-buffer-entries-written-5-5-P-4"><a href="#entries-in-buffer-entries-written-5-5-P-4" class="headerlink" title="entries-in-buffer/entries-written: 5/5   #P:4"></a>entries-in-buffer/entries-written: 5/5   #P:4</h1><h1 id="-61"><a href="#-61" class="headerlink" title=""></a></h1><h1 id="—–-gt-irqs-off-13"><a href="#—–-gt-irqs-off-13" class="headerlink" title="_—–=&gt; irqs-off"></a>_—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-13"><a href="#—-gt-need-resched-13" class="headerlink" title="/ _—-=&gt; need-resched"></a>/ _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-13"><a href="#—-gt-hardirq-softirq-13" class="headerlink" title="| / _—=&gt; hardirq/softirq"></a>| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-13"><a href="#–-gt-preempt-depth-13" class="headerlink" title="|| / _–=&gt; preempt-depth"></a>|| / _–=&gt; preempt-depth</h1><h1 id="delay-13"><a href="#delay-13" class="headerlink" title="||| /     delay"></a>||| /     delay</h1><h1 id="TASK-PID-CPU-TIMESTAMP-FUNCTION-5"><a href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-5" class="headerlink" title="TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION"></a>TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</h1><h1 id="-62"><a href="#-62" class="headerlink" title="| |       |   ||||       |         |"></a>| |       |   ||||       |         |</h1><pre><code>      usleep-2665  [001] ....  4186.475355: sys_nanosleep &lt;-system_call_fastpath
      &lt;idle&gt;-0     [001] d.h1  4186.475409: hrtimer_interrupt &lt;-smp_apic_timer_interrupt
      usleep-2665  [001] d.h1  4186.475426: hrtimer_interrupt &lt;-smp_apic_timer_interrupt
      &lt;idle&gt;-0     [003] d.h1  4186.475426: hrtimer_interrupt &lt;-smp_apic_timer_interrupt
      &lt;idle&gt;-0     [002] d.h1  4186.475427: hrtimer_interrupt &lt;-smp_apic_timer_interrupt
</code></pre>
<p>To see which functions are being traced, you can cat the file:</p>
<h1 id="cat-set-ftrace-filter"><a href="#cat-set-ftrace-filter" class="headerlink" title="cat set_ftrace_filter"></a>cat set_ftrace_filter</h1><p>hrtimer_interrupt<br>sys_nanosleep</p>
<p>Perhaps this is not enough. The filters also allow simple wild<br>cards. Only the following are currently available</p>
<p>  <match>*  - will match functions that begin with <match><br>  *<match>  - will match functions that end with <match><br>  <em><match></em> - will match functions that have <match> in it</p>
<p>These are the only wild cards which are supported.</p>
<p>  <match>*<match> will not work.</p>
<p>Note: It is better to use quotes to enclose the wild cards,<br>      otherwise the shell may expand the parameters into names<br>      of files in the local directory.</p>
<h1 id="echo-‘hrtimer-’-gt-set-ftrace-filter"><a href="#echo-‘hrtimer-’-gt-set-ftrace-filter" class="headerlink" title="echo ‘hrtimer_*’ &gt; set_ftrace_filter"></a>echo ‘hrtimer_*’ &gt; set_ftrace_filter</h1><p>Produces:</p>
<h1 id="tracer-function-6"><a href="#tracer-function-6" class="headerlink" title="tracer: function"></a>tracer: function</h1><h1 id="-63"><a href="#-63" class="headerlink" title=""></a></h1><h1 id="entries-in-buffer-entries-written-897-897-P-4"><a href="#entries-in-buffer-entries-written-897-897-P-4" class="headerlink" title="entries-in-buffer/entries-written: 897/897   #P:4"></a>entries-in-buffer/entries-written: 897/897   #P:4</h1><h1 id="-64"><a href="#-64" class="headerlink" title=""></a></h1><h1 id="—–-gt-irqs-off-14"><a href="#—–-gt-irqs-off-14" class="headerlink" title="_—–=&gt; irqs-off"></a>_—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-14"><a href="#—-gt-need-resched-14" class="headerlink" title="/ _—-=&gt; need-resched"></a>/ _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-14"><a href="#—-gt-hardirq-softirq-14" class="headerlink" title="| / _—=&gt; hardirq/softirq"></a>| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-14"><a href="#–-gt-preempt-depth-14" class="headerlink" title="|| / _–=&gt; preempt-depth"></a>|| / _–=&gt; preempt-depth</h1><h1 id="delay-14"><a href="#delay-14" class="headerlink" title="||| /     delay"></a>||| /     delay</h1><h1 id="TASK-PID-CPU-TIMESTAMP-FUNCTION-6"><a href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-6" class="headerlink" title="TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION"></a>TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</h1><h1 id="-65"><a href="#-65" class="headerlink" title="| |       |   ||||       |         |"></a>| |       |   ||||       |         |</h1><pre><code>      &lt;idle&gt;-0     [003] dN.1  4228.547803: hrtimer_cancel &lt;-tick_nohz_idle_exit
      &lt;idle&gt;-0     [003] dN.1  4228.547804: hrtimer_try_to_cancel &lt;-hrtimer_cancel
      &lt;idle&gt;-0     [003] dN.2  4228.547805: hrtimer_force_reprogram &lt;-__remove_hrtimer
      &lt;idle&gt;-0     [003] dN.1  4228.547805: hrtimer_forward &lt;-tick_nohz_idle_exit
      &lt;idle&gt;-0     [003] dN.1  4228.547805: hrtimer_start_range_ns &lt;-hrtimer_start_expires.constprop.11
      &lt;idle&gt;-0     [003] d..1  4228.547858: hrtimer_get_next_event &lt;-get_next_timer_interrupt
      &lt;idle&gt;-0     [003] d..1  4228.547859: hrtimer_start &lt;-__tick_nohz_idle_enter
      &lt;idle&gt;-0     [003] d..2  4228.547860: hrtimer_force_reprogram &lt;-__rem
</code></pre>
<p>Notice that we lost the sys_nanosleep.</p>
<h1 id="cat-set-ftrace-filter-1"><a href="#cat-set-ftrace-filter-1" class="headerlink" title="cat set_ftrace_filter"></a>cat set_ftrace_filter</h1><p>hrtimer_run_queues<br>hrtimer_run_pending<br>hrtimer_init<br>hrtimer_cancel<br>hrtimer_try_to_cancel<br>hrtimer_forward<br>hrtimer_start<br>hrtimer_reprogram<br>hrtimer_force_reprogram<br>hrtimer_get_next_event<br>hrtimer_interrupt<br>hrtimer_nanosleep<br>hrtimer_wakeup<br>hrtimer_get_remaining<br>hrtimer_get_res<br>hrtimer_init_sleeper</p>
<p>This is because the ‘&gt;’ and ‘&gt;&gt;’ act just like they do in bash.<br>To rewrite the filters, use ‘&gt;’<br>To append to the filters, use ‘&gt;&gt;’</p>
<p>To clear out a filter so that all functions will be recorded<br>again:</p>
<h1 id="echo-gt-set-ftrace-filter"><a href="#echo-gt-set-ftrace-filter" class="headerlink" title="echo &gt; set_ftrace_filter"></a>echo &gt; set_ftrace_filter</h1><h1 id="cat-set-ftrace-filter-2"><a href="#cat-set-ftrace-filter-2" class="headerlink" title="cat set_ftrace_filter"></a>cat set_ftrace_filter</h1><h1 id="-66"><a href="#-66" class="headerlink" title=""></a></h1><p>Again, now we want to append.</p>
<h1 id="echo-sys-nanosleep-gt-set-ftrace-filter"><a href="#echo-sys-nanosleep-gt-set-ftrace-filter" class="headerlink" title="echo sys_nanosleep &gt; set_ftrace_filter"></a>echo sys_nanosleep &gt; set_ftrace_filter</h1><h1 id="cat-set-ftrace-filter-3"><a href="#cat-set-ftrace-filter-3" class="headerlink" title="cat set_ftrace_filter"></a>cat set_ftrace_filter</h1><p>sys_nanosleep</p>
<h1 id="echo-‘hrtimer-’-gt-gt-set-ftrace-filter"><a href="#echo-‘hrtimer-’-gt-gt-set-ftrace-filter" class="headerlink" title="echo ‘hrtimer_*’ &gt;&gt; set_ftrace_filter"></a>echo ‘hrtimer_*’ &gt;&gt; set_ftrace_filter</h1><h1 id="cat-set-ftrace-filter-4"><a href="#cat-set-ftrace-filter-4" class="headerlink" title="cat set_ftrace_filter"></a>cat set_ftrace_filter</h1><p>hrtimer_run_queues<br>hrtimer_run_pending<br>hrtimer_init<br>hrtimer_cancel<br>hrtimer_try_to_cancel<br>hrtimer_forward<br>hrtimer_start<br>hrtimer_reprogram<br>hrtimer_force_reprogram<br>hrtimer_get_next_event<br>hrtimer_interrupt<br>sys_nanosleep<br>hrtimer_nanosleep<br>hrtimer_wakeup<br>hrtimer_get_remaining<br>hrtimer_get_res<br>hrtimer_init_sleeper</p>
<p>The set_ftrace_notrace prevents those functions from being<br>traced.</p>
<h1 id="echo-‘preempt‘-‘lock‘-gt-set-ftrace-notrace"><a href="#echo-‘preempt‘-‘lock‘-gt-set-ftrace-notrace" class="headerlink" title="echo ‘preempt‘ ‘lock‘ &gt; set_ftrace_notrace"></a>echo ‘<em>preempt</em>‘ ‘<em>lock</em>‘ &gt; set_ftrace_notrace</h1><p>Produces:</p>
<h1 id="tracer-function-7"><a href="#tracer-function-7" class="headerlink" title="tracer: function"></a>tracer: function</h1><h1 id="-67"><a href="#-67" class="headerlink" title=""></a></h1><h1 id="entries-in-buffer-entries-written-39608-39608-P-4"><a href="#entries-in-buffer-entries-written-39608-39608-P-4" class="headerlink" title="entries-in-buffer/entries-written: 39608/39608   #P:4"></a>entries-in-buffer/entries-written: 39608/39608   #P:4</h1><h1 id="-68"><a href="#-68" class="headerlink" title=""></a></h1><h1 id="—–-gt-irqs-off-15"><a href="#—–-gt-irqs-off-15" class="headerlink" title="_—–=&gt; irqs-off"></a>_—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-15"><a href="#—-gt-need-resched-15" class="headerlink" title="/ _—-=&gt; need-resched"></a>/ _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-15"><a href="#—-gt-hardirq-softirq-15" class="headerlink" title="| / _—=&gt; hardirq/softirq"></a>| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-15"><a href="#–-gt-preempt-depth-15" class="headerlink" title="|| / _–=&gt; preempt-depth"></a>|| / _–=&gt; preempt-depth</h1><h1 id="delay-15"><a href="#delay-15" class="headerlink" title="||| /     delay"></a>||| /     delay</h1><h1 id="TASK-PID-CPU-TIMESTAMP-FUNCTION-7"><a href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-7" class="headerlink" title="TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION"></a>TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</h1><h1 id="-69"><a href="#-69" class="headerlink" title="| |       |   ||||       |         |"></a>| |       |   ||||       |         |</h1><pre><code>        bash-1994  [000] ....  4342.324896: file_ra_state_init &lt;-do_dentry_open
        bash-1994  [000] ....  4342.324897: open_check_o_direct &lt;-do_last
        bash-1994  [000] ....  4342.324897: ima_file_check &lt;-do_last
        bash-1994  [000] ....  4342.324898: process_measurement &lt;-ima_file_check
        bash-1994  [000] ....  4342.324898: ima_get_action &lt;-process_measurement
        bash-1994  [000] ....  4342.324898: ima_match_policy &lt;-ima_get_action
        bash-1994  [000] ....  4342.324899: do_truncate &lt;-do_last
        bash-1994  [000] ....  4342.324899: should_remove_suid &lt;-do_truncate
        bash-1994  [000] ....  4342.324899: notify_change &lt;-do_truncate
        bash-1994  [000] ....  4342.324900: current_fs_time &lt;-notify_change
        bash-1994  [000] ....  4342.324900: current_kernel_time &lt;-current_fs_time
        bash-1994  [000] ....  4342.324900: timespec_trunc &lt;-current_fs_time
</code></pre>
<p>We can see that there’s no more lock or preempt tracing.</p>
<h2 id="Dynamic-ftrace-with-the-function-graph-tracer"><a href="#Dynamic-ftrace-with-the-function-graph-tracer" class="headerlink" title="Dynamic ftrace with the function graph tracer"></a>Dynamic ftrace with the function graph tracer</h2><p>Although what has been explained above concerns both the<br>function tracer and the function-graph-tracer, there are some<br>special features only available in the function-graph tracer.</p>
<p>If you want to trace only one function and all of its children,<br>you just have to echo its name into set_graph_function:</p>
<p> echo __do_fault &gt; set_graph_function</p>
<p>will produce the following “expanded” trace of the __do_fault()<br>function:</p>
<ol start="0">
<li><pre><code>          |  __do_fault() &#123;
</code></pre>
</li>
<li><pre><code>          |    filemap_fault() &#123;
</code></pre>
</li>
<li><pre><code>          |      find_lock_page() &#123;
</code></pre>
</li>
<li>  0.804 us    |        find_get_page();</li>
<li><pre><code>          |        __might_sleep() &#123;
</code></pre>
</li>
<li>  1.329 us    |        }</li>
<li>  3.904 us    |      }</li>
<li>  4.979 us    |    }</li>
<li>  0.653 us    |    _spin_lock();</li>
<li>  0.578 us    |    page_add_file_rmap();</li>
<li>  0.525 us    |    native_set_pte_at();</li>
<li>  0.585 us    |    _spin_unlock();</li>
<li><pre><code>          |    unlock_page() &#123;
</code></pre>
</li>
<li>  0.541 us    |      page_waitqueue();</li>
<li>  0.639 us    |      __wake_up_bit();</li>
<li>  2.786 us    |    }</li>
<li><ul>
<li>14.237 us   |  }</li>
</ul>
</li>
<li><pre><code>          |  __do_fault() &#123;
</code></pre>
</li>
<li><pre><code>          |    filemap_fault() &#123;
</code></pre>
</li>
<li><pre><code>          |      find_lock_page() &#123;
</code></pre>
</li>
<li>  0.698 us    |        find_get_page();</li>
<li><pre><code>          |        __might_sleep() &#123;
</code></pre>
</li>
<li>  1.412 us    |        }</li>
<li>  3.950 us    |      }</li>
<li>  5.098 us    |    }</li>
<li>  0.631 us    |    _spin_lock();</li>
<li>  0.571 us    |    page_add_file_rmap();</li>
<li>  0.526 us    |    native_set_pte_at();</li>
<li>  0.586 us    |    _spin_unlock();</li>
<li><pre><code>          |    unlock_page() &#123;
</code></pre>
</li>
<li>  0.533 us    |      page_waitqueue();</li>
<li>  0.638 us    |      __wake_up_bit();</li>
<li>  2.793 us    |    }</li>
<li><ul>
<li>14.012 us   |  }</li>
</ul>
</li>
</ol>
<p>You can also expand several functions at once:</p>
<p> echo sys_open &gt; set_graph_function<br> echo sys_close &gt;&gt; set_graph_function</p>
<p>Now if you want to go back to trace all functions you can clear<br>this special filter via:</p>
<p> echo &gt; set_graph_function</p>
<h2 id="ftrace-enabled"><a href="#ftrace-enabled" class="headerlink" title="ftrace_enabled"></a>ftrace_enabled</h2><p>Note, the proc sysctl ftrace_enable is a big on/off switch for the<br>function tracer. By default it is enabled (when function tracing is<br>enabled in the kernel). If it is disabled, all function tracing is<br>disabled. This includes not only the function tracers for ftrace, but<br>also for any other uses (perf, kprobes, stack tracing, profiling, etc).</p>
<p>Please disable this with care.</p>
<p>This can be disable (and enabled) with:</p>
<p>  sysctl kernel.ftrace_enabled=0<br>  sysctl kernel.ftrace_enabled=1</p>
<p> or</p>
<p>  echo 0 &gt; /proc/sys/kernel/ftrace_enabled<br>  echo 1 &gt; /proc/sys/kernel/ftrace_enabled</p>
<h2 id="Filter-commands"><a href="#Filter-commands" class="headerlink" title="Filter commands"></a>Filter commands</h2><p>A few commands are supported by the set_ftrace_filter interface.<br>Trace commands have the following format:</p>
<p><function>:<command>:<parameter></p>
<p>The following commands are supported:</p>
<ul>
<li><p>mod<br>This command enables function filtering per module. The<br>parameter defines the module. For example, if only the write*<br>functions in the ext3 module are desired, run:</p>
<p> echo ‘write*:mod:ext3’ &gt; set_ftrace_filter</p>
<p>This command interacts with the filter in the same way as<br>filtering based on function names. Thus, adding more functions<br>in a different module is accomplished by appending (&gt;&gt;) to the<br>filter file. Remove specific module functions by prepending<br>‘!’:</p>
<p> echo ‘!writeback*:mod:ext3’ &gt;&gt; set_ftrace_filter</p>
</li>
<li><p>traceon/traceoff<br>These commands turn tracing on and off when the specified<br>functions are hit. The parameter determines how many times the<br>tracing system is turned on and off. If unspecified, there is<br>no limit. For example, to disable tracing when a schedule bug<br>is hit the first 5 times, run:</p>
<p> echo ‘__schedule_bug:traceoff:5’ &gt; set_ftrace_filter</p>
<p>To always disable tracing when __schedule_bug is hit:</p>
<p> echo ‘__schedule_bug:traceoff’ &gt; set_ftrace_filter</p>
<p>These commands are cumulative whether or not they are appended<br>to set_ftrace_filter. To remove a command, prepend it by ‘!’<br>and drop the parameter:</p>
<p> echo ‘!__schedule_bug:traceoff:0’ &gt; set_ftrace_filter</p>
<p>  The above removes the traceoff command for __schedule_bug<br>  that have a counter. To remove commands without counters:</p>
<p> echo ‘!__schedule_bug:traceoff’ &gt; set_ftrace_filter</p>
</li>
<li><p>snapshot<br>Will cause a snapshot to be triggered when the function is hit.</p>
<p> echo ‘native_flush_tlb_others:snapshot’ &gt; set_ftrace_filter</p>
<p>To only snapshot once:</p>
<p> echo ‘native_flush_tlb_others:snapshot:1’ &gt; set_ftrace_filter</p>
<p>To remove the above commands:</p>
<p> echo ‘!native_flush_tlb_others:snapshot’ &gt; set_ftrace_filter<br> echo ‘!native_flush_tlb_others:snapshot:0’ &gt; set_ftrace_filter</p>
</li>
<li><p>enable_event/disable_event<br>These commands can enable or disable a trace event. Note, because<br>function tracing callbacks are very sensitive, when these commands<br>are registered, the trace point is activated, but disabled in<br>a “soft” mode. That is, the tracepoint will be called, but<br>just will not be traced. The event tracepoint stays in this mode<br>as long as there’s a command that triggers it.</p>
<p> echo ‘try_to_wake_up:enable_event:sched:sched_switch:2’ &gt; \</p>
<pre><code>  set_ftrace_filter
</code></pre>
<p>The format is:</p>
<p>  <function>:enable_event:<system>:<event>[:count]<br>  <function>:disable_event:<system>:<event>[:count]</p>
<p>To remove the events commands:</p>
</li>
</ul>
<p>   echo ‘!try_to_wake_up:enable_event:sched:sched_switch:0’ &gt; <br>        set_ftrace_filter<br>   echo ‘!schedule:disable_event:sched:sched_switch’ &gt; <br>        set_ftrace_filter</p>
<ul>
<li><p>dump<br>When the function is hit, it will dump the contents of the ftrace<br>ring buffer to the console. This is useful if you need to debug<br>something, and want to dump the trace when a certain function<br>is hit. Perhaps its a function that is called before a tripple<br>fault happens and does not allow you to get a regular dump.</p>
</li>
<li><p>cpudump<br>When the function is hit, it will dump the contents of the ftrace<br>ring buffer for the current CPU to the console. Unlike the “dump”<br>command, it only prints out the contents of the ring buffer for the<br>CPU that executed the function that triggered the dump.</p>
</li>
</ul>
<h2 id="trace-pipe"><a href="#trace-pipe" class="headerlink" title="trace_pipe"></a>trace_pipe</h2><p>The trace_pipe outputs the same content as the trace file, but<br>the effect on the tracing is different. Every read from<br>trace_pipe is consumed. This means that subsequent reads will be<br>different. The trace is live.</p>
<h1 id="echo-function-gt-current-tracer-3"><a href="#echo-function-gt-current-tracer-3" class="headerlink" title="echo function &gt; current_tracer"></a>echo function &gt; current_tracer</h1><h1 id="cat-trace-pipe-gt-tmp-trace-out-amp"><a href="#cat-trace-pipe-gt-tmp-trace-out-amp" class="headerlink" title="cat trace_pipe &gt; /tmp/trace.out &amp;"></a>cat trace_pipe &gt; /tmp/trace.out &amp;</h1><p>[1] 4153</p>
<h1 id="echo-1-gt-tracing-on-8"><a href="#echo-1-gt-tracing-on-8" class="headerlink" title="echo 1 &gt; tracing_on"></a>echo 1 &gt; tracing_on</h1><h1 id="usleep-1-2"><a href="#usleep-1-2" class="headerlink" title="usleep 1"></a>usleep 1</h1><h1 id="echo-0-gt-tracing-on-8"><a href="#echo-0-gt-tracing-on-8" class="headerlink" title="echo 0 &gt; tracing_on"></a>echo 0 &gt; tracing_on</h1><h1 id="cat-trace-8"><a href="#cat-trace-8" class="headerlink" title="cat trace"></a>cat trace</h1><h1 id="tracer-function-8"><a href="#tracer-function-8" class="headerlink" title="tracer: function"></a>tracer: function</h1><h1 id="-70"><a href="#-70" class="headerlink" title=""></a></h1><h1 id="entries-in-buffer-entries-written-0-0-P-4"><a href="#entries-in-buffer-entries-written-0-0-P-4" class="headerlink" title="entries-in-buffer/entries-written: 0/0   #P:4"></a>entries-in-buffer/entries-written: 0/0   #P:4</h1><h1 id="-71"><a href="#-71" class="headerlink" title=""></a></h1><h1 id="—–-gt-irqs-off-16"><a href="#—–-gt-irqs-off-16" class="headerlink" title="_—–=&gt; irqs-off"></a>_—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-16"><a href="#—-gt-need-resched-16" class="headerlink" title="/ _—-=&gt; need-resched"></a>/ _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-16"><a href="#—-gt-hardirq-softirq-16" class="headerlink" title="| / _—=&gt; hardirq/softirq"></a>| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-16"><a href="#–-gt-preempt-depth-16" class="headerlink" title="|| / _–=&gt; preempt-depth"></a>|| / _–=&gt; preempt-depth</h1><h1 id="delay-16"><a href="#delay-16" class="headerlink" title="||| /     delay"></a>||| /     delay</h1><h1 id="TASK-PID-CPU-TIMESTAMP-FUNCTION-8"><a href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-8" class="headerlink" title="TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION"></a>TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</h1><h1 id="-72"><a href="#-72" class="headerlink" title="| |       |   ||||       |         |"></a>| |       |   ||||       |         |</h1><h1 id="-73"><a href="#-73" class="headerlink" title=""></a></h1><h1 id="cat-tmp-trace-out"><a href="#cat-tmp-trace-out" class="headerlink" title="cat /tmp/trace.out"></a>cat /tmp/trace.out</h1><pre><code>        bash-1994  [000] ....  5281.568961: mutex_unlock &lt;-rb_simple_write
        bash-1994  [000] ....  5281.568963: __mutex_unlock_slowpath &lt;-mutex_unlock
        bash-1994  [000] ....  5281.568963: __fsnotify_parent &lt;-fsnotify_modify
        bash-1994  [000] ....  5281.568964: fsnotify &lt;-fsnotify_modify
        bash-1994  [000] ....  5281.568964: __srcu_read_lock &lt;-fsnotify
        bash-1994  [000] ....  5281.568964: add_preempt_count &lt;-__srcu_read_lock
        bash-1994  [000] ...1  5281.568965: sub_preempt_count &lt;-__srcu_read_lock
        bash-1994  [000] ....  5281.568965: __srcu_read_unlock &lt;-fsnotify
        bash-1994  [000] ....  5281.568967: sys_dup2 &lt;-system_call_fastpath
</code></pre>
<p>Note, reading the trace_pipe file will block until more input is<br>added.</p>
<h2 id="trace-entries"><a href="#trace-entries" class="headerlink" title="trace entries"></a>trace entries</h2><p>Having too much or not enough data can be troublesome in<br>diagnosing an issue in the kernel. The file buffer_size_kb is<br>used to modify the size of the internal trace buffers. The<br>number listed is the number of entries that can be recorded per<br>CPU. To know the full size, multiply the number of possible CPUs<br>with the number of entries.</p>
<h1 id="cat-buffer-size-kb"><a href="#cat-buffer-size-kb" class="headerlink" title="cat buffer_size_kb"></a>cat buffer_size_kb</h1><p>1408 (units kilobytes)</p>
<p>Or simply read buffer_total_size_kb</p>
<h1 id="cat-buffer-total-size-kb"><a href="#cat-buffer-total-size-kb" class="headerlink" title="cat buffer_total_size_kb"></a>cat buffer_total_size_kb</h1><p>5632</p>
<p>To modify the buffer, simple echo in a number (in 1024 byte segments).</p>
<h1 id="echo-10000-gt-buffer-size-kb"><a href="#echo-10000-gt-buffer-size-kb" class="headerlink" title="echo 10000 &gt; buffer_size_kb"></a>echo 10000 &gt; buffer_size_kb</h1><h1 id="cat-buffer-size-kb-1"><a href="#cat-buffer-size-kb-1" class="headerlink" title="cat buffer_size_kb"></a>cat buffer_size_kb</h1><p>10000 (units kilobytes)</p>
<p>It will try to allocate as much as possible. If you allocate too<br>much, it can cause Out-Of-Memory to trigger.</p>
<h1 id="echo-1000000000000-gt-buffer-size-kb"><a href="#echo-1000000000000-gt-buffer-size-kb" class="headerlink" title="echo 1000000000000 &gt; buffer_size_kb"></a>echo 1000000000000 &gt; buffer_size_kb</h1><p>-bash: echo: write error: Cannot allocate memory</p>
<h1 id="cat-buffer-size-kb-2"><a href="#cat-buffer-size-kb-2" class="headerlink" title="cat buffer_size_kb"></a>cat buffer_size_kb</h1><p>85</p>
<p>The per_cpu buffers can be changed individually as well:</p>
<h1 id="echo-10000-gt-per-cpu-cpu0-buffer-size-kb"><a href="#echo-10000-gt-per-cpu-cpu0-buffer-size-kb" class="headerlink" title="echo 10000 &gt; per_cpu/cpu0/buffer_size_kb"></a>echo 10000 &gt; per_cpu/cpu0/buffer_size_kb</h1><h1 id="echo-100-gt-per-cpu-cpu1-buffer-size-kb"><a href="#echo-100-gt-per-cpu-cpu1-buffer-size-kb" class="headerlink" title="echo 100 &gt; per_cpu/cpu1/buffer_size_kb"></a>echo 100 &gt; per_cpu/cpu1/buffer_size_kb</h1><p>When the per_cpu buffers are not the same, the buffer_size_kb<br>at the top level will just show an X</p>
<h1 id="cat-buffer-size-kb-3"><a href="#cat-buffer-size-kb-3" class="headerlink" title="cat buffer_size_kb"></a>cat buffer_size_kb</h1><p>X</p>
<p>This is where the buffer_total_size_kb is useful:</p>
<h1 id="cat-buffer-total-size-kb-1"><a href="#cat-buffer-total-size-kb-1" class="headerlink" title="cat buffer_total_size_kb"></a>cat buffer_total_size_kb</h1><p>12916</p>
<p>Writing to the top level buffer_size_kb will reset all the buffers<br>to be the same again.</p>
<h2 id="Snapshot"><a href="#Snapshot" class="headerlink" title="Snapshot"></a>Snapshot</h2><p>CONFIG_TRACER_SNAPSHOT makes a generic snapshot feature<br>available to all non latency tracers. (Latency tracers which<br>record max latency, such as “irqsoff” or “wakeup”, can’t use<br>this feature, since those are already using the snapshot<br>mechanism internally.)</p>
<p>Snapshot preserves a current trace buffer at a particular point<br>in time without stopping tracing. Ftrace swaps the current<br>buffer with a spare buffer, and tracing continues in the new<br>current (=previous spare) buffer.</p>
<p>The following debugfs files in “tracing” are related to this<br>feature:</p>
<p>  snapshot:</p>
<pre><code>This is used to take a snapshot and to read the output
of the snapshot. Echo 1 into this file to allocate a
spare buffer and to take a snapshot (swap), then read
the snapshot from this file in the same format as
&quot;trace&quot; (described above in the section &quot;The File
System&quot;). Both reads snapshot and tracing are executable
in parallel. When the spare buffer is allocated, echoing
0 frees it, and echoing else (positive) values clear the
snapshot contents.
More details are shown in the table below.

status\input  |     0      |     1      |    else    |
--------------+------------+------------+------------+
not allocated |(do nothing)| alloc+swap |(do nothing)|
--------------+------------+------------+------------+
allocated     |    free    |    swap    |   clear    |
--------------+------------+------------+------------+
</code></pre>
<p>Here is an example of using the snapshot feature.</p>
<h1 id="echo-1-gt-events-sched-enable"><a href="#echo-1-gt-events-sched-enable" class="headerlink" title="echo 1 &gt; events/sched/enable"></a>echo 1 &gt; events/sched/enable</h1><h1 id="echo-1-gt-snapshot"><a href="#echo-1-gt-snapshot" class="headerlink" title="echo 1 &gt; snapshot"></a>echo 1 &gt; snapshot</h1><h1 id="cat-snapshot"><a href="#cat-snapshot" class="headerlink" title="cat snapshot"></a>cat snapshot</h1><h1 id="tracer-nop"><a href="#tracer-nop" class="headerlink" title="tracer: nop"></a>tracer: nop</h1><h1 id="-74"><a href="#-74" class="headerlink" title=""></a></h1><h1 id="entries-in-buffer-entries-written-71-71-P-8"><a href="#entries-in-buffer-entries-written-71-71-P-8" class="headerlink" title="entries-in-buffer/entries-written: 71/71   #P:8"></a>entries-in-buffer/entries-written: 71/71   #P:8</h1><h1 id="-75"><a href="#-75" class="headerlink" title=""></a></h1><h1 id="—–-gt-irqs-off-17"><a href="#—–-gt-irqs-off-17" class="headerlink" title="_—–=&gt; irqs-off"></a>_—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-17"><a href="#—-gt-need-resched-17" class="headerlink" title="/ _—-=&gt; need-resched"></a>/ _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-17"><a href="#—-gt-hardirq-softirq-17" class="headerlink" title="| / _—=&gt; hardirq/softirq"></a>| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-17"><a href="#–-gt-preempt-depth-17" class="headerlink" title="|| / _–=&gt; preempt-depth"></a>|| / _–=&gt; preempt-depth</h1><h1 id="delay-17"><a href="#delay-17" class="headerlink" title="||| /     delay"></a>||| /     delay</h1><h1 id="TASK-PID-CPU-TIMESTAMP-FUNCTION-9"><a href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-9" class="headerlink" title="TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION"></a>TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</h1><h1 id="-76"><a href="#-76" class="headerlink" title="| |       |   ||||       |         |"></a>| |       |   ||||       |         |</h1><pre><code>      &lt;idle&gt;-0     [005] d...  2440.603828: sched_switch: prev_comm=swapper/5 prev_pid=0 prev_prio=120 prev_state=R ==&gt; next_comm=snapshot-test-2 next_pid=2242 next_prio=120
       sleep-2242  [005] d...  2440.603846: sched_switch: prev_comm=snapshot-test-2 prev_pid=2242 prev_prio=120 prev_state=R ==&gt; next_comm=kworker/5:1 next_pid=60 next_prio=120
</code></pre>
<p>[…]<br>          <idle>-0     [002] d…  2440.707230: sched_switch: prev_comm=swapper/2 prev_pid=0 prev_prio=120 prev_state=R ==&gt; next_comm=snapshot-test-2 next_pid=2229 next_prio=120</p>
<h1 id="cat-trace-9"><a href="#cat-trace-9" class="headerlink" title="cat trace"></a>cat trace</h1><h1 id="tracer-nop-1"><a href="#tracer-nop-1" class="headerlink" title="tracer: nop"></a>tracer: nop</h1><h1 id="-77"><a href="#-77" class="headerlink" title=""></a></h1><h1 id="entries-in-buffer-entries-written-77-77-P-8"><a href="#entries-in-buffer-entries-written-77-77-P-8" class="headerlink" title="entries-in-buffer/entries-written: 77/77   #P:8"></a>entries-in-buffer/entries-written: 77/77   #P:8</h1><h1 id="-78"><a href="#-78" class="headerlink" title=""></a></h1><h1 id="—–-gt-irqs-off-18"><a href="#—–-gt-irqs-off-18" class="headerlink" title="_—–=&gt; irqs-off"></a>_—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-18"><a href="#—-gt-need-resched-18" class="headerlink" title="/ _—-=&gt; need-resched"></a>/ _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-18"><a href="#—-gt-hardirq-softirq-18" class="headerlink" title="| / _—=&gt; hardirq/softirq"></a>| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-18"><a href="#–-gt-preempt-depth-18" class="headerlink" title="|| / _–=&gt; preempt-depth"></a>|| / _–=&gt; preempt-depth</h1><h1 id="delay-18"><a href="#delay-18" class="headerlink" title="||| /     delay"></a>||| /     delay</h1><h1 id="TASK-PID-CPU-TIMESTAMP-FUNCTION-10"><a href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-10" class="headerlink" title="TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION"></a>TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</h1><h1 id="-79"><a href="#-79" class="headerlink" title="| |       |   ||||       |         |"></a>| |       |   ||||       |         |</h1><pre><code>      &lt;idle&gt;-0     [007] d...  2440.707395: sched_switch: prev_comm=swapper/7 prev_pid=0 prev_prio=120 prev_state=R ==&gt; next_comm=snapshot-test-2 next_pid=2243 next_prio=120
</code></pre>
<p> snapshot-test-2-2229  [002] d…  2440.707438: sched_switch: prev_comm=snapshot-test-2 prev_pid=2229 prev_prio=120 prev_state=S ==&gt; next_comm=swapper/2 next_pid=0 next_prio=120<br>[…]</p>
<p>If you try to use this snapshot feature when current tracer is<br>one of the latency tracers, you will get the following results.</p>
<h1 id="echo-wakeup-gt-current-tracer-1"><a href="#echo-wakeup-gt-current-tracer-1" class="headerlink" title="echo wakeup &gt; current_tracer"></a>echo wakeup &gt; current_tracer</h1><h1 id="echo-1-gt-snapshot-1"><a href="#echo-1-gt-snapshot-1" class="headerlink" title="echo 1 &gt; snapshot"></a>echo 1 &gt; snapshot</h1><p>bash: echo: write error: Device or resource busy</p>
<h1 id="cat-snapshot-1"><a href="#cat-snapshot-1" class="headerlink" title="cat snapshot"></a>cat snapshot</h1><p>cat: snapshot: Device or resource busy</p>
<h2 id="Instances"><a href="#Instances" class="headerlink" title="Instances"></a>Instances</h2><p>In the debugfs tracing directory is a directory called “instances”.<br>This directory can have new directories created inside of it using<br>mkdir, and removing directories with rmdir. The directory created<br>with mkdir in this directory will already contain files and other<br>directories after it is created.</p>
<h1 id="mkdir-instances-foo"><a href="#mkdir-instances-foo" class="headerlink" title="mkdir instances/foo"></a>mkdir instances/foo</h1><h1 id="ls-instances-foo"><a href="#ls-instances-foo" class="headerlink" title="ls instances/foo"></a>ls instances/foo</h1><p>buffer_size_kb  buffer_total_size_kb  events  free_buffer  per_cpu<br>set_event  snapshot  trace  trace_clock  trace_marker  trace_options<br>trace_pipe  tracing_on</p>
<p>As you can see, the new directory looks similar to the tracing directory<br>itself. In fact, it is very similar, except that the buffer and<br>events are agnostic from the main director, or from any other<br>instances that are created.</p>
<p>The files in the new directory work just like the files with the<br>same name in the tracing directory except the buffer that is used<br>is a separate and new buffer. The files affect that buffer but do not<br>affect the main buffer with the exception of trace_options. Currently,<br>the trace_options affect all instances and the top level buffer<br>the same, but this may change in future releases. That is, options<br>may become specific to the instance they reside in.</p>
<p>Notice that none of the function tracer files are there, nor is<br>current_tracer and available_tracers. This is because the buffers<br>can currently only have events enabled for them.</p>
<h1 id="mkdir-instances-foo-1"><a href="#mkdir-instances-foo-1" class="headerlink" title="mkdir instances/foo"></a>mkdir instances/foo</h1><h1 id="mkdir-instances-bar"><a href="#mkdir-instances-bar" class="headerlink" title="mkdir instances/bar"></a>mkdir instances/bar</h1><h1 id="mkdir-instances-zoot"><a href="#mkdir-instances-zoot" class="headerlink" title="mkdir instances/zoot"></a>mkdir instances/zoot</h1><h1 id="echo-100000-gt-buffer-size-kb"><a href="#echo-100000-gt-buffer-size-kb" class="headerlink" title="echo 100000 &gt; buffer_size_kb"></a>echo 100000 &gt; buffer_size_kb</h1><h1 id="echo-1000-gt-instances-foo-buffer-size-kb"><a href="#echo-1000-gt-instances-foo-buffer-size-kb" class="headerlink" title="echo 1000 &gt; instances/foo/buffer_size_kb"></a>echo 1000 &gt; instances/foo/buffer_size_kb</h1><h1 id="echo-5000-gt-instances-bar-per-cpu-cpu1-buffer-size-kb"><a href="#echo-5000-gt-instances-bar-per-cpu-cpu1-buffer-size-kb" class="headerlink" title="echo 5000 &gt; instances/bar/per_cpu/cpu1/buffer_size_kb"></a>echo 5000 &gt; instances/bar/per_cpu/cpu1/buffer_size_kb</h1><h1 id="echo-function-gt-current-trace"><a href="#echo-function-gt-current-trace" class="headerlink" title="echo function &gt; current_trace"></a>echo function &gt; current_trace</h1><h1 id="echo-1-gt-instances-foo-events-sched-sched-wakeup-enable"><a href="#echo-1-gt-instances-foo-events-sched-sched-wakeup-enable" class="headerlink" title="echo 1 &gt; instances/foo/events/sched/sched_wakeup/enable"></a>echo 1 &gt; instances/foo/events/sched/sched_wakeup/enable</h1><h1 id="echo-1-gt-instances-foo-events-sched-sched-wakeup-new-enable"><a href="#echo-1-gt-instances-foo-events-sched-sched-wakeup-new-enable" class="headerlink" title="echo 1 &gt; instances/foo/events/sched/sched_wakeup_new/enable"></a>echo 1 &gt; instances/foo/events/sched/sched_wakeup_new/enable</h1><h1 id="echo-1-gt-instances-foo-events-sched-sched-switch-enable"><a href="#echo-1-gt-instances-foo-events-sched-sched-switch-enable" class="headerlink" title="echo 1 &gt; instances/foo/events/sched/sched_switch/enable"></a>echo 1 &gt; instances/foo/events/sched/sched_switch/enable</h1><h1 id="echo-1-gt-instances-bar-events-irq-enable"><a href="#echo-1-gt-instances-bar-events-irq-enable" class="headerlink" title="echo 1 &gt; instances/bar/events/irq/enable"></a>echo 1 &gt; instances/bar/events/irq/enable</h1><h1 id="echo-1-gt-instances-zoot-events-syscalls-enable"><a href="#echo-1-gt-instances-zoot-events-syscalls-enable" class="headerlink" title="echo 1 &gt; instances/zoot/events/syscalls/enable"></a>echo 1 &gt; instances/zoot/events/syscalls/enable</h1><h1 id="cat-trace-pipe"><a href="#cat-trace-pipe" class="headerlink" title="cat trace_pipe"></a>cat trace_pipe</h1><p>CPU:2 [LOST 11745 EVENTS]<br>            bash-2044  [002] …. 10594.481032: _raw_spin_lock_irqsave &lt;-get_page_from_freelist<br>            bash-2044  [002] d… 10594.481032: add_preempt_count &lt;-_raw_spin_lock_irqsave<br>            bash-2044  [002] d..1 10594.481032: __rmqueue &lt;-get_page_from_freelist<br>            bash-2044  [002] d..1 10594.481033: _raw_spin_unlock &lt;-get_page_from_freelist<br>            bash-2044  [002] d..1 10594.481033: sub_preempt_count &lt;-_raw_spin_unlock<br>            bash-2044  [002] d… 10594.481033: get_pageblock_flags_group &lt;-get_pageblock_migratetype<br>            bash-2044  [002] d… 10594.481034: __mod_zone_page_state &lt;-get_page_from_freelist<br>            bash-2044  [002] d… 10594.481034: zone_statistics &lt;-get_page_from_freelist<br>            bash-2044  [002] d… 10594.481034: __inc_zone_state &lt;-zone_statistics<br>            bash-2044  [002] d… 10594.481034: __inc_zone_state &lt;-zone_statistics<br>            bash-2044  [002] …. 10594.481035: arch_dup_task_struct &lt;-copy_process<br>[…]</p>
<h1 id="cat-instances-foo-trace-pipe"><a href="#cat-instances-foo-trace-pipe" class="headerlink" title="cat instances/foo/trace_pipe"></a>cat instances/foo/trace_pipe</h1><pre><code>        bash-1998  [000] d..4   136.676759: sched_wakeup: comm=kworker/0:1 pid=59 prio=120 success=1 target_cpu=000
        bash-1998  [000] dN.4   136.676760: sched_wakeup: comm=bash pid=1998 prio=120 success=1 target_cpu=000
      &lt;idle&gt;-0     [003] d.h3   136.676906: sched_wakeup: comm=rcu_preempt pid=9 prio=120 success=1 target_cpu=003
      &lt;idle&gt;-0     [003] d..3   136.676909: sched_switch: prev_comm=swapper/3 prev_pid=0 prev_prio=120 prev_state=R ==&gt; next_comm=rcu_preempt next_pid=9 next_prio=120
 rcu_preempt-9     [003] d..3   136.676916: sched_switch: prev_comm=rcu_preempt prev_pid=9 prev_prio=120 prev_state=S ==&gt; next_comm=swapper/3 next_pid=0 next_prio=120
        bash-1998  [000] d..4   136.677014: sched_wakeup: comm=kworker/0:1 pid=59 prio=120 success=1 target_cpu=000
        bash-1998  [000] dN.4   136.677016: sched_wakeup: comm=bash pid=1998 prio=120 success=1 target_cpu=000
        bash-1998  [000] d..3   136.677018: sched_switch: prev_comm=bash prev_pid=1998 prev_prio=120 prev_state=R+ ==&gt; next_comm=kworker/0:1 next_pid=59 next_prio=120
 kworker/0:1-59    [000] d..4   136.677022: sched_wakeup: comm=sshd pid=1995 prio=120 success=1 target_cpu=001
 kworker/0:1-59    [000] d..3   136.677025: sched_switch: prev_comm=kworker/0:1 prev_pid=59 prev_prio=120 prev_state=S ==&gt; next_comm=bash next_pid=1998 next_prio=120
</code></pre>
<p>[…]</p>
<h1 id="cat-instances-bar-trace-pipe"><a href="#cat-instances-bar-trace-pipe" class="headerlink" title="cat instances/bar/trace_pipe"></a>cat instances/bar/trace_pipe</h1><pre><code> migration/1-14    [001] d.h3   138.732674: softirq_raise: vec=3 [action=NET_RX]
      &lt;idle&gt;-0     [001] dNh3   138.732725: softirq_raise: vec=3 [action=NET_RX]
        bash-1998  [000] d.h1   138.733101: softirq_raise: vec=1 [action=TIMER]
        bash-1998  [000] d.h1   138.733102: softirq_raise: vec=9 [action=RCU]
        bash-1998  [000] ..s2   138.733105: softirq_entry: vec=1 [action=TIMER]
        bash-1998  [000] ..s2   138.733106: softirq_exit: vec=1 [action=TIMER]
        bash-1998  [000] ..s2   138.733106: softirq_entry: vec=9 [action=RCU]
        bash-1998  [000] ..s2   138.733109: softirq_exit: vec=9 [action=RCU]
        sshd-1995  [001] d.h1   138.733278: irq_handler_entry: irq=21 name=uhci_hcd:usb4
        sshd-1995  [001] d.h1   138.733280: irq_handler_exit: irq=21 ret=unhandled
        sshd-1995  [001] d.h1   138.733281: irq_handler_entry: irq=21 name=eth0
        sshd-1995  [001] d.h1   138.733283: irq_handler_exit: irq=21 ret=handled
</code></pre>
<p>[…]</p>
<h1 id="cat-instances-zoot-trace"><a href="#cat-instances-zoot-trace" class="headerlink" title="cat instances/zoot/trace"></a>cat instances/zoot/trace</h1><h1 id="tracer-nop-2"><a href="#tracer-nop-2" class="headerlink" title="tracer: nop"></a>tracer: nop</h1><h1 id="-80"><a href="#-80" class="headerlink" title=""></a></h1><h1 id="entries-in-buffer-entries-written-18996-18996-P-4"><a href="#entries-in-buffer-entries-written-18996-18996-P-4" class="headerlink" title="entries-in-buffer/entries-written: 18996/18996   #P:4"></a>entries-in-buffer/entries-written: 18996/18996   #P:4</h1><h1 id="-81"><a href="#-81" class="headerlink" title=""></a></h1><h1 id="—–-gt-irqs-off-19"><a href="#—–-gt-irqs-off-19" class="headerlink" title="_—–=&gt; irqs-off"></a>_—–=&gt; irqs-off</h1><h1 id="—-gt-need-resched-19"><a href="#—-gt-need-resched-19" class="headerlink" title="/ _—-=&gt; need-resched"></a>/ _—-=&gt; need-resched</h1><h1 id="—-gt-hardirq-softirq-19"><a href="#—-gt-hardirq-softirq-19" class="headerlink" title="| / _—=&gt; hardirq/softirq"></a>| / _—=&gt; hardirq/softirq</h1><h1 id="–-gt-preempt-depth-19"><a href="#–-gt-preempt-depth-19" class="headerlink" title="|| / _–=&gt; preempt-depth"></a>|| / _–=&gt; preempt-depth</h1><h1 id="delay-19"><a href="#delay-19" class="headerlink" title="||| /     delay"></a>||| /     delay</h1><h1 id="TASK-PID-CPU-TIMESTAMP-FUNCTION-11"><a href="#TASK-PID-CPU-TIMESTAMP-FUNCTION-11" class="headerlink" title="TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION"></a>TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION</h1><h1 id="-82"><a href="#-82" class="headerlink" title="| |       |   ||||       |         |"></a>| |       |   ||||       |         |</h1><pre><code>        bash-1998  [000] d...   140.733501: sys_write -&gt; 0x2
        bash-1998  [000] d...   140.733504: sys_dup2(oldfd: a, newfd: 1)
        bash-1998  [000] d...   140.733506: sys_dup2 -&gt; 0x1
        bash-1998  [000] d...   140.733508: sys_fcntl(fd: a, cmd: 1, arg: 0)
        bash-1998  [000] d...   140.733509: sys_fcntl -&gt; 0x1
        bash-1998  [000] d...   140.733510: sys_close(fd: a)
        bash-1998  [000] d...   140.733510: sys_close -&gt; 0x0
        bash-1998  [000] d...   140.733514: sys_rt_sigprocmask(how: 0, nset: 0, oset: 6e2768, sigsetsize: 8)
        bash-1998  [000] d...   140.733515: sys_rt_sigprocmask -&gt; 0x0
        bash-1998  [000] d...   140.733516: sys_rt_sigaction(sig: 2, act: 7fff718846f0, oact: 7fff71884650, sigsetsize: 8)
        bash-1998  [000] d...   140.733516: sys_rt_sigaction -&gt; 0x0
</code></pre>
<p>You can see that the trace of the top most trace buffer shows only<br>the function tracing. The foo instance displays wakeups and task<br>switches.</p>
<p>To remove the instances, simply delete their directories:</p>
<h1 id="rmdir-instances-foo"><a href="#rmdir-instances-foo" class="headerlink" title="rmdir instances/foo"></a>rmdir instances/foo</h1><h1 id="rmdir-instances-bar"><a href="#rmdir-instances-bar" class="headerlink" title="rmdir instances/bar"></a>rmdir instances/bar</h1><h1 id="rmdir-instances-zoot"><a href="#rmdir-instances-zoot" class="headerlink" title="rmdir instances/zoot"></a>rmdir instances/zoot</h1><p>Note, if a process has a trace file open in one of the instance<br>directories, the rmdir will fail with EBUSY.</p>
<h2 id="Stack-trace"><a href="#Stack-trace" class="headerlink" title="Stack trace"></a>Stack trace</h2><p>Since the kernel has a fixed sized stack, it is important not to<br>waste it in functions. A kernel developer must be conscience of<br>what they allocate on the stack. If they add too much, the system<br>can be in danger of a stack overflow, and corruption will occur,<br>usually leading to a system panic.</p>
<p>There are some tools that check this, usually with interrupts<br>periodically checking usage. But if you can perform a check<br>at every function call that will become very useful. As ftrace provides<br>a function tracer, it makes it convenient to check the stack size<br>at every function call. This is enabled via the stack tracer.</p>
<p>CONFIG_STACK_TRACER enables the ftrace stack tracing functionality.<br>To enable it, write a ‘1’ into /proc/sys/kernel/stack_tracer_enabled.</p>
<h1 id="echo-1-gt-proc-sys-kernel-stack-tracer-enabled"><a href="#echo-1-gt-proc-sys-kernel-stack-tracer-enabled" class="headerlink" title="echo 1 &gt; /proc/sys/kernel/stack_tracer_enabled"></a>echo 1 &gt; /proc/sys/kernel/stack_tracer_enabled</h1><p>You can also enable it from the kernel command line to trace<br>the stack size of the kernel during boot up, by adding “stacktrace”<br>to the kernel command line parameter.</p>
<p>After running it for a few minutes, the output looks like:</p>
<h1 id="cat-stack-max-size"><a href="#cat-stack-max-size" class="headerlink" title="cat stack_max_size"></a>cat stack_max_size</h1><p>2928</p>
<h1 id="cat-stack-trace"><a href="#cat-stack-trace" class="headerlink" title="cat stack_trace"></a>cat stack_trace</h1><pre><code>    Depth    Size   Location    (18 entries)
    -----    ----   --------
</code></pre>
<ol start="0">
<li><pre><code>2928     224   update_sd_lb_stats+0xbc/0x4ac
</code></pre>
</li>
<li><pre><code>2704     160   find_busiest_group+0x31/0x1f1
</code></pre>
</li>
<li><pre><code>2544     256   load_balance+0xd9/0x662
</code></pre>
</li>
<li><pre><code>2288      80   idle_balance+0xbb/0x130
</code></pre>
</li>
<li><pre><code>2208     128   __schedule+0x26e/0x5b9
</code></pre>
</li>
<li><pre><code>2080      16   schedule+0x64/0x66
</code></pre>
</li>
<li><pre><code>2064     128   schedule_timeout+0x34/0xe0
</code></pre>
</li>
<li><pre><code>1936     112   wait_for_common+0x97/0xf1
</code></pre>
</li>
<li><pre><code>1824      16   wait_for_completion+0x1d/0x1f
</code></pre>
</li>
<li><pre><code>1808     128   flush_work+0xfe/0x119
</code></pre>
</li>
<li><pre><code>1680      16   tty_flush_to_ldisc+0x1e/0x20
</code></pre>
</li>
<li><pre><code>1664      48   input_available_p+0x1d/0x5c
</code></pre>
</li>
<li><pre><code>1616      48   n_tty_poll+0x6d/0x134
</code></pre>
</li>
<li><pre><code>1568      64   tty_poll+0x64/0x7f
</code></pre>
</li>
<li><pre><code>1504     880   do_select+0x31e/0x511
</code></pre>
</li>
<li><pre><code> 624     400   core_sys_select+0x177/0x216
</code></pre>
</li>
<li><pre><code> 224      96   sys_select+0x91/0xb9
</code></pre>
</li>
<li><pre><code> 128     128   system_call_fastpath+0x16/0x1b
</code></pre>
</li>
</ol>
<p>Note, if -mfentry is being used by gcc, functions get traced before<br>they set up the stack frame. This means that leaf level functions<br>are not tested by the stack tracer when -mfentry is used.</p>
<p>Currently, -mfentry is used by gcc 4.6.0 and above on x86 only.</p>
<hr>
<p>More details can be found in the source code, in the<br>kernel/trace/*.c files.</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_ftrace/" title="Kernel-3.10.0-957.el7_ftrace" target="_blank" rel="external">http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_ftrace/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/03/13/Kernel-3.10.0-957.el7_bonding/" title="Kernel-3.10.0-957.el7_bonding"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/03/13/Kernel-3.10.0-957.el7_UserModeLinux-HOWTO/" title="Kernel-3.10.0-957.el7_UserModeLinux-HOWTO"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>