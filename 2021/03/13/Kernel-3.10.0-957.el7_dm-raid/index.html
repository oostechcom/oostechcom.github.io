<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Kernel-3.10.0-957.el7_dm-rai | oosTech.com</title>
  <meta name="description" content="dm-raidThe device-mapper RAID (dm-raid) target provides a bridge from DM to MD.It allows the MD RAID drivers to be accessed using a device-mapperinterface. Mapping Table InterfaceThe target is named “">
<meta property="og:type" content="article">
<meta property="og:title" content="Kernel-3.10.0-957.el7_dm-rai">
<meta property="og:url" content="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_dm-raid/index.html">
<meta property="og:site_name" content="oosTech">
<meta property="og:description" content="dm-raidThe device-mapper RAID (dm-raid) target provides a bridge from DM to MD.It allows the MD RAID drivers to be accessed using a device-mapperinterface. Mapping Table InterfaceThe target is named “">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-12T16:00:00.000Z">
<meta property="article:author" content="Sam Lee">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_dm-raid/index.html">
  
    <link rel="alternate" href="/atom.xml" title="oosTech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img src="/images/avatar.png" width="400" height="400">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">oosTech by Sam Lee</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="站内搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">站点首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档文档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">文档分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">常用链接</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">共享白板</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告牌</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p> 欢迎来到oosTech ，我是一个Linux 拥趸：D。 目前正在用的Linux 版本是 Red Hat Enterprise Linux release 8.3 </p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">文档分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a><span class="category-list-count">830</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a><span class="category-list-count">1658</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-4-18-0-80-el8-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_4.18.0-80.el8_内核文档</a><span class="category-list-count">3937</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3270/" class="title">Kernel-3.10.0-957.el7_3270</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-2-6-32-573-12-1-el6-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_2.6.32-573.12.1.el6_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-2.6.32-573.12.1.el6_devices/" class="title">Kernel-2.6.32-573.12.1.el6_devices</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_3c509/" class="title">Kernel-3.10.0-957.el7_3c509</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_4CCs/" class="title">Kernel-3.10.0-957.el7_4CCs</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
              </p>
              <p class="item-title">
                <a href="/2021/03/13/Kernel-3.10.0-957.el7_53c700/" class="title">Kernel-3.10.0-957.el7_53c700</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#dm-raid"><span class="toc-number">1.</span> <span class="toc-text">dm-raid</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Mapping-Table-Interface"><span class="toc-number">1.1.</span> <span class="toc-text">Mapping Table Interface</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-Tables"><span class="toc-number">1.2.</span> <span class="toc-text">Example Tables</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAID4-4-data-drives-1-parity-no-metadata-devices"><span class="toc-number">2.</span> <span class="toc-text">RAID4 - 4 data drives, 1 parity (no metadata devices)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#No-metadata-devices-specified-to-hold-superblock-bitmap-info"><span class="toc-number">3.</span> <span class="toc-text">No metadata devices specified to hold superblock&#x2F;bitmap info</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chunk-size-of-1MiB"><span class="toc-number">4.</span> <span class="toc-text">Chunk size of 1MiB</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Lines-separated-for-easy-reading"><span class="toc-number">5.</span> <span class="toc-text">(Lines separated for easy reading)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAID4-4-data-drives-1-parity-with-metadata-devices"><span class="toc-number">6.</span> <span class="toc-text">RAID4 - 4 data drives, 1 parity (with metadata devices)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chunk-size-of-1MiB-force-RAID-initialization"><span class="toc-number">7.</span> <span class="toc-text">Chunk size of 1MiB, force RAID initialization,</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#min-recovery-rate-at-20-kiB-sec-disk"><span class="toc-number">8.</span> <span class="toc-text">min recovery rate at 20 kiB&#x2F;sec&#x2F;disk</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Status-Output"><span class="toc-number">8.1.</span> <span class="toc-text">Status Output</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Message-Interface"><span class="toc-number">8.2.</span> <span class="toc-text">Message Interface</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Discard-Support"><span class="toc-number">8.3.</span> <span class="toc-text">Discard Support</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Version-History"><span class="toc-number">8.4.</span> <span class="toc-text">Version History</span></a></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Kernel-3.10.0-957.el7_dm-raid" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Kernel-3.10.0-957.el7_dm-rai
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/03/13/Kernel-3.10.0-957.el7_dm-raid/" class="article-date">
	 published: <time datetime="2021-03-12T16:00:00.000Z" itemprop="datePublished">2021-03-13</time>
	</a>
</span>

        
	<a href="/2021/03/13/Kernel-3.10.0-957.el7_dm-raid/" class="article-date">
	   updated: <time datetime="2021-03-12T16:00:00.000Z" itemprop="dateUpdated">2021-03-13</time>
	</a>


        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Kernel-3-10-0-957-el7-%E5%86%85%E6%A0%B8%E6%96%87%E6%A1%A3/">Kernel_3.10.0-957.el7_内核文档</a>
  </span>

        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill"></i>
	    <!--<span id="busuanzi_container_page_pv" style="display:inline;">-->
			<span id="busuanzi_value_page_pv" style="display:inline;"></span>
		<!--</span>-->
	</span>



        <!--<span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/03/13/Kernel-3.10.0-957.el7_dm-raid/#comments" class="article-comment-link">评论</a></span> -->
        
	
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="dm-raid"><a href="#dm-raid" class="headerlink" title="dm-raid"></a>dm-raid</h1><p>The device-mapper RAID (dm-raid) target provides a bridge from DM to MD.<br>It allows the MD RAID drivers to be accessed using a device-mapper<br>interface.</p>
<h2 id="Mapping-Table-Interface"><a href="#Mapping-Table-Interface" class="headerlink" title="Mapping Table Interface"></a>Mapping Table Interface</h2><p>The target is named “raid” and it accepts the following parameters:</p>
<p>  <raid_type> &lt;#raid_params&gt; <raid_params> <br>    &lt;#raid_devs&gt; <metadata_dev0> <dev0> [.. <metadata_devN> <devN>]</p>
<p><raid_type>:<br>  raid0        RAID0 striping (no resilience)<br>  raid1        RAID1 mirroring<br>  raid4        RAID4 with dedicated last parity disk<br>  raid5_n     RAID5 with dedicated last parity disk supporting takeover<br>        Same as raid4<br>        -Transitory layout<br>  raid5_la    RAID5 left asymmetric<br>        - rotating parity 0 with data continuation<br>  raid5_ra    RAID5 right asymmetric<br>        - rotating parity N with data continuation<br>  raid5_ls    RAID5 left symmetric<br>        - rotating parity 0 with data restart<br>  raid5_rs     RAID5 right symmetric<br>        - rotating parity N with data restart<br>  raid6_zr    RAID6 zero restart<br>        - rotating parity zero (left-to-right) with data restart<br>  raid6_nr    RAID6 N restart<br>        - rotating parity N (right-to-left) with data restart<br>  raid6_nc    RAID6 N continue<br>        - rotating parity N (right-to-left) with data continuation<br>  raid6_n_6    RAID6 with dedicate parity disks<br>        - parity and Q-syndrome on the last 2 disks;<br>          layout for takeover from/to raid4/raid5_n<br>  raid6_la_6    Same as “raid_la” plus dedicated last Q-syndrome disk<br>        - layout for takeover from raid5_la from/to raid6<br>  raid6_ra_6    Same as “raid5_ra” dedicated last Q-syndrome disk<br>        - layout for takeover from raid5_ra from/to raid6<br>  raid6_ls_6    Same as “raid5_ls” dedicated last Q-syndrome disk<br>        - layout for takeover from raid5_ls from/to raid6<br>  raid6_rs_6    Same as “raid5_rs” dedicated last Q-syndrome disk<br>        - layout for takeover from raid5_rs from/to raid6<br>  raid10        Various RAID10 inspired algorithms chosen by additional params<br>        (see raid10_format and raid10_copies below)<br>        - RAID10: Striped Mirrors (aka ‘Striping on top of mirrors’)<br>        - RAID1E: Integrated Adjacent Stripe Mirroring<br>        - RAID1E: Integrated Offset Stripe Mirroring<br>        -  and other similar RAID10 variants</p>
<p>  Reference: Chapter 4 of<br>  <a target="_blank" rel="noopener" href="http://www.snia.org/sites/default/files/SNIA_DDF_Technical_Position_v2.0.pdf">http://www.snia.org/sites/default/files/SNIA_DDF_Technical_Position_v2.0.pdf</a></p>
<p>&lt;#raid_params&gt;: The number of parameters that follow.</p>
<p><raid_params> consists of<br>    Mandatory parameters:<br>        <chunk_size>: Chunk size in sectors.  This parameter is often known as<br>              “stripe size”.  It is the only mandatory parameter and<br>              is placed first.</p>
<pre><code>followed by optional parameters (in any order):
[sync|nosync]   Force or prevent RAID initialization.

[rebuild &lt;idx&gt;]    Rebuild drive number &#39;idx&#39; (first drive is 0).

[daemon_sleep &lt;ms&gt;]
    Interval between runs of the bitmap daemon that
    clear bits.  A longer interval means less bitmap I/O but
    resyncing after a failure is likely to take longer.

[min_recovery_rate &lt;kB/sec/disk&gt;]  Throttle RAID initialization
[max_recovery_rate &lt;kB/sec/disk&gt;]  Throttle RAID initialization
[write_mostly &lt;idx&gt;]           Mark drive index &#39;idx&#39; write-mostly.
[max_write_behind &lt;sectors&gt;]       See &#39;--write-behind=&#39; (man mdadm)
[stripe_cache &lt;sectors&gt;]           Stripe cache size (RAID 4/5/6 only)
[region_size &lt;sectors&gt;]
    The region_size multiplied by the number of regions is the
    logical size of the array.  The bitmap records the device
    synchronisation state for each region.

    [raid10_copies   &lt;# copies&gt;]
    [raid10_format   &lt;near|far|offset&gt;]
    These two options are used to alter the default layout of
    a RAID10 configuration.  The number of copies is can be
    specified, but the default is 2.  There are also three
    variations to how the copies are laid down - the default
    is &quot;near&quot;.  Near copies are what most people think of with
    respect to mirroring.  If these options are left unspecified,
    or &#39;raid10_copies 2&#39; and/or &#39;raid10_format near&#39; are given,
    then the layouts for 2, 3 and 4 devices    are:
    2 drives         3 drives          4 drives
    --------         ----------        --------------
    A1  A1           A1  A1  A2        A1  A1  A2  A2
    A2  A2           A2  A3  A3        A3  A3  A4  A4
    A3  A3           A4  A4  A5        A5  A5  A6  A6
    A4  A4           A5  A6  A6        A7  A7  A8  A8
    ..  ..           ..  ..  ..        ..  ..  ..  ..
    The 2-device layout is equivalent 2-way RAID1.  The 4-device
    layout is what a traditional RAID10 would look like.  The
    3-device layout is what might be called a &#39;RAID1E - Integrated
    Adjacent Stripe Mirroring&#39;.

    If &#39;raid10_copies 2&#39; and &#39;raid10_format far&#39;, then the layouts
    for 2, 3 and 4 devices are:
    2 drives             3 drives             4 drives
    --------             --------------       --------------------
    A1  A2               A1   A2   A3         A1   A2   A3   A4
    A3  A4               A4   A5   A6         A5   A6   A7   A8
    A5  A6               A7   A8   A9         A9   A10  A11  A12
    ..  ..               ..   ..   ..         ..   ..   ..   ..
    A2  A1               A3   A1   A2         A2   A1   A4   A3
    A4  A3               A6   A4   A5         A6   A5   A8   A7
    A6  A5               A9   A7   A8         A10  A9   A12  A11
    ..  ..               ..   ..   ..         ..   ..   ..   ..

    If &#39;raid10_copies 2&#39; and &#39;raid10_format offset&#39;, then the
    layouts for 2, 3 and 4 devices are:
    2 drives       3 drives           4 drives
    --------       ------------       -----------------
    A1  A2         A1  A2  A3         A1  A2  A3  A4
    A2  A1         A3  A1  A2         A2  A1  A4  A3
    A3  A4         A4  A5  A6         A5  A6  A7  A8
    A4  A3         A6  A4  A5         A6  A5  A8  A7
    A5  A6         A7  A8  A9         A9  A10 A11 A12
    A6  A5         A9  A7  A8         A10 A9  A12 A11
    ..  ..         ..  ..  ..         ..  ..  ..  ..
    Here we see layouts closely akin to &#39;RAID1E - Integrated
    Offset Stripe Mirroring&#39;.

    [delta_disks &lt;N&gt;]
    The delta_disks option value (-251 &lt; N &lt; +251) triggers
    device removal (negative value) or device addition (positive
    value) to any reshape supporting raid levels 4/5/6 and 10.
    RAID levels 4/5/6 allow for addition of devices (metadata
    and data device tuple), raid10_near and raid10_offset only
    allow for device addition. raid10_far does not support any
    reshaping at all.
    A minimum of devices have to be kept to enforce resilience,
    which is 3 devices for raid4/5 and 4 devices for raid6.

    [data_offset &lt;sectors&gt;]
    This option value defines the offset into each data device
    where the data starts. This is used to provide out-of-place
    reshaping space to avoid writing over data whilst
    changing the layout of stripes, hence an interruption/crash
    may happen at any time without the risk of losing data.
    E.g. when adding devices to an existing raid set during
    forward reshaping, the out-of-place space will be allocated
    at the beginning of each raid device. The kernel raid4/5/6/10
    MD personalities supporting such device addition will read the data from
    the existing first stripes (those with smaller number of stripes)
    starting at data_offset to fill up a new stripe with the larger
    number of stripes, calculate the redundancy blocks (CRC/Q-syndrome)
    and write that new stripe to offset 0. Same will be applied to all
    N-1 other new stripes. This out-of-place scheme is used to change
    the RAID type (i.e. the allocation algorithm) as well, e.g.
    changing from raid5_ls to raid5_n.

[journal_dev &lt;dev&gt;]
    This option adds a journal device to raid4/5/6 raid sets and
    uses it to close the &#39;write hole&#39; caused by the non-atomic updates
    to the component devices which can cause data loss during recovery.
    The journal device is used as writethrough thus causing writes to
    be throttled versus non-journaled raid4/5/6 sets.
    Takeover/reshape is not possible with a raid4/5/6 journal device;
    it has to be deconfigured before requesting these.

[journal_mode &lt;mode&gt;]
    This option sets the caching mode on journaled raid4/5/6 raid sets
    (see &#39;journal_dev &lt;dev&gt;&#39; above) to &#39;writethrough&#39; or &#39;writeback&#39;.
    If &#39;writeback&#39; is selected the journal device has to be resilient
    and must not suffer from the &#39;write hole&#39; problem itself (e.g. use
    raid1 or raid10) to avoid a single point of failure.
</code></pre>
<p>&lt;#raid_devs&gt;: The number of devices composing the array.<br>    Each device consists of two entries.  The first is the device<br>    containing the metadata (if any); the second is the one containing the<br>    data. A Maximum of 64 metadata/data device entries are supported<br>    up to target version 1.8.0.<br>    1.9.0 supports up to 253 which is enforced by the used MD kernel runtime.</p>
<pre><code>If a drive has failed or is missing at creation time, a &#39;-&#39; can be
given for both the metadata and data drives for a given position.
</code></pre>
<h2 id="Example-Tables"><a href="#Example-Tables" class="headerlink" title="Example Tables"></a>Example Tables</h2><h1 id="RAID4-4-data-drives-1-parity-no-metadata-devices"><a href="#RAID4-4-data-drives-1-parity-no-metadata-devices" class="headerlink" title="RAID4 - 4 data drives, 1 parity (no metadata devices)"></a>RAID4 - 4 data drives, 1 parity (no metadata devices)</h1><h1 id="No-metadata-devices-specified-to-hold-superblock-bitmap-info"><a href="#No-metadata-devices-specified-to-hold-superblock-bitmap-info" class="headerlink" title="No metadata devices specified to hold superblock/bitmap info"></a>No metadata devices specified to hold superblock/bitmap info</h1><h1 id="Chunk-size-of-1MiB"><a href="#Chunk-size-of-1MiB" class="headerlink" title="Chunk size of 1MiB"></a>Chunk size of 1MiB</h1><h1 id="Lines-separated-for-easy-reading"><a href="#Lines-separated-for-easy-reading" class="headerlink" title="(Lines separated for easy reading)"></a>(Lines separated for easy reading)</h1><p>0 1960893648 raid <br>        raid4 1 2048 <br>        5 - 8:17 - 8:33 - 8:49 - 8:65 - 8:81</p>
<h1 id="RAID4-4-data-drives-1-parity-with-metadata-devices"><a href="#RAID4-4-data-drives-1-parity-with-metadata-devices" class="headerlink" title="RAID4 - 4 data drives, 1 parity (with metadata devices)"></a>RAID4 - 4 data drives, 1 parity (with metadata devices)</h1><h1 id="Chunk-size-of-1MiB-force-RAID-initialization"><a href="#Chunk-size-of-1MiB-force-RAID-initialization" class="headerlink" title="Chunk size of 1MiB, force RAID initialization,"></a>Chunk size of 1MiB, force RAID initialization,</h1><h1 id="min-recovery-rate-at-20-kiB-sec-disk"><a href="#min-recovery-rate-at-20-kiB-sec-disk" class="headerlink" title="min recovery rate at 20 kiB/sec/disk"></a>min recovery rate at 20 kiB/sec/disk</h1><p>0 1960893648 raid <br>        raid4 4 2048 sync min_recovery_rate 20 <br>        5 8:17 8:18 8:33 8:34 8:49 8:50 8:65 8:66 8:81 8:82</p>
<h2 id="Status-Output"><a href="#Status-Output" class="headerlink" title="Status Output"></a>Status Output</h2><p>‘dmsetup table’ displays the table used to construct the mapping.<br>The optional parameters are always printed in the order listed<br>above with “sync” or “nosync” always output ahead of the other<br>arguments, regardless of the order used when originally loading the table.<br>Arguments that can be repeated are ordered by value.</p>
<p>‘dmsetup status’ yields information on the state and health of the array.<br>The output is as follows (normally a single line, but expanded here for<br>clarity):<br>1: <s> <l> raid <br>2:      <raid_type> &lt;#devices&gt; <health_chars> <br>3:      <sync_ratio> <sync_action> <mismatch_cnt></p>
<p>Line 1 is the standard output produced by device-mapper.<br>Line 2 &amp; 3 are produced by the raid target and are best explained by example:<br>        0 1960893648 raid raid4 5 AAAAA 2/490221568 init 0<br>Here we can see the RAID type is raid4, there are 5 devices - all of<br>which are ‘A’live, and the array is 2/490221568 complete with its initial<br>recovery.  Here is a fuller description of the individual fields:<br>    <raid_type>     Same as the <raid_type> used to create the array.<br>    <health_chars>  One char for each device, indicating: ‘A’ = alive and<br>            in-sync, ‘a’ = alive but not in-sync, ‘D’ = dead/failed.<br>    <sync_ratio>    The ratio indicating how much of the array has undergone<br>            the process described by ‘sync_action’.  If the<br>            ‘sync_action’ is “check” or “repair”, then the process<br>            of “resync” or “recover” can be considered complete.<br>    <sync_action>   One of the following possible states:<br>            idle    - No synchronization action is being performed.<br>            frozen  - The current action has been halted.<br>            resync  - Array is undergoing its initial synchronization<br>                  or is resynchronizing after an unclean shutdown<br>                  (possibly aided by a bitmap).<br>            recover - A device in the array is being rebuilt or<br>                  replaced.<br>            check   - A user-initiated full check of the array is<br>                  being performed.  All blocks are read and<br>                  checked for consistency.  The number of<br>                  discrepancies found are recorded in<br>                  <mismatch_cnt>.  No changes are made to the<br>                  array by this action.<br>            repair  - The same as “check”, but discrepancies are<br>                  corrected.<br>            reshape - The array is undergoing a reshape.<br>    <mismatch_cnt>  The number of discrepancies found between mirror copies<br>            in RAID1/10 or wrong parity values found in RAID4/5/6.<br>            This value is valid only after a “check” of the array<br>            is performed.  A healthy array has a ‘mismatch_cnt’ of 0.<br>    <data_offset>   The current data offset to the start of the user data on<br>            each component device of a raid set (see the respective<br>            raid parameter to support out-of-place reshaping).<br>    <journal_char>    ‘A’ - active write-through journal device.<br>            ‘a’ - active write-back journal device.<br>            ‘D’ - dead journal device.<br>            ‘-‘ - no journal device.</p>
<h2 id="Message-Interface"><a href="#Message-Interface" class="headerlink" title="Message Interface"></a>Message Interface</h2><p>The dm-raid target will accept certain actions through the ‘message’ interface.<br>(‘man dmsetup’ for more information on the message interface.)  These actions<br>include:<br>    “idle”   - Halt the current sync action.<br>    “frozen” - Freeze the current sync action.<br>    “resync” - Initiate/continue a resync.<br>    “recover”- Initiate/continue a recover process.<br>    “check”  - Initiate a check (i.e. a “scrub”) of the array.<br>    “repair” - Initiate a repair of the array.</p>
<h2 id="Discard-Support"><a href="#Discard-Support" class="headerlink" title="Discard Support"></a>Discard Support</h2><p>The implementation of discard support among hardware vendors varies.<br>When a block is discarded, some storage devices will return zeroes when<br>the block is read.  These devices set the ‘discard_zeroes_data’<br>attribute.  Other devices will return random data.  Confusingly, some<br>devices that advertise ‘discard_zeroes_data’ will not reliably return<br>zeroes when discarded blocks are read!  Since RAID 4/5/6 uses blocks<br>from a number of devices to calculate parity blocks and (for performance<br>reasons) relies on ‘discard_zeroes_data’ being reliable, it is important<br>that the devices be consistent.  Blocks may be discarded in the middle<br>of a RAID 4/5/6 stripe and if subsequent read results are not<br>consistent, the parity blocks may be calculated differently at any time;<br>making the parity blocks useless for redundancy.  It is important to<br>understand how your hardware behaves with discards if you are going to<br>enable discards with RAID 4/5/6.</p>
<p>Since the behavior of storage devices is unreliable in this respect,<br>even when reporting ‘discard_zeroes_data’, by default RAID 4/5/6<br>discard support is disabled – this ensures data integrity at the<br>expense of losing some performance.</p>
<p>Storage devices that properly support ‘discard_zeroes_data’ are<br>increasingly whitelisted in the kernel and can thus be trusted.</p>
<p>For trusted devices, the following dm-raid module parameter can be set<br>to safely enable discard support for RAID 4/5/6:<br>    ‘devices_handle_discards_safely’</p>
<h2 id="Version-History"><a href="#Version-History" class="headerlink" title="Version History"></a>Version History</h2><p>1.0.0    Initial version.  Support for RAID 4/5/6<br>1.1.0    Added support for RAID 1<br>1.2.0    Handle creation of arrays that contain failed devices.<br>1.3.0    Added support for RAID 10<br>1.3.1    Allow device replacement/rebuild for RAID 10<br>1.3.2   Fix/improve redundancy checking for RAID10<br>1.4.0    Non-functional change.  Removes arg from mapping function.<br>1.4.1   RAID10 fix redundancy validation checks (commit 55ebbb5).<br>1.4.2   Add RAID10 “far” and “offset” algorithm support.<br>1.5.0   Add message interface to allow manipulation of the sync_action.<br>    New status (STATUSTYPE_INFO) fields: sync_action and mismatch_cnt.<br>1.5.1   Add ability to restore transiently failed devices on resume.<br>1.5.2   ‘mismatch_cnt’ is zero unless [last_]sync_action is “check”.<br>1.6.0   Add discard support (and devices_handle_discard_safely module param).<br>1.7.0   Add support for MD RAID0 mappings.<br>1.8.0   Explictely check for compatible flags in the superblock metadata<br>    and reject to start the raid set if any are set by a newer<br>    target version, thus avoiding data corruption on a raid set<br>    with a reshape in progress.<br>1.9.0   Add support for RAID level takeover/reshape/region size<br>    and set size reduction.<br>1.9.1   Fix activation of existing RAID 4/10 mapped devices<br>1.9.2   Don’t emit ‘- -‘ on the status table line in case the constructor<br>    fails reading a superblock. Correctly emit ‘maj:min1 maj:min2’ and<br>    ‘D’ on the status line.  If ‘- -‘ is passed into the constructor, emit<br>    ‘- -‘ on the table line and ‘-‘ as the status line health character.<br>1.10.0  Add support for raid4/5/6 journal device<br>1.10.1  Fix data corruption on reshape request<br>1.11.0  Fix table line argument order<br>    (wrong raid10_copies/raid10_format sequence)<br>1.12.0  MD deadlock fixes<br>1.13.0  Fix dev_health status at end of “recover” (was ‘a’, now ‘A’)<br>1.13.1  Fix deadlock caused by early md_stop_writes().  Also fix size and<br>        state race<br>1.13.2  Fix raid redundancy validation and avoid keeping raid set frozen<br>1.14.0  Fix reshape race on small devices.  Fix stripe adding reshape<br>    deadlock/potential data corruption.  Update superblock when<br>    specific devices are requested via rebuild.  Fix RAID leg<br>    rebuild errors.</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_dm-raid/" title="Kernel-3.10.0-957.el7_dm-rai" target="_blank" rel="external">http://www.oostech.com/2021/03/13/Kernel-3.10.0-957.el7_dm-raid/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">oosTech by Sam Lee</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/03/13/Kernel-3.10.0-957.el7_dma-buf-sharing/" title="Kernel-3.10.0-957.el7_dma-buf-sharing"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/03/13/Kernel-3.10.0-957.el7_descore-readme/" title="Kernel-3.10.0-957.el7_descore-readme"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,wechat"></div>
    
  </div>
  </div>
    <div class="container" align="left">
    <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
      <img src="/images/wechatp.png" itemprop="contentUrl">
      <span>欢迎关注公众号</span>
    </div>
    </div>
</nav>

  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>您能有收获就是我们最大的动力</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码捐赠</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">不管多少都是对分享的肯定</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码捐赠</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://google.com/" target="_blank" title="Google" data-toggle=tooltip data-placement=top><i class="icon icon-google"></i></a></li>
        
        <li><a href="https://twitter.com/" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
	<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" text-align: center >粤ICP备2021024811号</a>
        </div>
<!--    
    <div>
     <img src="/images/logo.png" width="140" height="140">
    </div>
-->
    </div>


        <!-- 不蒜子统计    //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <!--<span id="busuanzi_container_site_pv" style="display:inline;">-->本站总访问量<span id="busuanzi_value_site_pv" style="display:inline;></span>次</span>
        <span class="post-meta-divider">|</span>
  
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>







   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>











</body>
</html>